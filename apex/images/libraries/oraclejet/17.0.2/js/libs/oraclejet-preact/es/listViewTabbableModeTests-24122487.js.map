{"version":3,"file":"listViewTabbableModeTests-24122487.js","sources":["../../src/PRIVATE_List/__tests__/shared/listViewTabbableModeTests.tsx"],"sourcesContent":["import { fireEvent, render, waitFor, screen } from '@testing-library/preact';\nimport { expect } from 'chai';\nimport { VNode } from 'preact';\n\nimport { Metadata } from '../../../UNSAFE_Collection';\nimport userEvent from '@testing-library/user-event';\n\nimport { populateData } from './listViewTestFixtures';\nimport type { Employee } from './listViewTestFixtures';\nimport { getRoot, getContents } from './testHelpers';\n\nexport type Props<K> = {\n  data: { data: Employee<K>; metadata: Metadata<K> }[];\n};\n\ntype TestComponentProps<K extends string | number> = (props: Props<K>) => VNode;\n\nexport const testTabbableMode = (TestComponent: TestComponentProps<any>) => {\n  it('acts as single tab stop in composition', async () => {\n    const data = populateData(100, true) as Employee<string>[];\n    const dataMetadata: { data: Employee<string>; metadata: Metadata<string> }[] = data.map(\n      (data) => {\n        return { data: data, metadata: { key: data.id } };\n      }\n    );\n    render(<TestComponent data={dataMetadata} />);\n    const grid = await getRoot();\n\n    await userEvent.tab();\n    expect(screen.getByText('Preceding Button').matches(':focus')).to.be.true;\n    await userEvent.tab();\n    expect(grid.matches(':focus')).to.be.true;\n    await userEvent.tab();\n    expect(screen.getByText('Following Button').matches(':focus')).to.be.true;\n    await userEvent.tab({ shift: true });\n    expect(grid.matches(':focus')).to.be.true;\n    await userEvent.tab({ shift: true });\n    expect(screen.getByText('Preceding Button').matches(':focus')).to.be.true;\n  });\n\n  it('enters interactive mode with keyboard via F2', async () => {\n    const data = populateData(100, true) as Employee<string>[];\n    const dataMetadata: { data: Employee<string>; metadata: Metadata<string> }[] = data.map(\n      (data) => {\n        return { data: data, metadata: { key: data.id } };\n      }\n    );\n    const view = render(<TestComponent data={dataMetadata} />);\n    const grid = await getRoot();\n\n    // Tab past first button into ListView\n    await userEvent.tab();\n    await userEvent.tab();\n    expect(grid.matches(':focus')).to.be.true;\n\n    view.rerender(<TestComponent data={dataMetadata}></TestComponent>);\n    const firstRowInput = screen.getByTestId('input-0');\n    expect(firstRowInput.getAttribute('tabindex')).equals('-1');\n    fireEvent.keyDown(grid, { key: 'F2' });\n    expect(firstRowInput.getAttribute('tabindex')).equals('0');\n  });\n\n  it('leaves interactive mode with keyboard via ESC', async () => {\n    const data = populateData(100, true) as Employee<string>[];\n    const dataMetadata: { data: Employee<string>; metadata: Metadata<string> }[] = data.map(\n      (data) => {\n        return { data: data, metadata: { key: data.id } };\n      }\n    );\n    render(<TestComponent data={dataMetadata} />);\n    const grid = await getRoot();\n\n    const firstRowInput = screen.getByTestId('input-0');\n    expect(firstRowInput.getAttribute('tabindex')).equals('-1');\n    await userEvent.click(firstRowInput);\n    expect(firstRowInput.getAttribute('tabindex')).equals('0');\n    fireEvent.keyDown(firstRowInput, { key: 'Escape' });\n\n    await waitFor(() => {\n      expect(grid.matches(':focus'), 'active element should be grid').to.be.true;\n    });\n  });\n\n  it('enters interactive mode again with keyboard via arrow keys and F2', async () => {\n    const data = populateData(100, true) as Employee<string>[];\n    const dataMetadata: { data: Employee<string>; metadata: Metadata<string> }[] = data.map(\n      (data) => {\n        return { data: data, metadata: { key: data.id } };\n      }\n    );\n    render(<TestComponent data={dataMetadata} />);\n    const grid = await getRoot();\n    const items = await getContents();\n\n    await userEvent.click(items[0]);\n    fireEvent.keyDown(grid, { key: 'ArrowDown' });\n    const secondRowInput = screen.getByTestId('input-1');\n    expect(secondRowInput.getAttribute('tabindex')).equals('-1');\n    fireEvent.keyDown(grid, { key: 'F2' });\n    expect(secondRowInput.getAttribute('tabindex')).equals('0');\n  });\n\n  it('enters interactive mode with click on input', async () => {\n    const data = populateData(100, true) as Employee<string>[];\n    const dataMetadata: { data: Employee<string>; metadata: Metadata<string> }[] = data.map(\n      (data) => {\n        return { data: data, metadata: { key: data.id } };\n      }\n    );\n    const view = render(<TestComponent data={dataMetadata} />);\n\n    const firstRowInput = screen.getByTestId('input-0');\n    expect(firstRowInput.getAttribute('tabindex')).equals('-1');\n    await userEvent.click(firstRowInput);\n    // NOTE without this rerender the state change doesn't stick\n    view.rerender(<TestComponent data={dataMetadata}></TestComponent>);\n    expect(firstRowInput.getAttribute('tabindex')).equals('0');\n    expect(firstRowInput.matches(':focus')).to.be.true;\n\n    await userEvent.tab();\n    expect(screen.getByTestId('button-0').matches(':focus')).to.be.true;\n  });\n\n  // FIXME: reenable this test once  is fixed\n  xit('leaves interactive mode with click outside', async () => {\n    const data = populateData(100, true) as Employee<string>[];\n    const dataMetadata: { data: Employee<string>; metadata: Metadata<string> }[] = data.map(\n      (data) => {\n        return { data: data, metadata: { key: data.id } };\n      }\n    );\n    const view = render(<TestComponent data={dataMetadata} />);\n\n    const firstRowInput = screen.getByTestId('input-0');\n    expect(firstRowInput.getAttribute('tabindex')).equals('-1');\n    await userEvent.click(firstRowInput);\n    // NOTE without this rerender the state change doesn't stick\n    view.rerender(<TestComponent data={dataMetadata} />);\n    expect(firstRowInput.getAttribute('tabindex')).equals('0');\n    expect(firstRowInput.matches(':focus')).to.be.true;\n    const outsideElement = screen.getByText('Preceding Button');\n    await userEvent.click(outsideElement);\n    expect(outsideElement.matches(':focus')).to.be.true;\n    view.rerender(<TestComponent data={dataMetadata} />);\n    expect(firstRowInput.getAttribute('tabindex')).equals('-1');\n  });\n};\n"],"names":["_jsx"],"mappings":"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"}