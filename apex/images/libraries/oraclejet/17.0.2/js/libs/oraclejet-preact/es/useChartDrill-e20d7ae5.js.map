{"version":3,"file":"useChartDrill-e20d7ae5.js","sources":["../../src/hooks/PRIVATE_useChartDrill/useChartDrill.ts"],"sourcesContent":["/**\n * @license\n * Copyright (c) %FIRST_YEAR% %CURRENT_YEAR%, Oracle and/or its affiliates.\n * Licensed under The Universal Permissive License (UPL), Version 1.0\n * as shown at https://oss.oracle.com/licenses/upl/\n * @ignore\n */\n\nimport { Ref, useCallback } from 'preact/hooks';\nimport { getInfo } from '../../utils/UNSAFE_visUtils';\nimport {\n  ChartItemData,\n  ChartGroupInfo,\n  Info,\n  Group,\n  GroupDetail,\n  ItemDetail\n} from '../../utils/UNSAFE_visTypes/chart';\nimport { useVisDrill } from '#hooks/PRIVATE_useVisDrill';\n\ntype DrillEventsProps<K, D> = {\n  rootRef: Ref<HTMLDivElement>;\n  groups: Group[];\n  focusedItemInfo: Info;\n  focusedGroupInfo: ChartGroupInfo;\n  selectionMode: 'none' | 'single' | 'multiple';\n  getDataItem: (seriesIndex: number, groupIndex: number) => D | undefined;\n  drilling: 'on' | 'groupsOnly' | 'off';\n  onItemDrill?: (detail: ItemDetail<K, D>) => void;\n  onGroupDrill?: (detail: GroupDetail) => void;\n};\n\nconst isDrillable = <K, D extends ChartItemData<K>>(\n  info: { seriesIndex?: number; groupIndex?: number },\n  drilling: 'on' | 'groupsOnly' | 'off',\n  groups: Group[],\n  getDataItem: (seriesIndex: number, groupIndex: number) => D | undefined\n) => {\n  const { seriesIndex, groupIndex } = info;\n\n  if (groupIndex === undefined) {\n    return false;\n  }\n\n  if (seriesIndex != null) {\n    const itemDrilling = getDataItem(seriesIndex, groupIndex)?.drilling != 'off';\n    return drilling === 'on' && itemDrilling;\n  } else {\n    return groups[groupIndex].drilling != 'off';\n  }\n};\n\n/**\n * Returns the event handlers for drill support.\n */\nexport function useChartDrill<K, D extends ChartItemData<K>>({\n  rootRef,\n  focusedItemInfo,\n  focusedGroupInfo,\n  groups,\n  selectionMode,\n  drilling,\n  getDataItem,\n  onItemDrill,\n  onGroupDrill\n}: DrillEventsProps<K, D>) {\n  const processDrill = useCallback(\n    (info?: { seriesIndex?: number; groupIndex?: number }) => {\n      if (\n        !info ||\n        info.groupIndex == undefined ||\n        !isDrillable(info, drilling, groups, getDataItem)\n      ) {\n        return;\n      }\n\n      const { seriesIndex, groupIndex } = info;\n\n      if (seriesIndex != null) {\n        const data = getDataItem(seriesIndex, groupIndex);\n        if (data) {\n          onItemDrill?.({\n            groupIndex,\n            seriesIndex,\n            data,\n            id: data?.id\n          });\n        }\n      } else {\n        onGroupDrill?.({\n          groupIndex,\n          group: groups[groupIndex],\n          id: groups[groupIndex].id\n        });\n      }\n    },\n    [drilling, getDataItem, groups, onGroupDrill, onItemDrill]\n  );\n\n  const onDrill = useCallback(\n    (event: Event) => {\n      if (event.type === 'keydown') {\n        const focusedInfo = focusedItemInfo.isCurrent ? focusedItemInfo : focusedGroupInfo;\n        processDrill(focusedInfo);\n      } else {\n        processDrill(getInfo(rootRef, event.target as HTMLElement));\n      }\n    },\n    [rootRef, focusedItemInfo, focusedGroupInfo, processDrill]\n  );\n\n  return useVisDrill(selectionMode, onDrill);\n}\n"],"names":[],"mappings":";;;;;;AAAA;;;;;;AAMG;AA0BH,MAAM,WAAW,GAAG,CAClB,IAAmD,EACnD,QAAqC,EACrC,MAAe,EACf,WAAuE,KACrE;AACF,IAAA,MAAM,EAAE,WAAW,EAAE,UAAU,EAAE,GAAG,IAAI,CAAC;AAEzC,IAAA,IAAI,UAAU,KAAK,SAAS,EAAE;AAC5B,QAAA,OAAO,KAAK,CAAC;KACd;AAED,IAAA,IAAI,WAAW,IAAI,IAAI,EAAE;AACvB,QAAA,MAAM,YAAY,GAAG,WAAW,CAAC,WAAW,EAAE,UAAU,CAAC,EAAE,QAAQ,IAAI,KAAK,CAAC;AAC7E,QAAA,OAAO,QAAQ,KAAK,IAAI,IAAI,YAAY,CAAC;KAC1C;SAAM;QACL,OAAO,MAAM,CAAC,UAAU,CAAC,CAAC,QAAQ,IAAI,KAAK,CAAC;KAC7C;AACH,CAAC,CAAC;AAEF;;AAEG;AACG,SAAU,aAAa,CAAgC,EAC3D,OAAO,EACP,eAAe,EACf,gBAAgB,EAChB,MAAM,EACN,aAAa,EACb,QAAQ,EACR,WAAW,EACX,WAAW,EACX,YAAY,EACW,EAAA;AACvB,IAAA,MAAM,YAAY,GAAG,WAAW,CAC9B,CAAC,IAAoD,KAAI;AACvD,QAAA,IACE,CAAC,IAAI;YACL,IAAI,CAAC,UAAU,IAAI,SAAS;YAC5B,CAAC,WAAW,CAAC,IAAI,EAAE,QAAQ,EAAE,MAAM,EAAE,WAAW,CAAC,EACjD;YACA,OAAO;SACR;AAED,QAAA,MAAM,EAAE,WAAW,EAAE,UAAU,EAAE,GAAG,IAAI,CAAC;AAEzC,QAAA,IAAI,WAAW,IAAI,IAAI,EAAE;YACvB,MAAM,IAAI,GAAG,WAAW,CAAC,WAAW,EAAE,UAAU,CAAC,CAAC;YAClD,IAAI,IAAI,EAAE;AACR,gBAAA,WAAW,GAAG;oBACZ,UAAU;oBACV,WAAW;oBACX,IAAI;oBACJ,EAAE,EAAE,IAAI,EAAE,EAAE;AACb,iBAAA,CAAC,CAAC;aACJ;SACF;aAAM;AACL,YAAA,YAAY,GAAG;gBACb,UAAU;AACV,gBAAA,KAAK,EAAE,MAAM,CAAC,UAAU,CAAC;AACzB,gBAAA,EAAE,EAAE,MAAM,CAAC,UAAU,CAAC,CAAC,EAAE;AAC1B,aAAA,CAAC,CAAC;SACJ;AACH,KAAC,EACD,CAAC,QAAQ,EAAE,WAAW,EAAE,MAAM,EAAE,YAAY,EAAE,WAAW,CAAC,CAC3D,CAAC;AAEF,IAAA,MAAM,OAAO,GAAG,WAAW,CACzB,CAAC,KAAY,KAAI;AACf,QAAA,IAAI,KAAK,CAAC,IAAI,KAAK,SAAS,EAAE;AAC5B,YAAA,MAAM,WAAW,GAAG,eAAe,CAAC,SAAS,GAAG,eAAe,GAAG,gBAAgB,CAAC;YACnF,YAAY,CAAC,WAAW,CAAC,CAAC;SAC3B;aAAM;YACL,YAAY,CAAC,OAAO,CAAC,OAAO,EAAE,KAAK,CAAC,MAAqB,CAAC,CAAC,CAAC;SAC7D;KACF,EACD,CAAC,OAAO,EAAE,eAAe,EAAE,gBAAgB,EAAE,YAAY,CAAC,CAC3D,CAAC;AAEF,IAAA,OAAO,WAAW,CAAC,aAAa,EAAE,OAAO,CAAC,CAAC;AAC7C;;;;"}