{"version":3,"file":"useVisHover-d7a0b2f3.js","sources":["../../src/hooks/PRIVATE_useVisHover/useVisHover.ts"],"sourcesContent":["/**\n * @license\n * Copyright (c) %FIRST_YEAR% %CURRENT_YEAR%, Oracle and/or its affiliates.\n * Licensed under The Universal Permissive License (UPL), Version 1.0\n * as shown at https://oss.oracle.com/licenses/upl/\n * @ignore\n */\n\nimport { useState, useRef, useCallback } from 'preact/hooks';\n\nconst TOUCH_HOLD_THRESHOLD_MS = 200;\n\n/**\n * Returns the event handlers for visualization hover gestures.\n */\nexport function useVisHover(\n  onHover: (event: PointerEvent) => void,\n  onHoverEnter?: (event: PointerEvent, currentTarget: HTMLElement) => void,\n  onHoverLeave?: () => void,\n  touchResponse: 'touchStart' | 'touchHold' = 'touchStart',\n  isDisabled = false\n) {\n  const [isTouchHovering, setIsTouchHovering] = useState(false);\n  const touchTimeoutId = useRef<ReturnType<typeof setTimeout>>();\n\n  const onTouchMove = useCallback(\n    (event: TouchEvent) => {\n      // Disable browser handling of touch gestures such as panning.\n      if (isTouchHovering) event.preventDefault();\n    },\n    [isTouchHovering]\n  );\n\n  const onPointerDown = useCallback(\n    (event: PointerEvent) => {\n      if (event.pointerType === 'touch') {\n        // useDatatip currently depends on event.currentTarget during onHoverEnter\n        // On 'touchHold', the event.currentTarget would be accessed in a setTimeout,\n        // at which point it becomes null.\n        // Solution for now is to store the currentTarget upfront and pass it as an\n        // argument to onHoverEnter.\n        // TODO: JET-68292 to improve this.\n        const currentTarget = event.currentTarget as HTMLElement;\n        const initiateTouchHover = () => {\n          setIsTouchHovering(true);\n          onHoverEnter?.(event, currentTarget);\n          onHover(event);\n          if ((event.target as Element).hasPointerCapture(event.pointerId)) {\n            (event.target as Element).releasePointerCapture(event.pointerId);\n          }\n        };\n        if (touchResponse === 'touchHold') {\n          touchTimeoutId.current = setTimeout(initiateTouchHover, TOUCH_HOLD_THRESHOLD_MS);\n        } else {\n          initiateTouchHover();\n        }\n      }\n    },\n    [onHoverEnter, onHover, touchResponse]\n  );\n\n  const onPointerMove = useCallback(\n    (event: PointerEvent) => {\n      if (event.pointerType === 'touch' && !isTouchHovering) return;\n      onHover(event);\n    },\n    [onHover, isTouchHovering]\n  );\n\n  const onPointerUp = useCallback(\n    (event: PointerEvent) => {\n      if (event.pointerType === 'touch') {\n        clearTimeout(touchTimeoutId.current);\n        touchTimeoutId.current = undefined;\n        if (isTouchHovering) onHoverLeave?.();\n        setIsTouchHovering(false);\n      }\n    },\n    [onHoverLeave, isTouchHovering]\n  );\n\n  const onPointerEnter = useCallback(\n    (event: PointerEvent) => {\n      if (event.pointerType === 'touch' && !isTouchHovering) return;\n      onHoverEnter?.(event, event.currentTarget as HTMLElement);\n    },\n    [onHoverEnter, isTouchHovering]\n  );\n\n  const onPointerLeave = useCallback(\n    (event: PointerEvent) => {\n      if (event.pointerType === 'touch' && !isTouchHovering) return;\n      onHoverLeave?.();\n    },\n    [onHoverLeave, isTouchHovering]\n  );\n\n  const onPointerCancel = useCallback(\n    (event: PointerEvent) => {\n      if (event.pointerType === 'touch' && !isTouchHovering) {\n        clearTimeout(touchTimeoutId.current);\n        touchTimeoutId.current = undefined;\n      }\n    },\n    [isTouchHovering]\n  );\n\n  return isDisabled\n    ? {}\n    : {\n        onTouchMove,\n        onPointerDown,\n        onPointerUp,\n        onPointerMove,\n        onPointerEnter,\n        onPointerLeave,\n        onPointerCancel\n      };\n}\n"],"names":[],"mappings":"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"}