{"version":3,"file":"usePopupAnimation-4be04290.js","sources":["../../src/UNSAFE_Popup/usePopupAnimation.ts"],"sourcesContent":["import { Placement, Floating } from '../UNSAFE_Floating';\nimport {\n  useAnimationStatus,\n  AnimationStatus,\n  AnimationStatusProps,\n  AnimationStates\n} from '../hooks/PRIVATE_useAnimationStatus';\nimport { useUser } from '../hooks/UNSAFE_useUser';\nimport { useEffect, useCallback, useState } from 'preact/hooks';\nimport { getTransformOrigin } from '../utils/PRIVATE_popupAnimationUtils';\nimport { ComponentProps } from 'preact';\n\n/**\n * The placement and direction aware HTML element\n * The useAnimation hook do not allow to change dynamically the animation states,\n * but allows a function that returns animation states config. The function takes\n * the animated node of type <E extends HTMLElement> as an argument. This could be used\n * to extend HTMLElement with placement and direction.\n */\nexport type AnimationPopupElement = HTMLElement & {\n  placement?: Placement;\n  direction?: 'ltr' | 'rtl';\n};\n\ntype PopupAnimationProps = Omit<AnimationStatusProps, 'animationStates'> & {\n  /**\n   * Specifies placement of the Popup relative to the anchor.\n   */\n  placement: Placement;\n\n  /**\n   * animationStates is the configuration of the animations, how the element should be animated\n   */\n  animationStates?: AnimationStates;\n\n  /**\n   * Triggered when placement or coordinates are changed after collision is detected\n   */\n  onPosition?: ComponentProps<typeof Floating>['onPosition'];\n};\n\nconst animationStates = {\n  opening: (node: AnimationPopupElement) => {\n    return {\n      //zoomIn\n      from: {\n        scaleX: 0,\n        scaleY: 0,\n        opacity: 0,\n        transformOrigin: getTransformOrigin(node.placement, node.direction)\n      },\n      to: {\n        scaleX: 1,\n        scaleY: 1,\n        opacity: 1,\n        transformOrigin: getTransformOrigin(node.placement, node.direction)\n      },\n      options: {\n        duration: 200\n      }\n    };\n  },\n  closing: (node: AnimationPopupElement) => {\n    return {\n      //zoomOut\n      from: {\n        scaleX: 1,\n        scaleY: 1,\n        opacity: 1,\n        transformOrigin: getTransformOrigin(node.placement, node.direction)\n      },\n      to: {\n        scaleX: 0,\n        scaleY: 0,\n        opacity: 0,\n        transformOrigin: getTransformOrigin(node.placement, node.direction)\n      },\n      options: {\n        duration: 200\n      }\n    };\n  }\n};\n\nexport function usePopupAnimation(props: PopupAnimationProps): {\n  status: AnimationStatus;\n  setAnimationElementRef: (node: HTMLElement | null) => void;\n  onPosition: ComponentProps<typeof Floating>['onPosition'];\n} {\n  const {\n    isOpen,\n    isAnimatedOnMount,\n    onTransitionEnd,\n    placement,\n    animationStates: propsAnimationStates,\n    onPosition\n  } = props;\n\n  //The animationPlacement is used for the case of flipping.\n  const [animationPlacement, setAnimationPlacement] = useState<Placement>(placement);\n  const { direction } = useUser();\n  const { setAnimationElementRef, animationElementRef, status } =\n    useAnimationStatus<AnimationPopupElement>({\n      isOpen: isOpen,\n      isAnimatedOnMount: isAnimatedOnMount,\n      animationStates: propsAnimationStates ?? animationStates,\n      onTransitionEnd\n    });\n  const popupElementRef = animationElementRef;\n\n  const onPositionAnimated = useCallback<Required<ComponentProps<typeof Floating>>['onPosition']>(\n    (data) => {\n      if (placement !== data.placement) {\n        if (popupElementRef.current !== null) {\n          // if flips happens we need to change the placement in the animations.\n          // There are cases where animation is done before even running the useEffect below. Due to that we update current placement of the node here\n          popupElementRef.current.placement = data.placement;\n        }\n        setAnimationPlacement(data.placement);\n      }\n      onPosition?.(data);\n    },\n    [onPosition, placement, popupElementRef]\n  );\n\n  //This is needed for the case if popup flips and changes the placement.\n  useEffect(() => {\n    if (popupElementRef != null && popupElementRef.current != null && status != 'unmounted') {\n      if (popupElementRef.current.placement !== animationPlacement) {\n        popupElementRef.current.placement = animationPlacement;\n      }\n      popupElementRef.current.direction = direction;\n    }\n  }, [popupElementRef, animationPlacement, direction, status]);\n  return { setAnimationElementRef, status, onPosition: onPositionAnimated };\n}\n"],"names":[],"mappings":"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"}