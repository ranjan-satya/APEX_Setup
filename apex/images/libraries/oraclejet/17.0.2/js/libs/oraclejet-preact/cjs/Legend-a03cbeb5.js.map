{"version":3,"file":"Legend-a03cbeb5.js","sources":["../../src/UNSAFE_Legend/legendNavUtils.ts","../../src/UNSAFE_Legend/Legend.tsx"],"sourcesContent":["/**\n * @license\n * Copyright (c) %FIRST_YEAR% %CURRENT_YEAR%, Oracle and/or its affiliates.\n * The Universal Permissive License (UPL), Version 1.0\n * as shown at https://oss.oracle.com/licenses/upl/\n * @ignore\n */\n\nimport {\n  ItemActionDetail,\n  ItemFocusDetail,\n  ItemHoverDetail,\n  ItemInfo,\n  LegendItemData\n} from '../utils/UNSAFE_visTypes/legend';\n\nfunction getItem<K, D extends LegendItemData<K>>(itemInfo: ItemInfo, items: D[]) {\n  const { itemIdx } = itemInfo;\n\n  if (itemIdx == -1) {\n    return items[items.length - 1];\n  }\n  return items[itemIdx];\n}\n\nfunction getNextItemInfo<K>(itemInfo: ItemInfo, items: LegendItemData<K>[]) {\n  let itemIdx = itemInfo.itemIdx;\n\n  if (itemIdx == -1) {\n    itemIdx = items.length - 1;\n  }\n\n  itemIdx = Math.min(items.length - 1, itemIdx + 1);\n  if (items[itemIdx].actionable !== 'off') {\n    return { sectionIdx: 0, itemIdx };\n  } else if (itemIdx === items.length - 1) {\n    itemIdx = itemIdx - 1;\n    return { sectionIdx: 0, itemIdx };\n  }\n\n  return getNextItemInfo({ sectionIdx: 0, itemIdx }, items);\n}\n\nfunction getPrevItemInfo<K>(itemInfo: ItemInfo, items: LegendItemData<K>[]) {\n  let itemIdx = itemInfo.itemIdx;\n\n  if (itemIdx == -1) {\n    itemIdx = items.length - 1;\n  }\n\n  itemIdx = Math.max(0, itemIdx - 1);\n  if (items[itemIdx].actionable !== 'off') {\n    return { sectionIdx: 0, itemIdx };\n  }\n\n  return getPrevItemInfo({ sectionIdx: 0, itemIdx }, items);\n}\n\n/**\n * Returns utils functions for navigation in simple legend.\n * @param items\n * @returns\n */\nexport function getLegendNavUtils<K extends string | number, D extends LegendItemData<K>>(\n  items: D[]\n) {\n  return {\n    getItem: (itemInfo: ItemInfo) => {\n      return getItem(itemInfo, items);\n    },\n    getDetailFromInfo: (\n      itemInfo?: ItemInfo\n    ): ItemFocusDetail<K, D> | ItemHoverDetail<K, D> | ItemActionDetail<K, D> => {\n      if (!itemInfo) {\n        return { itemId: undefined, data: undefined };\n      }\n      const item = getItem(itemInfo, items);\n      return { itemId: item.id, data: item };\n    },\n    getPrevItemInfo: (itemInfo: ItemInfo) => {\n      return getPrevItemInfo(itemInfo, items);\n    },\n    getNextItemInfo: (itemInfo: ItemInfo) => {\n      return getNextItemInfo(itemInfo, items);\n    }\n  };\n}\n","/**\n * @license\n * Copyright (c) %FIRST_YEAR% %CURRENT_YEAR%, Oracle and/or its affiliates.\n * The Universal Permissive License (UPL), Version 1.0\n * as shown at https://oss.oracle.com/licenses/upl/\n * @ignore\n */\n\nimport { useRef } from 'preact/hooks';\nimport { BaseLegend } from '../PRIVATE_BaseLegend/BaseLegend';\nimport { useVisEvent } from '../hooks/PRIVATE_useVisEvents/useVisEvents';\nimport { LegendProps } from './legend.type';\nimport { getLegendNavUtils } from './legendNavUtils';\nimport {\n  getAriaProps,\n  getDatatipText,\n  getGridNums,\n  getIsLegendItemActionable,\n  getItemInfo,\n  getLegendTextStyle,\n  isEqualItem\n} from '../utils/PRIVATE_legendUtils/legendUtils';\nimport { mergeProps } from '../utils/UNSAFE_mergeProps';\nimport { useLegendDatatip } from './useLegendDatatip';\nimport { useItemFocus } from '../hooks/PRIVATE_useVisEvents';\nimport { useLegendLayout } from './useLegendLayout';\nimport { styles } from './themes/LegendStyles.css';\nimport { useCssVars } from '../hooks/PRIVATE_useCssVars';\nimport { legendVars, getKeyUpHandler } from '../utils/PRIVATE_legendUtils/legendUtils';\nimport { classNames } from '../utils/UNSAFE_classNames';\nimport { useTestId } from '../hooks/UNSAFE_useTestId';\nimport { useLegendContextMenu } from '../PRIVATE_BaseLegend/useLegendContextMenu';\nimport {\n  ItemFocusDetail,\n  ItemActionDetail,\n  ItemInfo,\n  LegendItemData\n} from '../utils/UNSAFE_visTypes/legend';\nimport { useVisTouchResponse } from '#hooks/PRIVATE_useVisTouchResponse';\nimport { merge } from '#utils/UNSAFE_stringUtils';\n\n/**\n * A legend displays an interactive description of symbols, colors, etc., used in graphical information representations.\n */\nexport function Legend<K extends string | number, D extends LegendItemData<K> = LegendItemData<K>>({\n  orientation = 'horizontal',\n  items,\n  isReadOnly = true,\n  onItemAction,\n  onItemHover,\n  onItemFocus,\n  testId,\n  contextMenuConfig,\n  hideAndShowBehavior = 'off',\n  hoverBehavior = 'none',\n  ...props\n}: LegendProps<K, D>) {\n  const testIdProps = useTestId(testId);\n  const rootRef = useRef<HTMLDivElement>(null);\n  const rootDimsRef = useRef<DOMRect>();\n  const { getItem, getDetailFromInfo, getPrevItemInfo, getNextItemInfo } = getLegendNavUtils<K, D>(\n    items\n  );\n  const { resolvedVars, cssContent } = useCssVars(legendVars);\n  const legendFontStylesObj = getLegendTextStyle(\n    {\n      fontStyle: props.textFontStyle,\n      fontSize: props.textFontSize?.toString(),\n      fontWeight: props.textFontWeight?.toString(),\n      fontFamily: props.textFontFamily\n    },\n    resolvedVars\n  );\n\n  const isLegendItemActionable = getIsLegendItemActionable(items, isReadOnly);\n\n  const { textMeasureContent, layoutInfo } = useLegendLayout({\n    resolvedVars,\n    items,\n    rootRef,\n    rootDimsRef,\n    orientation,\n    legendFontStylesObj,\n    symbolWidth: props.symbolWidth\n  });\n\n  const legendKeyUpHandler = (\n    triggerOnAction: () => void,\n    updatefocusedItemInfo: (itemInfo: ItemInfo) => void,\n    focusedItemInfo: ItemInfo\n  ) =>\n    getKeyUpHandler(\n      triggerOnAction,\n      updatefocusedItemInfo,\n      focusedItemInfo,\n      props.hiddenIds != null\n    );\n\n  const { touchResponse, touchResponseStyle } = useVisTouchResponse({ type: 'touchStart' });\n\n  //shall we put the below useEvent specific snipped in a useLegendEvents?\n  const { focusedItemInfo, hoveredItemInfo, onContextMenuDismissed, activeId, eventsProps } =\n    useVisEvent<ItemInfo, ItemActionDetail<K, D>, ItemFocusDetail<K, D>, D>(\n      touchResponse,\n      !isReadOnly,\n      isLegendItemActionable,\n      legendKeyUpHandler,\n      getDetailFromInfo,\n      getPrevItemInfo,\n      getNextItemInfo,\n      onItemAction,\n      onItemHover,\n      onItemFocus,\n      isEqualItem,\n      getItemInfo,\n      { itemIdx: 0, sectionIdx: 0 },\n      props.hiddenIds != null\n    );\n\n  const { focusedItemRef } = useItemFocus(focusedItemInfo);\n  const datatipText = getDatatipText(items, getItem, focusedItemInfo, hoveredItemInfo);\n  const {\n    datatipContent,\n    datatipProps: { 'aria-describedby': datatipAriaDescribedby, ...datatipProps }\n  } = useLegendDatatip({\n    text: datatipText,\n    rootDimsRef,\n    focusedItemInfo,\n    focusedItemRef,\n    touchResponse\n  });\n\n  const ariaProps = getAriaProps<K>(\n    isReadOnly,\n    props['aria-label'],\n    props.hiddenIds,\n    merge([props['aria-describedby'], datatipAriaDescribedby]),\n    props['aria-labelledby']\n  );\n\n  const { contextMenuContent, contextMenuProps } = useLegendContextMenu<K, D>({\n    rootRef,\n    contextMenuConfig,\n    focusedItemInfo,\n    items,\n    isReadOnly,\n    onContextMenuDismissed\n  });\n\n  const mergedProps = mergeProps(eventsProps, datatipProps, contextMenuProps);\n  const { itemsPerCol, itemsPerRow } = getGridNums(items.length, layoutInfo);\n  const { legendStyle, renderedLegendStyle, preRenderedLegendStyle } = styles;\n  const canRender = orientation === 'vertical' || !!layoutInfo;\n  return (\n    <div\n      ref={rootRef}\n      tabIndex={isReadOnly ? undefined : 0}\n      role=\"application\"\n      class={classNames([legendStyle, canRender ? renderedLegendStyle : preRenderedLegendStyle])}\n      style={touchResponseStyle}\n      {...testIdProps}\n      {...ariaProps}\n      {...mergedProps}\n      aria-activedescendant={activeId}>\n      {canRender ? (\n        <BaseLegend\n          {...props}\n          focusedItemRef={focusedItemRef}\n          items={items}\n          isReadOnly={isReadOnly}\n          orientation={orientation}\n          sectionIdx={0}\n          itemsPerRow={itemsPerRow}\n          itemsPerCol={itemsPerCol}\n          itemWidth={layoutInfo?.isWrapped ? layoutInfo?.maxItemWidth : undefined}\n          focusedItemInfo={focusedItemInfo}\n          hoveredItemInfo={hoveredItemInfo}\n          activeId={activeId}\n          hideAndShowBehavior={hideAndShowBehavior}\n          hoverBehavior={hoverBehavior}\n        />\n      ) : null}\n      {datatipContent}\n      {textMeasureContent}\n      {cssContent}\n      {contextMenuContent}\n    </div>\n  );\n}\n"],"names":["useTestId","useRef","useCssVars","legendVars","getLegendTextStyle","getIsLegendItemActionable","useLegendLayout","getKeyUpHandler","useVisTouchResponse","useVisEvent","isEqualItem","getItemInfo","useItemFocus","getDatatipText","useLegendDatatip","getAriaProps","merge","useLegendContextMenu","mergeProps","getGridNums","styles","_jsxs","classNames","_jsx","BaseLegend"],"mappings":"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"}