{"version":3,"file":"useChartDatatip-b6b2b00a.js","sources":["../../src/utils/PRIVATE_chartUtils/dataTipUtils.tsx","../../src/hooks/PRIVATE_useChartDatatip/useChartDatatip.tsx"],"sourcesContent":["/**\n * @license\n * Copyright (c) %FIRST_YEAR% %CURRENT_YEAR%, Oracle and/or its affiliates.\n * Licensed under The Universal Permissive License (UPL), Version 1.0\n * as shown at https://oss.oracle.com/licenses/upl/\n * @ignore\n */\n\nimport { ChartItemData, ChartSeriesData, ValueFormats, Group } from '../UNSAFE_visTypes/chart';\nimport { VisTabularDatatip } from '../../PRIVATE_VisTabularDatatip';\nimport { TableRowData } from '../../PRIVATE_VisTabularDatatip';\n\n/**\n * Returns the data required for the VisTabularDatatip to render.\n * @param activeInfo active item info.\n * @param series The array of chart series.\n * @param groups The array of chart groups.\n * @param valueFormats The array of chart series.\n * @param getDataItem function which returns chartItem\n */\nexport function getChartTabularData<K, D extends ChartItemData<K>>(\n  data: D,\n  seriesValue: string,\n  groupValue: string,\n  valueFormats?: ValueFormats,\n  isTimeAxis?: boolean\n) {\n  //TODO: Use translation strings\n  const value = data.value;\n  const itemValue = valueFormats?.value?.format ? valueFormats?.value?.format?.(value) : value;\n  const tableData: TableRowData[] = [];\n\n  if (valueFormats?.series?.isDisplayed != false) {\n    tableData.push({\n      key: valueFormats?.series?.label || 'Series',\n      value: seriesValue\n    });\n  }\n  if (valueFormats?.group?.isDisplayed != false) {\n    tableData.push({\n      key: valueFormats?.group?.label || (isTimeAxis ? 'Date' : 'Group'),\n      value: groupValue\n    });\n  }\n  if (valueFormats?.value?.isDisplayed != false) {\n    tableData.push({ key: valueFormats?.value?.label || 'Value', value: itemValue });\n  }\n  return tableData;\n}\n\nexport function getDefaultDatatipRenderer<\n  K extends string | number,\n  D extends ChartItemData<K>\n>(options: {\n  series: ChartSeriesData<K, D>;\n  groups: Group;\n  valueFormats?: ValueFormats;\n  timeAxisType?: 'mixedFrequency' | 'enabled' | 'skipGaps';\n}) {\n  const isMixedFrequency = options.timeAxisType === 'mixedFrequency';\n  const isRegularTimeAxis =\n    options.timeAxisType === 'enabled' || options.timeAxisType === 'skipGaps';\n\n  return (context: { data: D }) => {\n    const groupValue = options.groups.name || options.groups.id;\n    const timeValue = isMixedFrequency\n      ? context.data.x\n      : isRegularTimeAxis\n      ? groupValue\n      : undefined;\n    return {\n      content: (\n        <VisTabularDatatip\n          tableData={getChartTabularData<K, D>(\n            context.data,\n            options.series.name || options.series.id.toString(),\n            timeValue || options.groups.name || options.groups.id,\n            options.valueFormats,\n            options.timeAxisType != null\n          )}\n        />\n      ),\n      borderColor: context.data.color || options.series.color\n    };\n  };\n}\n","/**\n * @license\n * Copyright (c) %FIRST_YEAR% %CURRENT_YEAR%, Oracle and/or its affiliates.\n * Licensed under The Universal Permissive License (UPL), Version 1.0\n * as shown at https://oss.oracle.com/licenses/upl/\n * @ignore\n */\nimport { ComponentChildren } from 'preact';\nimport { calculateOffset, useDatatip } from '../PRIVATE_useDatatip';\nimport {\n  DataCursorPosition,\n  Group,\n  ChartItemData,\n  Info,\n  Scale,\n  ValueFormats\n} from '../../utils/UNSAFE_visTypes/chart';\nimport { BarSeriesData } from '../../UNSAFE_BarChart/barChart.types';\nimport { Dimension } from '../../utils/UNSAFE_visTypes/common';\nimport { getDefaultDatatipRenderer } from '../../utils/PRIVATE_chartUtils/dataTipUtils';\nimport { LineAreaSeriesData } from '../../UNSAFE_LineAreaChart/lineAreaChart.types';\nimport { getColorRamp } from '../../utils/UNSAFE_visUtils';\nimport { Placement } from '../../UNSAFE_Floating';\nimport { useUser } from '../../hooks/UNSAFE_useUser';\nimport { Property } from 'csstype';\n\ntype Props<K extends string | number, D extends ChartItemData<K>> = {\n  series: (BarSeriesData<K, D> | LineAreaSeriesData<K, D>)[];\n  groups: Group[];\n  isDataCursorEnabled?: boolean;\n  dataCursorPosition?: DataCursorPosition;\n  isHoriz: boolean;\n  getDataItemPos: (seriesIndex: number, groupIndex: number) => Dimension | undefined;\n  datatip?: (context: { data: D; seriesIndex: number; groupIndex: number; id: K }) => {\n    content: ComponentChildren;\n    borderColor?: Property.BorderColor;\n  };\n  xScale: Scale;\n  getDataItem: (seriesIndex: number, groupIndex: number) => D | undefined;\n  hoveredItemInfo?: Info;\n  focusedItemInfo?: Info;\n  width: number;\n  height: number;\n  valueFormats?: ValueFormats;\n  findNearest: (x: number, y: number) => any;\n  timeAxisType?: 'mixedFrequency' | 'skipGaps' | 'enabled';\n  touchResponse: 'touchStart' | 'touchHold';\n  isDisabled: boolean;\n};\nconst DATA_CURSOR_OFFSET = 10;\n\nexport const useChartDatatip = <K extends string | number, D extends ChartItemData<K>>({\n  isDataCursorEnabled,\n  dataCursorPosition,\n  isHoriz,\n  datatip,\n  xScale,\n  getDataItem,\n  getDataItemPos,\n  hoveredItemInfo,\n  focusedItemInfo,\n  series,\n  valueFormats,\n  groups,\n  width,\n  height,\n  findNearest,\n  timeAxisType,\n  touchResponse,\n  isDisabled\n}: Props<K, D>) => {\n  let activeInfo = !isDisabled\n    ? focusedItemInfo?.isCurrent\n      ? focusedItemInfo\n      : hoveredItemInfo?.isCurrent &&\n        hoveredItemInfo.seriesIndex !== undefined &&\n        hoveredItemInfo.groupIndex !== undefined\n      ? hoveredItemInfo\n      : undefined\n    : undefined;\n\n  const anchor = focusedItemInfo?.isCurrent || isDataCursorEnabled ? 'element' : 'pointer';\n  const elementBounds = focusedItemInfo?.isCurrent\n    ? getDataItemPos(focusedItemInfo.seriesIndex!, focusedItemInfo.groupIndex!)\n    : undefined;\n\n  const { direction } = useUser();\n  const isRtl = direction === 'rtl';\n\n  let placement = 'top-start' as Placement;\n  let offset = calculateOffset(isRtl, width, elementBounds);\n  if (isDataCursorEnabled && dataCursorPosition?.x != null && dataCursorPosition?.y != null) {\n    // TOD0: The offset for data cursor should be calculated according to\n    // datatip content dimensions as well.\n    activeInfo = activeInfo || findNearest?.(dataCursorPosition.x, dataCursorPosition.y);\n    const xPos = xScale.transform(dataCursorPosition.x);\n    offset = { mainAxis: -1, crossAxis: -1 };\n    if (isHoriz) {\n      placement = 'end';\n      offset.mainAxis = -1 * DATA_CURSOR_OFFSET;\n      offset.crossAxis = xPos - height / 2;\n    } else {\n      placement = 'top';\n      offset.crossAxis = isRtl ? width / 2 - xPos : xPos - width / 2;\n      offset.mainAxis = -1 * DATA_CURSOR_OFFSET;\n    }\n  }\n\n  let dtContent;\n  let item: D | undefined;\n  if (activeInfo?.seriesIndex != null && activeInfo?.groupIndex != null) {\n    item = getDataItem(activeInfo.seriesIndex, activeInfo.groupIndex!);\n    const datatipContext = item\n      ? {\n          data: item,\n          seriesIndex: activeInfo.seriesIndex,\n          groupIndex: activeInfo.groupIndex,\n          id: item.id\n        }\n      : undefined;\n\n    if (datatipContext) {\n      const datatipRenderer =\n        datatip ||\n        getDefaultDatatipRenderer({\n          series: series[activeInfo.seriesIndex],\n          groups: groups[activeInfo.groupIndex],\n          valueFormats,\n          timeAxisType\n        });\n      dtContent = datatipRenderer(datatipContext);\n    }\n  }\n  const colors = getColorRamp();\n  const borderColor =\n    dtContent?.borderColor ||\n    (activeInfo &&\n      ((series[activeInfo.seriesIndex!] as BarSeriesData<K, D>).color ||\n        (series[activeInfo.seriesIndex!] as LineAreaSeriesData<K, D>).lineColor ||\n        (series[activeInfo.seriesIndex!] as LineAreaSeriesData<K, D>).areaColor)) ||\n    (activeInfo && colors[activeInfo.seriesIndex! % colors.length]);\n\n  const { datatipContent, datatipProps } = useDatatip({\n    content: dtContent?.content,\n    anchor,\n    placement,\n    offset,\n    borderColor,\n    touchResponse\n  });\n\n  return { datatipContent, datatipProps };\n};\n"],"names":["_jsx"],"mappings":"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"}