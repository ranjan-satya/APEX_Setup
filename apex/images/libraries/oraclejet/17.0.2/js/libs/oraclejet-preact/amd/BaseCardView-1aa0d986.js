define(['exports', 'preact/jsx-runtime', 'preact', 'preact/compat', 'preact/hooks', './mergeProps-bcfa6a92', './keys-cc1cb01d', './collectionUtils-6740111c', './useCurrentKey-00f81f0b', './useCollectionFocusRing-64636529', './useTabbableModeSet-b4c18d1a', './useSelection-f1d96ce9', './LayerHost-eab40731', 'css!./DragAndDropStyles.styles.css', './useReorderableItem-d977f935', 'css!./ReorderableItemStyles.styles.css', './Selector-ad2af152', './HiddenAccessible-037ef42d', './LoadMoreCollection-83413a59', './PRIVATE_BaseCardView/themes/BaseCardViewStyles.css', './classNames-08d99695', './refUtils-d354a169', './logger-0f873e29', './tabbableUtils-62c44f56', './useId-c9578d26', './useAnimation-5bd3adfc', './useResizeObserver-c63865cc', './TabbableModeContext-a9c97640', './FocusTrap-eb3989cb', './useUser-6dd85af9', './Grid-85171367', './Flex-1f27b601', './PRIVATE_BaseCardView/themes/BaseCardViewContract.css', './Skeleton-325116ff', 'module'], (function(e,t,r,o,s,n,a,i,l,c,d,u,y,m,f,g,h,b,x,p,C,S,R,v,E,I,w,T,K,A,j,k,L,M,O){"use strict";function P({currentKey:e,children:r,dragKey:o,setDragKey:n,onReorder:a,rootRef:l,gutterSize:c,columns:d,context:u}){const y=s.useRef(null),m=1===d,g=u.index%d==0,h=u.index%d==d-1,b=p.multiVariantStyles({itemOverlayFront:c}),x=p.multiVariantStyles({itemOverlayFrontVertical:c}),S={itemOverlayFront:m?x:b,itemOverlayRear:m?p.styles.itemOverlayRearVertical:p.styles.itemOverlayRear,itemDragger:p.styles.itemDragger},R=s.useCallback((()=>y?.current?.closest(i.ITEM_SELECTOR)),[]),v=s.useCallback((e=>{e.dataTransfer?.setData("text/cardview-items-key",JSON.stringify(u.metadata.key))}),[u.metadata.key]),{rootProps:E,isDragged:I,overlayZoneBeforeProps:w,overlayZoneAfterProps:T}=f.useReorderableItem({currentKey:e,isDisabled:!a,draggable:!!a,dragKey:o,setDragKey:n,onReorder:a,rootRef:l,ref:y,getItem:R,setTransferData:v,itemStyles:S,itemSelector:i.ITEM_SELECTOR,isVertical:m}),{direction:K}=A.useUser(),j="rtl"===K,k=C.classNames([w?.class,!m&&!j&&g&&p.styles.itemOverlayFrontEdge,!m&&j&&h&&p.styles.itemOverlayFrontEdge]),L=C.classNames([T?.class,!m&&!j&&h&&p.styles.itemOverlayRearEdge,!m&&j&&g&&p.styles.itemOverlayRearEdge]);return t.jsxs("div",{...E,draggable:!1,children:[r,!I&&o&&t.jsxs(t.Fragment,{children:[t.jsx("div",{...w,class:k}),t.jsx("div",{...T,class:L})]})]})}const F=e=>({animationStates:{slideUp:{from:{translateY:"50px"},to:{translateY:"0px"},options:{duration:300,delay:50*e,easing:[0,0,.2,1]}},slideDown:{from:{translateY:"-50px"},to:{translateY:"0"},options:{duration:300,delay:50*e,easing:[0,0,.2,1]}}},isAnimatedOnMount:!0}),V=e=>({animationStates:{opacity:{from:{opacity:0},to:{opacity:1},options:{duration:150,delay:50*e,easing:"linear"}}},isAnimatedOnMount:!0}),D=o.memo((function({children:e,context:r,isTabbable:o,isFocused:n,isFocusRingVisible:a,isSelected:i,selectionMode:l,focusBehavior:c,setIsFocusBehaviorValid:d,initialAnimation:u,isGridLayout:y,updateCardSize:m,reorderItemProps:f}){const g=s.useRef(null),h=r.metadata.key,b=r.index,x=n&&a,A=p.multiVariantStyles({itemFocused:"card"===c&&x?"isItemFocused":"isNotItemFocused",itemInitialOpacity:u?"isTransparent":"isNotTransparent",itemInGridLayout:y?"isInGridLayout":"isNotInGridLayout"}),j=C.classNames([p.styles.itemStyle,A]),k=s.useCallback((e=>{m?.(e.contentRect.width,e.contentRect.height)}),[m]),L=s.useRef(null);w.useResizeObserver(m?g:L,k),s.useLayoutEffect((()=>{if("content"===c&&x){const e=g.current?.firstElementChild?.firstElementChild,t=v.allTabbableElements(e,!0,!0);0===t.length||t.length>1?(R.warn(`${t.length} focusable elements are detected in the card. 'content' focusBehavior is intended only for use when the card has single focusable element. Please specify one focusable element in the card or switch the focusBehavior to 'card'.`),d?.(!1)):t[0].focus()}}),[c,x,d]);const{nodeRef:M,controller:O}=I.useAnimation(u||"none",F(b)),{nodeRef:D,controller:B}=I.useAnimation(u?"opacity":"none",V(b));setTimeout((()=>{O.cancel(),B.cancel()}),1e3);const _=s.useMemo((()=>void 0===u?S.mergeRefs(g):S.mergeRefs(g,M,D)),[g,M,D,u]),z=f?t.jsx(P,{...f,context:r,children:e(r)}):e(r);return t.jsx("div",{id:E.useId(),ref:_,class:j,role:"gridcell","data-oj-key":h,onKeyDown:e=>{"card"!==c||!o||"ArrowDown"!==e.key&&"ArrowUp"!==e.key&&"ArrowLeft"!==e.key&&"ArrowRight"!==e.key||e.stopPropagation()},"aria-selected":"none"===l?void 0:i,..."number"==typeof h&&{"data-oj-key-type":"number"},children:t.jsx(T.TabbableModeContext.Provider,{value:{isTabbable:o},children:t.jsx(K.FocusTrap,{isDisabled:!o,restoreFocusRef:!1,children:z})})})}),((e,t)=>{return!(!e||!t)&&(e.children===t.children&&e.isTabbable===t.isTabbable&&e.isFocused===t.isFocused&&e.isFocusRingVisible===t.isFocusRingVisible&&e.isSelected===t.isSelected&&e.initialAnimation===t.initialAnimation&&e.focusBehavior===t.focusBehavior&&i.compareListItemContext(e.context,t.context)&&(r=e.reorderItemProps,o=t.reorderItemProps,r?.currentKey===o?.currentKey&&r?.dragKey===o?.dragKey&&r?.columns===o?.columns));var r,o}));function B({children:e,layout:r,gutterSize:o,columns:s}){const n=L.cardViewVars.gutterSize[o];return"grid"===r?s<1?null:t.jsx(j.Grid,{gridTemplateColumns:`repeat(${s}, 1fr)`,gap:n,children:e}):t.jsx(k.Flex,{wrap:"wrap",gap:n,children:e})}function _({children:e}){const[o,n]=s.useState(!1);return s.useEffect((()=>{setTimeout((()=>{n(!0)}),50)}),[]),o?t.jsx(r.Fragment,{children:e}):t.jsx("div",{class:x.LOADMORE_STYLE_CLASS})}const z=(e,r=25,o,s,n=!0)=>{const a=o||("flex"===e?"60x":"100%"),i=s||"70x";return[...Array(r)].map(((e,r)=>t.jsx(M.Skeleton,{width:a,height:i},n&&`${r}${(new Date).getTime()}`)))},N=e=>t.jsx(_,{children:z(e.layout)}),U=e=>{const r=[t.jsx("div",{class:x.LOADMORE_STYLE_CLASS,children:z(e.layout,1)}),...z(e.layout,24)];return t.jsx(_,{children:r})},H=()=>t.jsx("div",{class:x.LOADMORE_STYLE_CLASS}),Y=e=>{if(e.colCount<1||null==e.cardWidth||null==e.cardHeight)return t.jsx(H,{});{const r=[],o=e.colCount-e.totalCount%e.colCount,s=o===e.colCount,n=`calc(${e.cardWidth}px)`,a=e.cardHeight?`calc(${e.cardHeight}px)`:"70x",i="flex"===e.layout?n:"100%",l="flex"===e.layout||s?a:"100%",c=t.jsx("div",{class:x.LOADMORE_STYLE_CLASS,children:z(e.layout,1,i,l)});return r.push(c),r.push(z(e.layout,o-1,i,l)),s||r.push(z(e.layout,e.colCount,i,a)),t.jsx(_,{children:r})}},G={all:!1,keys:new Set},$={xs:12,sm:16,md:24,lg:48,xl:64},W=o.forwardRef((({children:e,data:o,onLoadMore:y=(()=>{}),hasMore:m=!1,getRowKey:g,currentKey:C,onCurrentKeyChange:S,selectionMode:R="none",selectedKeys:v=G,onSelectionChange:E,onReorder:I,viewportConfig:w,focusBehavior:T="card","aria-label":K,"aria-labelledby":A,initialAnimation:j="slideUp",gutterSize:k="sm",columns:L,layout:M,cardSize:O,updateCardSize:P},F)=>{const V=s.useRef(null);s.useImperativeHandle(F,(()=>V.current),[V]);const _=s.useRef(),z=s.useRef(),H=$[k],W={layout:M,columns:L,gutterSize:k},Z=s.useRef(!0);s.useEffect((()=>{null!=O.height&&null!=O.width&&(Z.current=!1)}),[O]);const J="none"===R?void 0:"multiple"===R,X=m||!o||L<1?-1:Math.ceil(o?.length/L),q=L<1?-1:L,[Q,ee]=s.useState(!0),te=Q?T:"card",re=s.useRef(!1),oe=null!=I,se=s.useRef(!1),[ne,ae]=d.useTabbableModeSet(V,(e=>i.keyExtractor(e,i.ITEM_SELECTOR)),C,S),{currentKeyProps:ie}=l.useCurrentKey((e=>i.keyExtractor(e,i.ITEM_SELECTOR)),"multiple"!==R,(()=>i.getPrevNextKeyByCount(o,g,C,-L)),(()=>i.getPrevNextKeyByCount(o,g,C,L)),(()=>i.getPrevNextKeyByCount(o,g,C,-1)),(()=>i.getPrevNextKeyByCount(o,g,C,1)),C,S),[le,ce]=c.useCollectionFocusRing(V,["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"]);s.useEffect((()=>{if(null!=C&&V.current){const e=i.findElementByKey(V.current,C,i.ITEM_SELECTOR);if(e){if("card"===te){const t=e.closest("[role=gridcell]"),r=V.current.getAttribute("aria-activedescendant");t&&r!==t.id&&(V.current.setAttribute("aria-activedescendant",t.id),re.current=!0)}re.current&&(e.scrollIntoView({block:"nearest"}),re.current=!1)}}}),[C,o,te,oe]);const de=s.useCallback((e=>{E&&(!1===e.value.all&&e.value.keys.size>0&&(_.current=Array.from(e.value.keys.values()).pop()),E(e))}),[_,E]),ue=s.useCallback((e=>{if(o&&E){const t=i.handleSelectionRange(e,o,g);Array.isArray(t)&&("shiftSpace"===e.eventType?_.current=e.value.start:_.current=e.value.end,E({value:{all:!1,keys:new Set(t)},target:null}))}}),[o,E,g]),{selectionProps:ye}=u.useSelection((e=>e===V.current?void 0===C?null:C:i.keyExtractor(e,i.ITEM_SELECTOR)),v,R,!1,"toggle",!1,de,_.current,C,((e,t)=>()=>i.getPrevNextKeyByCount(o,g,e,t?-L:L)),((e,t)=>()=>i.getPrevNextKeyByCount(o,g,e,t?-1:1)),(e=>{if(V.current){const t=i.findElementByKey(V.current,e,i.ITEM_SELECTOR);t&&t.scrollIntoView({block:"nearest"})}}),ue),{reorderProps:me,reorderItemProps:fe,reorderContext:ge,reorderInstructionsId:he,reorderInstructions:be}=(({currentKey:e,onReorder:t,gutterSize:r,columns:o,rootRef:n,scrollCurrItemIntoView:a})=>{const l=null!=t,[c,d]=s.useState(void 0),{reorderProps:u,reorderContext:y,reorderInstructionsId:m,reorderInstructions:g}=f.useReorderable({onReorder:t,rootRef:n,itemSelector:i.ITEM_SELECTOR,isDisabled:!l,columns:o});return l?{reorderProps:{...u,onDragOver:e=>{i.dragToScroll(e,void 0!==c,n.current),a.current=!1}},reorderItemProps:{currentKey:e,dragKey:c,setDragKey:d,onReorder:t,rootRef:n,gutterSize:r,columns:o},reorderContext:y,reorderInstructionsId:m,reorderInstructions:g}:{reorderProps:u,reorderContext:y,reorderInstructionsId:m,reorderInstructions:g}})({currentKey:C,onReorder:I,gutterSize:k,columns:L,rootRef:V,scrollCurrItemIntoView:re}),xe=oe&&t.jsx(t.Fragment,{children:t.jsx("span",{id:he,children:t.jsx(b.HiddenAccessible,{children:be})})}),pe=s.useCallback((()=>{se.current||(se.current=!0,y())}),[se,y]);s.useEffect((()=>{se.current=!1}),[o,m]);const Ce=s.useCallback((e=>{const r=g(e.data),o="multiple"===R?()=>t.jsx(h.Selector,{onChange:E,rowKey:r,selectedKeys:v}):void 0;return{index:e.index,data:e.data,metadata:{key:r},selector:o,isSelected:a.containsKey(v,r)}}),[R,v,E,g]),Se=o&&!o.length&&m?t.jsx(U,{layout:M}):t.jsx(Y,{layout:M,colCount:L,totalCount:o?.length||0,cardWidth:O.width,cardHeight:O.height});w=i.getViewportConfig(V,w);const Re=t.jsx("div",{role:"row",children:t.jsx(B,{...W,children:t.jsx(x.LoadMoreCollection,{data:o,hasMore:m,onLoadMore:pe,loadMoreIndicator:Se,loadMoreThreshold:H+4,viewportConfig:w,children:r=>{const o=Ce(r),s=ne(o.metadata.key),n=C===o.metadata.key&&!s,a=n&&le,i=o.isSelected;return(r=>t.jsx(D,{context:r,isTabbable:s,isFocused:n,isFocusRingVisible:a,isGridLayout:"grid"===M,isSelected:i,selectionMode:R,focusBehavior:te,..."content"===T&&{setIsFocusBehaviorValid:ee},...Z.current&&{initialAnimation:j},...0===o.index&&!O.width&&{updateCardSize:P},...oe&&{reorderItemProps:fe},children:e},o.metadata.key))(o)}})})}),ve=t.jsx(B,{...W,children:t.jsx(N,{layout:M})});return t.jsxs("div",{...n.mergeProps(ie,ce,ye,me,{onFocus:()=>{if(!a.isKeyDefined(C)&&S&&ne(void 0)&&V.current){const e=z.current||i.getFirstVisibleKey(V.current,i.ITEM_SELECTOR);a.isKeyDefined(e)&&S({value:e})}else if(a.isKeyDefined(C)&&V.current){const e=i.findElementByKey(V.current,C,i.ITEM_SELECTOR);e?.scrollIntoView({block:"nearest"})}},onPointerDown:e=>{const t=i.keyExtractor(e.target,i.ITEM_SELECTOR);a.isKeyDefined(t)&&(z.current=t)},onKeyDown:e=>{"content"===te&&"Tab"===e.key&&V.current?.focus({preventScroll:!0});oe&&(e.metaKey||e.ctrlKey)&&e.shiftKey&&["ArrowLeft","ArrowRight","ArrowUp","ArrowDown"].includes(e.key)&&(re.current=!0)}},{..."card"===te&&ae}),ref:V,role:"grid",class:p.styles.baseStyle,tabIndex:0,"aria-label":K,"aria-labelledby":A,"aria-multiselectable":J,"aria-rowcount":X,"aria-colcount":q,children:[t.jsx(f.ReorderableContext.Provider,{value:ge,children:o?o.length||m?Re:t.jsx(r.Fragment,{}):ve}),xe]})}));e.BaseCardView=W,e.getColCount=(e,t,r)=>{if(!t||!r)return 0;const o=Math.floor((r+e)/(e+t));return Math.max(1,o)},e.gutterSizeToPX=$}));
//# sourceMappingURL=BaseCardView-1aa0d986.js.map
