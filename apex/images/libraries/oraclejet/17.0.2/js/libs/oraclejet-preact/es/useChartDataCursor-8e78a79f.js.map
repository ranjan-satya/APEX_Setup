{"version":3,"file":"useChartDataCursor-8e78a79f.js","sources":["../../src/hooks/PRIVATE_useChartDataCursor/util.ts","../../src/hooks/PRIVATE_useChartDataCursor/useChartDataCursor.tsx"],"sourcesContent":["/**\n * @license\n * Copyright (c) %FIRST_YEAR% %CURRENT_YEAR%, Oracle and/or its affiliates.\n * Licensed under The Universal Permissive License (UPL), Version 1.0\n * as shown at https://oss.oracle.com/licenses/upl/\n * @ignore\n */\n\nimport type { DataCursorStyle, Scale } from '../../utils/UNSAFE_visTypes/chart';\n\nexport function getDataCursorCoords(\n  xScale: Scale,\n  x: number,\n  plotAreaSpace: { x: number; y: number; height: number; width: number },\n  isHoriz: boolean,\n  dataCursorStyle?: DataCursorStyle\n) {\n  const lineColor = dataCursorStyle?.lineColor;\n  const lineStyle = dataCursorStyle?.lineStyle;\n  const y1 = isHoriz ? xScale.transform(x) : plotAreaSpace.y + plotAreaSpace.height;\n  const x1 = isHoriz ? plotAreaSpace.x : xScale.transform(x);\n\n  const y2 = isHoriz ? xScale.transform(x) : plotAreaSpace.y;\n  const x2 = isHoriz ? plotAreaSpace.x + plotAreaSpace.width : xScale.transform(x);\n\n  const lineWidth = dataCursorStyle?.lineWidth || 1;\n  return {\n    mainLineProps: {\n      x1,\n      y1,\n      x2,\n      y2,\n      style: {\n        stroke: lineColor,\n        strokeDashArray: lineStyle === 'dotted' ? 3 : lineStyle === 'dashed' ? 6 : undefined,\n        strokeWidth: lineWidth\n      }\n    },\n    contrastLineProps: {\n      x1: isHoriz ? x1 : x1 + lineWidth,\n      y1: isHoriz ? y1 + lineWidth : y1,\n      x2: isHoriz ? x2 : x2 + lineWidth,\n      y2: isHoriz ? y2 + lineWidth : y2\n    }\n  };\n}\n","/**\n * @license\n * Copyright (c) %FIRST_YEAR% %CURRENT_YEAR%, Oracle and/or its affiliates.\n * Licensed under The Universal Permissive License (UPL), Version 1.0\n * as shown at https://oss.oracle.com/licenses/upl/\n * @ignore\n */\n\nimport type { Dimension, MarkerShapes } from '../../utils/UNSAFE_visTypes/common';\nimport type {\n  DataCursorPosition,\n  DataCursorStyle,\n  OnDataCursorPositionChange,\n  Scale,\n  Info\n} from '../../utils/UNSAFE_visTypes/chart';\nimport { getDataCursorCoords } from './util';\nimport { styles } from './themes/DataCursorStyles.css';\nimport { Marker } from '../../PRIVATE_SvgShapes';\nimport { useRef } from 'preact/hooks';\nimport type { ColorProps } from '../../utils/UNSAFE_interpolations/colors';\nimport { colorSchemeVars } from '../../Common/themes/themeContract.css';\nimport { rgb } from '../../UNSAFE_Theme';\nimport { useVisHover } from '#hooks/PRIVATE_useVisHover';\nimport { mergeProps } from '#utils/UNSAFE_mergeProps';\n\ntype Props = {\n  touchResponse: 'touchStart' | 'touchHold';\n  findNearest: (x: number, y: number) => any;\n  dataCursorPosition?: DataCursorPosition;\n  isDataCursorEnabled?: boolean;\n  isHoriz: boolean;\n  plotAreaSpace: Dimension;\n  yScale: Scale;\n  xScale: Scale;\n  onDataCursorPositionChange?: OnDataCursorPositionChange;\n  dataCursorStyle?: DataCursorStyle;\n  focusedItemInfo: Info;\n  getDataItemPos: (seriesIndex: number, groupIndex: number) => Dimension | undefined;\n  getMarkerInfo: (\n    seriesIndex: number,\n    groupIndex: number\n  ) => { type?: MarkerShapes; color: ColorProps['color'] };\n};\n\nexport function useChartDataCursor({\n  touchResponse,\n  findNearest,\n  dataCursorPosition,\n  onDataCursorPositionChange,\n  isDataCursorEnabled,\n  isHoriz,\n  plotAreaSpace,\n  yScale,\n  xScale,\n  dataCursorStyle,\n  focusedItemInfo,\n  getDataItemPos,\n  getMarkerInfo\n}: Props) {\n  let dataCursorContent = null;\n  let x = dataCursorPosition?.x;\n  let y = dataCursorPosition?.y;\n  const isSnap = dataCursorStyle?.behavior === 'snap';\n\n  const itemInfo = useRef<{ x: number; y: number; groupIndex: number; seriesIndex: number }>();\n\n  const updateDataCursor = () => {\n    const { seriesIndex, groupIndex } = focusedItemInfo;\n    const elemBounds = getDataItemPos(seriesIndex!, groupIndex!);\n    if (!elemBounds) {\n      return;\n    }\n    const px = elemBounds?.x + elemBounds.width / 2;\n    const py = elemBounds?.y + elemBounds.height / 2;\n\n    let X = xScale.invert(isHoriz ? py : px);\n    let Y = yScale.invert(isHoriz ? px : py);\n\n    const neareastItemInfo = findNearest(X, Y);\n    itemInfo.current = neareastItemInfo;\n    if (isSnap) {\n      X = xScale.invert(neareastItemInfo.x);\n      Y = yScale.invert(neareastItemInfo.y);\n    }\n    onDataCursorPositionChange?.({ x: X, y: Y });\n  };\n\n  const onHover = (event: PointerEvent) => {\n    const px = event.offsetX;\n    const py = event.offsetY;\n    if (\n      px < plotAreaSpace.x ||\n      py < plotAreaSpace.y ||\n      px > plotAreaSpace.x + plotAreaSpace.width ||\n      py > plotAreaSpace.y + plotAreaSpace.height\n    ) {\n      dataCursorContent = null;\n      onDataCursorPositionChange?.({ x: undefined, y: undefined });\n      return;\n    }\n\n    let X = xScale.invert(isHoriz ? py : px);\n    let Y = yScale.invert(isHoriz ? px : py);\n\n    const neareastItemInfo = findNearest(X, Y);\n    itemInfo.current = neareastItemInfo;\n    if (isSnap) {\n      X = xScale.invert(neareastItemInfo.x);\n      Y = yScale.invert(neareastItemInfo.y);\n    }\n    onDataCursorPositionChange?.({ x: X, y: Y });\n  };\n\n  const onHoverLeave = () => {\n    onDataCursorPositionChange?.({ x: undefined, y: undefined });\n    itemInfo.current = undefined;\n  };\n\n  const hoverHandlers = useVisHover(onHover, undefined, onHoverLeave, touchResponse);\n\n  const onKeyDown = (event: KeyboardEvent) => {\n    if (event.key === 'Tab') {\n      onDataCursorPositionChange?.({ x: undefined, y: undefined });\n      itemInfo.current = undefined;\n      return;\n    }\n    updateDataCursor();\n  };\n\n  const onKeyUp = (event: KeyboardEvent) => {\n    if (event.key === 'Tab' && focusedItemInfo.isCurrent) {\n      return;\n    }\n    updateDataCursor();\n  };\n\n  if (x != undefined && y != undefined && isDataCursorEnabled) {\n    const info = itemInfo.current || findNearest(x, y);\n    if (isSnap) {\n      x = xScale.invert(info.x);\n      y = yScale.invert(info.y);\n    }\n    const { mainLineProps, contrastLineProps } = getDataCursorCoords(\n      xScale,\n      x,\n      plotAreaSpace,\n      isHoriz,\n      dataCursorStyle\n    );\n    const { type, color } = getMarkerInfo(info.seriesIndex!, info.groupIndex!);\n    const markerType = type || 'circle';\n    // TODO: JET-65336\n    const markerDims = markerType === 'circle' ? 18 : 16;\n\n    dataCursorContent = (\n      <>\n        <g class={styles.dataCursor}>\n          <line {...mainLineProps} class={styles.dataCursorLine} />\n          <line {...contrastLineProps} class={styles.contrastLine} />\n        </g>\n        {dataCursorStyle?.isMarkerDisplayed && info && (\n          <Marker\n            type={markerType}\n            tx={info.x}\n            ty={info.y}\n            isInteractive={true}\n            scale={1}\n            fill={color}\n            stroke={rgb(colorSchemeVars.palette.neutral[0])}\n            outerStroke={color}\n            width={markerDims}\n            height={markerDims}\n            preserveRectAspectRatio\n          />\n        )}\n      </>\n    );\n  }\n\n  return {\n    dataCursorContent,\n    dataCursorProps: isDataCursorEnabled\n      ? mergeProps(hoverHandlers, {\n          onKeyDown,\n          onKeyUp\n        })\n      : {}\n  };\n}\n"],"names":["_jsxs","_Fragment","_jsx"],"mappings":"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"}