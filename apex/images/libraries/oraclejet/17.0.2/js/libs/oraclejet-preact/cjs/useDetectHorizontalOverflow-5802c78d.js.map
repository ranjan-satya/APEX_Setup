{"version":3,"file":"useDetectHorizontalOverflow-5802c78d.js","sources":["../../src/hooks/PRIVATE_useDetectHorizontalOverflow/useDetectHorizontalOverflow.ts"],"sourcesContent":["import { RefObject } from 'preact';\nimport { useState, useEffect } from 'preact/hooks';\n\ntype ElemDim<K extends string | number> = {\n  itemKey: K | undefined;\n  cumulativeWidth: number | undefined;\n};\n\ntype CallBack<K extends string | number> = (key: K) => number;\nexport type useDetectOverflowProps<K extends string | number> = {\n  rootRef: RefObject<HTMLDivElement>;\n  getWidth: CallBack<K>;\n  keysArray: (K | undefined)[];\n};\n\n/**\n * Implements overflow detection and calculation\n */\nexport function useDetectHorizontalOverflow<K extends string | number>(\n  options: useDetectOverflowProps<K>\n) {\n  const { rootRef, getWidth, keysArray } = options;\n  const [visibleItemKeys, setVisibleItemKeys] = useState<(K | undefined)[]>(keysArray);\n  const [overflowItemKeys, setOverflowingItemKeys] = useState<(K | undefined)[]>();\n\n  useEffect(() => {\n    let resizeObserver: ResizeObserver;\n    if (rootRef.current && keysArray && keysArray.length > 0) {\n      const itemDimensions: ElemDim<K>[] = [];\n      let sumofItemsWidth = 0;\n      keysArray.forEach((itemKey) => {\n        sumofItemsWidth += getWidth(itemKey as K);\n        const elemDimension = {\n          itemKey: itemKey,\n          cumulativeWidth: sumofItemsWidth\n        };\n        itemDimensions.push(elemDimension as ElemDim<K>);\n      });\n\n      resizeObserver = new ResizeObserver(() => {\n        const container = rootRef.current;\n        const arr = itemDimensions?.map((item) => item.cumulativeWidth) as number[];\n        if (\n          container &&\n          arr &&\n          (container.clientWidth < arr[arr.length - 1] ||\n            container.clientWidth < container.scrollWidth)\n        ) {\n          const { closestEntry, closestIndex } = searchClosest(arr, container?.clientWidth);\n          if (closestEntry && closestIndex) {\n            setVisibleItemKeys(keysArray.slice(0, closestIndex));\n            setOverflowingItemKeys(keysArray?.slice(closestIndex));\n          }\n        } else {\n          setVisibleItemKeys(keysArray);\n          setOverflowingItemKeys([]);\n        }\n      });\n      resizeObserver.observe(rootRef?.current as Element);\n    }\n\n    return () => {\n      if (resizeObserver) {\n        resizeObserver.disconnect();\n      }\n    };\n  }, [keysArray, getWidth, rootRef]);\n\n  return {\n    visibleItemKeys,\n    overflowItemKeys\n  } as const;\n}\n\nconst searchClosest = (\n  arr: number[] | undefined,\n  searchValue: number | undefined | null\n): { closestEntry: number | null; closestIndex: number | null } => {\n  {\n    if (arr != null && searchValue != null) {\n      let left = 0;\n      let right = arr.length - 1;\n      let closestEntry: number | null = null;\n      let closestIndex: number | null = null;\n      while (left <= right && left < arr.length && right > -1) {\n        const mid = Math.floor((left + right) / 2);\n        const midEntry = arr[mid];\n        if (midEntry === searchValue) {\n          return { closestEntry: midEntry!, closestIndex: mid! };\n        } else if (midEntry < searchValue) {\n          left = mid + 1;\n        } else {\n          right = mid - 1;\n        }\n\n        if (\n          !closestEntry ||\n          Math.abs(searchValue - midEntry) < Math.abs(searchValue - closestEntry)\n        ) {\n          closestEntry = midEntry as number;\n          closestIndex = mid as number;\n        }\n      }\n      return { closestEntry: closestEntry!, closestIndex: closestIndex! };\n    } else return { closestEntry: null, closestIndex: null };\n  }\n};\n"],"names":["useState","useEffect"],"mappings":"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"}