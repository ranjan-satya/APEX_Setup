{"version":3,"file":"useItemAction-dad80c7d.js","sources":["../../src/hooks/PRIVATE_useItemAction/useItemAction.tsx"],"sourcesContent":["import { useCallback } from 'preact/hooks';\nimport { DataState, ItemActionDetail, ListItemContext, Metadata } from '../../UNSAFE_Collection';\n\nimport { keyExtractor } from '../../utils/PRIVATE_collectionUtils';\n\nexport const useItemAction = <K extends string | number, D>(\n  currentKey: K | undefined,\n  dataState: DataState<K, D> | null,\n  onItemAction: ((detail: ItemActionDetail<K, D>) => void) | undefined,\n  itemSelector: string,\n  allowSpacebar: boolean\n) => {\n  const onClick = useCallback(\n    (event: MouseEvent) => {\n      const key = keyExtractor(event.target as HTMLElement, itemSelector) as K;\n      if (\n        handleItemAction(\n          event,\n          key,\n          dataState as DataState<K, D>,\n          onItemAction as (detail: ItemActionDetail<K, D>) => void\n        )\n      ) {\n        event.stopPropagation();\n      }\n    },\n    [dataState, onItemAction, itemSelector]\n  );\n\n  const onKeyDown = useCallback(\n    (event: KeyboardEvent) => {\n      if (event.key === 'Enter') {\n        handleItemAction(\n          event,\n          currentKey,\n          dataState as DataState<K, D>,\n          onItemAction as (detail: ItemActionDetail<K, D>) => void\n        );\n      } else if (allowSpacebar && event.key === ' ') {\n        handleItemAction(\n          event,\n          currentKey,\n          dataState as DataState<K, D>,\n          onItemAction as (detail: ItemActionDetail<K, D>) => void\n        );\n        event.preventDefault();\n      }\n    },\n    [dataState, onItemAction, currentKey, allowSpacebar]\n  );\n\n  return !dataState || !onItemAction\n    ? {}\n    : {\n        onClick,\n        onKeyDown\n      };\n};\n\nconst handleItemAction = <K, D>(\n  event: MouseEvent | KeyboardEvent,\n  key: K | undefined,\n  dataState: DataState<K, D>,\n  onItemAction: (detail: ItemActionDetail<K, D>) => void\n) => {\n  if (key !== undefined) {\n    const context = findItemContext(key, dataState);\n    context && onItemAction({ context: context, target: event.target });\n    return context !== undefined;\n  }\n  return false;\n};\n\n// returns a ListItemContext based on key\nexport const findItemContext = <K, D>(\n  key: K,\n  dataState: DataState<K, D>\n): ListItemContext<K, D> | undefined => {\n  const index = dataState?.data?.findIndex((d) => d.metadata.key === key) ?? -1;\n  if (index > -1) {\n    const context: ListItemContext<K, D> = {\n      index: index + (dataState?.offset || 0),\n      data: dataState?.data[index].data as D,\n      metadata: dataState?.data[index].metadata as Metadata<K>\n    };\n    return context;\n  }\n  return undefined;\n};\n"],"names":["useCallback","keyExtractor"],"mappings":";;;;;;AAKO,MAAM,aAAa,GAAG,CAC3B,UAAyB,EACzB,SAAiC,EACjC,YAAoE,EACpE,YAAoB,EACpB,aAAsB,KACpB;AACF,IAAA,MAAM,OAAO,GAAGA,iBAAW,CACzB,CAAC,KAAiB,KAAI;QACpB,MAAM,GAAG,GAAGC,4BAAY,CAAC,KAAK,CAAC,MAAqB,EAAE,YAAY,CAAM,CAAC;QACzE,IACE,gBAAgB,CACd,KAAK,EACL,GAAG,EACH,SAA4B,EAC5B,YAAwD,CACzD,EACD;YACA,KAAK,CAAC,eAAe,EAAE,CAAC;SACzB;KACF,EACD,CAAC,SAAS,EAAE,YAAY,EAAE,YAAY,CAAC,CACxC,CAAC;AAEF,IAAA,MAAM,SAAS,GAAGD,iBAAW,CAC3B,CAAC,KAAoB,KAAI;AACvB,QAAA,IAAI,KAAK,CAAC,GAAG,KAAK,OAAO,EAAE;YACzB,gBAAgB,CACd,KAAK,EACL,UAAU,EACV,SAA4B,EAC5B,YAAwD,CACzD,CAAC;SACH;aAAM,IAAI,aAAa,IAAI,KAAK,CAAC,GAAG,KAAK,GAAG,EAAE;YAC7C,gBAAgB,CACd,KAAK,EACL,UAAU,EACV,SAA4B,EAC5B,YAAwD,CACzD,CAAC;YACF,KAAK,CAAC,cAAc,EAAE,CAAC;SACxB;KACF,EACD,CAAC,SAAS,EAAE,YAAY,EAAE,UAAU,EAAE,aAAa,CAAC,CACrD,CAAC;AAEF,IAAA,OAAO,CAAC,SAAS,IAAI,CAAC,YAAY;AAChC,UAAE,EAAE;AACJ,UAAE;YACE,OAAO;YACP,SAAS;SACV,CAAC;AACR,EAAE;AAEF,MAAM,gBAAgB,GAAG,CACvB,KAAiC,EACjC,GAAkB,EAClB,SAA0B,EAC1B,YAAsD,KACpD;AACF,IAAA,IAAI,GAAG,KAAK,SAAS,EAAE;QACrB,MAAM,OAAO,GAAG,eAAe,CAAC,GAAG,EAAE,SAAS,CAAC,CAAC;AAChD,QAAA,OAAO,IAAI,YAAY,CAAC,EAAE,OAAO,EAAE,OAAO,EAAE,MAAM,EAAE,KAAK,CAAC,MAAM,EAAE,CAAC,CAAC;QACpE,OAAO,OAAO,KAAK,SAAS,CAAC;KAC9B;AACD,IAAA,OAAO,KAAK,CAAC;AACf,CAAC,CAAC;AAEF;MACa,eAAe,GAAG,CAC7B,GAAM,EACN,SAA0B,KACW;IACrC,MAAM,KAAK,GAAG,SAAS,EAAE,IAAI,EAAE,SAAS,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,QAAQ,CAAC,GAAG,KAAK,GAAG,CAAC,IAAI,CAAC,CAAC,CAAC;AAC9E,IAAA,IAAI,KAAK,GAAG,CAAC,CAAC,EAAE;AACd,QAAA,MAAM,OAAO,GAA0B;YACrC,KAAK,EAAE,KAAK,IAAI,SAAS,EAAE,MAAM,IAAI,CAAC,CAAC;YACvC,IAAI,EAAE,SAAS,EAAE,IAAI,CAAC,KAAK,CAAC,CAAC,IAAS;YACtC,QAAQ,EAAE,SAAS,EAAE,IAAI,CAAC,KAAK,CAAC,CAAC,QAAuB;SACzD,CAAC;AACF,QAAA,OAAO,OAAO,CAAC;KAChB;AACD,IAAA,OAAO,SAAS,CAAC;AACnB;;;;;"}