{"version":3,"file":"Transition-f9501682.js","sources":["../../src/PRIVATE_TransitionGroup/Transition.tsx"],"sourcesContent":["/**\n * @license\n * Copyright (c) %FIRST_YEAR% %CURRENT_YEAR%, Oracle and/or its affiliates.\n * The Universal Permissive License (UPL), Version 1.0\n * as shown at https://oss.oracle.com/licenses/upl/\n * @ignore\n */\nimport { Component, ComponentChild, RenderableProps } from 'preact';\n\n/**\n * Supported transitions\n */\ntype TransitionCompleteStatus = 'entered' | 'exited';\ntype TransitionIntermediateStatus = 'entering' | 'exiting' | null;\ntype TransitionStatus = TransitionCompleteStatus | TransitionIntermediateStatus;\n\n/**\n * A function wrapper that when cancelled, will not call the\n * original function when invoked.\n */\ntype CancellableFunction = {\n  (): void;\n  cancel?: () => void;\n};\n\n/**\n * State for the Transition component\n */\ntype State = {\n  status: TransitionStatus;\n};\n\n/**\n * Props for the Transition Component\n */\nexport type TransitionProps<M = any> = {\n  /**\n   * A boolean for whether or not to the show the child content. Usually, this represents\n   * whether or the current item existing in the data.\n   */\n  in?: boolean;\n\n  /**\n   * An optional metadata that will be passed along on all callbacks\n   */\n  metadata?: M;\n\n  /**\n   * Called when the component enters for the first time.\n   */\n  onEnter?: (node?: Element, metadata?: M) => void;\n\n  /**\n   * Called when the component enters for the first time and right after onEnter call.\n   */\n  onEntering?: (node?: Element, callback?: () => void, metadata?: M) => void;\n\n  /**\n   * Called when the component enters for the first time and all the enter transitions are over.\n   */\n  onEntered?: (node?: Element, metadata?: M) => void;\n\n  /**\n   * Called when the component exits.\n   */\n  onExit?: (node?: Element, metadata?: M) => void;\n\n  /**\n   * Called when the component exits and right after the onExit call.\n   */\n  onExiting?: (node?: Element, callback?: () => void, metadata?: M) => void;\n\n  /**\n   * Called when the component exits and all the transitions are over.\n   */\n  onExited?: (node?: Element, metadata?: M) => void;\n};\n\n/**\n * @classdesc\n * The component that acts as a layer for handing transitions.\n *\n * @ignore\n */\nexport class Transition<M = any> extends Component<TransitionProps<M>, State> {\n  private readonly _appearStatus: TransitionIntermediateStatus;\n  private _nextCallback: CancellableFunction | null;\n\n  ////////////////////////////////////////////////////////////////////////\n  // Handler functions are created as members to have them 'this' bound //\n  ////////////////////////////////////////////////////////////////////////\n\n  ///////////////////////////\n  // Handler functions end //\n  ///////////////////////////\n\n  /**\n   * Instantiates Component\n   *\n   * @param props The component properties\n   */\n  constructor(props: Readonly<TransitionProps<M>>) {\n    super(props);\n\n    let appearStatus: TransitionIntermediateStatus;\n    if (props.in) {\n      appearStatus = 'entering';\n    } else {\n      appearStatus = null;\n    }\n\n    this._appearStatus = appearStatus;\n    this.state = { status: 'exited' };\n    this._nextCallback = null;\n  }\n\n  //////////////////////////////////////\n  // Component Life Cycle Hooks Start //\n  //////////////////////////////////////\n\n  /**\n   * Lifecycle hook that gets called when the component is mounted to the DOM\n   */\n  componentDidMount() {\n    this._updateStatus(this._appearStatus);\n  }\n\n  /**\n   * Lifecycle hook that gets called after each update to the component\n   *\n   * @param prevProps The props of the component before last update\n   */\n  componentDidUpdate(prevProps: Readonly<TransitionProps<M>>) {\n    let nextStatus: TransitionIntermediateStatus = null;\n\n    if (prevProps !== this.props) {\n      const { status } = this.state;\n\n      if (this.props.in) {\n        if (status !== 'entering' && status !== 'entered') {\n          // The component is just entering, so set the next status as Entering\n          nextStatus = 'entering';\n        }\n      } else {\n        if (status === 'entering' || status === 'entered') {\n          // The component is not in the data anymore, so we need to do exit animation\n          // So, set the next status as Exiting\n          nextStatus = 'exiting';\n        }\n      }\n    }\n\n    this._updateStatus(nextStatus);\n  }\n\n  /**\n   * Lifecycle hook that gets called right before the component unmounts\n   */\n  componentWillUnmount() {\n    this._cancelNextCallback();\n  }\n\n  ////////////////////////////////////\n  // Component Life Cycle Hooks End //\n  ////////////////////////////////////\n\n  /**\n   * Renders the Transition component\n   *\n   * @param props The current props\n   * @returns The rendered component child\n   */\n  render(props?: RenderableProps<TransitionProps<M>>): ComponentChild {\n    return props?.children;\n  }\n\n  ////////////////////////////\n  // Private helper methods //\n  ////////////////////////////\n\n  /**\n   * Creates a wrapper callback function, which can be cancelled.\n   *\n   * @param callback The current callback function\n   * @returns The created cancellable callback\n   */\n  private _setNextCallback(callback: (...args: any) => void): CancellableFunction {\n    let active = true;\n\n    this._nextCallback = (...args: any[]) => {\n      if (active) {\n        active = false;\n        this._nextCallback = null;\n\n        callback(...args);\n      }\n    };\n\n    this._nextCallback.cancel = () => {\n      active = false;\n    };\n\n    return this._nextCallback;\n  }\n\n  /**\n   * Cancels the scheduled next callback\n   */\n  private _cancelNextCallback() {\n    this._nextCallback?.cancel?.();\n    this._nextCallback = null;\n  }\n\n  /**\n   * Updates the status of the component. Performs corresponding Transitions.\n   */\n  private _updateStatus(nextStatus: TransitionIntermediateStatus) {\n    if (nextStatus != null) {\n      this._cancelNextCallback();\n\n      if (nextStatus === 'entering') {\n        this._performEnter(this.base as Element); // In our component, base is always Element\n      } else {\n        this._performExit(this.base as Element); // In our component, base is always Element\n      }\n    }\n  }\n\n  /**\n   * Perform Entering transitions\n   *\n   * @param node The root DOM element of this component\n   */\n  private _performEnter(node?: Element) {\n    this.props.onEnter?.(node, this.props.metadata);\n\n    this.setState({ status: 'entering' }, () => {\n      this.props.onEntering?.(\n        node,\n        this._setNextCallback(() => {\n          this.setState({ status: 'entered' }, () => {\n            this.props.onEntered?.(node, this.props.metadata);\n          });\n        }),\n        this.props.metadata\n      );\n    });\n  }\n\n  /**\n   * Perform Exiting transitions\n   *\n   * @param node The root DOM element of this component\n   */\n  private _performExit(node?: Element) {\n    this.props.onExit?.(node, this.props.metadata);\n\n    this.setState({ status: 'exiting' }, () => {\n      this.props.onExiting?.(\n        node,\n        this._setNextCallback(() => {\n          this.setState({ status: 'exited' }, () => {\n            this.props.onExited?.(node, this.props.metadata);\n          });\n        }),\n        this.props.metadata\n      );\n    });\n  }\n}\n"],"names":[],"mappings":"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"}