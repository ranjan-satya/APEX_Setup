{"version":3,"file":"useDatatip-d00735e9.js","sources":["../../src/hooks/PRIVATE_useDatatip/useDatatip.tsx"],"sourcesContent":["/**\n * @license\n * Copyright (c) %FIRST_YEAR% %CURRENT_YEAR%, Oracle and/or its affiliates.\n * Licensed under The Universal Permissive License (UPL), Version 1.0\n * as shown at https://oss.oracle.com/licenses/upl/\n * @ignore\n */\n\nimport { ComponentChildren } from 'preact';\nimport { Layer } from '../../UNSAFE_Layer';\nimport { Floating, Placement } from '../../UNSAFE_Floating';\nimport { useRef, useState } from 'preact/hooks';\nimport { styles } from './themes/useDatatip.css';\nimport { useId } from '../UNSAFE_useId';\nimport { Property } from 'csstype';\nimport { DATATIP_OFFSET } from '#utils/UNSAFE_visUtils/datatipUtils';\nimport { useVisHover } from '#hooks/PRIVATE_useVisHover';\nimport { mergeProps } from '#utils/UNSAFE_mergeProps';\nexport type { Dimension } from '../../utils/UNSAFE_visTypes/common';\n\ntype DatatipProps = {\n  /**\n   * The datatip content.\n   */\n  content?: ComponentChildren;\n\n  /**\n   * Whether the datatip is anchored to pointer or element.\n   *\n   */\n  anchor: 'element' | 'pointer';\n\n  /**\n   * The offset from the anchor element or pointer.\n   */\n  offset?: {\n    mainAxis?: number;\n    crossAxis?: number;\n  };\n\n  /**\n   * The border color of the datatip.\n   */\n  borderColor?: Property.BorderColor;\n\n  /**\n   * The placement of datatip from anchor point.\n   */\n  placement?: Placement;\n\n  /**\n   * The touch response value.\n   */\n  touchResponse: 'touchStart' | 'touchHold';\n};\n\n/**\n * The hook to support custom datatip in visualization components.\n */\nexport function useDatatip({\n  content,\n  placement = 'top-end-corner',\n  offset,\n  borderColor,\n  anchor,\n  touchResponse\n}: DatatipProps) {\n  const uniqueIdRef = useRef<string>(useId());\n  const [coords, setCoords] = useState({ x: 0, y: 0 });\n  const offsetValue = offset || { mainAxis: DATATIP_OFFSET, crossAxis: -1 * DATATIP_OFFSET };\n  const [isVisible, setIsVisible] = useState(false);\n\n  const targetRef = useRef<HTMLElement | null>(null);\n  const toggleTimeoutRef = useRef<ReturnType<typeof setTimeout>>();\n\n  const onHover = (event: PointerEvent) => {\n    setCoords({ x: event.clientX, y: event.clientY });\n    setIsVisible(true);\n  };\n\n  const onHoverEnter = (event: PointerEvent, currentTarget: HTMLElement) => {\n    if (\n      event.pointerType === 'touch' ||\n      event.eventPhase === Event.AT_TARGET ||\n      event.eventPhase === Event.BUBBLING_PHASE\n    ) {\n      targetRef.current = currentTarget;\n      setIsVisible(true);\n    }\n  };\n\n  const onHoverLeave = () => {\n    toggleTimeoutRef.current = setTimeout(() => {\n      setIsVisible(false);\n    }, 20);\n  };\n\n  const hoverHandlers = useVisHover(onHover, onHoverEnter, onHoverLeave, touchResponse);\n\n  const onFocus = (event: FocusEvent) => {\n    if (event.eventPhase === Event.AT_TARGET || event.eventPhase === Event.BUBBLING_PHASE) {\n      targetRef.current = event.target as HTMLElement;\n      setIsVisible(true);\n    }\n  };\n\n  const onBlur = () => {\n    setIsVisible(false);\n  };\n\n  const onContentPointerEnter = () => {\n    clearTimeout(toggleTimeoutRef.current);\n  };\n\n  const onKeyUp = (event: KeyboardEvent) => {\n    if (event.code === 'Escape') {\n      event.preventDefault();\n      setIsVisible(false);\n    } else if (\n      event.code === 'ArrowUp' ||\n      event.code === 'ArrowDown' ||\n      event.code === 'ArrowRight' ||\n      event.code === 'ArrowLeft' ||\n      event.code === 'Tab'\n    ) {\n      setIsVisible(true);\n    }\n  };\n\n  const anchorRef = anchor === 'element' ? targetRef : { current: coords };\n  const datatipContent =\n    isVisible && content != null ? (\n      <Layer>\n        <Floating\n          anchorRef={anchorRef}\n          placement={placement}\n          offsetValue={offsetValue}\n          flipOptions={{ crossAxis: false, mainAxis: false }}\n          shiftOptions={{ crossAxis: true, mainAxis: true }}>\n          <div\n            role=\"tooltip\"\n            id={uniqueIdRef.current}\n            className={styles.visDatatipStyle}\n            style={{ borderColor }}\n            onPointerEnter={onContentPointerEnter}\n            onPointerLeave={onHoverLeave}>\n            {content}\n          </div>\n        </Floating>\n      </Layer>\n    ) : null;\n\n  return {\n    datatipContent,\n    datatipProps: {\n      'aria-describedby': datatipContent !== null ? uniqueIdRef.current : undefined,\n      ...mergeProps(hoverHandlers, {\n        onKeyUp,\n        onFocus,\n        onBlur\n      })\n    }\n  };\n}\n"],"names":["content","placement","offset","borderColor","anchor","touchResponse","uniqueIdRef","useRef","useId","coords","setCoords","useState","x","y","offsetValue","mainAxis","DATATIP_OFFSET","crossAxis","isVisible","setIsVisible","targetRef","toggleTimeoutRef","onHoverLeave","current","setTimeout","hoverHandlers","useVisHover","event","clientX","clientY","currentTarget","pointerType","eventPhase","Event","AT_TARGET","BUBBLING_PHASE","anchorRef","datatipContent","_jsx","jsx","Layer","Floating","flipOptions","shiftOptions","role","id","className","styles","visDatatipStyle","style","onPointerEnter","clearTimeout","onPointerLeave","children","datatipProps","undefined","mergeProps","onKeyUp","code","preventDefault","onFocus","target","onBlur"],"mappings":"+VA2D2BA,QACzBA,EAAOC,UACPA,EAAY,iBAAgBC,OAC5BA,EAAMC,YACNA,EAAWC,OACXA,EAAMC,cACNA,IAEA,MAAMC,EAAcC,EAAAA,OAAeC,EAAKA,UACjCC,EAAQC,GAAaC,EAAQA,SAAC,CAAEC,EAAG,EAAGC,EAAG,IAC1CC,EAAcZ,GAAU,CAAEa,SAAUC,EAAcA,eAAEC,WAAY,EAAID,EAAAA,iBACnEE,EAAWC,GAAgBR,EAAQA,UAAC,GAErCS,EAAYb,SAA2B,MACvCc,EAAmBd,EAAAA,SAkBnBe,EAAe,KACnBD,EAAiBE,QAAUC,YAAW,KACpCL,GAAa,EAAM,GAClB,GAAG,EAGFM,EAAgBC,EAAAA,aAtBLC,IACfjB,EAAU,CAAEE,EAAGe,EAAMC,QAASf,EAAGc,EAAME,UACvCV,GAAa,EAAK,IAGC,CAACQ,EAAqBG,KAEjB,UAAtBH,EAAMI,aACNJ,EAAMK,aAAeC,MAAMC,WAC3BP,EAAMK,aAAeC,MAAME,iBAE3Bf,EAAUG,QAAUO,EACpBX,GAAa,GACd,GASsDG,EAAcjB,GAgCjE+B,EAAuB,YAAXhC,EAAuBgB,EAAY,CAAEG,QAASd,GAC1D4B,EACJnB,GAAwB,MAAXlB,EACXsC,EAACC,IAAAC,kBACCF,EAACC,IAAAE,YACCL,UAAWA,EACXnC,UAAWA,EACXa,YAAaA,EACb4B,YAAa,CAAEzB,WAAW,EAAOF,UAAU,GAC3C4B,aAAc,CAAE1B,WAAW,EAAMF,UAAU,YAC3CuB,EACEC,IAAA,MAAA,CAAAK,KAAK,UACLC,GAAIvC,EAAYiB,QAChBuB,UAAWC,EAAAA,OAAOC,gBAClBC,MAAO,CAAE9C,eACT+C,eAlCoB,KAC5BC,aAAa9B,EAAiBE,QAAQ,EAkC9B6B,eAAgB9B,EACf+B,SAAArD,QAIL,KAEN,MAAO,CACLqC,iBACAiB,aAAc,CACZ,mBAAuC,OAAnBjB,EAA0B/B,EAAYiB,aAAUgC,KACjEC,EAAAA,WAAW/B,EAAe,CAC3BgC,QA3CW9B,IACI,WAAfA,EAAM+B,MACR/B,EAAMgC,iBACNxC,GAAa,IAEE,YAAfQ,EAAM+B,MACS,cAAf/B,EAAM+B,MACS,eAAf/B,EAAM+B,MACS,cAAf/B,EAAM+B,MACS,QAAf/B,EAAM+B,MAENvC,GAAa,EACd,EAgCGyC,QA3DWjC,IACXA,EAAMK,aAAeC,MAAMC,WAAaP,EAAMK,aAAeC,MAAME,iBACrEf,EAAUG,QAAUI,EAAMkC,OAC1B1C,GAAa,GACd,EAwDG2C,OArDS,KACb3C,GAAa,EAAM,KAwDvB"}