{"version":3,"file":"Layer-3700cd37.js","sources":["../../src/UNSAFE_Layer/Layer.tsx"],"sourcesContent":["import { VNode, RefObject } from 'preact';\nimport { createPortal, useContext, useLayoutEffect, useState, useRef } from 'preact/compat';\nimport { LayerContext, LayerLevel, LayerPriority } from './LayerContext';\nimport { classNames } from '../utils/UNSAFE_classNames';\nimport { baseStyle, styles } from './themes/LayerStyles.css';\nimport { useThemeInterpolations } from '../hooks/UNSAFE_useThemeInterpolations/useThemeInterpolations';\n\nexport const LOGICAL_PARENT = Symbol.for('oj-logical-parent');\n\ntype Props = {\n  /**\n   * The content to be re-parented using Portal\n   */\n  children: VNode;\n  /**\n   * Logical parent of the re-parented content. Typically the 'launcher' associated\n   * with the popup.\n   */\n  logicalParentRef?: RefObject<Element> | null;\n  /**\n   * Determines Layer's stacking context. Components that always need to render on top of other popup\n   * elements (such as Messages) should use respective priority value. The default priority level is 'popup'.\n   */\n  priority?: LayerPriority;\n  /**\n   * Determines Layer's nesting context. By default, new layers will render in the context of a parent Layer,\n   * if it exists (nearestAncestor)). Some popup components (such as Dialog and Message) may need to set up\n   * a new nesting context as(topLevel).\n   */\n  level?: LayerLevel;\n};\n\ntype LayerElement = HTMLDivElement & {\n  [LOGICAL_PARENT]?: Element | null;\n};\n\nconst Layer = ({\n  children,\n  logicalParentRef,\n  priority = 'popup',\n  level = 'nearestAncestor'\n}: Props) => {\n  const context = useContext(LayerContext);\n\n  const [layerContainer, _setLayerContainer] = useState<Element | null>(null);\n  const layerContainerRef = useRef<Element | null>(null);\n\n  const setLayerContainer = (elem: Element | null) => {\n    layerContainerRef.current = elem;\n    _setLayerContainer(elem);\n  };\n\n  // because the children are being rendered into a portal that is out of the flow of parent dom,\n  // we need to specify the colorScheme and scale class names here to pick up the correct CSS styles.\n  const themeClasses = useThemeInterpolations();\n\n  let priorityStyle = styles.popupPriorityStyle;\n\n  switch (priority) {\n    case 'dialog': {\n      priorityStyle = styles.dialogPriorityStyle;\n      break;\n    }\n    case 'messages': {\n      priorityStyle = styles.messagesPriorityStyle;\n      break;\n    }\n    default: {\n      priorityStyle = styles.popupPriorityStyle;\n      break;\n    }\n  }\n\n  const classes = classNames([themeClasses, baseStyle, priorityStyle]);\n\n  // Really need useLayoutEffect instead of useEffect here. Otherwise the re-parented\n  // content does not get re-rendered with valid ref's\n  useLayoutEffect(() => {\n    const host =\n      level === 'topLevel'\n        ? context.getRootLayerHost?.(priority)\n        : context.getLayerHost?.(priority);\n\n    if (!host) return;\n    const doc = host.ownerDocument ?? document;\n    const layer: LayerElement = doc.createElement('div');\n\n    layer.setAttribute('data-oj-layer', 'true');\n\n    if (logicalParentRef) {\n      layer[LOGICAL_PARENT] = logicalParentRef.current;\n    }\n    // layer.style.position = 'relative';\n    host.appendChild(layer);\n    setLayerContainer(layer);\n\n    return () => {\n      if (host && layer && host.contains(layer)) {\n        delete layer[LOGICAL_PARENT];\n        host.removeChild(layer);\n      }\n      if (context.onLayerUnmount) {\n        context.onLayerUnmount(layer);\n      }\n      setLayerContainer(null);\n    };\n  }, [logicalParentRef, context, level, priority]);\n\n  // add the colorScheme and scale classes if there is a layerContainer\n  if (layerContainer) {\n    // use the theme interpolations to set the appropriate style classes for colorScheme and scale\n    layerContainer.className = classes;\n  }\n\n  const getLayerHost = () => {\n    return layerContainer;\n  };\n\n  let newLayerContext = {};\n\n  if (context.getLayerHost) {\n    newLayerContext = {\n      getRootLayerHost: context.getRootLayerHost?.bind(null, priority),\n      getLayerHost: getLayerHost.bind(null)\n    };\n  }\n\n  return (\n    <LayerContext.Provider value={newLayerContext}>\n      {layerContainer && createPortal(children, layerContainer)}\n    </LayerContext.Provider>\n  );\n};\n\nexport default Layer;\n"],"names":["useContext","LayerContext","useState","useRef","useThemeInterpolations","styles","classNames","baseStyle","useLayoutEffect","_jsx","createPortal"],"mappings":"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"}