{"version":3,"file":"IconUserAssistance-c226cb4f.js","sources":["../../src/UNSAFE_UserAssistance/IconUserAssistance.tsx"],"sourcesContent":["import { useCallback, useRef } from 'preact/hooks';\n\nimport { useTranslationBundle } from '#hooks/UNSAFE_useTranslationBundle';\nimport { usePress } from '#hooks/UNSAFE_usePress';\nimport { BundleType } from '#resources/nls/bundle';\n\nimport { HelpIcon } from '#PRIVATE_ThemedIcons/HelpIcon';\nimport { Popup } from '#UNSAFE_Popup';\nimport { HiddenAccessible } from '#UNSAFE_HiddenAccessible';\nimport { InlineHelp } from './InlineHelp';\nimport {\n  iconUserAssistanceIcon,\n  iconUserAssistancePopupFocus\n} from './themes/UserAssistanceStyles.css';\nimport { useComponentTheme } from '#hooks/UNSAFE_useComponentTheme';\nimport { classNames } from '#utils/UNSAFE_classNames';\nimport { PopupRedwoodTheme } from '#UNSAFE_Popup/themes/redwood/PopupTheme';\nimport { useToggle } from '#hooks/UNSAFE_useToggle';\n\ntype Props = {\n  /**\n   * Text to provide guidance to help the user understand what data to enter.\n   */\n  assistiveText?: string;\n  /**\n   * Help source URL associated with the component.\n   */\n  helpSourceLink?: string;\n  /**\n   * Custom text to be rendered for the `helpSourceLink`. \"Learn more\" will be used if no custom text is provided.\n   */\n  helpSourceText?: string;\n  /**\n   * Whether the trigger element is in tab sequence\n   */\n  isTabbable?: boolean;\n  /**\n   * ID of the pop up content that can be used for aria-describedby\n   */\n  id?: string;\n};\n\n/**\n * Created to match icon user assistance spec for use with radio option, pending design review\n * of inline UA assistance.\n */\nconst IconUserAssistance = ({\n  assistiveText,\n  helpSourceLink,\n  helpSourceText,\n  isTabbable = true,\n  id\n}: Props) => {\n  const { bool: isOpen, setFalse: setIsOpenFalse, toggle } = useToggle(false);\n\n  const translations = useTranslationBundle<BundleType>('@oracle/oraclejet-preact');\n  const userAssistance_learnMoreStr = translations.userAssistance_learnMore();\n  const sourceText = helpSourceLink && (helpSourceText || userAssistance_learnMoreStr);\n  const helpForRadioString = translations.radio_helpForRadio();\n  const helpStringId = `${id}-help-string`;\n  const anchorRef = useRef<HTMLSpanElement>(null);\n\n  const handleOutsideClick = useCallback(\n    (event: MouseEvent) => {\n      const target = event?.target;\n      // We need to filter out anchor click events, because anchor is responsible for the toggling\n      if (\n        (target instanceof Element || target instanceof Document) &&\n        !anchorRef.current?.contains(target) &&\n        isOpen\n      ) {\n        setIsOpenFalse();\n      }\n    },\n    [isOpen, setIsOpenFalse]\n  );\n\n  const handleOnKeyDown = useCallback(\n    (e: KeyboardEvent) => {\n      // allow user to close popup without having to focus it\n      if (['Tab', 'Escape'].includes(e.key) && isOpen) {\n        setIsOpenFalse();\n      }\n\n      // prevent scroll jump\n      if (e.code === 'Space') {\n        e.preventDefault();\n      }\n    },\n    [isOpen, setIsOpenFalse]\n  );\n\n  const { pressProps } = usePress((e) => {\n    e.preventDefault();\n    toggle();\n  });\n\n  const handleLinkEvent = useCallback(\n    (e: Event) => {\n      // if it's a key event that is not \"enter\", return early\n      const { key } = e as KeyboardEvent;\n      if (key && key !== 'Enter') {\n        return;\n      }\n\n      // We want to close the pop up if a link is triggered with mouse or keyboard\n      const { tagName } = e.target as Element;\n\n      if (tagName?.toLowerCase() === 'a') {\n        setIsOpenFalse();\n\n        // we want to refocus to the help icon after the browser has launched the link\n        // prematurely doing so prevents keyboard events from firing\n        setTimeout(() => anchorRef.current?.focus());\n      }\n    },\n    [setIsOpenFalse]\n  );\n\n  // We are referencing popup vars, so we need to bring in the baseTheme for popup\n  const { baseTheme: popupBaseTheme } = useComponentTheme(PopupRedwoodTheme);\n  const iconUserAssistanceClasses = classNames([popupBaseTheme, iconUserAssistancePopupFocus]);\n\n  return helpSourceLink || assistiveText ? (\n    <>\n      <span\n        {...pressProps}\n        role=\"link\"\n        aria-describedby={helpStringId}\n        aria-haspopup=\"dialog\"\n        ref={anchorRef}\n        tabIndex={isTabbable ? 0 : -1}\n        class={iconUserAssistanceIcon}\n        onKeyDown={handleOnKeyDown}\n        id={`${id}-help-icon`}>\n        <HelpIcon />\n      </span>\n      <HiddenAccessible id={helpStringId} isHidden={true}>\n        {helpForRadioString}\n      </HiddenAccessible>\n      <Popup\n        placement=\"top\"\n        isOpen={isOpen}\n        anchorRef={anchorRef}\n        onClose={setIsOpenFalse}\n        onClickOutside={handleOutsideClick}\n        shiftOptions={{ mainAxis: true, crossAxis: false }}\n        maxWidth={'296px'}>\n        <div\n          id={id}\n          tabIndex={0}\n          class={iconUserAssistanceClasses}\n          onMouseUp={handleLinkEvent}\n          onKeyDown={handleLinkEvent}>\n          <InlineHelp\n            assistiveText={assistiveText}\n            sourceLink={helpSourceLink}\n            sourceText={sourceText}\n          />\n        </div>\n      </Popup>\n    </>\n  ) : null;\n};\n\nexport { IconUserAssistance };\n"],"names":["_jsxs","_Fragment","_jsx","HelpIcon"],"mappings":"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"}