/*!
 * Copyright (c) 1999, 2024, Oracle and/or its affiliates.
 */
apex.model={},function(e,t,i,n,s,r,l){"use strict";const a="table",o="tree",d="record",h="Malformed response",c="refresh",u="addData",f="revert",g="refreshRecords",_="delete",p="clearChanges",y="set",I="destroy",m="one",v="none";let R={},x=[],w=100,M=10;const b=new Set(["genIdPrefix","pageItemsToSubmit","fetchData","saveData","regionData","requestOptions","parentRecordId","editable","pageSize","callServer","visibilityFilter","visibilityFilterContext","trackChanges","onlyMarkForDelete","delayClearData"]),k=n.hasOwnProperty,F=l.extend,D=Array.isArray,C=l.isPlainObject,K=e=>"function"==typeof e,A=l.Deferred,S=n.equalValue,T=r.toNumber;function O(e){return e.replace(/#/g,"").split(/\s*,\s*/)}function q(e){return"object"==typeof e&&k(e,"v")}function B(e){if("string"==typeof e)return[e,null];if(D(e)&&2===e.length&&"string"==typeof e[0]&&(null===e[1]||"string"==typeof e[1]))return e;throw new Error("Invalid model id")}const P=new Map;function E(e){let t=P.get(e);return t||(t=1e3),P.set(e,t+1),t}function V(e){if(D(e)){let t=[];for(let i=0;i<e.length;i++)t.push(V(e[i]));return t}return C(e)?F(!0,{},e):e}function N(e,t,n){let s=e._listeners;for(let r=0;r<s.length;r++)try{s[r].onChange(t,n)}catch(e){i.error("Error in model listener.",e)}}function j(e,t,i,n,s,r){e?t.call(e,i,n,s,r):t(i,n,s,r)}function z(e){e.allowedOperations&&(e.canEdit=!!e.allowedOperations.update,e.canDelete=!!e.allowedOperations.delete)}function U(e){return"string"==typeof e?e:D(e)?1===e.length?""+e[0]:JSON.stringify(e):e.toString()}function W(e,t){let i=[],s=[];function r(e){let t,n=e._listeners;for(let e=0;e<n.length;e++)t=n[e].progressView,t&&t[0]&&t[0].offsetWidth&&t[0].offsetHeight&&(i.push(t),s.push(n[e].progressOptions||null))}if(r(e),t)for(let e=0;e<t.length;e++)r(t[e]);return 0===i.length?null:e._options.makeLoadingIndicator?e._options.makeLoadingIndicator(i,s):function(){let e,t=l();for(let r=0;r<i.length;r++)e=n.showSpinner(i[r],s[r]),t=t.add(e);return function(){t.remove()}}}function $(e,t){return F({},e.requestOptions,{loadingIndicator:W(t)})}function H(e,t,i,n){let s,r=e;return n&&(r+=" Server status: "+n),s=new Error(r),t&&t.status>=0&&(s.status=t.status),s}function L(e,t){delete e.error,delete e.warning,delete e.message;for(let i in e.fields)if(k(e.fields,i)){let n=e.fields[i];t||(delete n.changed,delete n.stale),delete n.error,delete n.warning,delete n.message}}function G(e,t,i){let n=-1,s=-1;return t-1>=0&&(n=parseFloat(e[t-1][i])),t<e.length&&(s=parseFloat(e[t][i])),[n,s]}function J(e,t,i,n,s,r){let l;return-1===t&&(t=0),r&&r>t&&(-1===i||r<i)?r:(-1===i&&(i=t+e*n),l=i-t,t+l/(n+1)*s)}const Y=e=>new Error(`Model has invalid shape for the ${e} method`),X=e=>new Error(`Wrong data type for ${e} aggregate`),Q=()=>new Error("Model must have identityField defined"),Z=(e,t)=>new Error(`Field '${e}' depends on unknown field/item '${t}'`),ee=(e,t)=>new Error(e+" field not found: "+t);function te(e,t,i){var n,s,r,l;for(n in t)k(t,n)&&((s=t[n]).volatile||s.virtual||"string"==typeof(l=e[r=i?s.index:n])&&(e[r]=l.replace(/\r\n/g,"\n")))}function ie(e,t,i,n,r){let l=e._options,a=t.record,o=e._getIdentity(a),d=[];!function t(i,n,s){for(let r=0;r<i.length;r++){let a,o=i[r],d=l.fields[o];d&&!n[o]&&(d.dependsOn&&t(d.dependsOn,n,s),n[o]||!d.calcValue&&!d.dependsOn||(s.push(o),n[o]=1,a=e._dependentFields[o],a&&t(a,n,s)))}}(i,r||{},d);for(let i=0;i<d.length;i++){let r,h,c,u,f,g,_,p,I=d[i],m=l.fields[I];if(m.calcValue){g=[];for(let t=0;t<m.dependsOn.length;t++)c=m.dependsOn[t],":"===c.substr(0,1)?_=s(c.substr(1)).getValue():(u=l.fields[c],_=e.getValue(a,c),"NUMBER"===m.dataType&&(_=T(_,u?u.formatMask:null))),g.push(_);if(p=m.calcValue(g,e,a),r=e.getFieldKey(I),t.fields&&t.fields[I]&&t.fields[I].ck)throw new Error("Set calculated value not allowed for field");h=a[r],S(h,p)||(a[r]=p,t.fields||(t.fields={}),f=t.fields[I],f||(f={},t.fields[I]=f),l.trackChanges&&(f.changed=!0),n&&N(e,y,{oldValue:h,oldIdentity:null,recordId:o,record:a,field:I}),e._checkAggregates(I))}else m.cellTemplate?(r=e.getFieldKey(I),h=a[r],n&&N(e,y,{oldValue:h,oldIdentity:null,recordId:o,record:a,field:I})):(f=t.fields[I],f||(f={},t.fields[I]=f),f.stale=!0,n&&e.metadataChanged(o,I,"stale"))}}function ne(e,t){let i={},n=t.record,s=[];for(let t=0;t<e._calculatedFields.length;t++){let r=e._calculatedFields[t];null==n[e.getFieldKey(r)]?s.push(r):i[r]=1}s.length>0&&ie(e,t,s,!1,i)}const se={SUM:{name:"SUM",init:function(e){if(e.dataType&&"NUMBER"!==e.dataType)throw X("SUM");e.total=0,e.grandTotal=0},add:function(e,t){t=T(t,e.formatMask),isNaN(t)||(e.total+=t,e.grandTotal+=t)},get:function(e,t){const i=t?e.total:e.grandTotal;return t&&(e.total=0),i}},AVG:{name:"AVG",init:function(e){if(e.dataType&&"NUMBER"!==e.dataType)throw X("AVG");e.total=0,e.grandTotal=0,e.count=0,e.totalCount=0},add:function(e,t){t=T(t,e.formatMask),isNaN(t)||(e.total+=t,e.grandTotal+=t,e.count+=1,e.totalCount+=1)},get:function(e,t){const i=t?e.total/e.count:e.grandTotal/e.totalCount;return t&&(e.total=0,e.count=0),i}},MAX:{name:"MAX",init:function(e){e.max=null,e.overallMax=null},add:function(e,t){"NUMBER"===e.dataType?t=T(t,e.formatMask):t.d&&(t=t.d),null===t||""===t.toString().trim()||isNaN(t)||((null===e.max||t>e.max)&&(e.max=t),(null===e.overallMax||t>e.overallMax)&&(e.overallMax=t))},get:function(e,t){const i=t?e.max:e.overallMax;return t&&(e.max=null),i}},MIN:{name:"MIN",init:function(e){e.min=null,e.overallMin=null},add:function(e,t){"NUMBER"===e.dataType?t=T(t,e.formatMask):t.d&&(t=t.d),null===t||""===t.toString().trim()||isNaN(t)||((null===e.min||t<e.min)&&(e.min=t),(null===e.overallMin||t<e.overallMin)&&(e.overallMin=t))},get:function(e,t){const i=t?e.min:e.overallMin;return t&&(e.min=null),i}},MEDIAN:{name:"MEDIAN",init:function(e){e.values=[],e.allValues=[]},add:function(e,t){t=T(t,e.formatMask),isNaN(t)||(e.values.push(t),e.allValues.push(t))},get:function(e,t){const i=t?e.values:e.allValues,n=i.length;let s;return i.sort((function(e,t){return e-t})),s=n%2==0?(i[n/2]+i[n/2-1])/2:i[(n-1)/2],t&&(e.values=[]),s}},COUNT:{name:"COUNT",init:function(e){e.count=0,e.totalCount=0},add:function(e,t){t.v&&(t=t.v),null!==t&&""!==t.toString().trim()&&(e.count+=1,e.totalCount+=1)},get:function(e,t){const i=t?e.count:e.totalCount;return t&&(e.count=0),i}},COUNT_DISTINCT:{name:"COUNT_DISTINCT",init:function(e){e.count=0,e.totalCount=0,e.distinctValues={}},add:function(e,t){t.v&&(t=t.v),null!==t&&""!==t.toString().trim()&&(e.distinctValues[t]||(e.count+=1,e.totalCount+=1),e.distinctValues[t]=1)},get:function(e,t){const i=t?e.count:e.totalCount;return t&&(e.count=0),i}}},re={modelId:function(){return null===this.instance?this.name:[this.name,this.instance]},_addToFetchRequest:function(e,t){let n,s,r=this,l=this._options;if(l.shape===a){let e,i=null,s=(c=t,u=l.pageSize,Math.floor(c/u)*u);if(!this._clearDataPending&&(t=function(e){let t,i=r._data;for(t=e;t<i.length&&void 0!==i[t];t++);return t}(s),this._haveAllData&&t>=this._data.length||this._masterRecordIsInserted||this._masterRecordIsDeleted))return!1;if(l.paginationType===v&&0!==t)return!1;e=this._getServerOffset(t),l.paginationType!==v&&(i=s+l.pageSize-e,i<l.pageSize&&void 0===this._data[s+l.pageSize]&&(i+=l.pageSize)),n={version:l.version,firstRow:e+1,maxRows:i}}else{if(l.shape===d&&this._haveAllData)return!1;n={version:l.version}}var c,u;if(this._requestsInProgress.fetch)return null;if(s=F({},l.regionData,{id:l.regionId,ajaxIdentifier:l.ajaxIdentifier,fetchData:F({},l.fetchData,n)}),e.regions||(e.regions=[]),e.regions.push(s),l.pageItemsToSubmit){let t,i=e.pageItems;i?D(i)||(i=O(i),e.pageItems=i):(i=[],e.pageItems=i),t=l.pageItemsToSubmit,D(t)||(t=O(t));for(let e=0;e<t.length;e++)i.includes(t[e])||i.push(t[e])}return this._addParentItems(s),this._requestsInProgress.fetch=!0,function(e){e.done((function(e){let n=!1;if(delete r._requestsInProgress.fetch,!r._destroyed){if(e.regions)for(let i=0;i<e.regions.length;i++){let s=e.regions[i];if(s.id===l.regionId){let e=null,i=null,h=null,c=null,u=null;s=s.fetchedData,l.shape===a?(e=s.values,i=s.totalRows,h=s.firstRow-1,c=s.moreData,u=s.dataOverflow):l.shape===o?e=s.root:l.shape===d&&(e=s.value),(e||l.shape===d)&&(r._checkClearPending(),r._addData(t,h,e,i,c,u),n=!0)}}if(!n){let t=H(h);i.error("Failed to fetch data.",t),e.error=t}}})).fail((function(){delete r._requestsInProgress.fetch}))}},fetch:function(e,t,i){let n,s,r,l,a=this._options,o=A(),d={};return"number"!=typeof e&&(i=t,t=e,e=0),s=this._addToFetchRequest(d,e),s?(l=F({},a.requestOptions),i?delete l.loadingIndicator:l.loadingIndicator=W(this),n=this._callServer(d,l),s(n),n.done((e=>{e.error?o.reject(e.error):e.errors?o.reject(e.errors):o.resolve()})).fail(((e,t,i)=>{o.reject(H("Error fetching data.",e,0,i))})),r=o.promise(),r.always((e=>{this._destroyed||(t&&t(e),this._drainWaiters(e))})),r):s},fetchAll:function(e,t=!0){const i=this,s=this._options,r=s.pageSize,o="m"+this.modelId();let d,h,c,u=0;if(s.shape!==a)throw Y("fetchAll");if(r<1e3&&(s.pageSize=1e3),d=s.pageSize,!t){const e=l('<span class="u-Processing u-Processing--inline"><span class="u-Processing-spinner"></span></span>');h=W(this),h&&n.delayLinger.start(o,(function(){c=h(e)}))}for(;this._data[u];)u+=1;!function t(){const l=i.fetch(u,(function(n){n?e({error:n}):(e({offset:u,total:i.getTotalRecords(),done:!1}),u+=d,t())}),!0);null===l?setTimeout((function(){t()}),500):!1===l&&(s.pageSize=r,h&&n.delayLinger.finish(o,(function(){K(c)?c():c.remove()})),e({offset:u,total:i.getTotalRecords(),done:!0}))}()},fetchRecords:function(e,t){let n,s,r,l,a,o=this._options,c=[],u=A();if(o.shape===d)throw Y("fetchRecords");if(void 0===this._identityKeys)throw Q();for(let t=0;t<e.length;t++){let i=this._getIdentity(e[t]),n=this.getRecordMetadata(i);n&&!n.inserted&&c.push({recordId:i,pk:this._getPrimaryKey(e[t])})}return 0===c.length?null:(a=F({},o.regionData,{id:o.regionId,ajaxIdentifier:o.ajaxIdentifier,fetchData:F({},o.fetchData,{version:o.version,primaryKeys:c})}),r={regions:[a]},o.pageItemsToSubmit&&(r.pageItems=o.pageItemsToSubmit),this._addParentItems(r.regions[0]),l=$(o,this),n=this._callServer(r,l),n.done((e=>{let t;if(!this._destroyed){if(e.regions&&e.regions.length>0){let i=e.regions[0];i.fetchedData&&i.id===o.regionId&&(t=i.fetchedData.values)}if(t)this._updateData(t),u.resolve();else{let e=H(h);i.error("Failed update data.",e),u.reject(e)}}})).fail((function(e,t,i){u.reject(H("Error fetching records.",e,0,i))})),s=u.promise(),t&&s.always(t),s)},save:function(e){let t,i,n,s=$(this._options,this),r=A(),l={};return i=this.addChangesToSaveRequest(l),i?(t=this._callServer(l,s),i(t),t.done((function(e){e.errors?r.reject(e.errors):e.error?r.reject(e.error):r.resolve(null,e)})).fail((function(e,t,i){r.reject(H("Error saving data.",e,0,i))})),n=r.promise(),e&&n.always(e),n):null},saveInProgress:function(){return!!this._requestsInProgress.save},addChangesToSaveRequest:function(e){let t,s,r,l,a,o,d,c=this,u=this._options,f=this._metaKey,g=[],_=[],p={},y=[],I=0;function m(){delete c._requestsInProgress.save,c._changes=c._pendingChanges.concat(c._changes)}function v(e){let t,i,n,s,r,l,a=e.record;r=e.inserted&&!e.originalId,t=u.recordIsArray?[]:{};for(let s=0;s<_.length;s++)n=_[s],i=a[n],null!==i&&q(i)&&(i=i.v),l=p[n],e.fields&&e.fields[l]&&e.fields[l].disabled&&(i=""),!r||!c.isIdentityField(l)||e.original&&i!==e.original[n]||(i=""),"string"==typeof i&&(i=i.replace(/\n/g,"\r\n")),u.recordIsArray?t.push(V(i)):t[n]=V(i);s=null,e.deleted?s="d":e.inserted?s="i":e.updated&&(s="u"),t[f]||(t[f]={}),s&&(t[f].op=s),t[f].recordId=c._getIdentity(a),e.originalId&&(t[f].originalId=e.originalId),u.saveSelection&&(t[f].sel=e.sel?"Y":"N"),y.push(t)}if(u.pageItemsToSubmit){let t,i=e.pageItems;if(i||(i=[],e.pageItems=i),D(i)){t=u.pageItemsToSubmit,D(t)||(t=O(t));for(let e=0;e<t.length;e++)i.includes(t[e])||i.push(t[e])}}if(this._requestsInProgress.save||0===this._changes.length&&!u.saveSelection)return null;for(let e in u.fields)k(u.fields,e)&&(t=u.fields[e],t.virtual||(I+=1),t.volatile||t.virtual||(s=u.recordIsArray?t.index:e,_.push(s),p[s]=e,u.recordIsArray&&t.index===this._metaKey&&(f=_.length-1)));u.recordIsArray&&_.sort((function(e,t){return e-t})),f||(f=u.recordIsArray?_.length:"_meta");for(let e=0;e<this._changes.length;e++)r=this._changes[e],r.autoInserted&&!r.updated&&g.push(r.record);g.length&&this.deleteRecords(g);for(let e=0;e<this._changes.length;e++)r=this._changes[e],v(r);if(this._pendingChanges=this._changes,this._changes=[],u.saveSelection)for(const e of this._selection.values())e.inserted||e.deleted||e.updated||v(e);l=e.regions,l||(e.regions=l=[]);for(let e=0;e<l.length&&(a=l[e],a.id!==u.regionId);e++)a=null;return a||(a=F({},u.regionData,{id:u.regionId,ajaxIdentifier:u.ajaxIdentifier,saveData:{models:[]}}),l.push(a)),o=a.saveData.models,d=F({},u.saveData,{instance:this.instance,version:u.version,values:y}),this._addParentItems(d),o.push(d),this._requestsInProgress.save=!0,function(e){e.done((function(e){let t,s;if(!c._destroyed){if(e.errors){for(let t=0;t<e.errors.length;t++){let i=e.errors[t],s=i.message;i.unsafe||(s=n.unescapeHTML(s)),i.regionStaticId===u.regionStaticId&&i.recordId&&i.instance==c.instance&&c.setValidity("error",i.recordId,i.columnName||null,s)}m()}else if(e.regions){let n,r=!1,l=null;for(let i=0;i<e.regions.length;i++){if(t=e.regions[i],t.id===u.regionId){n=t.fetchedData.models;for(let e=0;e<n.length;e++)if(n[e].instance==c.instance){l=n[e].values,c._metaKey||(s=u.recordIsArray?I:"_meta"),l&&(c._updateData(l,s),r=!0);break}break}t=null}if(!r){let t=H(h);i.error("Failed update data after save.",t),e.error=t}c._clearChanges("_pendingChanges")}delete c._requestsInProgress.save}})).fail((function(){m()}))}},setData:function(e,t=0,i=null,n=!1){let s={clearDataPending:!1};this._options.shape===a&&(s.keepPagination=!1),null===i&&e&&!n&&(i=e.length),this._checkClearPending(),this._addData(t,t,e,i,n,!1),0!==t&&null!==t||N(this,c,s)},clearData:function(e=!0,t=!1){const i=this._options;let n=this._requestsInProgress,s={clearDataPending:!1};return!n.fetch&&!n.save&&(i.shape===a&&(s.keepPagination=Boolean(t)),i.delayClearData?(this._clearDataPending=!0,s.clearDataPending=!0):this._clear(),e&&N(this,c,s),!0)},getTotalRecords:function(e){let t=this._options;return t.shape===a?this._haveAllData||t.paginationType===v?this._data.length:this._totalRecords<0&&!0!==e?this._totalRecords:Math.max(this._data.length,this._totalRecords):t.shape===d?e&&null===this._data?0:1:t.shape===o?this._index.size:void 0},getServerTotalRecords:function(){const e=this._options;return e.shape===a?this._totalRecords<0?this._totalRecords:this._totalRecords+this._numInsertedRecords-this._numDeletedRecords:e.shape===d?1:e.shape===o?-1:void 0},getDataOverflow:function(){return!!this._dataOverflow},forEach:function(e,t){const i=this._options,n=this._data;if(i.shape===d)throw Y("forEach");if(i.shape===o){let i=0;n&&this.walkTree(n,{node:n=>{j(t,e,n,i,this._getIdentity(n)),i+=1}})}else{const i=n.length;for(let s=0;s<i;s++){let i=n[s];i&&j(t,e,i,s,this._getIdentity(i,s))}}},transform:function(e,t){var i,n,s,r,l,a=/^\[\W*([^ \t/]+)\W*]$/,o=e.template,d=e.showNullAs,h=o.length,c=[],u={},f=this;function g(e,t){var i;return(i=e[t])||(i={values:{},paths:[]},e[t]=i),i}function _(e,t,i,n,s,r){var l,o,d,h,c,u,f,_;if(e){for(c=e.split("/"),u=n,f=null,_=null,d=null,l=0;l<c.length;l++){if(d=c[l],o=a.exec(d)){g(r,o[1]).paths[t]=c.slice(l+1).join("/");break}f=u,_=d,k(u,d)||(u[d]={}),u=u[d]}f?(D(f[_])?(h=f[_]).length=0:h=[],f[_]=h):h=n,s[t]=h}else{if(!D(n))throw new Error("Context must be an array when there is no path");s[t]=n}i&&g(r,i)}function p(e,i,n,s){var r,l,a,o,h=!1;return"string"==typeof e?(r=e.length,a=e.charAt(0),o=e.charAt(r-1),"'"===a&&"'"===o?e.substring(1,r-1):("("===a&&")"===o&&(e=e.substring(1,r-1),h=!0),null!==(l=f.getValue(i,e))&&"object"==typeof l&&k(l,"d")&&(l=h?l.v:l.d),h||!d||null!==l&&""!==l||(l=d),l)):K(e)?e.call(t,f,i,n,s):null===e?e:D(e)?function(e,t,i,n,s){var r,l;for(r=0;r<e.length;r++)void 0!==(l=p(e[r],i,n,s))&&(t[r]=l);return t}(e,[],i,n,s):"object"==typeof e?function(e,t,i,n,s){var r,l;for(r in e)k(e,r)&&void 0!==(l=p(e[r],i,n,s))&&(t[r]=l);return t}(e,{},i,n,s):void 0}function y(e,t,i,n){var s,r,l,o=[];if(e)for(e=e.split("/"),s=0;s<e.length;s++)r=e[s],(l=a.exec(r))&&o.push({key:l[1],value:p(l[1],t,i,n)});return o}function I(i,n,s){var a,d,I,m,v,R,x,w,M,b,k;if(!(n<r||l>0&&n>=r+l)&&(e.includeAggregates||!f._metaKey||!i[f._metaKey].agg)&&(!e.filter||e.filter.call(t,f,i,n,s)))for(a=0;a<h;a++)if(R=null,I=o[a],m=c[a],!I.filter||I.filter.call(t,f,i,n,s)){if(I.uniqueIndexField&&(R=u[I.uniqueIndexField],x=p(I.uniqueIndexField,i,n,s),void 0!==R.values[x]))continue;if(void 0!==(v=p(I.item,i,n,s))){if(R)R.values[x]={index:m.length,arrays:[],indexes:{}};else for(w=y(I.path,i,n,s),k=u,d=0;d<w.length;d++)void 0===(M=(R=g(k,w[d].key)).values[w[d].value])&&(M={index:m.length,arrays:[],indexes:{}},b=""===R.paths[a]?[]:{},m.push(b),R.values[w[d].value]=M),b=m[M.index],M.arrays[a]||_(R.paths[a],a,null,b,M.arrays,M.indexes),m=M.arrays[a],k=M.indexes;m.push(v)}}}for(null!==t&&"object"==typeof t||(t={}),function(){var e,i;for(e=0;e<o.length;e++)_((i=o[e]).path,e,i.uniqueIndexField,t,c,u)}(),r=0,e.offset>=0&&(r=e.offset),l=e.fetchData?this._options.pageSize:null,e.count>0&&(l=e.count),e.fetchData?this.forEachInPage(r,l,I):this.forEach(I),i=0;i<h;i++)n=o[i],s=c[i],n.sort&&s.array.sort(n.sort);return t},forEachInPage:function(e,t,n,s){const r=this,l=this._options,o=this._data;let d,h,c=e;function u(l){const a=t-(l-e);let o,d;i.trace("Model: "+r.modelId()+". forEachInPage fetching more data starting at: ",l),r._waitingPages.push({offset:l,callback:n,thisArg:s,next:function(){r.forEachInPage(l,a,n,s)}}),r._requestsInProgress.fetch||(d=r.fetch(l,(function(e){e||setTimeout((function(){r._waitingPages.length>0&&(o=r._waitingPages.shift(),o.next())}),1)})),d||(r._waitingPages.pop(),j(s,n,null,-1,null)))}if(l.shape!==a)throw Y("forEachInPage");if(t>l.pageSize&&(l.pageSize=10*Math.floor((t+9)/10)),l.paginationType===m&&(c=e-this._offset),this._clearDataPending)u(e);else if(c<0||c>=o.length)this._haveAllData?(j(s,n,null,-1,null),this._drainWaiters()):u(e);else{d=c+t,h=e;for(let e=c;e<d;e++){let t,i=o[e];if(void 0===i)return void(this._haveAllData&&e>=o.length?(j(s,n,null,-1,null),this._drainWaiters()):u(e+this._offset));i&&(void 0!==o[e+1]||this._haveAllData&&e+1>=o.length||(t=!1),j(s,n,i,h,this._getIdentity(i,e),t),h+=1)}this._drainWaiters()}},indexOf:function(e){const t=this._options.shape;if(t===d)throw Y("indexOf");if(e&&void 0!==this._identityKeys){let i=this.getRecordMetadata(this._getIdentity(e));if(t===o)return i&&i.parent?i.parent[this._childrenKey].indexOf(e):-1;if(i)return i.index}return this._data.indexOf(e)},recordAt:function(e){if(this._options.shape!==a)throw Y("recordAt");return this._data[e]||null},getRecordId:function(e){return this._getIdentity(e)},getControlBreakId:function(e){let t=null;if(this._controlBreakKeys?.length>0){t="";for(let i=0;i<this._controlBreakKeys.length;i++){let n=e[this._controlBreakKeys[i]];n?.v&&(n=n.v),t.length>0&&(t+="|"),t+=n}}return t},hasControlBreaks:function(){return Boolean(this._controlBreakKeys)},getControlBreaks:function(e){if(!this._controlBreakKeys)return null;const t=(e,t)=>({id:e,firstId:t.firstId,lastId:t.lastId,firstIndex:t.firstId?this.getRecordMetadata(t.firstId)?.index:null,lastIndex:t.lastId?this.getRecordMetadata(t.lastId)?.index:null});if(e){const i=this._controlBreaksMap.get(e);return i?t(e,i):null}let i=[];for(const[e,n]of this._controlBreaksMap)i.push(t(e,n));return i.sort(((e,t)=>e.firstIndex-t.firstIndex)),i},getAggregateRecord:function(e,t){let i,n,s,r,l=null;if(null!=t){if(s=this._controlBreaksMap.get(t)?.lastId,s&&(i=this.indexOf(this.getRecord(s))),i>=0)for(r=!1;i<this._data.length;i++)if(l=this._data[i],n=l[this._metaKey],n&&n.agg){if(r=!0,n.agg===e)break}else if(r){l=null;break}}else for(i=this._data.length-1;i>=0;i--){if(l=this._data[i],n=l[this._metaKey],!(n&&n.agg&&n.grandTotal)){l=null;break}if(n.agg===e)break}return l},isIdentityField:function(e){return void 0!==this._identityKeys&&this._identityKeys.includes(this.getFieldKey(e))},getRecordMetadata:function(e){const t=this._options;let i,n;return n=e||t.shape!==d?U(e):t.identityField?this.getRecordId(this._data):"0",i=this._index.get(n),i||null},metadataChanged:function(e,t=null,i=null){let n=this._index.get(U(e));n&&N(this,"metaChange",{record:n.record,recordId:e,field:t,property:i})},getTypeMetadata:function(e){return this._options.types[e]||null},getFieldMetadata:function(e){return this._options.fields[e]||null},getFieldKey:function(e){const t=this._options;if(k(t.fields,e)&&!t.fields[e].virtual)return t.recordIsArray?t.fields[e].index:e},isChanged:function(){let e=0;if(0===this._changes.length)return!1;for(let t=0;t<this._changes.length;t++){let i=this._changes[t];i.autoInserted&&!i.updated||(e+=1)}return e>0},getChanges:function(){return this._changes},clearChanges:function(){this._clearChanges("_changes")},hasErrors:function(){return this._errors.length>0},getErrors:function(){return this._errors},setHiddenState:function(e,t){let i=this.getRecordMetadata(e);i&&i.hidden!==t&&(i.hidden=t,this.metadataChanged(e,null,"hidden"))},updateVisibility:function(e=null){const t=this._options,i=t.visibilityFilter;if(i){null!==e&&(t.visibilityFilterContext=e);let n=this,s=t.visibilityFilterContext;if(null===s)return;if(t.shape===o){let e=[];n.walkTree(n.root(),{node:function(t){if(!1===n.hasChildren(t)){let r=i(n,t,s);n.setHiddenState(n.getRecordId(t),!r),r&&(e[e.length-1]=r)}},beginChildren:function(){e.push(null)},endChildren:function(t){let r=!1,l=e.pop();0===e.length&&(r=!0,l=!0),null===l&&(l=i(n,t,s)),n.setHiddenState(n.getRecordId(t),!l),l&&!r&&(e[e.length-1]=l)}},null)}else t.shape===a&&n.forEach((function(e,t,r){let l=i(n,e,s);n.setHiddenState(r,!l)}))}},setDisabledState:function(e,t){let i=this.getRecordMetadata(e);i&&i.disabled!==t&&(i.disabled=t,this._numDisabledRecords+=t?1:-1,this.metadataChanged(e,null,"disabled"))},setSelectionState:function(e,t,i="set"){let n,s,r,l;const a=(e,t)=>!t.agg&&!this.isDisabled(e,t),o=(e,t)=>{let i=!1;for(let l=e;l<t;l++)r=this._data[l],r?(n=this._getIdentity(r,l),s=this._index.get(n),s&&a(r,s)&&(s.sel=!0,this._selection.set(n,s))):i=!0;return i};if("all"===i)l=o(0,this.getTotalRecords(!0)),l&&(this._selectRange=[]),this._selectAll=!0;else if("anchor"===i&&null==e)this._selectAnchor=null;else if(n=U(e),s=this._index.get(n),s){if(t=!!t,this._selectAll&&(this._selectAll=!1,["set","range"].includes(i)&&this.clearSelection()),"range"===i){let e,t,i=s.index;s=this._index.get(this._selectAnchor),s&&(t=s.index,i>t&&(e=i,i=t,t=e),l=o(i,t+1),l&&(this._selectRange=[i,t]))}else"anchor"===i?a(s.record,s)&&(this._selectAnchor=n):(a(s.record,s)&&(s.sel!==t&&(s.sel=t,t?this._selection.set(n,s):this._selection.delete(n)),this._selectAnchor=n),"toggle"!==i&&(this._selectRange=null));if(!this._selectAll){let e=this._index.size-this._numAggregateRecords-this._numDisabledRecords;this.getSelectedCount()===e&&(this._selectAll=!0)}}},clearSelection:function(){for(const e of this._selection.values())e.sel=!1;this._selection.clear(),this._selectAll=!1,this._selectRange=null},getSelectedCount:function(){return this._selection.size},getSelectedRecords:function(){return[...this._selection.values()].sort(((e,t)=>e.index-t.index)).map((e=>e.record))},getSelectionState:function(){return{selectAll:this._selectAll,incomplete:null!=this._selectRange,rangeAnchor:this._selectAnchor}},allowEdit:function(e){return this.check("canEdit",e)},allowDelete:function(e){const t=this._options;if(t.shape===d||t.shape===o&&e===this._data)return!1;if(t.shape===o){let t=!0,i=!1;if(this.walkTree(e,{node:e=>{if(i&&t&&(this.check("canDelete",e)||(t=!1)),!t)return!0},beginChildren:()=>{i=!0}}),!t)return!1}return this.check("canDelete",e)},allowAdd:function(e,t,i){const n=this._options;let s,r,l;if(n.shape===d)return!1;if(!(n.shape!==o||e&&e[this._childrenKey]))return!1;if(r=this.check("canAdd",e,t,i),r&&i&&n.shape===o&&(l=this._getType(e),s=void 0!==l.validChildren?l.validChildren:void 0===n.types.default.validChildren||n.types.default.validChildren,!0!==s))for(let e=0;e<i.length;e++)if(!s.includes(i[e][this._typeKey])){r=!1;break}return r},allowDrag:function(e){return this._options.shape!==d&&this.check("canDrag",e)},dragOperations:function(e){const t=this._options;let i,n;if(e){if(e.length>0&&this._typeKey){n=e[0][this._typeKey]||"default";for(let t=1;t<e.length;t++)if((e[t][this._typeKey]||"default")!==n){n="default";break}}else n="default";i=t.types[n].operations&&void 0!==t.types[n].operations.drag?t.types[n].operations.drag:t.types.default.operations.drag}else i=t.types.default.operations.externalDrag;return i},check:function(e,t,i,n){const s=this._options,r=this._getType(t);let l,a=!1;if(!s.editable||this._masterRecordIsDeleted||this._clearDataPending)return!1;if(t&&(l=this.getRecordMetadata(this._getIdentity(t)),l)){if(l.deleted||l.agg)return!1;if(l.inserted&&("canEdit"===e||"canDelete"===e))return!0}return l&&void 0!==l[e]?a=l[e]:r.operations&&void 0!==r.operations[e]?a=r.operations[e]:void 0!==s.types.default.operations[e]&&(a=s.types.default.operations[e]),K(a)&&(a=a.call(this,t,i,n)),K(s.check)&&(a=s.check(a,e,t,i,n)),a},isDisabled:function(e,t){const n=this._options,s=this._getType(e);let r=!1;return t?t.record!==e&&i.warn("Model: incorrect metadata or duplicate record id detected:",this.getRecordId(e)):t=this.getRecordMetadata(this.getRecordId(e)),null!=t.disabled?r=t.disabled:void 0!==s.isDisabled?r=s.isDisabled:void 0!==n.types.default.isDisabled&&(r=n.types.default.isDisabled),r},getValue:function(e,t){return void 0===t&&(t=e,e=this._data),e[this.getFieldKey(t)]},setValue:function(e,t,n,s){var r,l,a,d,h,c,u,f,g,_,p,I,m,v=this._options,R=!1;if(void 0===n&&(n=t,t=e,e=this._data),a=this.getFieldKey(t),!this.allowEdit(e))throw new Error("Set value not allowed for record");if(u=this._getIdentity(e),!(d=this.getRecordMetadata(u)))return null;if(m=v.fields[t],void 0===a||m.readonly&&!m.parentField||d.fields&&d.fields[t]&&d.fields[t].ck)throw new Error("Set value not allowed for field");if(this._controlBreakKeys?.includes(a)&&i.warn("Setting value of a control break field."),l=e[a],!S(l,n)){if(!s&&(t===v.sequenceField||t===v.parentIdentityField))if(f=g=_=null,t===v.sequenceField){if(v.shape===o?(g=this.parent())&&(f=g[this._childrenKey]):f=this._data,f){let t=parseFloat(n);for(r=0;r<f.length&&!(parseFloat(f[r][this._sequenceKey])>t);r++)_=f[r];_===e&&(_=null)}}else t===v.parentIdentityField&&(g=this.getRecord(n));if(d.original||(d.original=function(e){let t,i;if(D(e))for(i=[],t=0;t<e.length;t++)i[t]=V(e[t]);else for(t in i={},e)k(e,t)&&(i[t]=V(e[t]));return i}(e),R=!0),e[a]=n,(c=this._getIdentity(e))!==u){if(this._index.has(c))return e[a]=l,R&&delete d.original,"DUP";d.originalId||(d.originalId=u),this._index.delete(u),this._index.set(c,d),d.sel&&(this._selection.delete(u),this._selection.set(c,d))}return d.updated||d.deleted||d.inserted||this._addChange(d),v.trackChanges&&(d.updated=!0),d.fields||(d.fields={}),(h=d.fields[t])||(h={},d.fields[t]=h),v.trackChanges&&(h.changed=!0),(d.error||d.warning)&&this.setValidity("valid",c),N(this,y,{oldValue:l,oldIdentity:c!==u?u:null,recordId:c,record:e,field:t}),this._checkAggregates(t),(p=this._dependentFields[t])&&(m.calcValue&&((I={})[t]=1),ie(this,d,p,!0,I)),(g||_)&&this.moveRecords([e],g,_),"SET"}return"NC"},getRecordValue:function(e,t){return this.getValue(this.getRecord(e),t)},setRecordValue:function(e,t,i){this.setValue(this.getRecord(e),t,i)},setValidity:function(e,t,i,n){let s,r,l,a,o,d,h,c=this._index.get(U(t));if(c&&(i?(c.fields||(c.fields={}),r=c.fields[i],r||(r={},c.fields[i]=r)):r=c,o="valid",d=r.message||n,r.warning&&(o="warning"),r.error&&(o="error"),e!==o||d!==n)){switch(h="message",e){case"error":s="error",delete r.warning;break;case"warning":s="warning",delete r.error;break;case"valid":delete r.error,delete r.warning,delete r.message;break;default:throw new Error("Invalid value for pValidity parameter: "+e)}if(e!==o&&("valid"!==o&&(h+=","+o),s&&(h+=","+s)),s&&(r[s]=!0,r.message=n),l=c.error,!l&&c.fields)for(let e in c.fields)if(k(c.fields,e)&&c.fields[e].error){l=!0;break}l?(a=this._errors.indexOf(c),a>=0&&this._errors.splice(a,1),this._errors.push(c)):this._removeError(c),this.metadataChanged(t,i,h)}},deleteRecords:function(e){const t=this._options,n=[],s=[],r=[];let l=-1;if(t.shape===d)throw Y("deleteRecords");for(let s=0;s<e.length;s++){let r=e[s],l=this._getIdentity(r);this.getRecordMetadata(l)?this.allowDelete(r)?t.shape===o?this.walkTree(r,{postNode:e=>{n.push(e)}}):n.push(r):i.warn("Delete not allowed for record: "+l):i.warn("Record to delete not found: "+l)}for(let e=0;e<n.length;e++){const i=n[e],o=this._getIdentity(i),d=this.getRecordMetadata(o);t.shape===a&&(this._numDeletedRecords+=1),t.onlyMarkForDelete&&!d.inserted||(t.shape===a&&d.inserted&&(this._numDeletedRecords-=1,this._numInsertedRecords-=1),this._removeRecord(o,d),t.shape===a&&(-1===l||d.index<l)&&(l=d.index)),d.inserted?(delete d.inserted,delete d.autoInserted,delete d.updated,this._removeError(d),this._removeChange(d)):(L(d,!0),this._removeError(d),t.trackChanges&&(d.deleted=!0),this._addChange(d)),s.push(i),r.push(o)}return l>=0&&this._resequenceServerOffset(l),s.length>0&&(N(this,_,{records:s,recordIds:r}),this._checkAggregates()),s.length},canRevertRecord:function(e){const t=this.getRecordMetadata(this._getIdentity(e));return!(!t||!t.original&&!t.deleted)},revertRecords:function(e){const t=this._options;let n={},s=[],r=[];for(let l=0;l<e.length;l++){let h,c,u=e[l],f=this._getIdentity(u),g=this.getRecordMetadata(f);g?g.original||g.deleted?(t.shape===a?(h=this._data,c=g.index):t.shape===o&&(h=this.parent(g.record)[this._childrenKey],c=h.indexOf(g.record)),g.deleted?(t.shape===a&&(this._numDeletedRecords-=1),delete g.deleted):(g.originalId&&(this._index.set(g.originalId,g),this._index.delete(f),g.sel&&(this._selection.set(g.originalId,g),this._selection.delete(f)),n[f]=g.originalId,delete g.originalId),g.original&&(g.record=g.original,delete g.original),delete g.updated),L(g),this._removeError(g),this._removeChange(g),u=g.record,t.shape!==d&&h[c]!==u&&(h[c]=u),s.push(u),r.push(f)):i.warn("Nothing to revert for record "+f):i.warn("Record to revert not found: "+f)}return s.length>0&&(N(this,f,{records:s,recordIds:r,newIds:n}),this._checkAggregates()),s.length},insertNewRecord:function(e,t,i){const n=this._options;let s,r,l,h,c,u,f=!1,g=!1,_=null;if(n.shape===d)throw Y("insertNewRecord");if(h=this._initRecord(i,null,e),!this.allowAdd(e,"new",[h]))throw new Error("Insert not allowed for new record");if(n.shape===o?(u=e||this._data,c=u[this._childrenKey]):c=this._data,r=0,l=this._getIdentity(h),t){let e;if(_=this._getIdentity(t),e=this.getRecordMetadata(_),e&&(r=n.shape===a?e.index+1:c.indexOf(e.record)+1,this._controlBreakKeys&&e.endControlBreak)){const n=this.getControlBreakId(t);let s=this._controlBreaksMap.get(n);g=!0,i&&n!==this.getControlBreakId(h)?f=!0:(s.lastId=l,delete e.endControlBreak,this._metaKey&&delete t[this._metaKey].endControlBreak)}}else this._controlBreakKeys&&i&&this.getControlBreakId(this.recordAt(0))!==this.getControlBreakId(h)&&(f=!0,g=!0);if(this._sequenceKey){let e=parseFloat(h[this._sequenceKey])||null,[t,i]=G(c,r,this._sequenceKey);h[this._sequenceKey]=""+J(n.sequenceStep,t,i,1,1,e)}if(!i&&this._controlBreakKeys){const e=t||this.recordAt(0);if(e){const t=this.getControlBreakId(e);let i=this._controlBreaksMap.get(t);for(let e=0;e<this._controlBreakKeys.length;e++)h[this._controlBreakKeys[e]]=i.values[e]}else f=!0,g=!0}if(c.splice(r,0,h),s={record:h},n.shape===a&&(this._reindex(r+1),s.index=r),g&&(this._metaKey&&(h[this._metaKey].endControlBreak=!0),s.endControlBreak=!0),f){let e=this.getControlBreakId(h),t={values:this._controlBreakKeys.map((e=>h[e])),firstId:l,lastId:l};this._controlBreaksMap.set(e,t)}return n.trackChanges&&(s.inserted=!0),this._index.set(l,s),this._addChange(s),n.shape===o?s.parent=u:this._numInsertedRecords+=1,ne(this,s),N(this,"insert",{record:h,recordId:l,insertAfterId:_}),l},moveRecords:function(e,t,n){let s,r,l,a,h,c,u,f,g,_,p,y=this._options,I=[],m=[],v=null;if(y.shape===d)throw Y("moveRecords");y.shape===o?(t||(t=this._data),l=t[this._childrenKey]):l=this._data,r=0,n&&(v=this._getIdentity(n),s=this.getRecordMetadata(v),s&&(r=l.indexOf(s.record)+1),(!s||r<0)&&(i.warn("AfterRecord not found, move to beginning."),r=0)),this._sequenceKey&&([f,g]=G(l,r,this._sequenceKey)),p=0,_=this._data.length;for(let n=0;n<e.length;n++)if(c=e[n],u=this._getIdentity(c),s=this.getRecordMetadata(u),s){if(y.shape===o){if(a=this.parent(c),!a){i.warn("Move not allowed for root");continue}a=a[this._childrenKey]}else a=l;if(h=a.indexOf(c),y.shape!==o&&(h>p&&(p=h),h<_&&(_=h)),a.splice(h,1),l===a&&h<r&&(r-=1),m.push(c),I.push(u),l.splice(r,0,c),y.shape!==o&&(r>p&&(p=r),r<_&&(_=r)),r+=1,this._sequenceKey){let t=parseFloat(c[this._sequenceKey])||null;this.setValue(c,y.sequenceField,""+J(y.sequenceStep,f,g,e.length,n+1,t),!0)}y.shape===o&&(s.parent=t,this._parentIdKey&&this.setValue(c,y.parentIdentityField,this._getIdentity(t),!0))}else i.warn("Record to move not found: "+u);return y.shape!==o&&(this._reindex(_,p+1),this._resequenceServerOffset(_)),N(this,"move",{records:m,recordIds:I,insertAfterId:v}),I},copyRecords:function(e,t,n){const s=this,r=this._options;let l,a,h,c,u,f,g,_,p,y,I=[],m=[],v=null;if(r.shape===d)throw Y("copyRecords");r.shape===o?(_={node:function(e,t){if(t){const i=s._getIdentity(e),n={record:e,inserted:!0,parent:t};s._index.set(i,n),s._addChange(n)}}},t||(t=this._data),f=t[this._childrenKey]):f=this._data,a=0,n&&(v=this._getIdentity(n),l=this.getRecordMetadata(v),l&&(a=f.indexOf(l.record)+1),(!l||a<0)&&(i.warn("AfterRecord not found, copy to beginning."),a=0)),this._sequenceKey&&([p,y]=G(f,a,this._sequenceKey));for(let n=0;n<e.length;n++)h=e[n],u=this._getIdentity(h),l=this.getRecordMetadata(u),l?(c=this._initRecord(null,e[n],t),f.splice(a,0,c),this._sequenceKey&&(c[this._sequenceKey]=""+J(r.sequenceStep,p,y,e.length,n+1)),g=this._getIdentity(c),m.push(c),I.push(g),l={record:c,inserted:!0,index:a},this._index.set(g,l),this._addChange(l),r.shape===o?(l.parent=t,this.walkTree(c,_,null)):this._numInsertedRecords+=1,a+=1):i.warn("Record to copy not found: "+u);return this._reindex(a),N(this,"copy",{records:m,recordIds:I,insertAfterId:v}),this._checkAggregates(),I},root:function(){if(this._options.shape!==o)throw Y("root");return this._data},child:function(e,t){const i=e[this._childrenKey];if(i)return i[t]},parent:function(e){if(this._identityKeys){let t=this._getIdentity(e),i=this.getRecordMetadata(t);if(i&&k(i,"parent"))return i.parent?i.parent:null}},childCount:function(e){const t=e[this._childrenKey];return null===t?null:t?t.length:0},hasChildren:function(e){const t=e[this._childrenKey];return null===t?null:!!t&&t.length>0},fetchChildNodes:function(e,t){let i,n,s,r,l,a=this._options,o=A();return l=F({},a.regionData,{id:a.regionId,ajaxIdentifier:a.ajaxIdentifier,fetchData:F({},a.fetchData,{version:a.version,parentId:e?this._getPrimaryKey(e):null})}),s={regions:[l]},a.pageItemsToSubmit&&(s.pageItems=a.pageItemsToSubmit),this._addParentItems(s.regions[0]),r=$(a,this),e&&delete r.loadingIndicator,i=this._callServer(s,r),i.done((t=>{if(this._destroyed)return;let i,n=t.regions[0].fetchedData;if(e){let t=n[this._childrenKey];this._addData(e,null,t),i=t.length}else this._addData(null,null,n.root),i=1;o.resolve(i)})).fail((function(e,t,i){o.reject(H("Error fetching child nodes.",e,0,i))})),n=o.promise(),t&&n.always(t),n},clearChildNodes:function(e){e[this._childrenKey]=null},walkTree:function(e,t,i){let n,s,r,l;if(e&&(void 0===i&&(i=null,n=this._getIdentity(e),n&&(s=this.getRecordMetadata(n),s&&(i=s.parent))),!t.node||(l=t.node(e,i),!l))){if(r=e[this._childrenKey],r&&r.length>0){t.beginChildren&&t.beginChildren(e);for(let i=0;i<r.length;i++)this.walkTree(r[i],t,e);t.endChildren&&t.endChildren(e)}t.postNode&&t.postNode(e,i)}},subscribe:function(e){let t=e.viewId;return t||(t="v::"+w,w+=1,e.viewId=t),this._listeners.push(e),t},unSubscribe:function(e){for(let t=0;t<this._listeners.length;t++)this._listeners[t].viewId===e&&this._listeners.splice(t,1)},getOption:function(e){const t=this._options[e];if(void 0===t)throw new Error("No such option: "+e);return t},setOption:function(e,t){const n=this._options;if(b.has(e)){if("editable"===e&&!n.identityField&&n.shape!==d)throw Q();"trackChanges"===e&&!t&&n.onlyMarkForDelete&&(n.onlyMarkForDelete=!1),"onlyMarkForDelete"===e&&!1===n.trackChanges&&(t&&i.warn(e+" cannot be true when trackChanges is false"),t=!1),n[e]=t}else i.warn("Option cannot be set: "+e)},_callServer:function(e,i){return(this._options.callServer||t.plugin)(e,i)},_drainWaiters:function(e){for(let t=0;t<this._waitingPages.length;t++){let i=this._waitingPages[t];if((this._haveAllData||this._data[i.offset]||e)&&(this._waitingPages.splice(t,1),t-=1,e&&0!==e.status?j(i.thisArg,i.callback,null,-1,null,e):i.next(),this._requestsInProgress.fetch))return}},_getServerOffset:function(e){var t,i,n,s=e-1;for(n=this._data[s];n;){if(t=this._getIdentity(n,s),(i=this.getRecordMetadata(t))&&i.serverOffset>=0)return i.serverOffset+1;s-=1,n=this._data[s]}return e},_clear:function(){let e=this._options;(this._requestsInProgress.fetch||this._requestsInProgress.save)&&i.error("Model cleared during ajax request"),this._haveAllData=!1,this._clearDataPending=!1,e.shape===a?(this._data=[],e.hasTotalRecords?this._totalRecords=0:this._totalRecords=-1,this._offset=0,this._numInsertedRecords=0,this._numDeletedRecords=0,this._numAggregateRecords=0,this._numDisabledRecords=0,this._masterRecordIsInserted&&(this._haveAllData=!0),this._dataOverflow=!1):this._data=null,this._changes=[],this._errors=[],this._index.clear(),this._selection.clear(),this._controlBreaksMap.clear(),this._selectAll=!1,this._selectRange=null,this._selectAnchor=null,this._controlBreakKeys=null;let t=[];for(const[i,n]of Object.entries(e.fields))n.controlBreakIndex>0&&t.push({n:i,i:n.controlBreakIndex});t.sort(((e,t)=>e.i-t.i)),t.length>0&&(this._controlBreakKeys=t.map((e=>this.getFieldKey(e.n))))},_checkClearPending(){this._clearDataPending&&this._clear()},_saveDataState:function(){this._saveState={_data:this._data,_totalRecords:this._totalRecords,_haveAllData:this._haveAllData,_offset:this._offset,_numInsertedRecords:this._numInsertedRecords,_numDeletedRecords:this._numDeletedRecords,_numAggregateRecords:this._numAggregateRecords,_numDisabledRecords:this._numDisabledRecords,_dataOverflow:this._dataOverflow,_changes:this._changes,_errors:this._errors,_index:this._index,_controlBreaksMap:this._controlBreaksMap,_selection:this._selection,_selectAll:this._selectAll,_selectRange:this._selectRange},this._index=new Map,this._selection=new Map,this._controlBreaksMap=new Map},_restoreDataState:function(){const e=this._saveState;this._data=e._data,this._totalRecords=e._totalRecords,this._haveAllData=e._haveAllData,this._offset=e._offset,this._numInsertedRecords=e._numInsertedRecords,this._numDeletedRecords=e._numDeletedRecords,this._numAggregateRecords=e._numAggregateRecords,this._numDisabledRecords=e._numDisabledRecords,this._dataOverflow=e._dataOverflow,this._changes=e._changes,this._errors=e._errors,this._index=e._index,this._controlBreaksMap=e._controlBreaksMap,this._selection=e._selection,this._selectAll=e._selectAll,this._selectRange=e._selectRange},_clearChanges:function(e){const t=[],i=[],n=this._options,s=this[e];let r=-1,l=!1;for(let e=0;e<s.length;e++){const o=s[e],d=this._getIdentity(o.record);o.deleted&&n.onlyMarkForDelete&&(this._removeRecord(d,o),n.shape===a&&(l=!0)),o.deleted?t.push(d):(o.inserted||o.updated)&&(i.push(d),o.inserted&&n.shape===a&&(o.serverOffset=0,l=!0)),l&&(-1===r||o.index<r)&&(r=o.index),delete o.deleted,delete o.recordId,delete o.inserted,delete o.autoInserted,delete o.updated,delete o.original}l&&this._resequenceServerOffset(r),this._totalRecords>=0&&(this._totalRecords+=this._numInsertedRecords,this._totalRecords-=this._numDeletedRecords),this._numInsertedRecords=0,this._numDeletedRecords=0,this[e]=[],N(this,p,{deletedIds:t,changedIds:i})},_reindex:function(e,t){const i=this._data;let n=i.length;null!=t&&t<n&&(n=t);for(let t=e;t<n;t++)if(void 0!==i[t]){let e=this._getIdentity(i[t]);this.getRecordMetadata(e).index=t}},_resequenceServerOffset:function(e=0){const t=this._data;let i,n,s=-1;for(;e>0&&(i=t[e-1],s=this.getRecordMetadata(this.getRecordId(i)).serverOffset,void 0===s);)e-=1;for(let r=e;r<t.length;r++)i=t[r],i?(n=this.getRecordMetadata(this.getRecordId(i)),n.serverOffset>=0&&(s+=1,n.serverOffset=s)):s+=1},_addData:function(e,t,n,s,r,l){const h=this._options,c=this,f=this._calculatedFields.length>0;let g,_,p,y,I,R,x,w,M,b,k,D,C;function K(e,t,i,n){const s={record:n};return c._metaKey&&(F(s,n[c._metaKey]),s.sel=!0===s.sel||"Y"===s.sel,null!=s.disabled&&(s.disabled=!0===s.disabled||"Y"===s.disabled),s.agg&&(!e||c._identityKeys&&!n[c._identityKeys[0]])&&(c._assignTempIdentity(n),e=c._getIdentity(n)),z(s)),null!=t&&(s.serverOffset=t),null!=i&&(s.index=i),s.agg&&(c._numAggregateRecords+=1),s.disabled&&(c._numDisabledRecords+=1),c._index.set(e,s),(s.sel||c._selectAll||c._selectRange&&i>c._selectRange[0]&&i<=c._selectRange[1])&&(s.agg||s.disabled?delete s.sel:(s.sel=!0,c._selection.set(e,s))),h.visibilityFilter&&h.visibilityFilterContext&&(s.hidden=!h.visibilityFilter(c,n,h.visibilityFilterContext)),te(n,h.fields,h.recordIsArray),f&&!s.agg&&ne(c,s),s}function A(e,t,i){let n=0;for(let s=0;s<c._aggregateRecs.length;s++){let r,l,a,o,d=c._aggregateRecs[s];t[d]||(l=c._initRecord(!1),o=c._getIdentity(l),a={agg:d},i&&(a.grandTotal=i),l[c._metaKey]=a,r=e+n,c._data[r]?c._data.splice(r,0,l):c._data[r]=l,K(o,null,r,l),n+=1)}return n}function S(e,t,i,n,s){if(c._data.length>0&&c._haveAllData&&c._aggregateRecs.length>0){if(n){if(t&&t.grandTotal){for(e=c._data.length-1;e>=0&&(i=c._data[e],(t=c._metaKey&&i[c._metaKey])&&t.agg&&t.grandTotal);e--);e+=1}e+=A(e,s),c._reindex(e)}(e=A(c._data.length,s,!0))>0&&c._checkAggregates()}}function T(){if(null!==c._selectRange){let e=c._selectRange[0]+1,t=c._selectRange[1]-1;c._selectAll&&(e=0,t=c.getTotalRecords(!0));for(let i=e;i<t;i++)if(!c._data[i])return;c._selectRange=null}}function O(e,t,i,n){const s=c.getControlBreakId(e);let r,l;null!=s&&(r=c._controlBreaksMap.get(s),r||(r={values:c._controlBreakKeys.map((t=>e[t]))},c._controlBreaksMap.set(s,r)),"start"===n?(l=r.firstId?c.getRecordMetadata(r.firstId):null,(!l||i<l.serverOffset)&&(r.firstId=t)):"end"===n&&(l=r.lastId?c.getRecordMetadata(r.lastId):null,(!l||i>l.serverOffset)&&(r.lastId=t)))}if(h.shape===a?((0===e&&!this.isChanged()||h.paginationType===v)&&this._clear(),h.paginationType===m&&(this._offset=e),this._totalRecords=-1,null!=s?this._totalRecords=s:h.hasTotalRecords&&i.warn("Model missing total records"),this._haveAllData||r||(this._haveAllData=!0),l&&(this._dataOverflow=!0)):h.shape===d&&this._clear(),h.shape===o&&e)i.trace("Model: "+this.modelId()+". add data subtree: ",e),R=e,R[this._childrenKey]=n,h.identityField&&c.walkTree(R,{node:function(e,t){t&&(K(c._getIdentity(e),null,null,e).parent=t)}},null),N(this,u,{parentNode:R,offset:0,count:n.length});else if(null===this._data||0===this._data.length||h.shape!==a||h.paginationType===m){if(i.trace("Model: "+this.modelId()+". add data set: ",e,n?.length,s,r),this._data=n,this._numInsertedRecords=0,this._numDeletedRecords=0,this._numAggregateRecords=0,this._numDisabledRecords=0,h.shape!==d)if(M={offset:0,count:n.length},x=t,h.shape===o&&this.root())h.identityField&&this.walkTree(this.root(),{node:function(e,t){let i,n=c._getIdentity(e);c._metaKey&&e[c._metaKey].agg?w=null:(w=x,x+=1),i=K(n,w,null,e),i.parent=t}},null),M.parentNode=null,M.count=1;else{let e;for(b=!0,D=!1,C={},e=0;e<this._data.length;e++)p=this._data[e],g=this._getIdentity(p,e),_=this._metaKey&&p[this._metaKey],_&&_.agg?(w=null,C[_.agg]=1):(w=x,x+=1,D&&(e+=A(e,C)),D=!1),_&&this._controlBreakKeys&&b&&!_.agg&&(O(p,g,w,"start"),b=!1),_&&_.endControlBreak&&(O(p,g,w,"end"),b=!0,this._aggregateRecs.length>0&&(D=!0,C={})),K(g,w,e,p);S(e,_,p,D,C),T()}else this._data?(this._haveAllData=!0,M={offset:0,count:1},K(this._getIdentity(this._data),null,null,this._data)):(this._haveAllData=!0,M={offset:0,count:0});N(this,u,M)}else{let l;for(b=!0,i.trace("Model: "+this.modelId()+". add data merge: ",e,n?.length,s,r),y=e,x=t,k=[],D=!1,C={},l=0;l<n.length;l++){if(p=n[l],g=this._getIdentity(p,y),_=this._metaKey&&p[this._metaKey],_&&_.agg?(w=null,C[_.agg]=1):(w=x,x+=1),I=this.getRecordMetadata(g),I){if(I.updated||I.inserted||I.deleted)continue;this._data[I.index]=p,te(p,h.fields,h.recordIsArray),I.record=p,x-=1,_&&F(I,_),k.push(g),f&&!I.agg&&ne(this,I)}else this._data[y]?this._data.splice(y,0,p):this._data[y]=p,K(g,w,y,p),y+=1;_&&(_&&this._controlBreakKeys&&b&&!_.agg&&(O(p,g,w,"start"),b=!1),_.agg||(D&&(y+=A(y,C)),D=!1),_.endControlBreak&&(O(p,g,w,"end"),b=!0,this._aggregateRecs.length>0&&(D=!0,C={})))}S(l,_,p,D,C),T(),M={offset:e,count:y-e},k.length&&(M.replacedIds=k),N(this,u,M)}},_updateData:function(e,t){const i=this._options,n=[],s=[],r=[],l=[],a={},o=t||this._metaKey;let d=!1,h=-1;for(let d=0;d<e.length;d++){const c=e[d],u=c[o];let f,g,_=u?u.recordId:null;if(u&&_&&u.notFound)f=this.getRecordMetadata(_),this._removeRecord(_,f),r.push(f.record),l.push(_),(-1===h||f.index<h)&&(h=f.index);else if(g=this._getIdentity(c),_===g&&(_=null),f=this.getRecordMetadata(_||g),f){if(_&&(a[_]=g,this._index.set(g,f),this._index.delete(_),this._selection.delete(_),f.sel&&this._selection.set(g,f),(-1===h||f.index<h)&&(h=f.index),f.serverOffset=0,this._controlBreakKeys))for(const[,e]of this._controlBreaksMap)e.lastId===_&&(e.lastId=g),e.firstId===_&&(e.firstId=g);n.push(c),s.push(_||g),this._data[f.index]=c,te(c,i.fields,i.recordIsArray),f.record=c,o&&u?(F(!0,f,u),f.highlight&&void 0===u.highlight&&delete f.highlight,z(f),delete f.recordId):t&&(i.recordIsArray?c.splice(t,1):delete c[t]),i.visibilityFilter&&i.visibilityFilterContext&&(f.hidden=!i.visibilityFilter(this,c,i.visibilityFilterContext)),ne(this,f),delete f.deleted,delete f.inserted,delete f.autoInserted,delete f.updated,delete f.original,L(f),this._removeError(f),this._removeChange(f)}}h>=0&&this._resequenceServerOffset(h),n.length>0&&(N(this,g,{records:n,recordIds:s,newIds:a}),d=!0),r.length>0&&(this._totalRecords>=r.length&&(this._totalRecords-=r.length),N(this,_,{records:r,recordIds:l}),d=!0),d&&this._checkAggregates()},_initRecord:function(t,i,n){const s=this._options;let r,l,a,d,h=!0;if(t)l=t;else{!1===t&&(h=!1),l=s.recordIsArray?[]:{};for(let t in s.fields)if(k(s.fields,t)){let n,r,o=s.fields[t],c=s.recordIsArray?o.index:t;if(!o.virtual)if(!i||o.noCopy){if(o.parentField&&s.parentModel&&(a||(a=e.get(s.parentModel),a&&!d&&s.parentRecordId&&(d=a.getRecord(s.parentRecordId))),d)){l[c]=a.getValue(d,o.parentField);continue}n="",h&&(r=o.defaultValue,void 0!==r&&(n="function"==typeof r?r(this,i):r)),c!==this._metaKey&&(l[c]=n)}else this._identityKeys.includes(c)||(l[c]=i[c])}}if(a&&e.release(s.parentModel),this._identityKeys&&this._assignTempIdentity(l),this._metaKey&&void 0===l[this._metaKey]&&(l[this._metaKey]={}),s.shape===o&&(this._parentIdKey&&(l[this._parentIdKey]=this._getIdentity(n)),r=[],l[this._childrenKey]=r,i)){let e=i[this._childrenKey];if(e)for(let t=0;t<e.length;t++)r.push(this._initRecord(null,e[t],l))}return l},_assignTempIdentity:function(e){for(let t=0;t<this._identityKeys.length;t++)e[this._identityKeys[t]]||(e[this._identityKeys[t]]=this._options.genIdPrefix+E(this.name))},_getIdentity:function(e,t){let i=null;if(void 0!==this._identityKeys)if(1===this._identityKeys.length)i=e[this._identityKeys[0]]+"";else{i=[];for(let t=0;t<this._identityKeys.length;t++)i.push(e[this._identityKeys[t]]+"")}else null!=t?i=t+"":this._options.shape===d&&(i="0");return null!==i?U(i):i},_getPrimaryKey:function(e){let t;if(void 0!==this._identityKeys){t=[];for(let i=0;i<this._identityKeys.length;i++)t.push(e[this._identityKeys[i]]+"")}return t},_getType:function(e){let t="default",i=this._options;return e&&void 0!==this._typeKey&&(t=e[this._typeKey],null!==t&&q(t)&&(t=t.v),t||(t="default")),i.types[t]||i.types.default},_getRecordById:function(e){let t=this._index.get(U(e));return t?t.record:null},_removeRecord:function(e,t){const i=this._options;let n,s,r;if(i.shape===a?(n=this._data,r=t.index):i.shape===o&&(n=t.parent[this._childrenKey],r=n.indexOf(t.record),delete t.parent),this._controlBreakKeys&&t.endControlBreak){let e=n[r-1],i=this.getControlBreakId(t.record);if(e&&i===this.getControlBreakId(e)){let t=this.getRecordId(e),n=this.getRecordMetadata(t);this._controlBreaksMap.get(i).lastId=t,n.endControlBreak=!0,this._metaKey&&(e[this._metaKey].endControlBreak=!0)}else this._controlBreaksMap.delete(i)}n.splice(r,1),this._reindex(r),s=U(e),this._index.delete(s),t.sel&&this._selection.delete(s)},_addChange:function(e){if(!this._options.trackChanges)return;let t=this._changes.indexOf(e);t>=0&&this._changes.splice(t,1),this._changes.push(e)},_removeChange:function(e){if(!this._options.trackChanges)return;let t=this._changes.indexOf(e);t>=0&&!e.deleted&&!e.updated&&!e.inserted&&this._changes.splice(t,1)},_removeError:function(e){let t=this._errors.indexOf(e);t>=0&&this._errors.splice(t,1)},_addParentItems:function(t){var i,n,s,r,l,a,o={values:[]},d=this._options;if(d.parentModel&&d.parentRecordId){for(i in d.fields)k(d.fields,i)&&(n=d.fields[i]).parentField&&(s||(s=e.get(d.parentModel))&&!r&&(r=s.getRecord(d.parentRecordId),a=s.getRecordMetadata(d.parentRecordId)),r&&(l={n:n.parentField,v:s.getValue(r,n.parentField)},o.values.push(l)));a&&(a.salt&&(o.salt=a.salt),a.protected&&(o.protected=a.protected)),s&&e.release(d.parentModel),t.parentRecordId=d.parentRecordId,o.values.length>0&&(t.parentItems=o)}},_updateAggregates:function(){var e,t,i,n,s,l,a=this._options.fields,o=[];if(!(this._staleAggFields.length<=0)){for(e=0;e<this._staleAggFields.length;e++)for(i=a[n=this._staleAggFields[e]],t=0;t<i.aggregates.length;t++)"string"==typeof(s=i.aggregates[t])&&(s=se[s]),(l={name:s.name,fieldName:n,key:this.getFieldKey(this._staleAggFields[e]),state:{dataType:i.dataType,formatMask:i.formatMask},agg:s}).agg.init(l.state),o.push(l);this.forEach((function(e,t,i){var n,s,a,d=this.getRecordMetadata(i);for(n=0;n<o.length;n++)if(l=o[n],d.agg){if(d.agg===l.name){let t=l.state.dataType,n=l.state.formatMask;a=e[l.key],s=l.agg.get(l.state,!d.grandTotal)+"",s="NUMBER"===t&&n?r.formatNumber(s,n):""+s,e[l.key]=s,N(this,y,{oldValue:a,oldIdentity:null,recordId:i,record:e,field:l.fieldName})}}else d.deleted||(s=e[l.key],l.agg.add(l.state,s))}),this),this._staleAggFields=[]}},_checkAggregates:function(e){if(e)this._aggregatedFields[e]&&this._staleAggFields.indexOf(e)<0&&(this._staleAggFields.push(e),this._debouncedUpdateAggregates());else for(let e in this._aggregatedFields)k(this._aggregatedFields,e)&&this._checkAggregates(e)},_recalculate:function(e){this.forEach((function(t,i,n){const s=this.getRecordMetadata(n);s.agg||ie(this,s,e,!0)}),this)}},le={shape:a,recordIsArray:!1,hasTotalRecords:!1,genIdPrefix:"t",regionId:null,ajaxIdentifier:null,pageItemsToSubmit:null,regionData:{},fetchData:{},saveData:{},requestOptions:{},version:1,parentModel:null,parentRecordId:null,editable:!1,trackChanges:!0,onlyMarkForDelete:!0,identityField:null,typeField:null,childrenField:null,parentIdentityField:null,sequenceField:null,metaField:null,sequenceStep:10,saveSelection:!1,types:{default:{isDisabled:!1,validChildren:!0,operations:{canAdd:!0,canEdit:!0,canDelete:!0,canDrag:!0,drag:{normal:"move",ctrl:"copy"},externalDrag:{normal:"add"}}}},check:null,sortCompare:null,callServer:null,paginationType:v,pageSize:100,preFetch:!1,visibilityFilterContext:null,visibilityFilter:null,delayClearData:!1},ae=new Set([a,o,d]),oe=new Set([v,m,"progressive"]);function de(e){const t=B(e);let i=R[t[0]];return i&&(i=t[1]?i.instances[t[1]]:i.model),i}function he(e,t,i,n){let s=n?B(n):null,r=[];function l(n){let r=!(!i&&!n._options.regionId);return r&&("change"===e?r=n.isChanged():"error"===e&&(r=n.hasErrors()),r&&t&&(r=function(e){let t,i=e,n=B(i.modelId());for(;n;){if(n[0]===s[0]&&(n[1]===s[1]||null===s[1]))return!0;n=null,t=i.getOption("parentModel"),t&&(i=de(t),i&&(n=B(t)))}return!1}(n))),r}function a(e,t){r.push({id:e,model:t})}function o(e,t){e.model&&l(e.model)&&a(t,e.model);for(let i in e.instances)k(e.instances,i)&&l(e.instances[i])&&a([t,i],e.instances[i])}if(s||(t=!1),!t&&s&&s[0]){let e=s[0],t=R[e];t&&(s[1]?t.instances[s[1]]&&l(t.instances[s[1]])&&a([e,s[1]],t.instances[s[1]]):o(t,e))}else for(let e in R)k(R,e)&&o(R[e],e);return r}function ce(e){let t=x.indexOf(e);t>=0&&x.splice(t,1)}e.create=function(t,r,h,u,m,w){const b=B(t),C=Object.create(re);let K,A,S,T,O,q,P,E,V,j,z;function U(e,t){const n=K.fields[e];(n.calcValue||n.dependsOn||n.aggregates&&n.aggregates.length>0)&&(i.warn("Model "+t+" field does not support calculations"),delete n.calcValue,delete n.dependsOn)}if(C.name=b[0],C.instance=b[1],C._requestsInProgress={},C._listeners=[],C._waitingPages=[],A=r.fields,C._options=F(!0,{},le,r),C._options.fields=A,K=C._options,!K.fields)throw new Error("The fields option is required");if(!ae.has(K.shape))throw new Error("Invalid shape option: "+K.shape);if(!oe.has(K.paginationType))throw new Error("Invalid paginationType option: "+K.paginationType);if(K.editable&&!K.identityField&&K.shape!==d)throw Q();if(K.shape===o&&!K.childrenField)throw new Error("A tree shaped model requires a childrenField");if(K.shape===a&&K.paginationType===v&&void 0===r.hasTotalRecords&&(K.hasTotalRecords=!0),!K.trackChanges&&K.onlyMarkForDelete&&(r.onlyMarkForDelete&&i.warn("Model forcing onlyMarkForDelete to false"),K.onlyMarkForDelete=!1),C._dependentFields={},C._calculatedFields=[],C._aggregatedFields={},C._aggregateRecs=[],function(e,t,i,r,a){let o,d,h,c,u,f,g,_=[],p={};const y=function(e){const t=e.target.id;C._recalculate(C._dependentFields[":"+t])};for(d in e)if(k(e,d)){if(h=e[d],h.calcValue&&i.push(d),c=h.dependsOn,c)for(let i=0;i<c.length;i++){if(f=c[i],":"===f.substr(0,1)){if(g=f.substr(1),!s(g).node)throw Z(d,g);_.push(g)}else if(!e[f])throw Z(d,f);I=d,t[m=f]||(t[m]=[]),t[m].push(I)}if(h.aggregates){for(let e=0;e<h.aggregates.length;e++){if(o=h.aggregates[e],"string"==typeof o&&!se[o]||"object"==typeof o&&!(o.name&&o.init&&o.add&&o.get))throw new Error(`Field '${d}' has invalid aggregate`);u=o.name||o,p[u]||a.push(u),p[u]=1}r[d]=1}}var I,m;_.length>0&&(C._externalItems$=l(_.map((e=>"#"+n.escapeCSS(e))).join(",")),C._externalItems$.on("change",y),C._externalItemsHandler=y)}(K.fields,C._dependentFields,C._calculatedFields,C._aggregatedFields,C._aggregateRecs),C._staleAggFields=[],C._debouncedUpdateAggregates=n.debounce((function(){C._updateAggregates()}),250),K.identityField)if(D(K.identityField)){C._identityKeys=[];for(let e=0;e<K.identityField.length;e++){if(C._identityKeys.push(C.getFieldKey(K.identityField[e])),void 0===C._identityKeys[e])throw ee("Identity",K.identityField[e]);U(K.identityField[e],"identity")}}else{if(C._identityKeys=[C.getFieldKey(K.identityField)],void 0===C._identityKeys[0])throw ee("Identity",K.identityField);U(K.identityField,"identity")}if(K.typeField){if(C._typeKey=C.getFieldKey(K.typeField),void 0===C._typeKey)throw ee("Type",K.typeField);U(K.typeField,"type")}if(K.childrenField){if(C._childrenKey=C.getFieldKey(K.childrenField),void 0===C._childrenKey)throw ee("Children",K.childrenField);U(K.childrenField,"children")}if(K.parentIdentityField){if(C._parentIdKey=C.getFieldKey(K.parentIdentityField),void 0===C._parentIdKey)throw ee("Parent identity",K.parentIdentityField);U(K.parentIdentityField,"parentIdentity")}if(K.sequenceField){if(C._sequenceKey=C.getFieldKey(K.sequenceField),void 0===C._sequenceKey)throw ee("Sequence",K.sequenceField);U(K.sequenceField,"sequence")}if(K.metaField){if(C._metaKey=C.getFieldKey(K.metaField),void 0===C._metaKey)throw ee("Meta",K.metaField);U(K.metaField,"meta")}if(K.shape!==d?K.identityField?C.getRecord=C._getRecordById:K.shape===a?C.getRecord=C.recordAt:C.getRecord=function(){return null}:C.getRecord=function(){return C._data},C._index=new Map,C._selection=new Map,C._controlBreaksMap=new Map,C._clear(),h?(E=K.paginationType!==v&&(null!=m?m:null==u||h.length<u),C._addData(0,0,h,u,E,w)):(null!=u&&(C._totalRecords=u),K.shape===d&&!1===m&&(C._haveAllData=!0)),K.parentModel&&K.parentRecordId&&!h&&(z=e.get(K.parentModel),z)){j=z.getRecordMetadata(K.parentRecordId),j.inserted&&(C._masterRecordIsInserted=!0,C._clear()),j.deleted&&(C._saveDataState(),C._masterRecordIsDeleted=!0,C._clear(),C._addData(0,0,[],0,!1,!1)),O=C._parentFieldsMap={};for(let e in K.fields)k(K.fields,e)&&(T=K.fields[e],T.parentField&&(O[T.parentField]||(O[T.parentField]=[]),O[T.parentField].push(e)));C.parentModelViewId=z.subscribe({onChange:function(t,i){let n;if(t===_||t===f||t===g||t===p){n=i.recordIds||i.deletedIds;for(let s=0;s<n.length;s++)if(n[s]===K.parentRecordId){if(t===_)C._saveDataState(),C._masterRecordIsDeleted=!0,C._clear(),C._addData(0,0,[],0,!1,!1),N(C,c,{});else if(t!==f&&t!==g||!C._masterRecordIsDeleted)if(t===g&&i.newIds&&i.newIds[C.instance]){const t=i.newIds[C.instance];let n=[];K.parentRecordId=t,e.renameInstance(C.modelId(),t),C.forEach(((e,t,i)=>{let s=C.getRecordMetadata(i);s.autoInserted&&!s.updated&&n.push(s.record)})),n.length&&C.deleteRecords(n)}else t===p&&C._masterRecordIsDeleted&&delete C._saveState;else delete C._masterRecordIsDeleted,C._restoreDataState(),N(C,c,{});break}t===p&&C._masterRecordIsInserted&&delete C._masterRecordIsInserted}else t===y&&(i.oldIdentity||i.recordId)===K.parentRecordId?(q=i.field,q in O&&(S=O[q],P=z.getValue(i.record,q),C.forEach((function(e){let t;if(!C._metaKey||!e[C._metaKey].agg)for(let n=0;n<S.length;n++)t=S[n],i.oldValue===C.getValue(e,t)&&C.setValue(e,t,P)}))),i.oldIdentity&&(K.parentRecordId=i.recordId,e.renameInstance(C.modelId(),i.recordId))):t===c&&C._masterRecordIsDeleted?(delete C._masterRecordIsDeleted,C._restoreDataState(),N(C,c,{})):t===I&&(K.parentModel=null,C.parentModelViewId=null,delete C._masterRecordIsDeleted,delete C._masterRecordIsInserted)},progressView:"m:"+t}),e.release(K.parentModel)}return x.length>=M&&(V=function(){for(let e=0;e<x.length;e++){let t=x[e];if(!t.isChanged())return t}return null}(),V&&(i.info("Model: cache overflow; remove model from cache: "+V.modelId()),e.destroy(B(V.modelId())))),V=R[b[0]],V||(V={instances:{},instancesRef:{}},R[b[0]]=V),b[1]?(V.instances[b[1]]&&(e.destroy(b),R[b[0]]=V),V.instancesRef[b[1]]=1,V.instances[b[1]]=C):(V.model&&(e.destroy(b),R[b[0]]=V),V.modelRef=1,V.model=C),i.info("Model: created model: "+t+" refCount: 1"),C},e.list=function(e,t,i){return he(null,i,e,t).map((e=>e.id))},e._resetTempIds=function(){P.clear()},e._getStats=function(){let e,t,i=[];for(let n in R)if(k(R,n)){const s=R[n],r=s.model;for(t in r&&(e={name:r.name,instance:null,refCount:s.modelRef,cachePos:x.indexOf(r),subscribers:r._listeners.length,progressViews:r._listeners.map((function(e){return e.progressView||null}))},i.push(e)),s.instances)if(k(s.instances,t)){const n=s.instances[t];e={name:n.name,instance:n.instance,refCount:s.instancesRef[t],cachePos:x.indexOf(n),subscribers:n._listeners.length,progressViews:n._listeners.map((function(e){return e.progressView||null}))},i.push(e)}}return i},e.anyChanges=function(e,t,i){return he("change",i,e,t).length>0},e.anyErrors=function(e,t,i){return he("error",i,e,t).length>0},e.addChangesToSaveRequest=function(e,t,i){let n=[],s=he("change",i,!1,t);if(s.length<=0)return null;for(let t=0;t<s.length;t++){let i=s[t].model.addChangesToSaveRequest(e);i&&n.push(i)}return function(e){for(let t=0;t<n.length;t++)n[t](e)}},e.save=function(e,i,n,s,r){let l,a,o,d;if(e=e||{},i=i||{},o=he("change",s,!1,n),l=apex.model.addChangesToSaveRequest(e,n,s),l){if(n&&void 0===i.loadingIndicator&&void 0===i.loadingIndicatorPosition){d=[];for(let e=1;e<o.length;e++)d.push(o[e].model);i.loadingIndicator=W(o[0].model,d)}return a=(r||t.plugin)(e,i),l(a),a}return null},e.multipleFetch=function(e,i,n,s){let r,l=[];if(e=e||{},i=i||{},n.forEach((t=>{let i,n=he(null,!1,!1,t);n.length>0&&(i=n[0].model._addToFetchRequest(e,0),i&&l.push(i))})),l.length>0){r=(s||t.plugin)(e,i);for(let e=0;e<l.length;e++)l[e](r);return r}return null},e.equalModelIds=function(e,t){return"string"==typeof e&&"string"==typeof t?e===t:!(!D(e)||!D(t)||2!==e.length||2!==t.length)&&n.arrayEqual(e,t)},e.get=function(e){const t=B(e),n=R[t[0]];let s,r;return n&&(t[1]?(s=n.instances[t[1]],s&&(r=n.instancesRef[t[1]]+=1)):(s=n.model,s&&(r=n.modelRef+=1)),s&&(ce(s),i.info("Model: get model: "+e+" refCount: "+r))),s},e.renameInstance=function(e,t){const n=B(e),s=n[0],r=n[1],l=R[s];if(l&&r){let e,n=l.instances[r];l.instances[t]&&i.error("Model: Error rename model to one that already exists.",t),n.instance=t,e=l.instancesRef[r],delete l.instances[r],delete l.instancesRef[r],l.instances[t]=n,l.instancesRef[t]=e,i.info("Model: rename model "+s+" instance: "+r+" to "+t),N(n,"instanceRename",{oldInstance:r,newInstance:t})}},e.release=function(t){const n=B(t);let s,r=R[n[0]];r&&(n[1]?r.instancesRef[n[1]]?(s=r.instancesRef[n[1]]-=1,r=r.instances[n[1]]):r=null:(s=r.modelRef-=1,r=r.model),r&&(i.info("Model: release model: "+t+" refCount: "+s),s<=0&&(r._options.parentModel&&de(r._options.parentModel)?(i.info("Model: save in cache model: "+t),function(e){let t=x.indexOf(e);t>=0&&x.splice(t,1),x.push(e)}(r)):r.isChanged()||e.destroy(n))))},e.destroy=function(t){const n=B(t);let s,r=R[n[0]];function l(n){if(n){if(ce(n),n.parentModelViewId){let t=n._options.parentModel,i=e.get(t);i&&(i.unSubscribe(n.parentModelViewId),n.parentModelViewId=null,e.release(t))}n._externalItems$&&n._externalItems$.off("change",n._externalItemsHandler),N(n,I,{}),n._data=null,n._index=null,n._selection=null,n._controlBreaksMap=null,n._destroyed=!0,i.info("Model: destroy model: "+t)}}if(r){if(n[1])l(r.instances[n[1]]),delete r.instancesRef[n[1]],delete r.instances[n[1]];else if(l(r.model),delete r.model,delete r.modelRef,"string"==typeof t&&!n[1])for(s in r.instances)k(r.instances,s)&&(l(r.instances[s]),delete r.instancesRef[s],delete r.instances[s]);0!==Object.keys(r.instances).length||r.model||delete R[n[0]]}},e.getMaxCachedModels=function(){return M},e.setMaxCachedModels=function(e){M=parseInt(e,10)||10},e.initialModelData=function(e){let t=!0;if("string"==typeof e)try{e=JSON.parse(l("#"+e).text())}catch(e){i.error("Failed to parse initial model data.",e),t=!1}return null!=e&&(D(e)||"object"!=typeof e)&&(t=!1),t||(i.error("Invalid model data. Proceeding with no data."),e={values:null}),e};const ue=new Map,fe=apex.WebComponent,ge={modelId:{type:fe.dataTypes.string},recordId:{type:fe.dataTypes.string,default:""},explicitStore:{type:fe.dataTypes.boolean,default:!1},syncWith:{type:fe.dataTypes.string,default:""}};fe._addHyphenCaseAttrNames(ge);const _e=fe._configObservedAttributes(ge),pe=class extends fe{#e=null;#t=null;#i=-1;#n=!1;#s=!1;#r=[];#l=null;#a=null;#o=null;#d=!1;#h=null;#c={modelId:null,recordId:null,explicitStore:null,syncWith:null};constructor(){super(),this._configPrivateState(this.#c);let e=this;this.#h=apex.actions.createContext("modelCursor",this),this.#h.add([{name:"cursor-next",action:function(){e.nextRecord()}},{name:"cursor-previous",action:function(){e.previousRecord()}}])}getModel(){return this.#e}getCurrentRecord(){return this.#t}firstRecord(){let e;if(this.#n){if(e=this.#e.getRecord(),e)return this.recordId=this.#e.getRecordId(e),!0}else if(this.#s);else if(e=this.#e.recordAt(0),e)return this.recordId=this.#e.getRecordId(e),this.#i=0,!0;return!1}nextRecord(){if(this.#n)return!1;let e,t=this.#i;if(this.#s);else if(t<0&&this.#t&&(this.#i=t=this.#e.indexOf(this.#t)),t>=0&&(t+=1,e=this.#e.recordAt(t),e))return this.recordId=this.#e.getRecordId(e),this.#i=t,!0;return!1}previousRecord(){if(this.#n)return!1;let e,t=this.#i;if(this.#s);else if(t<0&&this.#t&&(this.#i=t=this.#e.indexOf(this.#t)),t>=0){if(t-=1,t<0)return!1;if(e=this.#e.recordAt(t),e)return this.recordId=this.#e.getRecordId(e),this.#i=t,!0}return!1}lastRecord(){let e,t=0;if(this.#n){if(e=this.#e.getRecord(),e)return this.recordId=this.#e.getRecordId(e),!0}else if(this.#s);else{let i=this.#e.getTotalRecords(!0);if(i>0&&(t=i-1),e=this.#e.recordAt(t),e)return this.recordId=this.#e.getRecordId(e),this.#i=t,!0}return!1}store(){l(this).trigger("apexbindstore")}subscribe(e,t,i){this.#r.push({field:t,recordId:e,notify:i})}unsubscribe(e,t,i){let n=this.#r.findIndex((n=>n.notify===i&&n.recordId===e&&n.field===t));return n>=0&&this.#r.splice(n,1),0===this.#r.length}attributeChangedCallback(e,t,i){if(super.attributeChangedCallback(e,t,i),"model-id"===e){let e=this.#c.modelId;if(e.startsWith("[")&&e.endsWith("]"))try{e=JSON.parse(e),D(e)&&2===e.length||(e=null)}catch(t){e=null}this.#u(e)}else if("record-id"===e)t!==i&&this.#f(this.#c.recordId);else if("sync-with"===e&&t!==i){let e=apex.region(i),t=this;this.#o&&this.#o.off("interactivegridselectionchange.ig"),e&&"InteractiveGrid"===e.type&&(this.#o=e,e.on("interactivegridselectionchange.ig",n.debounce(((e,i)=>{const n=i.selectedRecords[0];n&&(t.#d=!0,t.recordId=i.model.getRecordId(n))}),100)))}}#u(t){let s=!0,r=!1;const l=(e,t)=>{if(e===c)0===this.#e._data.length&&(this.#t=null);else if(e===I)this.modelId="";else if(e===u){let e=this.#i;this.#f(this.#c.recordId),e>0&&null!==this.#t&&(this.#i=this.#e.indexOf(this.#t))}else if(e===g||e===f)for(let e=0;e<t.recordIds.length;e++){let i=t.recordIds[e];i===this.#c.recordId&&(this.#t=t.records[e]),this.#g(i,null)}else"move"===e||e===p||t.recordIds||"set"!==e&&"metaChange"!==e||this.#g(t.recordId,t.field)};this.#e&&(this.#e.unSubscribe(this.#l),s=D(this.#a)&&D(t)?!n.arrayEqual(this.#a,t):this.#a!==t,s&&(e.release(this.#a),this.#e=null,this.#t=null,r=!0));let a=this.recordId;if(t){s&&(this.#e=e.get(t),this.#e?this.#a=t:(this.#a=null,i.error("Model not found: ",this.#c.modelId)));let n=this.#e,a=n.getOption("shape");if(this.#n=a===d,this.#s=a===o,this.#l=n.subscribe({onChange:l}),r&&this.#c.recordId){let e=this.#n?n.getRecord():n.recordAt(0);e?(this.recordId=n.getRecordId(e),this.#i=0):this.recordId=""}else if(this.#n){let e="";n.getOption("identityField")&&(e=n.getRecordId(n.getRecord())),this.recordId=e}}else r&&this.#c.recordId&&(this.recordId="");this.#c.recordId===a&&this.#f(this.#c.recordId)}#g(e,t){const i=this.#r,n=this.#n;for(let s=0;s<i.length;s++){let r=i[s],l=r.recordId;l||n||(l=this.#c.recordId),!n&&e&&l!==e||t&&r.field!==t||r.notify()}}#f(e){(e||this.#n)&&this.#e?this.#t=this.#e.getRecord(e):this.#t=null,this.#i=-1,this.#g(null,null),this.#o&&(this.#d||this.#o.call("setSelectedRecords",[this.#t],!1,!1),this.#d=!1)}static get observedAttributes(){return _e}static get componentMetaData(){return ge}};apex.gPageContext$.on("apexreadyend",(()=>{customElements.define("a-model-cursor",pe)})),apex.binding.addDataRefType("model",{priority:10,subscribe:function(e,t){if(!e.field||!(e.cursor&&!e.modelId||!e.cursor&&e.modelId&&"string"==typeof e.modelId))return void i.error("Invalid model data reference: ",e);let s=e.cursor;if(!s){const t=e.modelId;if(s=ue.get(t),!s){let e=l(`<a-model-cursor model-id="${n.escapeHTMLAttr(t)}" style="display:none;"></a-model-cursor>`);e.appendTo("body"),s=e[0],ue.set(t,s)}}s.subscribe(e.recordId||null,e.field,t)},unsubscribe:function(e,t){let i=e.modelId,n=i?null:e.cursor;n||(n=ue.get(i)),n&&n.unsubscribe(e.recordId||null,e.field,t)&&i&&(ue.delete(i),l(n).remove())},_getCursorFromRef:function(e){let t=e.cursor;return t||(t=ue.get(e.modelId)),t||null},getValue:function(e){const t=this._getCursorFromRef(e),i=t?.getModel();if(!i)return"";let n,s="";return n=e.recordId?i.getRecord(e.recordId):t.getCurrentRecord(),n&&(s=i.getValue(n,e.field)),s},setValue:function(e,t,n,s,r){const l=this._getCursorFromRef(e),a=l?.getModel(),o=e.field;if(!a)return void i.warn("setValue no model",e);let d,h;if("record"!==a.getOption("shape")?(h=e.recordId||e.cursor.recordId,d=a.getRecord(h)):d=a.getRecord(),d){let e,i=a.getValue(d,o);if(null!==i&&"object"==typeof i&&k(i,"v")&&(t={v:t,d:n}),e=a.setValue(d,o,t),"DUP"===e);else{let e=a.getRecordId(d);s.valid?a.setValidity("valid",e,o):a.setValidity("error",e,o,r)}}},parse:function(e,t){let i,n=l(t).closest("[data-bind-model],[data-bind-cursor],a-model-cursor"),s=l(t).closest("[data-bind-record],.a-GV-row[data-id]"),r=s.attr("data-bind-record")||s.attr("data-id"),a=null;return n[0]?(i=n.attr("data-bind-cursor"),i&&(n=l("#"+i)),n.is("a-model-cursor")&&(i=n[0]),a={type:"model",field:e},i?a.cursor=i:a.modelId=n.attr("data-bind-model"),r&&(a.recordId=r),a):a}})}(apex.model,apex.server,apex.debug,apex.util,apex.item,apex.locale,apex.jQuery);
!function(e,t,i,s,o,l){"use strict";const n="a-GV",r="noDataMsg",a="moreDataMsg",h="altMessage",d=h+"-text",c=h+"-icon",g="footer",f="-hideDeleted",p="js-ScrollFiller",u="."+p,m="is-selected",_="."+m,R=".is-aggregate",S="aria-labelledby",P="aria-label",C="aria-current",k="aria-controls",v="aria-hidden",$="js-tabbable",I="."+$,O="js-rangeDisplay",T="."+O,w=":tabbable",y=":visible",A="data-start",D="data-end",b="data-id",M="data-rownum",x="data-state",F="data-page",E="class",H="disabled",L="role",B="region",N=".js-pg-prev,.js-pg-next,.js-pg-first,.js-pg-last",z="APEX.GV.",j="true",G="before",V="after",W="pageChange",U=e.hasOwnProperty,K=Object.entries,q=e.applyTemplate,Y=Array.isArray,X=e=>parseInt(e,10);let Q=new Map;function Z(e){return s.getMessage(z+e)}function J(e,...t){return s.formatMessage(z+e,...t)}function ee(e,...t){return s.formatMessageNoEscape(z+e,...t)}function te(e,t){return Math.floor(e/t)*t}function ie(e,t,i,s,o){let l=Math.ceil((i+1-t)/s)*o;e.css("height",l)}function se(t,i){const s=i.cssClassPrefix||n;return e.escapeHTMLAttr(s+"-"+t)}function oe(e,t){return"."+se(e,t)}function le(e,t,i){e.find(u).each((function(){let e=l(this),s=X(e.attr(A)),o=X(e.attr(D));ie(e,s,o,t,i)}))}function ne(e){return"collapse"!==e.css("visibility")}function re(e,t){e.css("visibility",t?"":"collapse").toggleClass("is-hidden",!t)}function ae(e){return e.getOption("hasTotalRecords")}l.widget("apex.tableModelViewBase",{widgetEventPrefix:"tableModelViewBase",options:{modelName:null,progressOptions:null,noDataMessage:"",selectionStatusMessageKey:"APEX.TMV.SELECTION_COUNT",entityTitleSingular:null,entityTitlePlural:null,cssClassPrefix:"",noDataIcon:"icon-irr-no-results",moreDataMessage:"",editable:!1,autoAddRecord:!1,hideDeletedRows:!1,hasSize:!1,footer:!0,fixedRowHeight:!0,showNullAs:"-",applyTemplateOptions:{},stickyTop:!1,stickyFooter:!1,hideEmptyFooter:!1,pagination:{scroll:!1,virtual:!1,loadMore:!1,showPageLinks:!1,maxLinks:5,showPageSelector:!1,showRange:!0,firstAndLastButtons:!1,hideSinglePage:!1},persistSelection:!1,loadIncompleteSelection:"on-demand",highlights:{},highlighter:null,highlighterContext:null,rowsPerPage:null,scrollParentOverride:null,updateStatus:null},firstPage:function(){let e;return!this.renderInProgress&&(this.options.pagination.scroll?(e=this.scrollParent$,e.scrollTop(this.scrollDelta)):this.pageOffset>0&&(this.pageOffset=0,this.refresh(!1)),!0)},previousPage:function(){let e,t;return!this.renderInProgress&&(this.options.pagination.scroll?(e=this.scrollParent$,t=e.scrollTop()-this.scrollDelta-this.viewportHeight,t<0&&(t=0),e.scrollTop(t+this.scrollDelta)):this.pageOffset>0&&(this.pageOffset-=this.pageSize,this.pageOffset<0&&(this.pageOffset=0),this.refresh(!1)),!0)},nextPage:function(){let e,t,i,s;return!this.renderInProgress&&(this.options.pagination.scroll?(e=this.scrollParent$,t=this._getDataContainer().height()-this.viewportHeight,i=e.scrollTop()-this.scrollDelta+this.viewportHeight,i>t&&(i=t),e.scrollTop(i+this.scrollDelta)):(s=this.model.getTotalRecords(),(s<0||this.pageOffset+this.pageCount<s)&&(this.pageOffset+=this.pageSize,this.refresh(!1))),!0)},lastPage:function(){let e,t,i,s;return!this.renderInProgress&&(this.options.pagination.scroll?(t=this.scrollParent$,i=this._getDataContainer().height()-this.viewportHeight,t.scrollTop(i+this.scrollDelta)):(s=this.model.getTotalRecords(),s>0&&this.pageOffset+this.pageCount<s&&(e=Math.ceil(s/this.pageSize),this.pageOffset=(e-1)*this.pageSize,this.refresh(!1))),!0)},loadMore:function(){return this.options.pagination.scroll&&!this._scrollHandler?this._addNextPage():this.nextPage()},fetchAllData:function(e=!0){if(this.fetchAllDataActive)return;let t,i=this.options.persistSelection&&ae(this.model);i&&(t=this._selectedCount()),this.fetchAllDataActive=!0,this.model.fetchAll((e=>{this._updateStatus(),e.done&&(i&&this._checkSelectionChange(t),this.fetchAllDataActive=!1)}),!e)},getPageInfo:function(){let t=null,i=ae(this.model),s=this.options.pagination,o=this.model.getTotalRecords(),n=this.model.getServerTotalRecords();if(!this.noData)if(t={rowHeight:this.avgRowHeight,recordsPerRow:this._getRecordsPerRow(),firstOffset:this.pageFirstOffset||null,lastOffset:this.pageLastOffset||null,pageSize:this.pageSize,pageOffset:this.pageOffset},i&&(t.total=n),s.scroll){const i=this._getDataContainer(),s=this.scrollParent$[0]===window,o="TBODY"===i[0].nodeName,n="grid"===i.attr(L);let r,a,h,d;this._hasNestedControlBreaks()?(d=this._controlBreakSelector()+" "+this._itemSelector(),h=i.find(d)):h=i.children(),h=h.not(R),t.scrollOffset=this.scrollParent$.scrollTop(),r=e.binarySearch(h,t.scrollOffset,((e,i)=>{let n=l(i),r=s?n.offset().top:n.position().top;return s||o||n.offsetParent().closest(this.scrollParent$).length>0||(r+=t.scrollOffset),e-r})),a=h.eq(r),n&&(a=a.children().first()),t.viewOffset=X(a.attr(M))-1}else t.currentPage=Math.floor(this.pageOffset/this.pageSize),o>=0&&(t.totalPages=Math.ceil(o/this.pageSize));return t},gotoPage:function(e){let t,i=this.model.getTotalRecords();return!this.renderInProgress&&(i>0&&(t=Math.ceil(i/this.pageSize),e>=0&&e<t&&(this.pageOffset=e*this.pageSize,this.refresh(!1))),!0)},getActiveRecordId:function(){return this.activeRecordId},getActiveRecord:function(){return this.activeRecord},getModel:function(){return this.model},setActiveRecordValue:function(e){const t=this.columnItems[e];this.activeRecord&&t&&(this.ignoreItemChange=!0,this._setModelValue(null,t.item,this.activeRecord,e,!0),this.ignoreItemChange=!1)},lockActive:function(){this.activeRecord&&(this.activeLockCount+=1)},unlockActive:function(){this.activeRecord&&(this.activeLockCount-=1,this.activeLockCount<0&&(this.activeLockCount=0),0===this.activeLockCount&&(this.activeUnlockCallback&&(this.activeUnlockCallback(),this.activeUnlockCallback=null),this.finishEditingCallback&&(this.finishEditingCallback(),this.finishEditingCallback=null)))},finishEditing:function(){const e=this,t=l.Deferred();function i(){e._finishEditing?e._finishEditing(t):t.resolve()}return this.activeLockCount>0?this.finishEditingCallback=i:i(),t.promise()},addStateIcon:function(t,i,s){const o=e.htmlBuilder();this.stateIconMessages[t]=s,0===this._findStateIcon(t).length&&(o.markup("<span role='img'").attr(E,i).attr(x,t).attr(P,s||t).markup("></span>"),this.stateIcons$.append(o.toString()))},removeStateIcon:function(e){this._findStateIcon(e).remove(),delete this.stateIconMessages[e]},_create:function(){const e=this.options;e.hideDeletedRows&&this.element.addClass(se(f,e)),this.noData=!0,this.pendingRefresh=null,this.renderInProgress=!1,this._refreshNeeded=!1,this.pageOffset=0,this.highWaterMark=0,this.pageCount=0,this.totalRenderedRecords=0,this.pageSize=10,this.onLastPage=!1,this.lastScrollLeft=null,this.lastScrollTop=null,this.scrollPageTimer=null,this.hasScrollFillers=!1,this._scrollHandler=null,this.stateIconMessages={},this.prevSelCount=0,this.ignoreFieldChange=null,this.reinitCallbacks=null,this.activeRecord=null,this.activeRecordId=null,this.activeLockCount=0,this.activeUnlockCallback=null,this.columnItems=null,this.columnItemsContainer$=null,e.progressOptions||(e.progressOptions={fixed:!e.hasSize}),e.pagination.scroll&&!e.pagination.loadMore&&(e.rowsPerPage=null),e.rowsPerPage&&(this.pageSize=e.rowsPerPage),this._setOption("applyTemplateOptions",e.applyTemplateOptions)},_tableModelViewDestroy:function(){this.footer$&&(this.footer$.remove(),this.footer$=null),this.pageRange$=null,this.pageSelector$=null,this.status$=null,this.stateIcons$=null,this.element.removeClass(se(f,this.options)),this._removeScrollHandler()},_refreshCheckIfVisible:function(){return null===this.element[0].offsetParent?(this.pendingRefresh=!0,!1):(this.pendingRefresh=!1,!0)},_checkDelayRefresh:function(e){return!this.model.getOption("delayClearData")||this.forceRefresh?(this.forceRefresh=!1,!1):0!==this.model.getTotalRecords(!0)&&!this.model.recordAt(this.pageOffset)&&(this.model.fetch(this.pageOffset,(()=>{this.renderInProgress=!1,this.pendingRefresh=!1,this.forceRefresh=!0,this.refresh(e)}))&&(this.renderInProgress=!0,this.pendingRefresh=!0),!0)},_initModel:function(i,s){const o=this.options,l=this;let n,r=!0;if(this.model&&(this.model.unSubscribe(this.modelViewId),r=Y(this.modelName)&&Y(i)?!e.arrayEqual(this.modelName,i):this.modelName!==i,r&&(t.release(this.modelName),this.model=null,this.modelName=null)),this.modelChanged=r,i){if(r&&(this.modelName=i,this.model=t.get(i),!this.model))throw new Error("Model not found: "+i);this.modelViewId=this.model.subscribe({onChange:s||function(e,t){let i,s,r,a,h,d,c,g,f,p,u=!1;if(!l.pendingRefresh){if("refresh"===e)t.keepPagination||(l.pageOffset=0,l.highWaterMark=0,l.pageCount=0),t.clearDataPending&&l._refreshCheckIfVisible()?l.model.fetch(l.pageOffset,(function(){l.renderInProgress=!1,l.refresh()}))&&(l.renderInProgress=!0):l.refresh();else if("refreshRecords"===e||"revert"===e){i=l._elementsFromRecordIds(t.recordIds);for(let e=0;e<i.length;e++)s=i[e],s&&(r=t.records[e],h=t.recordIds[e],a=t.newIds[h]||h,d=l.model.getRecordMetadata(a),l._replaceRecord(s,r,h,a,d));"refreshRecords"===e&&!o.pagination.scroll&&Object.keys(t.newIds).length>0&&(u=!0)}else if("move"===e){f=t.records,t.insertAfterId&&(i=l._elementsFromRecordIds([t.insertAfterId]),s=i.length>0?i[0]:null);for(let e=f.length-1;e>=0;e--)r=f[e],a=l.model.getRecordId(r),d=l.model.getRecordMetadata(a),i=l._elementsFromRecordIds([a]),i.length>0&&i[0]&&l._removeRecord(i[0]),c=l._insertRecord(s,r,a,d,s?V:G)}else if("insert"===e||"copy"===e)if("insert"===e?(p=!1,f=[t.record]):(p=!0,f=t.records),t.insertAfterId&&(i=l._elementsFromRecordIds([t.insertAfterId]),s=i.length>0?i[0]:null),l.noData)setTimeout((function(){l.refresh(),i=l._elementsFromRecordIds([l.model.getRecordId(f[0])]),i.length>0&&i[0]&&l._afterInsert(i,p)}),1);else{g=[];for(let e=f.length-1;e>=0;e--)r=f[e],a=l.model.getRecordId(r),d=l.model.getRecordMetadata(a),c=l._insertRecord(s,r,a,d,s?V:G),g.unshift(c);l._afterInsert(g,p)}else if("clearChanges"===e){if(n){i=l._elementsFromRecordIds(t.deletedIds);for(let e=0;e<i.length;e++)i[e]&&l._removeRecord(i[e]);t.deletedIds.length>0&&!o.pagination.scroll&&(u=!0)}i=l._elementsFromRecordIds(t.changedIds);for(let e=0;e<i.length;e++)s=i[e],s&&(a=t.changedIds[e],d=l.model.getRecordMetadata(a),r=l.model.getRecord(a),l._updateRecordState(s,a,r,d))}else if(t.recordIds){i=l._elementsFromRecordIds(t.recordIds);for(let h=0;h<i.length;h++)s=i[h],s&&(a=t.recordIds[h],d=l.model.getRecordMetadata(a),r=t.records[h],"delete"===e?(!o.hideDeletedRows&&n&&null!==d||l._removeFocus(s),n&&null!==d?l._updateRecordState(s,a,r,d):l._removeRecord(s)):l._updateRecordState(s,a,r,d));"delete"===e&&(0===l.model.getTotalRecords()?u=!0:n||o.pagination.scroll?o.hideDeletedRows&&(l._deletedRowsHidden(),l._updateStatus()):u=!0)}else if("set"===e||"metaChange"===e){if(null===l.ignoreFieldChange||l.ignoreFieldChange!==t.field){let s=t.property;r=t.record,a=l.model.getRecordId(r),t.oldIdentity&&l._identityChanged(t.oldIdentity,a),d=l.model.getRecordMetadata(a),i=l._elementsFromRecordIds([a]),i.length>0&&i[0]&&("set"===e&&l._updateRecordField(i[0],r,t.field,d),l._updateRecordState(i[0],a,r,d,s))}}else"instanceRename"===e&&l.modelName[1]===t.oldInstance&&(l.modelName[1]=t.newInstance);u?l._refreshNeeded||(l._refreshNeeded=!0,queueMicrotask((()=>{l.refresh(),l._refreshNeeded=!1}))):"refresh"!==e&&l._updateTotalRecords()}},progressView:this.element,progressOptions:o.progressOptions}),n=this.model.getOption("onlyMarkForDelete"),this.options.pagination.scroll&&this.scrollParent$&&this.scrollParent$.scrollTop()>this.scrollDelta&&this.scrollParent$.scrollTop(this.scrollDelta),this.pageOffset=0,this.highWaterMark=0,this.pageCount=0}},_renderButton:function(e,t,i,s,o){e.markup(`<button class='${t}' type='button'`).attr(P,s).attr("title",s).optionalAttr("aria-expanded",null==o?null:o?j:"false").markup("><span aria-hidden='true' class='a-Icon ").attr(i).markup("'></span></button>")},_renderAltDataMessages:function(e,t){const i=this.options;function o(s,o,l,n,r,a){e.markup(`<div class='${s} ${se(h,i)}' style='display:none;' `).optionalAttr(L,r).optionalAttr(P,a).markup(`><div class='${se(c,i)}' `).optionalAttr(L,a?"img":null).optionalAttr(P,a).optionalAttr(v,a?null:j).markup(`><span class='a-Icon ${l}'></span></div>`).markup(`<div role='status'><span class='${se(d,i)}'`).optionalAttr("id",t?t+o+"_msg":null).markup(`>${n}</span></div></div>`)}o(se(r,i),"_no",i.noDataIcon,i.noDataMessage,"region",s.getMessage("APEX.IG.NO_DATA_FOUND")),o(se(a,i),"_more","icon-warning",i.moreDataMessage)},_renderLoadMore:function(e,t){const i=this.options,s=i.pagination;s.scroll&&s.loadMore&&e.markup(`<div class="${se("loadMore",i)}"`).optionalAttr("role",t?"region":"").optionalAttr(P,t).markup(`><button type="button" class="a-Button js-load ${se("loadMoreButton",i)}">`).content(Z("LOAD_MORE")).markup("</button></div>")},_renderFooter:function(e,t){const i=this.options;function s(){let s=i.entityTitlePlural?ee("PAGE_RANGE_ENTITY",i.entityTitlePlural):Z("PAGE_RANGE");e.markup("<span ").attr(E,O).optionalAttr("id",t?t+"_pageRange":null).attr("title",s).markup(`><span class="${se("pageRange",i)} "></span></span>`)}if(i.footer){let o;if(o=i.pagination?i.pagination.scroll?Z("RANGE_DISPLAY"):Z("PAGINATION_LANDMARK"):null,e.markup(`<div class="${se(g,i)}" style="display:none;" `).attr(L,B).attr(P,Z("FOOTER_LANDMARK")).markup(`><div class="${se("stateIcons",i)}" `).attr(L,B).attr(P,Z("STATE_ICONS_LANDMARK")).markup("></div><div ").attr(L,B).attr(P,Z("STATUS_LANDMARK")).markup("><div ").optionalAttr("id",t?t+"_status":null).attr(E,se("status",i)).attr(L,"status").markup(`></div></div><div class="${se("pagination",i)}" `).optionalAttr(L,o?B:null).optionalAttr(P,o).markup(">"),i.pagination){const t=[se("pageButton",i),se("pageButton--nav",i),"a-Button"],o=ae(this.model);let l=!1;i.pagination.scroll||(o&&i.pagination.firstAndLastButtons&&this._renderButton(e,t.join(" ")+" js-pg-first","icon-first",Z("FIRST_PAGE")),this._renderButton(e,t.join(" ")+" js-pg-prev","icon-prev",Z("PREV_PAGE"))),o&&(i.pagination.showPageLinks||i.pagination.showPageSelector)?e.markup(`<span class="${se("pageSelector",i)}"></span>`):i.pagination.showRange&&(s(),l=!0),i.pagination.scroll||(this._renderButton(e,t.join(" ")+" js-pg-next","icon-next",Z("NEXT_PAGE")),o&&i.pagination.firstAndLastButtons&&this._renderButton(e,t.join(" ")+" js-pg-last","icon-last",Z("LAST_PAGE"))),!l&&i.pagination.showRange&&s()}e.markup("</div></div>")}},_refreshPagination:function(e){const t=this.options,i=t.pagination;this.hasScrollFillers=i.scroll&&i.virtual&&!i.loadMore,this.lastScrollTop=null,this.lastScrollLeft=null,e.length&&(t.hasSize||(e=t.scrollParentOverride?l(t.scrollParentOverride):l(window)),this.lastScrollLeft=e.scrollLeft(),this.lastScrollTop=e.scrollTop())},_paginationHasFocus:function(){const e=this.options,t=l(document.activeElement);if(t.closest(oe(g,e)).length>0){if(t.parent().hasClass(se("pageSelector-item",e)))return t.parent().attr(F);{const e=/js-pg-\S+/.exec(t.attr(E));if(e)return"."+e[0]}}return!1},_restorePaginationFocus:function(e){if(e){let t,i=e;i>=0&&(i=`[${F}='${e}'] button`),t=this.footer$.find(i),t[0]&&t[0].disabled&&(t=this.footer$.find(":focusable").eq(0)),t.trigger("focus")}},_initPagination:function(e,t){const i=this.options,s=this.element,o=s.hasClass("u-RTL")?"right":"left",n=this.footer$=s.find(oe(g,i));if(this.pageKey=null,this.status$=n.find(oe("status",i)),this.stateIcons$=n.find(oe("stateIcons",i)),this.pageRange$=n.find(oe("pageRange",i)),this.pageSelector$=n.find(oe("pageSelector",i)),this.noData$=s.find(oe(r,i)),this.moreData$=s.find(oe(a,i)),l.ui.tooltip){let e=this.stateIconMessages;this.stateIcons$.tooltip({content:function(){let t=l(this).attr(x);return e[t]},items:`[${x}]`,show:apex.tooltipManager.defaultShowOption(),tooltipClass:se("tooltip",i),position:{my:o+" bottom",at:o+" top-10",collision:"flipfit"}})}if(this._updateScrollHandler(t),i.pagination.scroll&&(this.pageOffset=0,this.highWaterMark=0,this.pageCount=0,this.totalRenderedRecords=0),!i.hasSize&&l.apex.stickyWidget){if(i.stickyTop){let t={stickToEnd:!0,toggleWidth:!0,bottom:()=>s.offset().top+s.outerHeight()-this._footerHeight()};"function"==typeof i.stickyTop&&(t.top=i.stickyTop),e.css("overflow","hidden").stickyWidget(t)}i.footer&&i.stickyFooter&&n.stickyWidget({isFooter:!0,toggleWidth:!0,stickToEnd:!0,top:()=>s.offset().top+this._getHeaderHeight()})}i.pagination.showPageLinks?this.pageSelector$.on("click",(e=>{let t=l(e.target).parent();t.length&&this.gotoPage(X(t.attr(F))),e.preventDefault()})):i.pagination.showPageSelector&&this.pageSelector$.on("change",(e=>{this.gotoPage(X(l(e.target).val()))})),n.find(".js-pg-first").on("click",(()=>{this.firstPage()})),n.find(".js-pg-prev").on("click",(()=>{this.previousPage()})),n.find(".js-pg-next").on("click",(()=>{this.nextPage()})),n.find(".js-pg-last").on("click",(()=>{this.lastPage()})),s.find(".js-load").on("click",(()=>{const e=this.scrollParent$.scrollTop();this.loadMore(),this.focus(),this.scrollParent$.scrollTop(e)})),n.on("click",".js-loadAll",(e=>{this.focus(),l(e.target).closest(".js-loadAll").remove(),this.fetchAllData()}))},_updateHeaderFooter(e){const t=this.options;!t.hasSize&&l.apex.stickyWidget&&(e[0]&&t.stickyTop&&e.stickyWidget("refresh"),this.footer$[0]&&t.stickyFooter&&this.footer$.stickyWidget("refresh"))},_footerHeight:function(){return this.footer$.outerHeight()||0},_addNextPage:function(){if(this.renderInProgress)return!1;let e=this.model.getTotalRecords();return(e<0||this.pageOffset+this.pageCount<e)&&(this.pageOffset+=this.pageCount,this._addPageOfRecords()),!0},_addPageOfRecords:function(t){const i=this,s=this.options,o=this._hasControlBreaks(),n=this._hasNestedControlBreaks(),r=ae(this.model),a=this._controlBreakSelector(),d=this._itemSelector();let c,g,f,m,_,S,P,C=this._getDataRenderContext(),k=null;function v(e,t,i,s,o){return e>t||(i.attr(A,e),i.attr(D,t),ie(i,e,t,s,o),!1)}function $(e,t,i,s){let r=s||0,h=i-t;return o&&!n&&(r=t+r,h=i,t=0,i+=e.filter(a).length),e.slice(t,i).filter(((e,t)=>{let i=l(t);return o&&!n&&i.is(a)&&(e<r&&(r+=1),h+=1),i.hasClass(p)&&(h=e),e>=r&&e<h}))}function I(e,t,i){let o=t,l=_.find(`[${M}="${t+1}"]`);return(e&&!ne(e)||!l.is(y))&&(o=X(l[i?"nextAll":"prevAll"](` ${oe("row",s)} [${M}]:visible`).first().attr(M))||0),o}function O(e,t){e.closest(a)[t](k)}function T(){let e,t,o,h,d,g,S,P=c-(m-f),T=i.avgRowHeight;if(i.hasScrollFillers){e=_.find(u),o=i.model.getTotalRecords(!0)-1,d=o,0===e.length&&r?(k&&(i._getDataContainer().append(k),k=null),t=i._getDataRenderContext(),i._renderFillerRecord(t,p),e=i._insertFiller(t,null),e.attr(A,0),e.attr(D,o),e=e.last()):0===e.last().next().length&&(d=X(e.last().attr(D))),o!==d&&e.last().attr(D,o),h=i._getRecordsPerRow();let c=-1,f=!1;if(e.each((function(e){let s,o=!1,r=l(this),a=X(r.last().attr(A)),d=X(r.last().attr(D)),g=m+P;if(m===a)k?(O(r,V),i.controlBreakGroupContainer$.append(r)):n&&r.parent()[0]!==i.controlBreakGroupContainer$[0]&&i.controlBreakGroupContainer$.prepend(r),o=v(g,d,r,h,T),i._insertData(C,r,G),c=e,f=!0;else if(g<d){let o;k&&(o=r.parent(),O(r,V),i.controlBreakGroupContainer$.append(r)),v(g,d,r,h,T),t=i._getDataRenderContext(),i._renderFillerRecord(t,p),s=i._insertFiller(t,r),o&&o.append(s),v(a,m-1,s,h,T),i._insertData(C,r,G),c=e+1,f=!0}else m<=d&&g>d&&(k&&(O(r,V),i.controlBreakGroupContainer$.append(r)),o=v(a,m-1,r,h,T),i._insertData(C,r,V),c=e+1,f=!0);if(f)return o&&(c===e&&(c=e+1),r.remove()),!1})),f||(i._insertData(C),c=e.length),!n&&i.totalRenderedRecords>8*i.pageSize){let l,r,d,f,m,P,C,k=0,O=null,w=0,x=0,F=!1;if(s.fixedRowHeight||(g=_.find(`[${M}="${i.pageOffset+1}"]`),g[0]&&(S=g.offset().top)),e=_.find(u),C=e.length-1,x>=c)x=-1,m=2*i.pageSize;else if(O=e.eq(x),n){let t=!1,i=O;for(;i[0]&&x<c;){if(0!==i.next().length){O=i,m=X(O.attr(D));break}t=!0,m=X(O.attr(D)),x+=1,O=i,i=e.eq(x)}t&&(x=-1,m+=1)}else{for(;O.next().is(u);)O=O.next();m=X(O.attr(D))}if(m>0&&(k=Math.abs(i.pageOffset-I(O,m+1,!0))),k>=3*i.pageSize)x>=0?(f=$(O.nextAll(),0,i.pageSize),w=f.not(a).length,d=f.first().is(y)&&f.last().is(y),P=f.last().next().filter(u),P.length&&d===ne(P)?(l=X(O.attr(A)),r=X(P.attr(D)),v(l,r,P,h,T),O.remove()):d===ne(O)?(l=X(O.attr(A)),r=X(O.attr(D))+w,v(l,r,O,h,T)):(l=X(O.attr(D))+1,F=!0)):(l=m,r=l+i.pageSize,f=$(_.children(),l,r),w=n?f.length:f.not(a).length,d=f.first().is(y)&&f.last().is(y),F=!0),F&&(t=i._getDataRenderContext(),i._renderFillerRecord(t,p),O=i._insertFiller(t,f.eq(0)),v(l,l+w-1,O,h,T),re(O,d));else{let s;if(k=0,C<c)C=-1,m=-1,s=_.children().not(R).last(),s.attr(b)&&(m=i.model.indexOf(i.model.getRecord(s.attr(b))),m=te(m,i.pageSize)-i.pageSize);else{for(O=e.eq(C);O.prev().is(u);)O=O.prev();m=X(O.attr(A))}m>0&&(k=Math.abs(i.pageOffset+i.pageSize-I(O,m-1,!1))),k>=3*i.pageSize&&(C>=0?(f=$(O.prevAll(),0,i.pageSize),w=f.not(a).length,d=f.first().is(y)&&f.last().is(y),P=f.prev(u),P.length&&d===ne(P)?(l=X(P.attr(A)),r=X(O.attr(D)),v(l,r,P,h,T),O.remove()):d===ne(O)?(l=X(O.attr(A))-w,r=X(O.attr(D)),v(l,r,O,h,T)):(l=X(O.attr(A))-w,r=l+w-1,F=!0)):(l=o-m,r=l+i.pageSize,f=$(s.prevAll(),0,r,l),w=f.not(a).length,w>0&&(d=f.first().is(y)&&f.last().is(y),F=!0,r=m-1,l=m-w)),F&&(t=i._getDataRenderContext(),i._renderFillerRecord(t,p),O=i._insertFiller(t,f.eq(0)),v(l,r,O,h,T),re(O,d)))}w>0&&(f.remove(),i.totalRenderedRecords-=w)}if(!s.fixedRowHeight){let e=0;i._updateAvgRowHeight(),le(i._getDataContainer(),h,i.avgRowHeight),g&&g[0]&&(e=g.offset().top-S),0!==e&&i.scrollParent$.scrollTop(i.scrollParent$.scrollTop()+e)}}else i._insertData(C)}if(!this.renderInProgress){if(S=i.noData$.parent().children().not(oe(h,s)),(this.noData||this.moreData$.is(y))&&this.noData$.length&&(this.noData$.hide(),this.moreData$.hide(),S.show(),this.resize()),_=i._getDataContainer(),0!==this.pageOffset&&s.pagination.scroll||(this.pageFirstOffset="",this.pageLastOffset=""),s.pagination.scroll||(this.totalRenderedRecords=0),this.controlBreakCollapsed=!!o&&null,o)if(0!==this.pageOffset&&s.pagination.scroll){if(!n||!i.hasScrollFillers){let e=this.model.getOption("metaField");if(e){let t=this.pageOffset-1;for(;t>0;){let i,s=this.model.recordAt(t);if(s&&(i=this.model.getValue(s,e),!i.agg)){P=!0===i.endControlBreak;break}t-=1}}}}else P=!0;else this.controlBreakGroupContainer$=null;c=0,g=this.pageSize,s.pagination.scroll?i.hasScrollFillers&&_.find(u).each((function(){let e=l(this),t=X(e.attr(A)),s=X(e.attr(D));if(i.pageOffset>=t&&i.pageOffset<s)return g=Math.min(g,s+1-i.pageOffset),!1})):this.pageOffset=te(this.pageOffset,g),m=f=this.pageOffset,this.renderInProgress=!0,this.model.forEachInPage(this.pageOffset,g,(function(a,h,p,R){if(a){const t=p?this.model.getRecordMetadata(p):{};let s,g,f,m=t.serverOffset;if(o&&!t.agg){if(!P&&0===c&&n&&i.hasScrollFillers){const t=this.model.getControlBreakId(a),i=this._getDataContainer().find(`[${b}="${e.escapeCSS(t)}"]`);i[0]?this.controlBreakGroupContainer$=i.find(d+","+u).first().parent():P=!0}if(s=!0,P&&n&&i.hasScrollFillers){const t=this.model.getControlBreakId(a),i=this._getDataContainer().find(`[${b}="${e.escapeCSS(t)}"]`);i[0]&&(P=!1,this.controlBreakGroupContainer$=i.find(d+","+u).first().parent())}P&&(P=!1,f=n?this._getDataRenderContext():C,g=this._controlBreakData(a),this._renderBreak(f,s,g,m),n&&(f.markup("\x3c!--$row$--\x3e"),this._renderEndBreak(f,g),k=l(f.toString()),this.controlBreakGroupContainer$=this._findRowsPlaceholderParent(k),this.hasScrollFillers&&r||(this._getDataContainer().append(k),k=null))),t.endControlBreak&&(P=!0)}this._renderRecord(C,a,h,p,t),void 0!==m&&(m+=1,""===this.pageFirstOffset&&(this.pageFirstOffset=m),m>this.pageLastOffset&&(this.pageLastOffset=m)),c+=1}c===g||!a||R?function(e){const o=i.pageOffset+c;let n;if(i.pageCount=c,i.totalRenderedRecords+=c,o>i.highWaterMark&&(i.highWaterMark=o),0===i.pageOffset&&0===c)i.noData=!0,S.hide(),i.moreData$.hide(),i.noData$.show(),i._trigger(W,null,{offset:0,count:0}),s.autoAddRecord&&i.model.allowAdd()&&!e&&i._autoAddRecord();else{if(0===c)return i.renderInProgress=!1,void(s.pagination.scroll||(i.pageOffset-=i.pageSize,i.pageOffset<0&&(i.pageOffset=0),i._addPageOfRecords()));i.noData=!1,i.noData$.hide(),i.model.getDataOverflow()&&s.moreDataMessage?(i.moreData$.show(),S.hide()):(i.moreData$.hide(),S.show()),T(),i._trigger(W,null,{offset:f,count:c})}if(i._updateTotalRecords(),i.renderInProgress=!1,!i.noData&&s.pagination.scroll&&(i.controlBreakCollapsed||!r&&_.height()<i.scrollParent$.height())){let e=i.model.getTotalRecords(),s=i.hasScrollFillers?i.pageOffset+i.pageCount:i.highWaterMark;if(e<0||s<e){let e=!0;if(i.pageOffset=s,i.hasScrollFillers&&(e=!1,n=_.find(u),n.each((function(){if(i.pageOffset===X(l(this).attr(A)))return e=!0,!1}))),e)return void i._addPageOfRecords(t)}}t&&t()}(R):(P&&this.controlBreakGroupContainer$||!1===R)&&(T(),m+=c,C.clear())}),this)}},_findRowsPlaceholderParent:function(e=this.element){let t,i,s=l(),o=e[0].ownerDocument.evaluate("descendant::comment()",e[0],null,XPathResult.ANY_TYPE,null);for(i=o.iterateNext();i;){if("$row$"===i.nodeValue.trim()){t=l(i);break}i=o.iterateNext()}return t&&(s=t.parent(),t.remove()),s},_initPageSize:function(){let t,i,s,o,l=this.options,n=this._getRecordsPerRow();this.hasScrollFillers&&(this.recPerRow!==n&&le(this._getDataContainer(),n,this.avgRowHeight),this._scrollPage()),this.recPerRow=n,this._updateAvgRowHeight(),t=this.avgRowHeight,l.hasSize?i=this.scrollParent$[0].offsetHeight:(i=this.scrollParent$.height(),this.footer$.hasClass("js-stickyWidget-toggle")&&(i-=this._footerHeight()),o=this._getStickyTop(),o>0&&(i-=o+this._getHeaderHeight())),i-=e.getScrollbarSize().height,s=Math.floor(i/t),s<1&&(s=1),this.viewportHeight=s*t,l.rowsPerPage||(l.fixedRowHeight||l.pagination.scroll?(s*=n,l.pagination.scroll?(this.pageSize=Math.round(Math.max(20,1.5*s)),this.pageSize=Math.ceil(this.pageSize/n)*n):this.pageSize=s):this.pageSize=20)},_updateStatus:function(){const e=this.options,t=this._selectedCount(),i=ae(this.model)?this.model.getTotalRecords():null,s=this.model.getSelectionState().incomplete;let o=null,l="";this.prevSelCount=t,this.options.hideDeletedRows&&(o=this._deletedCount()),t>0&&(l+=this._selectedStatusMessage(t)),s&&!this.fetchAllDataActive&&("on-demand"===e.loadIncompleteSelection?l+=` <button type="button" class="a-Button a-Button--link js-loadAll"> ${Z("LOAD_ALL")}</button> `:"always"===e.loadIncompleteSelection&&this.fetchAllData(!0)),o>0&&(l&&(l+=", "),l+=J("DELETED_COUNT",o)+" "),this.status$.html(l),e.updateStatus&&e.updateStatus({deletedCount:o,selectedCount:t,total:i,incomplete:s})},_setModelValue:function(e,t,i,s,o){let l,n,r,a;if(e&&e.removeClass("is-active"),n=t.getValue(),o||(this.ignoreFieldChange=s),a=this.model.getRecordId(i),r=this.model.getValue(i,s),null!==r&&"object"==typeof r&&U(r,"v")&&(n={v:n,d:t.displayValueFor(n)}),l=this.model.setValue(i,s,n),"DUP"===l)this._setColumnItemValue(t,i,s),apex.message.alert(Z("DUP_REC_ID"));else{let e=t.getValidity(),o=this.model.getRecordId(i);e.valid?this.model.setValidity("valid",o,s):this.model.setValidity("error",o,s,t.getValidationMessage()),o!==a&&this._identityChanged(a,o)}o||(this.ignoreFieldChange=null)},_initColumnItems:function(e){const t=this.options;let s=!0;this.columnItems={},this.columnItemsContainer$=null,this.asyncColumnItems=[];for(let i=0;i<e.length;i++){let l,n=e[i],r=n.elementId,a=null;r&&(Q.has(r)?(a=this.columnItems[n.property]=Q.get(r),l=a.item):(l=o(r),l.node&&(s=!1,a=this.columnItems[n.property]={element$:l.element.closest(oe("columnItem",t)),item:l},Q.set(r,a),l.whenReady&&this.asyncColumnItems.push(l.whenReady()))),a&&!this.columnItemsContainer$&&(this.columnItemsContainer$=a.element$.parent()))}this.columnItemsContainer$?s||this.columnItemsContainer$.find(w).addClass($).attr("tabindex",-1):this.editable&&i.error(`An editable ${this.widgetName} must have at least one column with a column item.`)},_waitForColumnItems:function(){return l.when(...this.asyncColumnItems)},_activateColumnItem:function(e,t){const i=e.element$;i.find(I).attr("tabindex",0).removeClass($),t&&(l("label[id='"+t+"']").length||("RADIO_GROUP"===e?.item?.item_type?i.find("[role='radiogroup']").attr(S,t):"CHECKBOX_GROUP"===e?.item?.item_type?i.find("[role='group']").attr(S,t):i.find(w).first().attr(S,t)))},_deactivateColumnItem:function(e){const t=e.element$,i=t.find(w);"RADIO_GROUP"===e?.item?.item_type?t.find("[role='radiogroup']").removeAttr(S):"CHECKBOX_GROUP"===e?.item?.item_type?t.find("[role='group']").removeAttr(S):i.first().removeAttr(S),this.columnItemsContainer$.append(t),i.addClass($).attr("tabindex",-1)},_renderFieldDataValue:function(t,i,s,o,l){const n=this.options;let r,a,h,d=null;(l&&l.url||i.linkTargetColumn)&&!o.agg&&(d=i.linkTargetColumn?this.model.getValue(s,i.linkTargetColumn)||null:l.url),r=this.model.getValue(s,i.property),(o.agg||o.inserted&&i.readonly)&&this.model.isIdentityField(i.property)&&(r=""),(i.linkText||i.linkAttributes||i.cellTemplate)&&(a=this.atOptions,a.model=this.model,a.record=s),d&&(t.markup("<a").attr("href",d),i.linkAttributes&&t.markup(q(i.linkAttributes,a)),t.markup(" tabindex='-1'>")),d&&i.linkText?t.markup(q(i.linkText,a)):i.cellTemplate?o.agg?(r=null==r?"":r,t.content(""+r)):(r=q(i.cellTemplate,a),n.highlighter&&(r=n.highlighter(n.highlighterContext,r,i)),t.markup(r)):null!==r&&""!==r||!(n.showNullAs||o.agg||d)?(null===r&&(r=""),"object"==typeof r&&U(r,"d")?r=r.d:(h=this.columnItems[i.property],h&&(r=h.item.displayValueFor(r,{readonly:l&&!!l.ck||i.readonly||o.deleted||!1,disabled:l&&l.disabled||!1,labelBy:i.domId}))),!1!==i.escape&&(r=e.escapeHTML(""+r)),!0===i.sanitize&&(r=e.sanitizeHtml(""+r)),n.highlighter&&(r=n.highlighter(n.highlighterContext,r,i)),t.markup(r)):(r=o.agg||o.inserted||l&&(l.changed||l.error||l.warning)?"":d||n.showNullAs,t.content(r)),d&&t.markup("</a>")},_beginSetColumnItems:function(){this.reinitCallbacks=[]},_setColumnItemValue:function(e,t,i,s){let o,l=null,n=this.model.getValue(t,i);null!==n&&"object"==typeof n&&U(n,"d")&&(l=n.d,n=n.v),this.reinitCallbacks?(o=e.reinit(n,l),o&&this.reinitCallbacks.push(o)):e.setValue(n,l),s&&(s.fields&&s.fields[i]&&s.fields[i].disabled?e.disable():e.enable())},_endSetColumnItems:function(){const e=this.reinitCallbacks;if(e)for(let t=0;t<e.length;t++)e[t]();this.reinitCallbacks=null},_autoAddRecord:function(e){const t=this.model.insertNewRecord(null,e);this.model.getRecordMetadata(t).autoInserted=!0},_triggerBeginEditing:function(e,t){this.element.trigger("apexbeginrecordedit",[{model:this.model,record:e,recordId:t}])},_triggerEndEditing:function(e,t){this.element.trigger("apexendrecordedit",[{model:this.model,record:e,recordId:t}])},_updateHighlights:function(){let e=this.options,t=[],i="";for(const[i,s]of K(e.highlights))s.id=i,t.push(s);t.sort(((e,t)=>t.seq-e.seq));for(let e=0;e<t.length;e++){let s=t[e];s.cssClass||(s.cssClass=(s.row?"hlr_":"hlc_")+s.id),(s.color||s.background)&&(s.row?i+="."+s.cssClass+" td":i+="td."+s.cssClass,i+=" { ",s.color&&(i+="color: "+s.color+" !important; "),s.background&&(i+="background-color: "+s.background+" !important; "),i+="}\n")}!this.gridStyles$&&i&&(this.gridStyles$=l("<style></style>"),l("head").append(this.gridStyles$)),this.gridStyles$&&(this.gridStyles$=this.gridStyles$.text(i))},_findStateIcon:function(e){return this.stateIcons$.find(`[${x}='${e}']`)},_setOption:function(e,t){const s=this.options;this._super(e,t),"noDataMessage"===e?this.element.find(oe(h,s)+" > div > "+oe(d,s)).text(t):"noDataIcon"===e?this.element.find(oe(h,s)+" > "+oe(c,s)+" span").attr(E,"a-Icon "+t):"rowsPerPage"===e?(s.pagination.scroll&&!s.pagination.loadMore&&(i.warn("Ignoring rowsPerPage when scroll pagination."),s.rowsPerPage=null),s.rowsPerPage&&(this.pageSize=s.rowsPerPage)):"hideDeletedRows"===e?(this.element.toggleClass(se(f,s),t),!0===t&&this._deletedRowsHidden(),this._updateStatus()):"scrollParentOverride"===e?s.hasSize?i.warn("Ignoring scrollParentOverride when hasSize is true."):this._updateScrollHandler():"applyTemplateOptions"===e&&(this.atOptions=l.extend(!0,{},s.applyTemplateOptions||{},{extraSubstitutions:{},placeholders:{}}))},_updateScrollHandler:function(e){let t=this.options,i=this.scrollParent$,s=t.scrollParentOverride;t.hasSize?(this.scrollParent$=e,this.scrollDelta=0):(this.scrollParent$=l(s||window),this.scrollDelta=this.element.offset().top-this._getStickyTop()),this.totalRenderedRecords=0,t.pagination.scroll&&!t.pagination.loadMore&&(i&&this._scrollHandler?i.off("scroll",this._scrollHandler):this._scrollHandler=()=>{this.element[0].clientWidth>0&&this._scrollPage()},this.scrollParent$.on("scroll",this._scrollHandler))},_removeScrollHandler:function(){this._scrollHandler&&(this.scrollParent$.off("scroll",this._scrollHandler),this._scrollHandler=null)},_scrollPage:function(){const e=this,t=this.scrollParent$.scrollTop();t!==this.lastScrollTop&&(this.lastScrollTop=t,this.scrollPageTimer||(this.scrollPageTimer=setTimeout((function(){if(!e.model)return;let t,i,s,o,n,r,a,h,d=null,c=!1,g=ae(e.model),f=e.scrollParent$[0]===window,p=e.avgRowHeight;if(e.scrollPageTimer=null,e.renderInProgress)return e.lastScrollTop=null,void e._scrollPage();if(o=e.scrollParent$.height(),n=0-o/2,o*=2,r=n+o,t=e._getDataContainer(),i=e.scrollParent$.scrollTop(),e.hasScrollFillers&&(d=t.find(u),!d.length&&g&&e._removeScrollHandler(),s=e.pageOffset,t[0]&&(h="TBODY"===t[0].nodeName),d.each((function(){const t=l(this),a=X(this.style.height),d=X(t.attr(A)),g=X(t.attr(D));let u,m;if(!(d>g))return m=f?t.offset().top:t.position().top,(f||h||t.offsetParent().closest(e.scrollParent$).length>0)&&(m-=i),u=m+a,m<=r&&u>=n?(e.pageOffset=a<2*o||m>n?d:te(u<r?g:d+Math.ceil((n+o/2-m)*e._getRecordsPerRow()/p),e.pageSize),e.pageOffset!==s&&e._addPageOfRecords(),c=!0,ne(t)||re(t,!0),!1):void 0}))),!(c||g&&e.hasScrollFillers)){let s=t.height();(f||t.offsetParent().closest(e.scrollParent$).length>0)&&(s+=f?t.offset().top:t.position().top),s-=i,s>0&&s<=1.5*o&&(a=e.model.getTotalRecords(),a<0||e.highWaterMark<a?(e.pageOffset=e.highWaterMark,e._addPageOfRecords()):(d&&0===d.length||!d&&a===e.totalRenderedRecords)&&e._removeScrollHandler())}}),300)))},_updateTotalRecords:function(){const e=this.options,t=this.footer$,i=this.pageSelector$,s=e.pagination,o=this.model.getTotalRecords(),n=this.model.getServerTotalRecords(),r=ae(this.model);let a,h,d,c,g,f,p=null,u=null;function R(t){return 1===t&&e.entityTitleSingular?ee("TOTAL_ENTITY_SINGULAR",e.entityTitleSingular):t>1&&e.entityTitlePlural?ee("TOTAL_ENTITY_PLURAL",n,e.entityTitlePlural):J("TOTAL_PAGES",n)}if(r&&this._updateStatus(),o>=0&&(p=Math.ceil(o/this.pageSize),u=Math.floor(this.pageOffset/this.pageSize)),null!==this.lastScrollLeft&&(this.scrollParent$.scrollLeft(this.lastScrollLeft),this.scrollParent$.scrollTop(this.lastScrollTop),this.lastScrollLeft=null,this.lastScrollTop=null),this.onLastPage=!1,0===this.pageCount&&0===this.pageOffset?(d="",this.onLastPage=!0,t.find(N).attr(H,!0),t.find(T).attr(v,j)):(t.find(N).attr(H,!1),t.find(T).removeAttr(v),this.element.find(".js-load").attr(H,!1),0===this.pageOffset&&t.find(".js-pg-prev,.js-pg-first").attr(H,!0),o>0&&u===p-1&&(this.onLastPage=!0,t.find(".js-pg-next,.js-pg-last").attr(H,!0),this.element.find(".js-load").attr(H,!0)),s.loadMore&&s.hideSinglePage&&this.element.find(".js-load").toggle(1!==p),d=s.scroll&&s.virtual&&!s.loadMore&&r?R(n):r?s.hideSinglePage&&1===p?R(n):J("PAGE_RANGE_XYZ",this.pageFirstOffset,this.pageLastOffset,n):J("PAGE_RANGE_XY",this.pageFirstOffset,this.pageLastOffset)),document.activeElement&&document.activeElement.disabled&&l(document.activeElement).hasClass("js-load")&&this.focus(),this.pageRange$&&this.pageRange$.text(d),p>0){if(s.showPageLinks){if(g=`${o}_${this.pageSize}_${u}`,this.pageKey!==g){f=`<li class="${se("pageSelector-item",e)}">&hellip;</li>`,this.pageKey=g,c=`<ul class="${se("pageSelector-list",e)}">`,a=u-Math.floor(s.maxLinks/2),a<0&&(a=0),h=a+s.maxLinks,h>=p&&(h=p,a=h-s.maxLinks,a<0&&(a=0)),a>0&&(c+=f);for(let t=a;t<h;t++)c+=`<li class="${se("pageSelector-item",e)}" ${F}='${t}'><button class="${se("pageButton",e)}" type='button'>${t+1}</button></li>`;h<p&&(c+=f),c+="</ul>",i.html(c)}i.find(_).removeClass(m).removeAttr(C).attr(k),i.find(`[${F}='${u}']`).addClass(m).attr(C,"page").attr(k,this.element[0].id)}else if(s.showPageSelector){if(g=`${o}_${this.pageSize}`,this.pageKey!==g){this.pageKey=g,c=`<select class="${se("pageSelectlist",e)}" size='1' aria-label='${Z("PAGE_SELECTION")}' aria-controls='${this.element[0].id}'>`;for(let e=0;e<p;e++)c+=`<option value='${e}'>${J("SELECT_PAGE_N",e+1)}</option>`;c+="</select>",i.html(c)}i.children("select").val(u)}}else i.empty(),this.pageKey=null;s.hideSinglePage&&!s.scroll&&(t.find(N).add(i)[1===p?"hide":"show"](),t.find(T)[r?"show":"hide"]()),t[this.noData&&e.hideEmptyFooter?"hide":"show"]()},_updateAvgRowHeight:function(){let e;if(this.options.fixedRowHeight)e=this._getFixedRecordHeight();else{let t,i=this._getRecordsPerRow(),s=Math.ceil(this.totalRenderedRecords/i);s<=0?e=this.avgRowHeight||this._getFixedRecordHeight():(t=this._getDataContainer().height(),this._getDataContainer().find(u).each((function(){t-=l(this).height()})),e=t/s)}e<=0&&(e=43),this.avgRowHeight=e},_getStickyTop:function(){let e=this.options.stickyTop;return"function"==typeof e?e():0},_getHeaderHeight:function(){return 0},_getRecordsPerRow:function(){return 1},_getDataRenderContext:function(){return e.htmlBuilder()},_selectedCount:function(){return 0},_selectedStatusMessage:function(e){const t=this.options;return t.entityTitlePlural&&t.entityTitleSingular?ee("SELECTED_ENTITY_COUNT",e,1===e?t.entityTitleSingular:t.entityTitlePlural):s.formatMessage(t.selectionStatusMessageKey,e)},_deletedRowsHidden:function(){},_deletedCount:function(){return 0},_hasControlBreaks:function(){return!1},_hasNestedControlBreaks:function(){return!1},_controlBreakSelector:function(){return null},_itemSelector:function(){return null},_elementsFromRecordIds:function(){return[]},_renderFillerRecord:function(){},_controlBreakData:function(){return{}},_renderBreak:function(e,t,i){e.markup("<h3>").content(i.label).markup("</h3>")},_renderEndBreak:function(){},_renderRecord:function(){},_removeRecord:function(){},_insertRecord:function(){return l()},_afterInsert:function(){},_identityChanged:function(){},_replaceRecord:function(){},_updateRecordField:function(){},_removeFocus:function(){},_updateRecordState:function(){}}),l.apex.tableModelViewBase.clearColumnItemCache=function(e){if(e)for(const[t,i]of Q.entries())i.element$.parent()[0]===e&&Q.delete(t);else Q.clear()}}(apex.util,apex.model,apex.debug,apex.lang,apex.item,apex.jQuery);
!function(e,t,i,o,s,l){"use strict";const n="is-selected",r=":visible",a="data-id",c="data-group-id",h="data-rownum",d="class",u="aria-disabled",p="disabled",m=Object.entries,g=e.applyTemplate,f=e=>parseInt(e,10);function _(t,i){return"."+function(t,i){const o=i.cssClassPrefix||"a-GV";return e.escapeHTMLAttr(o+"-"+t)}(t,i)}const S="a-TMV",T=S+"--variableHeight",C="a-TMV-w-scroll",I="."+C,A="a-TMV-hdr",$="."+A,E="is-disabled",R="."+E,P="selectionChange",{NAV_NONE:L}=apex.widget.ListViewSelection.NAV_MODES,k=l.ui.keyCode,w=/^\s*<\w+[^>]*>/;function O(e){e.APEX$ROW_STATE_CLASSES=e.APEX$AGG=e.APEX$AGG_TOTAL=e.APEX$ROW_URL=e.APEX$ROW_ID=e.APEX$ROW_INDEX=e.APEX$VALIDATION_MESSAGE=e.APEX$GROUP_ID=null}l.widget("apex.tableModelView",l.apex.tableModelViewBase,{widgetEventPrefix:"tableModelView",options:{headerTemplate:"",beforeTemplate:"<ul>",bodyTemplate:"",recordTemplate:"",controlBreakTemplate:"",controlBreakBeforeTemplate:"",controlBreakAfterTemplate:"",aggregateTemplate:"",afterTemplate:"</ul>",syncHeaderHScroll:!1,collectionClasses:null,iconClassColumn:null,imageURLColumn:null,imageAttributes:null,labelColumn:null,linkTarget:!1,linkTargetColumn:null,linkAttributes:null,useIconList:!1,iconListOptions:{},itemNavigationMode:L,selectionFollowsFocus:!0,multiple:!1,selectAll:!1,selectAllId:null,allowSelectHidden:!1,itemSelector:null,controlBreakSelector:null,accLabelColumn:null,constrainNavigation:!0,allowCopy:!0,clipboardValue:null,selectionStateItem:null,selectionChange:null,currentItemChange:null,pageChange:null},_create:function(){const e=this.options,t=this.element;i.info(`TableModelView '${t[0].id}' created. Model: ${e.modelName}`),t.addClass(S),e.fixedRowHeight||t.addClass(T),this.gotoItemPending=null,e.recordTemplate||e.itemSelector||(e.itemSelector=".a-TMV-item"),this._sel=new apex.widget.ListViewSelection(this.element,{itemNavigationMode:e.itemNavigationMode,selectionFollowsFocus:e.selectionFollowsFocus,multiple:e.multiple,allowSelectAll:e.selectAll,selectAllId:e.selectAllId,allowSelectHidden:e.allowSelectHidden,itemSelector:e.itemSelector,groupSelector:e.controlBreakSelector,constrainNavigation:e.constrainNavigation,selectionStateItem:e.selectionStateItem,persistSelection:e.persistSelection,itemsAreServerRendered:e._isTemplateReport||!1,allowCopy:e.allowCopy,clipboardValue:e.clipboardValue,dataTransferFormats:e.dataTransferFormats},{isValid:()=>this.element.hasClass(S),getContainer:()=>this._getDataContainer(),getModel:()=>this.model,getValuesForItems:e=>this.getRecords(e),renderItem:(e,t,i,o,s)=>{this._renderRecord(e,t,i,o,s)},selectionChanged:e=>{this._trigger(P,e)},currentItemChanged:()=>{this._trigger("currentItemChange")},updateStatus:()=>{this._updateStatus()},getPagination:()=>e.pagination,keyboardIgnoreSelector:()=>".a-GV-footer, .a-TMV-hdr",firstPage:()=>{this.firstPage()},lastPage:()=>{this.lastPage()},waitForPageChange:()=>new Promise((e=>{this.element.one("tablemodelviewpagechange",(()=>{e()}))}))}),e.itemNavigationMode=this._sel.itemNavigationMode,e.persistSelection=this._sel.persistSelection,this._enforceOptionConstraints(),this._super(),this.recordHeight=null,this.recPerRow=null,this._initModel(e.modelName),this._initRecordTemplate(),this._on(this._eventHandlers),this._sel.initialize(),this.refresh(),e.disabled&&this._setOption(p,e.disabled)},_eventHandlers:{keydown:function(e){const t=this.options,i=e.which;if(!e.isDefaultPrevented()&&t.useIconList){let o=this.getIconList().options;if(!o.navigation&&o.noNavKeyContent&&l(e.target).closest(o.noNavKeyContent).length)return;if(i!==k.DOWN&&i!==this.getIconList().forwardKey||!t.pagination.loadMore)(i===k.UP||i===this.getIconList().backwardKey)&&t.pagination.loadMore&&l(e.target).hasClass("js-load")&&(this.getIconList().focus(),e.preventDefault());else{let t=this.element.find(".js-load");if(t[0]){if(t[0].disabled)return;t.trigger("focus"),e.preventDefault()}}t.constrainNavigation&&[k.DOWN,k.UP,k.LEFT,k.RIGHT,k.PAGE_UP,k.PAGE_DOWN].includes(i)&&e.preventDefault()}},resize:function(e){e.target===this.element[0]&&(this.resize(),e.stopPropagation())}},_destroy:function(){const e=this.element;this._tableModelViewDestroy(),e.removeClass(S+" "+E).empty(),this._sel.destroy(),this._sel=null,i.info(`TableModelView '${e[0].id}' destroyed. Model: ${this.options.modelName}`),this.data$=null,this._initModel(null)},_setOption:function(e,t){const o=this.options;if(i.info(`TableModelView '${this.element[0].id}' set option '${e}' to: ${t}`),"iconListOptions"===e)throw new Error(`TableModelView '${e}' cannot be set. Set options directly on the iconList widget`);if("allowCopy"===e)throw new Error(`TableModelView '${e}' cannot be set`);if(["itemNavigationMode","selectionFollowsFocus","multiple","selectAll","selectAllId","allowSelectHidden","itemSelector","controlBreakSelector","constrainNavigation","dataTransferFormats","clipboardValue","persistSelection","selectionStateItem",p].includes(e)){let i=e;"selectAll"===e?i="allowSelectAll":"controlBreakSelector"===e&&(i="groupSelector"),this._sel[i]=t,t=this._sel[i]}if(this._super(e,t),this._enforceOptionConstraints(),e===p){if(this.element.toggleClass(E,t),o.useIconList)return this.getIconList().option(e,t);t&&this.resize()}else"modelName"===e?(this._initModel(t),this.refresh(!1)):"highlights"===e?this._updateHighlights():"hideEmptyFooter"===e?this._updateTotalRecords():"fixedRowHeight"===e?(this.element.toggleClass(T,!t),this.refresh()):["beforeTemplate","recordTemplate","afterTemplate","collectionClasses","iconClassColumn","imageURLColumn","imageAttributes","labelColumn","linkTarget","linkTargetColumn","linkAttributes","bodyTemplate","entityTitleSingular","entityTitlePlural","multiple","itemNavigationMode"].includes(e)?(this.options.labelColumn&&(this.options.recordTemplate=null),this._initRecordTemplate(),this.refresh()):["footer","useIconList","pagination","rowsPerPage"].includes(e)&&this.refresh()},_enforceOptionConstraints:function(){const e=this.options;e.useIconList&&this._sel.supportsNavigation()&&(i.warn("Forced itemNavigationMode to none when useIconList is true"),e.itemNavigationMode=L,this._sel.itemNavigationMode=L),this._sel.supportsNavigation()&&!e.itemSelector&&(i.warn("Forced itemNavigationMode to none because itemSelector not defined"),e.itemNavigationMode=L,this._sel.itemNavigationMode=L),!this._sel.supportsSelection()&&e.persistSelection&&(i.warn("Forced persistSelection to false when itemNavigationMode is not selection"),e.persistSelection=!1,this._sel.persistSelection=!1),e.controlBreakBeforeTemplate&&e.controlBreakAfterTemplate&&e.controlBreakTemplate&&(i.warn("Forced controlBreakTemplate to empty string in favor of before and after control break templates"),e.controlBreakTemplate=""),e.useIconList&&(e.controlBreakBeforeTemplate||e.controlBreakAfterTemplate||e.controlBreakTemplate||e.aggregateTemplate)&&(i.warn("Control break and aggregate templates cannot be used when useIconList is true"),e.aggregateTemplate=e.controlBreakTemplate=e.controlBreakBeforeTemplate=e.controlBreakAfterTemplate=""),!(e.controlBreakBeforeTemplate||e.controlBreakAfterTemplate||e.controlBreakTemplate)||e.itemSelector&&e.controlBreakSelector||(i.warn("Control break requires itemSelector and controlBreakSelector"),e.controlBreakTemplate=e.controlBreakBeforeTemplate=e.controlBreakAfterTemplate="")},refresh:function(e){const t=this.options,i=this,o=this.element;let s=!1;if(!0!==e&&(s=this._paginationHasFocus()),void 0===e&&(e=l(document.activeElement).closest(o).length>0),!this._refreshCheckIfVisible())return;if(this._checkDelayRefresh(e))return;let n=this.modelChanged;this.modelChanged=!1,this._sel.saveState(),!t.hasSize&&this.data$&&o.css("min-height",o.height()+"px"),t._isTemplateReport?this._refreshPagination(o):this._refreshPagination(o.find(I)),this._initView(),this._updateStatus(),this.resize(),this._addPageOfRecords((function(){i.noData&&t.bodyTemplate&&i._initView(!0),s&&(i._restorePaginationFocus(s),e=!1),t.hasSize||o.css("min-height",""),i._sel.restoreState(n),i._updateHeaderFooter(o.find($)),e&&i.focus()}))},resize:function(){const e=this.element,t=this.options,i=e.height(),o=e.children().first(),s=e.find(I);let l,n;null!==e[0].offsetParent&&(o.length&&!this.pendingRefresh?(l=e.width(),t._isTemplateReport||s.width(l),this.recordHeight=null,this.recPerRow=null,t.hasSize&&(n=i-this._footerHeight(),o.height(n),s.height(n-(e.find($).height()||0))),this.data$&&(t.useIconList&&this.data$.iconList("resize"),this._initPageSize(),this._updateHeaderFooter(e.find($)))):this.renderInProgress||this.refresh())},focus:function(){const e=this.getIconList();e?e.focus():this._sel.focus()},getCurrentItem:function(){return this._sel.getCurrentItem()},setCurrentItem:function(e,t){this._sel.setCurrentItem(e,t)},getCurrentItemValue:function(){let e=this.getCurrentItem();if(e?.is(this.options.controlBreakSelector))return e.attr(c);if(e){let t=this.getRecords(e)[0];return this.model.getRecordId(t)}return null},setCurrentItemValue:function(t,i){const o=this._getDataContainer();let s=o.find(`[${a}="${e.escapeCSS(t)}"]`);!s[0]&&this._hasControlBreaks()&&(s=o.find(`[${c}="${e.escapeCSS(t)}"]`)),this.setCurrentItem(s,i)},gotoItem:function(t){const o=this.options;let s,l,n,r,c=!1,h=this.element.find(`[${a}="${e.escapeCSS(t)}"]`);if(this.gotoItemPending=null,this.data$){if(!h.length){if(s=this.model.getRecord(t),!s)return void i.warn("Warning record not found "+t);l=this.model.indexOf(s),this.gotoItemPending=t,o.pagination.scroll?(n=this.scrollParent$,r=Math.floor(l*this.avgRowHeight),n.scrollTop(r)):(this.pageOffset=Math.floor(l/this.pageSize)*this.pageSize,c=!0)}c&&this.refresh(!1),this.gotoItemPending||this.setSelection(h,!0)}},getSelection:function(){const e=this.options,t=this.getIconList();return e.useIconList?t?t.getSelection():l():this._sel.getSelection()},setSelection:function(e,t,i){const o=this.getIconList();o?o.setSelection(e,t,i):this._sel.setSelection(e,t,i)},selectAll:function(e,t){this.options.useIconList||this._sel.selectAll(e,t)},getRecords:function(e){let t=this.model,i=[];return e.each((function(){let e,o=l(this).attr(a);o&&(e=t.getRecord(o),e&&i.push(e))})),i},getSelectedRecords:function(){if(this.data$){if(this.options.useIconList)return this.getRecords(this.getSelection());if(this._sel.supportsSelection())return this._sel.getSelectedValues()}return null},getSelectedValues:function(){const e=this.getSelectedRecords();return e?e.map((e=>this.model.getRecordId(e))):null},setSelectedRecords:function(e,t,i){const o=this.options,s=this.data$;if(!s||this.renderInProgress)return-1;if(o.useIconList){let n=[],r=0,c=e.length,h=new Set;!o.multiple&&c>1&&(c=1);for(let t=0;t<c;t++)h.add(this.model.getRecordId(e[t]));return s.children().each((function(){let e=l(this).attr(a);h.has(e)&&(h.delete(e),n.push(this),r+=1)})),this.setSelection(l(n),t,i),r}return this._sel.setSelectedValues(e,t,i)},setSelectedValues:function(e,t,i){let o=[];return e.forEach((e=>{const t=this.model.getRecord(e);t&&o.push(t)})),this.setSelectedRecords(o,t,i)},getIconList:function(){return this.options.useIconList&&this.data$?this.data$.data("apex-iconList"):null},_initRecordTemplate:function(){const e=this.options;if(!e.recordTemplate){let t,i,o;if(e.collectionClasses||(e.collectionClasses="a-TMV-defaultIconView"),!e.labelColumn)throw new Error("Option recordTemplate or labelColumn is required");e.beforeTemplate="<ul>",e.afterTemplate="</ul>",t=`<li ${a}='&APEX$ROW_ID.' ${h}='&APEX$ROW_INDEX.' class='a-TMV-item &APEX$ROW_STATE_CLASSES.'>`,e.linkTarget||e.linkTargetColumn?(o=e.linkTargetColumn?e.linkTargetColumn:"APEX$ROW_URL",t+=`<a href='&${o}.' class='a-IconList-content' ${e.linkAttributes?e.linkAttributes:""}>`,i="</a>"):(t+="<span class='a-IconList-content'>",i="</span>"),this._sel.supportsSelection()&&(t+="<div class='a-IconList-selection'>#APEX$SELECTOR#</span>"),(e.iconClassColumn||e.imageURLColumn)&&(t+="<span class='a-IconList-icon'>",e.iconClassColumn?t+=`<span class='&${e.iconClassColumn}.'></span>`:t+=`<img src='&${e.imageURLColumn}.' ${e.imageAttributes?e.imageAttributes:""}/>`,t+="</span>"),t+=`<span class='a-IconList-label'>&${e.labelColumn}.</span>${i}</li>`,e.recordTemplate=t}let t=this.atOptions;t.model=this.model,t.record=null,O(t.extraSubstitutions),w.exec(g(e.recordTemplate,t))||e._isTemplateReport||(g(e.beforeTemplate,t).toLowerCase().match(/<ul|<ol/)?e.recordTemplate=`<li>${e.recordTemplate}</li>`:e.recordTemplate=`<div>${e.recordTemplate}</div>`)},_initView:function(t=!1){const i=this,o=this.element,s=this.options,n="scroll.tmvss",r=this._getDataRenderContext(),a=this.atOptions,c=a.extraSubstitutions;let h,u,p,f=0,S=0,T=null;function E(){f!==S&&(u[0].scrollLeft=f=S,p[0].scrollLeft=f,h.css("left",f)),T=null}a.model=this.model,a.record=null,O(c),s._isTemplateReport||r.markup("<div").attr(d,"a-TMV-body").markup(">"),s.bodyTemplate||this._renderAltDataMessages(r);let R=[];for(const[e,t]of m(this.model.getOption("fields"))){let i=l.extend({fieldName:e},t);R.push(i)}R.sort(((e,t)=>e.seq-t.seq)),c.APEX$COLUMNS=R,s.headerTemplate&&(a.placeholders.APEX$HAS_SELECTOR=this._sel.supportsSelection()?"Y":"N",a.placeholders.APEX$HAS_SELECT_ALL=this._sel.supportsSelection()&&s.multiple&&s.selectAll?"Y":"N",a.placeholders.APEX$SELECTOR="",r.markup(`<div class='${A}'>${g(s.headerTemplate,a)}</div>`)),s.firstDisplayedRow>0&&(this.pageOffset=s.firstDisplayedRow,delete s.firstDisplayedRow,this.pageOffset>0&&s.lazyLoading&&(this.model._data.length=1)),s._isTemplateReport||r.markup("<div").attr(d,C).markup(" tabindex='-1'>");let L="\x3c!--$row$--\x3e";switch(s.bodyTemplate?(a.placeholders.APEX$HAS_MESSAGE=t?"T":"",a.placeholders.APEX$MESSAGE=s.noDataMessage,a.placeholders.APEX$MESSAGE_ICON=s.noDataIcon,a.placeholders.APEX$COMPONENT_CSS_CLASSES=s.componentCssClasses||"",a.placeholders.APEX$ROWS=L,r.markup(g(s.bodyTemplate,a))):(a.placeholders.APEX$HAS_SELECTOR=this._sel.supportsSelection()?"Y":"N",a.placeholders.APEX$SELECTOR="",r.markup(g(s.beforeTemplate,a)).markup(L).markup(g(s.afterTemplate,a)),this._renderLoadMore(r)),s._isTemplateReport||r.markup("</div></div>"),t||(this.footer$&&this.footer$.prop("outerHTML")?r.markup(this.footer$.prop("outerHTML")):this._renderFooter(r)),o.html(r.toString()),this.data$=this._findRowsPlaceholderParent(),this.data$[0]?.nodeName){case"UL":case"OL":this.recordElement="li";break;case"TBODY":case"THEAD":case"TABLE":this.recordElement="tr";break;default:this.recordElement="div"}this.data$.addClass(s.collectionClasses||""),s.headerTemplate&&this._sel.selectAllId&&o.find("#"+this._sel.selectAllId)[0]&&(this._sel.selectAllId=this._sel.selectAllId),this._sel.contentChanged(),this.selectorPlaceholder=this._sel.supportsSelection()?this._sel.getPreferredSelectorControl():"",s.useIconList&&(this.data$.iconList(s.iconListOptions),this.data$.on("iconlistselectionchange",(function(e){i._updateStatus(),i._trigger(P,e)}))),p=s._isTemplateReport?o:o.find(I),u=o.find($),this._initPagination(u,p),s.headerTemplate&&s.syncHeaderHScroll&&(h=this.data$.find(_("loadMoreButton",s)),p.on(n,(function(){S=this.scrollLeft,T||(T=e.invokeAfterPaint(E))})),u.on(n,(function(){S=this.scrollLeft,T||(T=e.invokeAfterPaint(E))})))},_initRecordMetrics:function(){const e=this.options,t=this.atOptions,i=this._hasNestedControlBreaks();let o,s,n=0;if(O(this.atOptions.extraSubstitutions),t.record=null,this.recPerRow=1,o=i?this.data$.find(e.controlBreakSelector+" "+e.itemSelector):this.data$.children(),o=o.filter(r).first(),t.placeholders.APEX$SELECTOR=this._sel.getPreferredSelectorControl(),!o.length){let n="";i&&(t.placeholders.APEX$GROUP_IDENTIFICATION='data-group-id="0" data-rownum="0"',n+=g(e.controlBreakBeforeTemplate,t));for(let i=0;i<20;i++)t.placeholders.APEX$ROW_IDENTIFICATION=`data-id="${i}" data-rownum="${i}"`,n+=g(e.recordTemplate,t);i&&(n+=g(e.controlBreakAfterTemplate,t)),s=l(n),this.data$.append(s),o=i?this.data$.find(e.controlBreakSelector+" "+e.itemSelector):this.data$.children(),o=o.filter(r).first(),e.useIconList&&this.getIconList().refresh()}if(e.useIconList)this.recPerRow=this.getIconList().getColumns();else{let e=o,t=e.length>0?Math.trunc(e.offset().top):0,i=t,s=0;for(;i===t&&e[0];)s+=1,e=e.next(),e[0]&&(i=Math.trunc(e.offset().top));this.recPerRow=s,n=i-t}this.recPerRow<1&&(this.recPerRow=1),0===n&&(n=o.outerHeight(!0),"grid"===this.data$.css("display")&&(n+=f(this.data$.css("grid-row-gap")))),this.recordHeight=n||43,s&&s.remove()},_getHeaderHeight:function(){return this.element.find($).outerHeight()},_getFixedRecordHeight:function(){return this.recordHeight||this._initRecordMetrics(),this.recordHeight},_getRecordsPerRow:function(){return this.recPerRow||this._initRecordMetrics(),this.recPerRow},_getDataContainer:function(){return this.data$},_checkSelectionChange:function(e){this.options.useIconList||this._sel.checkSelectionChange(e)},_selectedCount:function(){return this.options.useIconList?this.getIconList().getSelection().length:this._sel.supportsSelection()?this._sel.getSelectedCount():0},_deletedRowsHidden:function(){},_hasControlBreaks:function(){const e=this.options;return this.model.hasControlBreaks()&&Boolean(e.controlBreakTemplate||e.controlBreakAfterTemplate&&e.controlBreakBeforeTemplate)},_hasNestedControlBreaks:function(){const e=this.options;return this.model.hasControlBreaks()&&Boolean(e.controlBreakAfterTemplate&&e.controlBreakBeforeTemplate)},_controlBreakSelector:function(){return this.options.controlBreakSelector},_itemSelector:function(){return this.options.itemSelector},_elementsFromRecordIds:function(t){let i=[];for(let o=0;o<t.length;o++){let s=this.data$[0].querySelector(`[${a}="${e.escapeCSS(t[o])}"]`);s&&i.push(l(s))}return i},_renderFillerRecord:function(e,t){e.markup(`<${this.recordElement} aria-hidden="true" class="${t}"></${this.recordElement}>`)},_insertFiller:function(e,t){let i=l(e.toString());return t?t.before(i):(this.controlBreakGroupContainer$||this.data$).html(i),this._sel.contentChanged(),i},_insertData:function(e,t,i){const o=this.options;let s=l(e.toString());if(t?t[i](s):(this.controlBreakGroupContainer$||this.data$).append(s),s.find(R).add(s.filter(R)).attr(u,"true"),this._sel.contentChanged(s),o.useIconList){let e=this.element.find(I),t=e.scrollTop();this.getIconList().refresh(),e.scrollTop(t)}this.atOptions.clearItemCache=!0,this.gotoItemPending&&setTimeout((()=>{this.gotoItem(this.gotoItemPending)}),0)},_controlBreakData:function(e){return{record:e}},_renderBreak:function(t,i,o,s){const l=this.options;let n,r=this.atOptions,a=r.extraSubstitutions,c=l.controlBreakBeforeTemplate&&l.controlBreakAfterTemplate?l.controlBreakBeforeTemplate:l.controlBreakTemplate;O(a),r.model=this.model,r.record=o.record,a.APEX$GROUP_ID=this.model.getControlBreakId(o.record),a.APEX$ROW_INDEX=null!=s?""+(s+1):"",delete r.placeholders.APEX$ROW_IDENTIFICATION,r.placeholders.APEX$GROUP_IDENTIFICATION=`data-group-id="${e.escapeHTMLAttr(a.APEX$GROUP_ID)}" data-rownum="${a.APEX$ROW_INDEX}"`,delete r.placeholders.APEX$SELECTOR,n=g(c,r),l.highlighter&&(n=l.highlighter(l.highlighterContext,n)),t.markup(n),this.atOptions.clearItemCache=!1},_renderEndBreak:function(e,t){const i=this.options;let o,s=this.atOptions,l=s.extraSubstitutions,n=i.controlBreakBeforeTemplate&&i.controlBreakAfterTemplate?i.controlBreakAfterTemplate:null;n&&(O(l),s.model=this.model,s.record=t.record,delete s.placeholders.APEX$ROW_IDENTIFICATION,delete s.placeholders.APEX$GROUP_IDENTIFICATION,delete s.placeholders.APEX$SELECTOR,o=g(n,s),e.markup(o))},_renderRecord:function(t,i,s,l,r){const a=this.options,c=this.atOptions,h=c.extraSubstitutions;let d,u,p=a.recordTemplate,m="",f="";if(O(h),r.agg){if(!a.aggregateTemplate)return;p=a.aggregateTemplate,h.APEX$AGG=r.agg,h.APEX$AGG_TOTAL=r.grandTotal?"Y":"",h.APEX$ROW_STATE_CLASSES="is-aggregate"}else r.url&&(h.APEX$ROW_URL=r.url),r.hidden&&(f+=" u-hidden"),this.model.isDisabled(i,r)&&(f+=" "+E),r.sel&&(f+=" "+n),r.deleted?f+=" is-deleted":(r.inserted?f+=" is-inserted":r.updated&&(f+=" is-updated"),r.error?f+=" is-error":r.warning&&(f+=" is-warning"),r.highlight&&(d=a.highlights[r.highlight],d&&d.cssClass?f+=" "+d.cssClass:f+=" "+r.highlight),r.message&&(h.APEX$VALIDATION_MESSAGE=r.message)),f&&(h.APEX$ROW_STATE_CLASSES=f);h.APEX$ROW_ID=""+l,h.APEX$ROW_INDEX=""+(s+1),delete c.placeholders.APEX$GROUP_IDENTIFICATION,c.placeholders.APEX$ROW_IDENTIFICATION=`data-id='${e.escapeHTMLAttr(h.APEX$ROW_ID)}' data-rownum="${h.APEX$ROW_INDEX}"`,m=a.accLabelColumn?o.formatMessage("APEX.TMV.SELECTOR_LABEL_1",this.model.getValue(i,a.accLabelColumn)):o.getMessage("APEX.TMV.SELECTOR_LABEL"),c.placeholders.APEX$SELECTOR=this.selectorPlaceholder.replaceAll("%0",m),c.model=this.model,c.record=i,u=g(p,c),a.highlighter&&!r.agg&&(u=a.highlighter(a.highlighterContext,u)),t.markup(u),this.atOptions.clearItemCache=!1},_removeRecord:function(e){e.remove(),this._sel.contentChanged()},_insertRecord:function(t,i,o,s,n){const r=e.htmlBuilder();this._renderRecord(r,i,null,o,s),this.atOptions.clearItemCache=!0;let a=l(r.toString());return"after"===n&&t?t.after(a):this.data$.prepend(a),a.find(R).add(a.filter(R)).attr(u,"true"),this.options.useIconList?this.getIconList().refresh():this._sel.contentChanged(a),a},_afterInsert:function(){},_identityChanged:function(e,t){const i=this._elementsFromRecordIds([e])[0];if(i){let o=this.model.getRecord(t),s=this.model.getRecordMetadata(t);this._replaceRecord(i,o,e,t,s)}},_replaceRecord:function(t,i,o,s,r){const c=this.options,d=e.htmlBuilder();let u,p=t.hasClass(n),m=t.attr(h)||null;null!==m&&(m=f(m)-1),p&&!c.persistSelection&&((r=l.extend({},r)).sel=!0),this._renderRecord(d,i,m,s,r),this.atOptions.clearItemCache=!0,u=l(d.toString()),c.itemSelector&&!u.is(c.itemSelector)&&(t=t.parent()),t.replaceWith(u),c.useIconList?(this.getIconList().refresh(),this.getIconList().setSelection(l(`[${a}="${e.escapeCSS(s)}"]`)),this.focus()):this._sel.contentChanged(u)},_removeFocus:function(){},_checkAllHidden:e.debounce((function(){const e=this.options.pagination;let t;this._hasNestedControlBreaks()?t=this.data$.find(this._controlBreakSelector()+" "+this._itemSelector()):(t=this.data$.children(),this._controlBreakSelector()&&(t=t.not(this._controlBreakSelector()))),t.is(":visible")?!e.scroll||e.loadMore||e.virtual||this.data$.height()<this.scrollParent$.height()&&this._addNextPage():(this.noData$.show(),this.data$.hide(),this.noData=!0)}),10),_updateRecordState:function(e,t,i,o,s){if("hidden"===s)return this.noData&&!o.hidden&&(this.noData$.hide(),this.data$.show(),this.noData=!1),e.toggleClass("u-hidden",o.hidden),void(this.noData||this._checkAllHidden());this._replaceRecord(e,i,t,t,o)}})}(apex.util,apex.model,apex.debug,apex.lang,apex.item,apex.jQuery);