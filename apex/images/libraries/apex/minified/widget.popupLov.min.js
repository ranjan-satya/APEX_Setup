/*!
 Copyright (c) 2012, 2024, Oracle and/or its affiliates. All rights reserved.
*/
!function(e,t,a,l){"use strict";const i="disabled",n="is-active",r="."+n,s="apex-item-multi-remove",u="."+s,o="apex-item-multi-item",p="."+o,c="data-value",d="aria-expanded",f="apexPopupLovInputTrap",h=l.ui.keyCode,g=a.hasOwnProperty;e.popupLov=function(m){var v,y,b,V,x,S,C,E,O,T,D,I=h.RIGHT,w=h.LEFT,P=!1,j=!1,A=!1,L="",M=m.itemId,_=l("#"+a.escapeCSS(M)+"_lov_btn",apex.gPageContext$),N=_.parent(),R=l("#"+a.escapeCSS(M),apex.gPageContext$),F=l("#"+a.escapeCSS(M)+"_HIDDENVALUE",apex.gPageContext$),U=l().add(_).add(R).add(F),k=l().add(_).add(R);function H(t){var a,l=!1,i=R.val();m.enterable&&i!==L?a=i:t?(a=t,l=!0):a=null,L=i,R.attr(d,"true"),j=!0,R.focus(),e.util.openPopupLov(P,a,l,m,(function(e){e&&(L=e.d||e.v||e,m.multiple&&R.val("")),R.attr(d,"false"),j=!1})),P=!1}function K(e,t){var l=t||e;return"<li class='"+o+"' data-value='"+a.escapeHTMLAttr(e)+"'><span>"+a.escapeHTML(l)+"<button class='"+s+"' type='button' tabindex='-1' aria-label='"+apex.lang.formatMessage("APEX.POPUP_LOV.REMOVE_VALUE",l)+"'><span class='a-Icon icon-multi-remove'></span></button></span></li>"}function $(e,t){"separated"===t?F.val(e.join(m.separator)):F.val(JSON.stringify(e))}function W(){var e,t;(e=R.data("popupLovModelName"))&&(t=apex.model.get(e))&&(t.setData([]),apex.model.release(e)),P=!0}if((m=l.extend({dependingOnSelector:null,pageItemsToSubmit:null,height:m.isPopup?280:380,width:null,isPopup:!1,display:"list",nullValue:"",dynamicDefault:!1,initialFetch:"empty",multiple:!1,separator:":",enterable:!1,incrementalSearch:!1,minSearchChars:0,displayColumn:null,iconColumn:null,extraOut:{},persistState:!0},m)).width||m.isPopup||(m.width="grid"===m.display?500:300),void 0===m.nullDisplayValue&&(m.nullDisplayValue=m.nullValue),m.hasDisplayValue=!m.enterable&&m.displayColumn,R.attr("role","combobox").attr("aria-autocomplete","list").attr(d,"false").attr("aria-haspopup","dialog"),m.multiple&&(E=R.attr("placeholder"),"rtl"===(b=R.parent().parent()).css("direction")&&(I=h.LEFT,w=h.RIGHT),(x=b.parent()).css("position","relative"),R.css("flex-grow",0),S=function(){var e=x.width()-_.outerWidth(!0);b.css("max-width",e),V=e-parseInt(b.css("border-left-width"),10)-parseInt(b.css("border-right-width"),10)-parseInt(b.css("padding-left"),10)-parseInt(b.css("padding-right"),10)},e.util.onElementResize(x[0],(function(){S(),v.afterModify()})),e.util.onVisibilityChange(x[0],(function(t){t&&e.util.updateResizeSensors(x[0])})),S(),T=[],D=[],b.children().not(":last").each((function(){var e=l(this);T.push(e.attr(c)),D.push(e.text())})).remove(),b.on("click",(function(e){var t=!1,a=l(e.target),i=a.closest(u),s=a.closest(p);v.isDisabled()||(i[0]?(v.removeValue(s.attr(c)),t=!0):s.find("input")[0]||(b.children(r).removeClass(n),s.addClass(n),t=!0),t&&setTimeout((function(){R.trigger("focus")}),1))})).keydown((function(e){var t=e.which,a=b.children(r);v.isDisabled()||(""===R.val()?t===h.DELETE||t===h.BACKSPACE?(e.target!==R[0]||t!==h.BACKSPACE||a[0]||(a=R.parent().prev()),a[0]&&v.removeValue(a.attr(c))):t===w?a[0]?a.prev()[0]&&(a.removeClass(n),a.prev().addClass(n)):R.parent().prev().addClass(n):t===I&&a[0]&&a.next()[0]&&(a.removeClass(n),(a=a.next()).find("input")[0]||a.addClass(n)):m.enterable&&t===h.ENTER&&R.val()&&(v.addValue(R.val()),R.val(""),e.stopPropagation()),t===h.ENTER&&e.preventDefault())})).focusin((function(e){b.addClass("is-focused"),"INPUT"!==e.target.nodeName.toUpperCase()&&R.trigger("focus")})).focusout((function(){b.removeClass("is-focused").children(r).removeClass(n),m.enterable&&R.val()&&!j&&(v.addValue(R.val()),R.val(""))}))),m.initialSearch="",P=!0,"value"!==m.initialFetch||m.multiple||(m.initialSearch=R.val()),(m.pageItemsToSubmit||m.dependingOnSelector)&&(y=m.pageItemsToSubmit||"",m.dependingOnSelector&&(y.length>0&&(y+=","),y+=m.dependingOnSelector),m.itemsToSubmit=y.replace(/#/g,"").split(/\s*,\s*/)),m.itemsToSubmit&&(m.pluginTarget=R[0]),m.isPopup&&!m.enterable?N.mousedown((function(e){const t=l(e.target).parent().hasClass(s);0!==e.button||v.isDisabled()||t||(H(),e.preventDefault())})):_.on("click",(function(){A||H(),A=!1})).mousedown((function(){j&&(A=!0)})),m.enterable&&!m.multiple&&!l.isEmptyObject(m.extraOut)){let e;R.on("focus",(t=>{e=t.target.value})).blur((t=>{let a=t.target.value;e!==a&&v.setValue(a,null,!0)}))}function z(){v.refresh()}R.keydown((function(e){var t,a=e.which,i=!1;a===h.DOWN||a===h.UP?H():a===h.ENTER?e.preventDefault():m.enterable||((i=!(a>=112&&a<=123||a>=33&&a<=46||a<32))&&(e.ctrlKey||e.metaKey)&&{65:1,67:1,86:1,88:1,89:1,90:1}[a]&&(i=!1),i&&((t=l("#"+f))[0]||(t=l("<input id='"+f+"' type='text' class='u-vh' aria-hidden='true' tabindex='-1'>")),t.insertAfter(R).trigger("focus"),setTimeout((function(){var e=t.val();t.val(""),e.length>0?H(e):document.activeElement===t[0]&&R.trigger("focus")}),10)))})),_.on("focus",(function(){R.trigger("focus")})),O={enable:function(){U.prop(i,!1),R.removeClass("apex_disabled"),m.multiple&&b.find(u).prop(i,!1)},disable:function(){U.prop(i,!0),R.addClass("apex_disabled"),m.multiple&&b.find(u).prop(i,!0)},isDisabled:function(){return R.prop(i)},show:function(){k.show()},hide:function(){k.hide()},refresh:function(){R.trigger("apexbeforerefresh"),m.dynamicDefault?apex.server.plugin(m.ajaxIdentifier,{p_widget_action:"get-default-values",pageItems:l(m.pageItemsToSubmit).add(m.dependingOnSelector)},{loadingIndicator:"#"+a.escapeCSS(v.id),success:function(e){let t=[],a=[];for(const l in e)g(e,l)&&(t.push(l),a.push(e[l].display));t.length>0?v.setValue(t,a):v.setValue(m.nullValue,m.nullDisplayValue)}}):v.setValue(m.nullValue,m.nullDisplayValue),function(e){let t=m.extraOut;for(const[,a]of Object.entries(t)){let t,l;e?(t="",l=null):(t=a.initialValue,l=null,null!==t&&"object"==typeof t&&g(t,"d")&&(t=t.v,l=t.d)),$s(a.item,t,l)}}(!0),W(),R.trigger("apexafterrefresh")},setValue:function(e,i,n){function r(e,t){j||apex.server.plugin(m.ajaxIdentifier,{p_widget_action:"get-row-values",f01:e,pageItems:m.pageItemsToSubmit},{loadingIndicator:"#"+a.escapeCSS(v.id),success:function(e){t(e)}})}function s(e,t){let a,i="";for(a=0;a<e.length;a++)i+=K(e[a],t?t[a]:null);R.parent().before(l(i))}function u(e){let a,i=m.extraOut;if(!l.isEmptyObject(i))for(const[l,r]of Object.entries(i))a=e?e[l]:"",t(r.item).setValue(a,null,n)}if(e||W(),m.multiple){let t=a.toArray(e,this.getMultiValueStorage());$(t,this.storageType),R.val(""),b.children().not(":last").remove(),""!==e&&(i?s(t,a.toArray(i,", ")):r(t,(e=>{let a=[];if(l.isEmptyObject(e))a.concat(t);else for(let l=0;l<t.length;l++)e[t[l]]?a.push(e[t[l]].display):a.push(t[l]);s(t,a)})))}else m.hasDisplayValue?(F.val(e),i||e!==m.nullValue?i?(R.val(i),l.isEmptyObject(m.extraOut)||r(e,(t=>{l.isEmptyObject(t)?u():u(t[e].columns)}))):e?r(e,(t=>{l.isEmptyObject(t)?(R.val(e),u(e)):(R.val(t[e].display),u(t[e].columns))})):(R.val(""),u()):(R.val(m.nullDisplayValue),u())):(R.val(e),l.isEmptyObject(m.extraOut)||r(e,(t=>{l.isEmptyObject(t)?u():u(t[e].columns)})))},addValue:function(e,t){if(m.multiple){let a,i;if(i=!0,b.children().not(":last").each((function(){if(l(this).attr(c)===e)return i=!1,!1})),i){let i=[];a=l(K(e,t)),R.parent().before(a),b.children().not(":last").each((function(){i.push(l(this).attr(c))})),$(i,this.storageType),R.trigger("change")}}},removeValue:function(e){if(m.multiple){let t=[],a=[];b.children().not(":last").each((function(){l(this).attr(c)===e&&t.push(this)})),l(t).remove(),b.children().not(":last").each((function(){a.push(l(this).attr(c))})),$(a,this.storageType),t.length&&R.trigger("change")}},isChanged:function(){var e=this.getValue();return Array.isArray(e)&&(e=e.join(m.separator)),C!==e},getValue:function(){return m.multiple?a.toArray(F.val(),this.getMultiValueStorage()):m.hasDisplayValue?F.val():R.val()},hasDisplayValue:function(){const e=l(this.node),t=m.multiple?this.getValue():e.val()||this.getValue(),a=e.attr("placeholder");return!!(a&&a.length>0)||(!(!m.multiple||t?.length||!b.children().not(":last").length)||!(!t||!t.length))},afterModify:function(){if(m.multiple){let e,t,a=R.parent(),l=V,i=l;const n=parseInt(a.css("margin-left"),10)+parseInt(a.css("margin-right"),10);if(E&&R.attr("placeholder",this.isEmpty()?E:""),a=a.prev(),!this.isEmpty()&&a.length>0)for(t=a.offset().top;(i-=a.outerWidth(!0),a=a.prev(),a.length)&&(e=a.offset().top,e===t);)t=e;i<60&&(i=l),R.css("max-width",i-n)}},setFocusTo:function(){return R},displayValueFor:function(e){var t,i,n;if(m.hasDisplayValue){if(m.multiple){if(i=a.toArray(e,this.getMultiValueStorage()),(n=this.getValue()).length!==i.length)return e;for(t=0;t<i.length;t++)if(i[t]!==n[t])return e;return l.map(b.children().not(":last"),(function(e){return l(e).text()})).join(", ")}if(e===this.getValue())return l(this.node).val()}return e},getPopupSelector:function(){return".ui-dialog-popuplov"},getValidity:function(){const e=R.prop("required");return void 0!==e&&!1!==e&&this.isEmpty()?{valid:!1,valueMissing:!0}:{valid:!0}},nullValue:m.nullValue,storageType:m.multiple?m.storageType:null,separator:m.multiple?m.separator:null},m.itemsToSubmit&&(O.reinit=function(e,t){return this.setValue(e,t,!0),function(){W()}}),t.create(M,O),v=apex.item(M),m.multiple&&(v.setValue(T,D,!0),v.afterModify()),L=R.val(),C=v.getValue(),Array.isArray(C)&&(C=C.join(m.separator)),m.dependingOnSelector&&l(m.dependingOnSelector).on("change",z),R.on("apexrefresh",z)}}(apex.widget,apex.item,apex.util,apex.jQuery);