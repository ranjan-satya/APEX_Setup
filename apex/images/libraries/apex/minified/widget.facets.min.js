/*!
 Copyright (c) 2019, 2024, Oracle and/or its affiliates.
 */
!function(t,e,a,s,i,n,r,l,o){"use strict";const c="a-FS",h=`${c}--smart`,u=`${c}--facets`,p=`${c}--collapsible`,d=`${c}-currentList`,f=`${c}-currentItem`,m=`${c}-header`,g="."+m,C=`${c}-inputValue`,b="."+C,_=`${c}-apply`,F="a-Chip",v=".a-Chip-text > .a-Chip-value",S=".a-Chip-label,.a-Chip-text",y=`${c}-control`,k=`${c}-control--collapsible`,$=`${c}-addFilter-filterSelection`,x=`.${$} > a-select`,I="js-openFilterDialog",w=`${I}Facet`,A=`${c}-body`,E=`${c}-wrap`,T=`${c}-bodyInner`,O="."+T,L=`${c}-filter`,P=`.${L}`,V=`${c}-facetChart`,B="apex-item-group",D="."+B,M="apex-item-subgroup",N="."+M,R="apex-item-option",j="."+R,H="apex-item-option-badge",U="js-ctrlApply",G="."+H,W=`${c}-totalArea`,z=`${c}-totalCount`,q="is-disabled",J="."+q,X="is-checked",Y="is-collapsed",Q="js-controlRoot",K="."+Q,Z="js-tabbable",tt="js-begin",et=`.${tt}`,at="js-end",st=`.${at}`,it="a-FS-range",nt=`.${it}`,rt="."+Z,lt=":visible",ot=":tabbable",ct=`${c}-addFilter`,ht="icon-bar-chart",ut="icon-pie-chart",pt="u-hidden",dt=`.${pt}`,ft="data-order",mt="data-count",gt="data-value",Ct="data-fc",bt="id",_t="class",Ft="aria-label",vt="aria-labelledby",St="title",yt="tabindex",kt="role",$t="aria-selected",xt="aria-checked",It="min",wt="max",At="disabled",Et=`<ul class="${c}-currentItems"></ul>`,Tt="</div>",Ot="</span>",Lt="change",Pt="focus",Vt="click",Bt="Facets: Unknown dataType: ",Dt="string",Mt="object",Nt="facets",Rt="FILTER_DIALOG",jt=Lt,Ht="filterablefilter",Ut="facetCollapsedState",Gt="openCharts",Wt="chartConfig",zt="filterDialogFacetName",qt="clientSideFiltering",Jt=".facets",Xt=":",Yt="|",Qt="_A-FC",Kt="checkbox",Zt="radio",te="group",ee="list",ae="input",se=ae,ie="rangeList",ne="SHOW_MORE",re="SHOW_LESS",le=1e4,oe="VARCHAR2",ce="NUMBER",he="DATE",ue="TIMESTAMP",pe="TIMESTAMP_TZ",de="TIMESTAMP_LTZ",fe=i.ui.keyCode,me="YYYYMMDDHH24MISS",ge="APEX.FS.INPUT_CURRENT_LABEL",Ce="ACTIONS_MENU_FILTER",be=i.extend,_e=t=>parseInt(t,10),Fe=/^(\d+)(:(.*))?$/;let ve,Se=0,ye=!1;function ke(t){return a.getMessage("APEX.FS."+t)}function $e(t){return typeof t===Dt?t:t.map((t=>null!==t&&typeof t===Mt?t.b+Yt+t.e:t)).join(Xt)}function xe(t){return t.split(Xt).map((t=>{let e=(t+"").split(Yt);return 2===e.length?{b:e[0],e:e[1]}:t}))}function Ie(t){let e=$v(t);return e=e&&""!==e.trim()?e.split("\n"):[],e}function we(e,a,s){let i;const n=(""+e).toLowerCase().indexOf(a.toLowerCase());if(a&&n>-1){const r=n+a.length-1,l=e.slice(0,n),o=e.slice(n,r+1),c=e.slice(r+1);i=`${t.escapeHTML(l)}<span class='${s}'>${t.escapeHTML(o)}</span>${t.escapeHTML(c)}`}return i}function Ae(e,a=!1){const s=i("#"+t.escapeCSS(e.name)).val();return e.type===ae&&e.flexibleOperator&&s&&s.includes(Xt)&&!a?Te(s):s}function Ee(t){return xe(Ae(t,!0))[0]}function Te(t){return t.split(Xt)[1]||""}function Oe(e,a){i("#"+t.escapeCSS(e)).val(a).trigger(Lt,[{internal:!0}])}function Le(t,e){Oe(t.name,e)}function Pe(t,e){return t.findIndex((t=>t.name===e))}function Ve(t,e,a){let s=e,i=ea[t.type];return i.getLabelForValue&&(s=i.getLabelForValue(t,e,a),s||0!==t.values.length||(s=e)),s}function Be(t,e){let a=null,s=t.values,i=t.suggestedValues,n=null;if(s&&s.length>0){if(Array.isArray(i)&&i.length>0){for(let s=0;s<i.length;s++)if(a=t.values.find((t=>t.r===i[s])),a){if(a=a.r,e&&0===e[a]){a=null;continue}break}null!=a||t.type!==ie||t.noManualEntry||(a=i[0])}else if(!0===i)if(e){let t=Object.entries(e).sort(((t,e)=>e[1]-t[1]));t.length>0&&t[0][1]>=0&&(a=t[0][0])}else a=s[0].r}else Array.isArray(i)&&i.length>0&&(a=i[0]);return a&&e&&0===e[a]&&(a=null),a&&(n={r:a,d:Ve(t,xe(a)[0])}),n}function De(t,e,a){e.removeClass(Z).children(S).attr(yt,-1);let s=t.addClass(Z).children(S).attr(yt,0).first();a&&s.trigger(Pt)}function Me(t){let e,a,s;if(t.values&&(t.checkedFirst||t.disabledLast||t.orderByCount))for(a=t.values,e=0;e<a.length;e++)s=a[e],s.order=e+1}function Ne(t,e){let a;if(!t)return t;switch(e.dataType){case oe:case ce:return t;case he:case ue:case pe:case de:try{return a=n.parse(t,me),n.format(a,e.formatMask)}catch(e){return t}default:throw new Error(`${Bt}${e.dataType}`)}}function Re(t,e){let a;if(!t)return t;switch(e.dataType){case oe:case ce:return t;case he:case ue:case pe:case de:try{return a=n.parse(t,e.formatMask),n.format(a,me)}catch(t){return""}default:throw new Error(`${Bt}${e.dataType}`)}}function je(t){return t.length>0?JSON.stringify(t):""}function He(t,e){return!(t.is(lt)||typeof e===Dt&&i(e).is(lt))}function Ue(e,a){let s=a+"_row_count_lbl";return`<div class='${W}' role='region' aria-labelledby='${s}' ><span class='a-FS-totalLabel' id='${s}'>${t.escapeHTML(e)}</span> <span class='${z}'></span></div>`}function Ge(t,e,a,s,i,n,r=!1,l){r&&t.markup("<div class='apex-item-group apex-item-group--search'>"),l&&t.markup('<h3 class="u-vh"').attr(bt,l).attr("aria-roledescription",ke("VISUALLY_HIDDEN_HEADING")).markup(">").content(i).markup("</h3>"),t.markup(`<input class="text_field apex-item-text${s?" apex-item-has-icon":""}" type="search" maxlength=500`).attr(bt,e).optionalAttr("placeholder",a),l?t.attr(vt,l):t.optionalAttr(Ft,i),t.markup(">"),n&&t.markup("<span class='a-FS-search-clear js-clearInput' tabindex='-1'><span class='a-Icon icon-multi-remove' ></span></span>"),s&&Qe(t,"apex-item-icon icon-search"),r&&t.markup("</div>")}function We(e,a,s){const i=ke("ADD_FILTER"),n=a?"a-Button--noLabel ":"",r=s?`${c}-moreFacets ${c}-moreFacets--bottom`:`${c}-searchActions`,l=s?" a-Button--stretch":"";e.markup(`<div class="${r}">`),e.markup(`<button type='button' class="a-Button ${n}a-Button--withIcon${l} ${I}"`).optionalAttr(St,a?i:"").optionalAttr(Ft,a?i:"").markup(">"),Qe(e,"a-Icon icon-add-filter"),a||e.content(t.escapeHTML(i)),e.markup("</button>"),e.markup("</div>")}function ze(t,e){const a=i(e),s=a.hasClass("js-showMore")?ne:re;t._updateDisplayedItems(a,s)}function qe(t,e,a,s,i,n,r){t.markup('<button type="button"').attr(_t,`a-Button ${a}`).optionalAttr(St,s?e:"").optionalAttr(Ft,s?e:"").optionalAttr("tabindex",i||"").optionalAttr("aria-controls",n||""),void 0!==r&&t.attr(Ct,r),t.markup(">").content(s?"":e),s&&Qe(s),t.markup("</button>")}function Je(e){return i("#"+t.escapeCSS(e+Qt))}function Xe(t,e,a,i){let n;return n=!0===e?null!==a&&t>=a?s.formatCompactNumber(t,{maximumFractionDigits:0}):s.formatNumber(t,"FM999G999G999G999G999G999G999G999"):"compact"===e?s.formatCompactNumber(t,i):typeof e===Dt?s.formatNumber(t,e,i):""+t,n}function Ye(t,e,s,i){let n=a.formatMessageNoEscape("APEX.FS.FILTER",s.label),r=e+"_f";t.markup(`<div class='${L}'`).optionalAttr("style",i?"display: none":"").markup(">"),Ge(t,r,n,!0,n,!0,!0),t.markup(Tt)}function Qe(t,e){t.markup("<span aria-hidden='true'").attr(_t,`a-Icon ${e}`).markup(">"+Ot)}function Ke(t,e,a,s,i){t.markup("<button class='a-FS-clear' type='button'").attr(Ft,a).attr(Ct,i),typeof s===Mt?(t.attr("data-begin",s.b),t.attr("data-end",s.e)):t.attr(gt,s),t.markup(">").content(e).markup("<span class='a-Icon icon-multi-remove'></span></button>")}function Ze(t){const e=apex.navigation;t.on("popupopen",(()=>{e.beginFreezeScroll()})).on("popupclose",(()=>{e.endFreezeScroll()}))}function ta(t,e){const a=t.compareDocumentPosition(e),s=Node.DOCUMENT_POSITION_CONTAINED_BY+Node.DOCUMENT_POSITION_FOLLOWING;return a===Node.DOCUMENT_POSITION_FOLLOWING||a===s}i.widget("apex.facets",{widgetEventPrefix:Nt,options:{uiMode:"F",collapsibleSearchBar:null,maxChips:5,moreFiltersChip:!0,initState:null,batch:!0,externalApply:!1,feedback:!0,searchField:!1,searchButton:null,searchItem:null,multipleSearches:!1,searchSuggestions:!1,currentFacets:!0,showTotalCount:!0,showCharts:!1,chartTopNValues:10,defaultChartDialog:{width:620,height:580,appendTo:"form[name='wwv_flow']",resizable:!0,draggable:!0,title:ke("CHART_TITLE"),modal:!1},defaultChartPopup:null,defaultConfigPopup:{title:ke("CONFIG_TITLE"),appendTo:"form[name='wwv_flow']",relativePosition:"below",width:"auto",minHeight:"0",noOverlay:!0,callout:!1},defaultFilterDialogPopup:{appendTo:"form[name='wwv_flow']",relativePosition:"below",width:"300px",minHeight:"0",noOverlay:!0,callout:!0,autoOpen:!1,classes:{"ui-dialog":`${c}-addFilterPopup`},showTitle:!0},numberFormat:!0,numberFormatThreshold:null,numberFormatOptions:null,persistState:!0,clearOnHide:!0,controls:[],text:{},change:null,beforeAddChart:null,afterRemoveChart:null,filteredRegionItemsToSubmit:null},_create:function(){let t,a,s=[],n=this.options,r=this.element;if(e.info(`Facets '${r[0].id}' created. Options: `,n),r.addClass(c),this._super(),n.feedback||(n.showTotalCount=!1),"S"===n.uiMode){r.addClass(h),n.currentFacets=!1,n.searchField=!0,n.multipleSearches=!0,n.maxChips<=0&&(n.moreFiltersChip=!1),n.externalApply=n.batch;const t=()=>{this.isMobile=!1,apex.theme.mq("(min-width: 640px)")||(this.isMobile=!0),this._isSearchBarCollapsible()&&r.addClass(p+" "+Y),this._checkSearchBarCollapse()};i(window).on("apexwindowresized",t),t()}else r.addClass(u);this.lockCount=0,this.totalResourceCount=null,this.facetValueCounts=null,this.hiddenControls=[],this.filterDialogControls=[],this.moreFiltersPopup$=null,this.filterDialogPopup$=null,this.facetUIPopup$=null,this.searchBarCollapseTimer=null,this._on("S"===n.uiMode?this._eventHandlersS:this._eventHandlersF),this.idPrefix=r[0].id,this.idPrefix||(this.idPrefix="afc_"+Se,Se+=1),this.searchId=null,this.searchButtonId=null,this.pendingChange=!1,this.currentValues={},this.facetValuesNeeded=[],this.facetCountsNeeded=[],this.facetCollapsedState={},this.currentCharts=[],this.chartConfig={},this.chartDashboard$=this.chartsPopup$=this.chartWidget=null,this.chartsLoaded=!1,this.clientFilteringConfig={},n.controls.length>0&&(this.itemsContainer$=i("#"+n.controls[0].name).parent(),this.itemsContainer$.on(Lt+Jt,((t,e)=>{let a;e&&e.internal||(a=i(t.target),a.prop(bt)===n.searchItem?"F"===n.uiMode?n.multipleSearches?this._changed():(this._initSearch(),this._doSearch()):(this._setSearchTerms(),this._changed()):this._setFCValue(a))}))),this.currentFacetsArea$=this.currentFacets$=this.totalCount$=null;for(let e=0;e<n.controls.length;e++)t=n.controls[e],t.collapsible&&void 0!==t.initialCollapsed&&(t._origCollapsed=t.initialCollapsed),void 0!==t.initialChart&&(t.initialChart&&s.push(t.name),t._origChart=t.initialChart);if(this.sessionStore=apex.storage.getScopedSessionStorage({prefix:"ORA_WWV_apex.facets",usePageId:!0,regionId:n.regionStaticId}),n.persistState){let r,l,o,c=this.sessionStore;if("reset"!==n.initState)try{this.facetCollapsedState=JSON.parse(c.getItem(Ut)),s=JSON.parse(c.getItem(Gt))||s,this.chartConfig=JSON.parse(c.getItem(Wt)),this.clientFilteringConfig=JSON.parse(c.getItem(qt))}catch(t){e.warn("Failed to restore facets state from session",t),this.facetCollapsedState=this.chartConfig=s=null}else this._clearSessionState();i.isPlainObject(this.facetCollapsedState)||(this.facetCollapsedState={}),Array.isArray(s)||(s=[]),i.isPlainObject(this.chartConfig)||(this.chartConfig={}),i.isPlainObject(this.clientFilteringConfig)||(this.clientFilteringConfig={});for(let e=0;e<n.controls.length;e++)t=n.controls[e],r=t.name,a=this.facetCollapsedState[r],l=ea[t.type],o=this.clientFilteringConfig[t.name],!t.collapsible||1!==a&&0!==a||(t.initialCollapsed=1!==a),typeof n.showCharts===Dt&&(t.initialChart=s.includes(r)),l.hasFilter(t)&&void 0!==o&&Ra(t)&&(t.filterValues=o)}o.util.onVisibilityChange(r[0],(t=>{t&&(this.pendingRefresh?(this.refreshView(),this.fetchCounts()):this.pendingFetch&&this.fetchCounts())})),apex.region.create(n.regionStaticId,(function(t){t.type="Facets",t.widgetName=Nt,t.widget=function(){return r},o.util.makeInterfaceFromWidget(t,r,"facets",["openConfig"],["initState","ajaxIdentifier","regionStaticId"])}));let d={};ve=`${n.regionStaticId}_ET`,d[ve]="#ERROR_MESSAGE#",l.registerTemplates(d),this.refreshView(),n.disabled&&this._setOption(At,n.disabled),this.fetchCounts(),n.showCharts&&this._loadCharts()},_eventHandlersS:{"click .js-expandSearchBar":function(t){this.element.removeClass(Y);let e=this.element.find(".a-FS-searchBar input");t=t.originalEvent||t,e.trigger(Pt),t.detail>0&&e.mousedown()},focusin:function(){this.searchBarCollapseTimer&&(clearTimeout(this.searchBarCollapseTimer),this.searchBarCollapseTimer=null)},focusout:function(){this._isSearchBarCollapsible()&&!this.searchBarCollapseTimer&&(this.searchBarCollapseTimer=setTimeout((()=>{this._checkSearchBarCollapse()}),10))}},_eventHandlersF:{"click .js-toggleOverflow":function(t){ze(this,t.target)},filterablefilter:function(t){let e=i(t.target).closest(".a-FS-control"),a=e.find(".js-toggleOverflow"),s=this._getControl(a);a.length&&(this._updateDisplayedItems(a),oa(e,s))},"click .js-clear":function(t){this._clear(this._getControl(i(t.target))),this._changed()},"click .js-apply":function(){this.apply()},"click .js-openConfig":function(){this.openConfig()},"click .js-openFilterDialog":function(t){this.filterDialogPopup$.find(x).parent().show(),this._renderFilterDialogFacetSelectOptions(),i(t.currentTarget).prop(At,!0),this.filterDialogPopup$.popup("option","parentElement",t.currentTarget).popup("option",St,ke(Ce)).popup("option","relativePosition",i(t.currentTarget).hasClass("a-Button--stretch")?"after":"below").popup("open")},"click .js-addChart":function(t){let e,a=i(t.target),s=this._getControl(a);s&&this.chartsLoaded&&(e=s.name,this.currentCharts.includes(e)?Je(e).trigger(Pt):(this._addChart(s,a.parent()),this._updateCharts()))},"click .a-FS-search .js-clearInput":function(){let e=i(this.searchId),a="#"+t.escapeCSS(this.options.searchItem);e.val(""),i(a).val()&&this._doSearch(),e.trigger(Pt)},keydown:function(t){let e,a,s,n=this.options,r=t.which;n.batch&&!n.externalApply&&r===fe.ENTER?(e=t.target.type,"radio"!==e&&"checkbox"!==e||(t.preventDefault(),this.apply())):(a=i(t.target).closest(g),a[0]&&(r!==fe.UP&&r!==fe.DOWN||(s=a.parent()[r===fe.UP?"prevAll":"nextAll"]().filter(lt).first().find(g+" "+ot).first(),s[0]&&(s.trigger(Pt),t.preventDefault()))))},collapsibleexpand:function(t){!ye&&this.options.persistState&&this._updateCollapsedState(this._getControl(i(t.target)),!0)},collapsiblecollapse:function(t){!ye&&this.options.persistState&&this._updateCollapsedState(this._getControl(i(t.target)),!1)}},_destroy:function(){let t=this.element,e=this.options;this._cleanupHandlers(),this._cleanupCharts(),this.itemsContainer$&&this.itemsContainer$.off(Lt+Jt),t.removeClass([c,q,u,h,p,Y].join(" ")).empty(),typeof e.currentFacets===Dt&&this.currentFacetsArea$&&this.currentFacetsArea$.removeClass(d+" "+q).empty(),typeof e.showTotalCount===Dt&&this.totalCount$&&this.totalCount$.empty(),this.moreFiltersPopup$&&this.moreFiltersPopup$.parent().remove(),this.filterDialogPopup$?.length&&this.filterDialogPopup$.parent().remove(),this.facetUIPopup$&&this.facetUIPopup$.parent().remove()},_setOption:function(t,e){let a=this.element,s=this.options;if(["feedback","currentFacets","showTotalCount","uiMode","searchItem"].includes(t))throw new Error(`Facets ${t} cannot be set`);if("S"===s.uiMode&&["searchField","multipleSearches","externalApply"].includes(t)||"F"===s.uiMode&&["collapsibleSearchBar","moreFiltersChip","maxChips"].includes(t))throw new Error(`Facets ${t} cannot be set for this uiMode`);if(this._super(t,e),t===At)a.toggleClass(q,e),typeof s.currentFacets===Dt&&this.currentFacetsArea$&&this.currentFacetsArea$.toggleClass(q,e);else if("batch"===t){let t="S"===s.uiMode;for(let t=0;t<s.controls.length;t++)s.controls[t]._noCtrlApply=s.batch||xa(s.controls[t]);t&&(s.externalApply=s.batch),this.refreshView()}else"showCharts"===t||("defaultChartPopup"===t||"defaultChartDialog"===t)&&!0===this.showCharts?("showCharts"!==t||!0!==e||this.chartsLoaded||this._loadCharts(),this.refreshView()):"collapsibleSearchBar"===t?(a.toggleClass(p+" "+Y,this._isSearchBarCollapsible()),this.refreshView()):["maxChips","moreFiltersChip"].includes(t)&&(s.maxChips<=0&&(s.moreFiltersChip=!1),this.refreshView())},_loadCharts:function(){window.require?require(["ojs/ojcore","ojs/ojchart"],(()=>{this.chartsLoaded||this.pendingRefresh||this._initCharts(),this.chartsLoaded=!0})):e.warn("JET Charts not available, option showCharts ignored.")},_initFacetControls:function(){let a=null,s=this.options,n=null,r="S"===s.uiMode,l=-1;this.moreFiltersPopup$&&(this.moreFiltersPopup$.parent().remove(),this.moreFiltersPopup$=null),this.filterDialogPopup$?.length&&(this.filterDialogPopup$.parent().remove(),this.filterDialogPopup$=null),this.filterDialogControls=[],this.facetControlItems=[];for(let o=0;o<s.controls.length;o++){let c=s.controls[o];if(ea[c.type]){if(c.type===Kt?(c._groupIndex=a,c._groupDisplayAs=n,s.controls[a]._children.push(c.name)):(a=null,n=null),c.type===te){if(c._children=[],a=o,n=c.displayAs,c.facets&&c.facets.length>0){for(let t=0;t<c.facets.length;t++){let e=c.facets[t];e.showChart=!1,e.showCounts=c.showCounts,s.controls.splice(o+1+t,0,e)}delete c.facets}l=-1,(c.checkedFirst||c.disabledLast||c.orderByCount)&&(l=1)}c.type===Kt&&l>0?(c.order=l,l+=1):Me(c),r?(delete c.showAllCount,delete c.showMoreStepSize,c.clearBtn=!1,Array.isArray(c.suggestedValues)&&0===c.suggestedValues.length&&(c.suggestedValues=!1)):(c.showAllCount=void 0===c.showAllCount?le:c.showAllCount,c.maxItemsDisplayed=c.showAllCount,c.showMoreStepSize=void 0===c.showMoreStepSize?le:c.showMoreStepSize,c.showAllGrace=void 0===c.showAllGrace?1:c.showAllGrace),(void 0===c.includeLabel||xa(c))&&(c.includeLabel=!0),void 0===c.hasFeedback&&(c.hasFeedback=s.feedback),xa(c)&&!c._groupDisplayAs&&this.filterDialogControls.push(c.name),void 0===c.showCounts&&c.hasFeedback&&(c.showCounts=!0),c.hasFeedback||(c.showCounts=!1),void 0===c.showChart&&c.showCounts&&(c.showChart=!1!==s.showCharts),void 0===c.clearBtn&&(c.clearBtn=!0),c._noCtrlApply=!!r||(s.batch||xa(c)),c._complete=r,c.type!==te&&this.facetControlItems.push(c.name),["list","rangeList","selectList"].includes(c.type)||delete c.lovValuesOptimizationSort,c._watchId&&c.visibleCondition&&t.unwatchCondition(c.visibleCondition,c._watchId),c.lovDependsOn&&i("#"+t.escapeCSS(c.lovDependsOn)).off(Lt+".fsDependsOn"+o)}else e.warn("Unknown control type removed:",c.type),s.controls.splice(o,1),o-=1}if(!1!==s.searchField){if(!s.searchItem)throw new Error("Option searchItem required when searchField is not false");this.facetControlItems.push(s.searchItem)}},_cleanupHandlers:function(){this.searchId&&i(this.searchId).off(Jt),this.searchId=null,this.searchButtonId&&i(this.searchButtonId).off(Jt),this.searchButtonId=null,this.currentFacetsArea$&&this.currentFacetsArea$.off(Jt)},_cleanupCharts:function(){this.currentCharts=[],this.chartDashboard$&&this.chartDashboard$.remove(),this.chartsPopup$&&this.chartsPopup$.remove()},refreshView:function(){let e=this._makeSetValueFn(),a=this.element,s=this.options;const n="S"===s.uiMode;let r=e=>{let a,i=e.visibleCondition,n=Pe(s.controls,i.item);n>=0&&(a=s.controls[n]),e._watchId=t.watchCondition(i,{doSubstitution:!0,multiValued:a&&a.multiple},(t=>{this._toggleVisibility(e.name,t,!0)}))},l=(e,a,s,n)=>{let r=this.idPrefix+"_"+a,l=i("#"+t.escapeCSS(e.lovDependsOn));l.on(Lt+".fsDependsOn"+a,(()=>{""===l.val()&&e.lovDependsOnRequired?(e.values=[],this._updateControlValues(e,s,n,r,r+"_lbl")):this.facetValuesNeeded.push(e.name)}))};if(He(this.element,s.currentFacets))this.pendingRefresh=!0;else{this.pendingRefresh=!1,this._initFacetControls(),this._cleanupHandlers(),this._cleanupCharts(),this._render(),this.currentFacetsArea$=null,s.currentFacets&&(!0===s.currentFacets?this.currentFacetsArea$=a.find("."+d):(this.currentFacetsArea$=i(s.currentFacets).first(),this.currentFacetsArea$.addClass(d).html(Et)),this.currentFacets$=this.currentFacetsArea$.children("ul").first(),!0===s.showTotalCount&&(this.currentFacetsArea$.prepend(Ue(s.text.totalCountLabel,s.regionStaticId)),this.totalCount$=this.currentFacetsArea$.find("."+z)),this.currentFacetsArea$.on(Vt+Jt,"button.a-FS-clear, button.a-FS-clearAll",(t=>{let e,a,n,r=i(t.target).closest("button"),l=_e(r.attr(Ct)),o=r.attr(gt),c=r.attr("data-begin"),h=r.attr("data-end");if(l>=0&&""!==o){e=s.controls[l],a=xe(Ae(e,!0));for(let t=0;t<a.length;t++)if(n=a[t],o===n||typeof n===Mt&&c===n.b&&h===n.e){a.splice(t,1);break}a=$e(a),e.type===ae&&e.flexibleOperator&&(a=a?`${a}:`:""),Le(e,a),this._setFCValueByIndex(l,a),this._changed()}else l<0&&s.multipleSearches?this._removeSearchTerm(o):this._clearAll(s.multipleSearches)}))),typeof s.showTotalCount===Dt?this.totalCount$=i(s.showTotalCount).first():!1===s.currentFacets&&!0===s.showTotalCount&&(this.totalCount$=a.find("."+z)),n?this._initSmartFilterMode():this._initFacetedSearchMode();for(let t=0;t<s.controls.length;t++){let a,i,o,c,h=s.controls[t],u=this.idPrefix+"_"+t;h.type!==te&&(o=Ae(h,!0),c=xe(o),this._setValue(h,t,c,o),a=ea[h.type],i=this._getControlElementByIndex(h,t),a.init(i,h,e,n),a.setValue(i,h,c,n),a.hasFilter(h)&&this._initFilterable(i,h,u),"F"===s.uiMode&&this._initFacetMenu(i,h,u),h.visibleCondition&&r(h),h.values&&h.lovDependsOn&&(l(h,t,a,i),0===h.values.length&&this._toggleVisibility(h.name,!1)))}"F"===s.uiMode?s.multipleSearches||this._initSearch():this._setSearchTerms(),this.facetValueCounts&&this._updateControls({counts:this.facetValueCounts},!0),this.chartsLoaded&&this._initCharts()}},reset:function(){this._reset(),this._clearAll(!0)},refresh:function(){this.fetchCounts()},fetchCounts:function(){let t=this.options;t.disabled||(He(this.element,t.currentFacets)?this.pendingFetch=!0:(this.pendingFetch=!1,this._fetchCounts()))},getFacetCount:function(t){let e,a,s=this.options,i=s.controls,n=0;for(e=0;e<i.length;e++)a=i[e],a.type===te||wa(a)||(n+=1);return t&&s.searchItem&&$v(s.searchItem).trim()&&(n+=1),n},clear:function(){this._clearAll(!0)},clearFacets:function(){this._clearAll()},getTotalResourceCount:function(){return this.totalResourceCount},getFacetValueCounts:function(){return this.facetValueCounts},showFacet:function(t){const e=this.options.controls;let a;t&&(a=e[Pe(e,t)]),xa(a)||this._toggleVisibility(t,!0)},hideFacet:function(t){const e=this.options.controls;let a;t&&(a=e[Pe(e,t)]),xa(a)||this._toggleVisibility(t,!1)},focus:function(){this.element.find(`.a-FS-search,.${A},.a-FS-searchBarButton,.a-FS-searchBar`).filter(lt).first().find(ot).first().trigger(Pt)},apply:function(t){let e,a,s=this.options.controls;if(t){s=[s[Pe(s,t)]]}for(e=0;e<s.length;e++){const t=s[e];let i;t.type!==te&&(i=Ae(t,!0),this.currentValues[t.name]!==i&&(a=!0),this.currentValues[t.name]=i)}a&&this._changed()},lock:function(){0===this.lockCount&&this._setOption(At,!0),this.lockCount+=1},unlock:function(){this.lockCount<=0||(this.lockCount-=1,this.lockCount<=0&&(this.lockCount=0,this._setOption(At,!1),this.pendingChange&&(this.pendingChange=!1,this._changed())))},addChart:function(t,e,a){let s,i=this.options.controls,n=Pe(i,t);n>=0&&(s=i[n],s.showCounts&&(e&&e.length||this.options.showCharts)&&!xa(s)&&(this.currentCharts.includes(t)?Je(t).trigger(Pt):(this._addChart(s,null,e,a),this._updateCharts())))},removeChart:function(t){this._removeChart(t)},_toggleFacets:function(t){this._toggleVisibility(t,!0,!1,!1),this.filterDialogControls.forEach((e=>{e!==t&&this._toggleVisibility(e,!1,!1,!0)}))},_enableDisableFilterDialogButton:function(){const t=this.options,e=this.element.find(`.${I}`);let a=!0;t.currentFacets?(this.filterDialogControls.forEach((e=>{wa(t.controls[Pe(t.controls,e)],!0)&&(a=!1)})),a?e.prop(At,!0):e.prop(At,!1)):e.prop(At,!1)},_renderFilterDialogFacetSelectOptions:function(){const t=this.options,e=r(this.idPrefix+"_fdsi");let s=[];this.filterDialogControls.forEach((e=>{const i=t.controls[Pe(t.controls,e)],n=wa(i,!0)?i.label:a.formatMessage("APEX.FS.FILTER_APPLIED",i.label);!wa(i,!0)&&t.currentFacets||s.push({d:n,r:e})})),e.choices={data:s},t.persistState&&!t.currentFacets&&this.sessionStore.getItem(zt)?e.setValue(this.sessionStore.getItem(zt)):e.setValue(s[0].r),this.filterDialogFacet=e.getValue(),this._toggleFacets(this.filterDialogFacet)},_renderFilterDialog:function(){const e=this,a=e.options,s=a.controls,n="js-cancel",l="js-clear";let o,h,u,p=e.filterDialogPopup$;if(!p){let d=t.htmlBuilder();function f(){if(p.length){const t=p.parent()[0],e=t.getBoundingClientRect(),a=parseFloat(e.top);let s;p.css("height","auto"),s=window.innerHeight-a-10,t.style.maxHeight=s+"px"}}d.markup(`<div class="${ct}">`),d.markup(`<div class="${$}">`),d.markup("<a-select").attr(bt,e.idPrefix+"_fdsi").attr("match-type","contains").attr("min-characters-search","0").attr("required",!0).attr(Ft,ke("INPUT_FACET_SELECTOR")),d.markup("></a-select>"),d.markup("</div>"),d.markup(`<div class="${c} ${c}-addFilter-filters"`),d.attr(bt,e.idPrefix+"_fdfw"),d.markup("></div>"),d.markup(`<div class="${c}-addFilter-actions">`),qe(d,ke("CANCEL"),n),a.currentFacets||qe(d,ke("CLEAR"),l),qe(d,ke("APPLY"),`t-Button--hot ${U}`),d.markup("</div>"),d.markup("</div>"),p=i(d.toString()),e.element.after(p),e.filterDialogPopup$=p,p.find(`.${n}`).on(Vt,(()=>{p.popup("close")})),a.currentFacets||p.find(`.${l}`).on(Vt,(()=>{const t=s[Pe(s,e.filterDialogFacet)];t._children?t._children.forEach((t=>{const a=s[Pe(s,t)];e._clear(a)})):e._clear(t),e._changed(),p.popup("close")})),h=p.find(`.${U}`),h.on(Vt,(()=>{s[Pe(s,e.filterDialogFacet)]._children?e.apply():e.apply(e.filterDialogFacet),u=!0,p.popup("close")})),o=p.find(x),o.on(Lt,(t=>{const i=r(t.target).getValue();if(""!==i){const t=s[Pe(s,i)];e.filterDialogFacet=i,!a.currentFacets&&a.persistState&&e.sessionStore.setItem(zt,i),a.currentFacets&&e._clear(t),h.prop(At,!1),e._toggleFacets(i)}queueMicrotask((()=>{f()}))})),p.popup(a.defaultFilterDialogPopup).on("keydown",(t=>{if(t.which===fe.ENTER){const a=s[Pe(s,e.filterDialogFacet)];[ee,ie,Zt].includes(a.type)||i(t.target).closest("a-select")||(t.preventDefault(),e.apply(e.filterDialogFacet),u=!0,p.popup("close"))}})).on("popupclose",(()=>{const t=s[Pe(s,e.filterDialogFacet)];e._enableDisableFilterDialogButton(),a.currentFacets&&!u&&i(p.popup("option","parentElement")).hasClass(I)&&e._clear(t),u=!1})).on("popupopen",(()=>{queueMicrotask((()=>{f()}))})).on(Vt,".js-toggleOverflow",(function(t){ze(e,t.target),queueMicrotask((()=>{f()}))})).on(Ht,(function(t){const a=i(t.target).closest(".a-FS-control"),s=a.find(".js-toggleOverflow"),n=e._getControl(s);s.length&&(e._updateDisplayedItems(s),oa(a,n)),queueMicrotask((()=>{f()}))})),Ze(p)}},_renderFacetedSearchMode:function(){let e,a,s,n=this.options,r=this.element,l=n.text,o=t.htmlBuilder();function c(t){t.markup(Tt+Tt),n.batch&&t.markup(`<div class='${_}' style='display:none;'><button class='a-Button a-Button--hot js-apply' type='button'>`).content(ke("BATCH_APPLY")).markup("</button></div>"),t.markup(Tt+Tt)}if($a(n.controls)&&this._renderFilterDialog(),!0===n.searchField){e=this.idPrefix+"_search",this.searchId="#"+e;const t=e+"_heading";o.markup("<div class='a-FS-search' role='region'").attr(vt,t).markup(">"),Ge(o,e,l.searchPlaceholder,!0,l.searchLabel,!0,!0,t),$a(n.controls)&&We(o,!0),o.markup("</div>")}!0===n.currentFacets?s=Et:!1===n.currentFacets&&!0===n.showTotalCount&&(s=Ue(n.text.totalCountLabel,n.regionStaticId)),s&&(o.markup(`<div class='${d}'`),!0===n.currentFacets&&o.attr(Ft,ke("CUR_FILTERS_LM")).attr(kt,"region"),o.markup(`>${s}${Tt}`)),a=null;for(let e=0;e<n.controls.length;e++){const s=n.controls[e],r=ea[s.type],l=this.idPrefix+"_"+e,h=this.hiddenControls.includes(s.name),u=s.label,p=xa(s),d=p?"":l+"_lbl";let f,g=t.htmlBuilder(),C=null;if(s.type===te?C=s.name:s.type===Kt&&a&&(C=a),null!==C&&C===a||(a&&(ia(o),c(o)),f=y+" "+Q,s.cssClasses&&(f+=" "+s.cssClasses),s.collapsible&&(f+=" "+k),g.markup("<div").attr(_t,f).attr(Ct,e).optionalAttr("role",p?"":"region").optionalAttr(vt,d).optionalAttr("style",h?"display:none;":"").optionalAttr(bt,p?l:"").markup(">"),p||(g.markup(`<div class='${m}'`).attr(bt,l).markup(">"),s.collapsible&&g.markup("<button class='a-FS-toggle' type='button'").attr(vt,d).markup("></button>"),g.markup("<h3 class='a-FS-label'").attr(bt,d).optionalAttr(yt,s.collapsible?null:"0").markup(">"),s.icon&&Qe(g,s.icon),g.content(u).markup("</h3>"),s.clearBtn&&g.markup("<button class='a-FS-clearButton js-clear' type='button'>").content(ke("CLEAR")).markup("</button>"),g.markup("</div>")),g.markup(`<div class="${A}"`).attr(bt,l+"_b").markup(">"),r.hasFilter(s)&&Ye(g,l,s,!p),g.markup(`<div class="${E+(s.maxHeight?" has-max-height":"")}"`).optionalAttr("style",s.maxHeight?"max-height:"+s.maxHeight+"px;":null).markup(`><div class="${T}">`),C&&sa(g,d,!0,s,u),a=C),r.render(g,l,d,s,!1,u),null!==C&&C===a||(a&&ia(g),c(g)),p){const r=i(`#${t.escapeCSS(this.idPrefix+"_fdfw")}`);a&&e===n.controls.length-1&&(ia(g),c(g)),a&&s.type===Kt&&void 0!==s._groupIndex?r.find(`#${t.escapeCSS(this.idPrefix)}_${s._groupIndex} .apex-item-group`).append(g.toString()):r.append(g.toString())}else o.markup(g.toString())}a&&(ia(o),c(o)),!n.searchField&&$a(n.controls)&&We(o,!1,!0),r.html(o.toString()),$a(n.controls)&&this._enableDisableFilterDialogButton()},_initFacetedSearchMode:function(){let e=this.options;ye=!0,this.element.find("."+k).each(((t,a)=>{let s=i(a),n=e.controls[s.attr(Ct)];s.collapsible({content:s.find("."+A),controllingElement:s.find(".a-FS-toggle"),heading:g,collapsed:!!n.initialCollapsed})})),ye=!1,typeof e.searchField===Dt&&(this.searchId="#"+t.escapeCSS(e.searchField),e.searchButton&&(this.searchButtonId="#"+t.escapeCSS(e.searchButton))),this.searchId&&i(this.searchId).on("keydown"+Jt,(t=>{t.which===fe.ENTER?(t.preventDefault(),this._doSearch()):t.which===fe.ESCAPE&&""!==i(this.searchId).val().trim()&&(t.preventDefault(),i(this.searchId).val(""))})),this.searchButtonId&&i(this.searchButtonId).on(Vt+Jt,(()=>{this._doSearch()}))},_initSearch:function(){let t=i(),e=this.options;!0===e.searchField&&e.searchItem?t=i("#"+this.idPrefix+"_search"):e.searchField&&(t=i(this.searchId)),t.val($v(e.searchItem))},_doSearch:function(){let t=this.options;if(this.searchId){let e=i(this.searchId),a=e.val();t.multipleSearches?(this._addSearchTerm(a),e.val("")):(Oe(t.searchItem,a),this._changed())}},_updateCollapsedState:function(t,e){this.facetCollapsedState[t.name]=e?1:0,this.sessionStore.setItem(Ut,JSON.stringify(this.facetCollapsedState))},_updateDisplayedItems:function(t,e){let a,s,n,r,l,o,c=!1,h=!1,u=t.parent(),p=u.parent(),d=this._getControl(t),f=u.closest("."+y).find(P),m=d.showAllCount,g=ea[d.type],C=g.isFiltered(p);C?a=d.matchFilterItems$:(a=p.find(j),d.hideEmpty&&(a=a.not("."+q))),e===ne?(d.maxItemsDisplayed=d.maxItemsDisplayed+d.showMoreStepSize,l=a.not(dt).length):e===re&&(d.maxItemsDisplayed=m),r=d.maxItemsDisplayed,e&&C&&p.find(D).filterable("refresh"),a.length===r+d.showAllGrace&&(r+=d.showAllGrace),C||a.each((function(t){let e=i(this),a=t>=r&&!i(this).hasClass(X);e.toggleClass(pt,a)})),d.hasGroups&&p.find(N).each((function(){let t=i(this);t.toggleClass(pt,0===t.children(j).not(dt).length)})),o=a.not(dt).length,C||e!==ne||l!==o||g.allItemsDisplayed(p,d)||this._updateDisplayedItems(t,ne),C||(d.filterValues&&g.canBeFiltered(p,d)?f.show():f.hide(),c=a.length>r&&a.length>o,h=a.length>m+d.showAllGrace&&r>m&&a.filter((t=>t>=m)).not(dt).find("input:not(:checked)").length),s=u.find(".js-showMore"),n=u.find(".js-showLess"),s.toggleClass(pt,!c),n.toggleClass(pt,!h),u.find(".a-FS-listFooterButtonSeparator").toggleClass(pt,!(c&&h)),e&&(!c&&h?n[0].focus({preventScroll:!0}):!h&&c&&s[0].focus({preventScroll:!0}))},_initFacetMenu:function(e,a,s){const n=s+"_facetMenu",r=e.closest(".a-FS-control"),l=r.find(`.${m}`),o=[],c=this.options,h=ea[a.type];let u;if([ee,ie].includes(a.type)&&Ra(a)&&o.push({type:"toggle",label:ke(Ce),set:t=>{let e=r.find(P),s=e.find(se),i=this.clientFilteringConfig;return t?e.show():(s.val("").trigger(Lt),e.hide()),i[a.name]=t,this._persistClientFilteringConfig(),a.filterValues=t,!0},get:()=>a.filterValues,disabled:()=>!h.canBeFiltered(l,a)}),c.showCharts&&a.showCounts&&a.showChart&&o.push({type:"action",label:ke("SHOW_CHART"),action:()=>{if(this.chartsLoaded){let t=a.name;!0!==this.options.showCharts||this.chartsPopup$[this.chartWidget]("isOpen")||r.find(".js-moreOptions").focus(),this.currentCharts.includes(t)?Je(t).trigger(Pt):(this._addChart(a,l),this._updateCharts())}}}),o.length){let e=t.htmlBuilder(),s=a.label+" "+ke("ACTIONS_MENU_BUTTON_LABEL");e.markup("<button type='button' class='js-moreOptions a-FS-moreOptions a-Button a-Button--noUI a-Button--noLabel a-Button--withIcon'").attr(St,s).attr(Ft,s).attr("data-menu",n).markup(">"),Qe(e,"icon-facet-actions"),e.markup("</button>"),l.append(e.toString()),i(`<div id='${n}' />`).menu({items:o,beforeOpen:function(t){u=function(){i(t.target).menu("toggle")},apex.gPageContext$[0].addEventListener("scroll",u,!0)},afterClose:function(){apex.gPageContext$[0].removeEventListener("scroll",u,!0)}})}},_renderSmartFilterMode:function(){let e,a,s,i=this.element,n=this.options,r=0!==n.maxChips,l=n.text,o=t.htmlBuilder(),c=t.htmlBuilder();function h(){c.markup(Tt+Tt+Tt),r&&o.markup("</li>")}e=this.idPrefix+"_search",this.searchId="#"+e,o.markup('<div class="a-FS-smartFilter"><div class="a-FS-searchBarButton"><button type="button" class="a-Button js-expandSearchBar"').attr(Ft,l.searchLabel).markup(">"),Qe(o,"icon-search"),o.markup("</button>"+Tt),o.markup("<div class='a-FS-searchBar'><ul><li>"),Ge(o,e,l.searchPlaceholder,!1,l.searchLabel,!1),o.markup("</li></ul></div>"),r&&o.markup("<div class='a-FS-suggestionChips'><ul class='a-Chips' role='toolbar'").attr(Ft,ke("SUGGESTIONS")).markup(">"),s=0;for(let t=0;t<n.controls.length;t++){let e,i,l=n.controls[t],u=this.idPrefix+"_"+t,p=u+"_lbl",d=this.hiddenControls.includes(l.name),f=l.label,m=null;if(l.type===te?m=l.name:l.type===Kt&&a&&(m=a),e=ea[l.type],null===m||m!==a){if(a&&(r&&ia(o),h()),r&&(n.maxChips>=0&&s>=n.maxChips&&(d=!0),i=F,l.cssClasses&&(i+=" "+l.cssClasses),l.suggestedValues)){let e=Be(l,null);o.markup("<li").attr(_t,i).attr(Ct,t).optionalAttr("style",d?"display:none;":"").markup(">"),l.includeLabel&&o.markup('<span class="a-Chip-label" role="button" aria-haspopup="true"').markup(">").content(f).markup(Ot),!e&&l.lovValuesOptimizationSort&&(e={r:"",d:""}),e&&(o.markup('<span class="a-Chip-text" role="button"').attr(gt,e.r).markup('><span class="a-Chip-value">').content(e.d).markup(Ot),l.showCounts&&o.markup('<span class="a-Chip-count"></span>'),o.markup(Ot)),s+=1}i=A+" "+Q,l.cssClasses&&(i+=" "+l.cssClasses),c.markup("<div").attr(bt,u+"_b").attr(_t,i).markup("><span class='u-vh'").attr(bt,p).markup(">").content(l.label).markup(Ot),e.hasFilter(l)&&Ye(c,u,l,!1),c.markup(`<div class="${E}"><div class="${T}">`),m&&r&&sa(o,p,!0,l),a=m}e.render(c,u,p,l,"S"===n.uiMode),null!==m&&m===a||(a&&r&&ia(o),h())}a&&(r&&ia(o),h()),r&&n.maxChips>=0&&n.moreFiltersChip&&o.markup('<li tabindex=\'-1\' class=\'a-Chip js-moreFilters\'><span class="a-Chip-label" role="button" aria-haspopup="true">').content(ke("OPEN_CONFIG")).markup(Ot+"</li>"),r&&o.markup("</ul></div>"),o.markup(Tt),!0===n.showTotalCount&&o.markup(`<div class='${d}'>${Ue(n.text.totalCountLabel,n.regionStaticId)}${Tt}`),o.markup(`<div id="${this.idPrefix}_controls" style="display:none">${c.toString()}</div>`),i.html(o.toString())},_initSmartFilterMode:function(){let t,e,a,s=this.element,n=this.options,r=fe.RIGHT,l=fe.LEFT;const c=(t,e)=>{if(t.hasClass("js-moreFilters"))this._openMoreFilters();else{let a,s=_e(t.attr(Ct)),i=null,n=null;e&&(a=t.find(".a-Chip-text"),i=a.attr(gt),n=a.children(".a-Chip-value").text()),this._applyFilterChip(s,i,n)}},h=(t,e)=>{let a=n.controls[t];setTimeout((()=>{if(e){if("list"===a.type&&a.multiple){let t=xe(Ae(a));""===t[0]||t.includes(e)||(t.push(e),e=$e(t))}Le(a,e),this._setFCValueByIndex(t,xe(e)),this._changed()}else this.searchBarInstance.activate(""+t)}),0)},u=(r,l,o)=>{let c=this.facetUIPopup$,h="#"+this.idPrefix+"_"+r+"_b";c||(c=i("<div class='a-FS-facetPopupContent'></div>"),this.element.after(c),c.popup(be(!0,{},n.defaultConfigPopup,{autoOpen:!1,maxHeight:400,classes:{"ui-dialog":"a-FS-facetPopup"},parentElement:l,create:function(){let t=i(this);t.keydown((function(e){if(e.which===fe.TAB){let a=t.find(":tabbable:last")[0],s=t.find(":tabbable:first")[0];ta(e.target,a)||e.shiftKey?!ta(s,e.target)&&e.shiftKey&&t.popup("close"):t.popup("close")}}))}})).on("popupclose",(()=>{""===Ae(e)&&(this.searchBarInstance.removeValueChip(t),this._updateSuggestionChips()),this.facetControlUIArea$.append(c.children().first()),a(!0),this.facetUIisExpanded=!1,n.batch&&this.apply(),this._checkSearchBarCollapse()})),Ze(c),this.facetUIPopup$=c),t=r,e=n.controls[t],a=o,c.append(s.find(h)),this.facetUIisExpanded=!0,c.popup("option",St,e.label).popup("option","parentElement",l).popup("open")};this.facetControlUIArea$=i("#"+this.idPrefix+"_controls"),"rtl"===s.css("direction")&&(r=fe.LEFT,l=fe.RIGHT),this.searchBarInstance=o.util.initComboSelect(s.find(".a-FS-searchBar"),{baseId:this.idPrefix,searchIcon:!0,clearIcon:!0,multiValued:!0,activeChipMessage:ke("APPLIED_FACET"),enterable:!0,useOverflow:!0,escapeChoices:!1,hasIcons:!0,popupClasses:"a-FS-suggestionsPopup",choices:(t,e)=>{this._searchFilter(t,e)},getChipLabel:t=>{let e=t.find(".a-Chip-label").text(),a=t.find(v),s=a.attr(Ft);return e+=s?" "+s:" "+a.text(),e},isDisabled:function(){return!1},removeValue:t=>{if(t.startsWith("S:"))t=t.substr(2),this._removeSearchTerm(t);else{let e=n.controls[_e(t)];!wa(e)?(this._clear(e),this._changed()):this._updateSuggestionChips()}},addValue:(t,e)=>{let a=null;if(t===e&&(t="S:"+t),t.startsWith("S:"))this._addSearchTerm(e),a={value:t,text:e};else{let e=Fe.exec(t);if(e){let t,s=_e(e[1]),i=n.controls[s],r=e[3]||"";h(s,r),i.type===ae&&i.flexibleOperator&&(t=Ee(i)),r=Ve(i,xe(r)[0],t),a={value:""+s,text:r,label:i.label}}}return a},activateChip:(t,e,a)=>{if(!t.startsWith("S:"))return u(t,e,a),!0;{let e=t.substr(2);this._removeSearchTerm(e),this.searchBarInstance.editValue(t,e)}}});let p=s.find(".a-FS-suggestionChips .a-Chips");this.suggestionChips$=p,p.children().first().addClass(Z).children(S).attr(yt,0),p.on(Vt,".a-Chip",(t=>{let e=i(t.target),a=e.closest("."+F);c(a,!e.hasClass("a-Chip-label"))})).on("keydown",(t=>{let e,a=t.which,s=p.children(rt);if(a===l)e=s.prevAll(lt).first();else if(a===r)e=s.nextAll(lt).first();else if(a===fe.ENTER){let e=i(t.target);c(s,!e.hasClass("a-Chip-label")),t.preventDefault()}else a===fe.SPACE&&t.preventDefault();e&&e[0]&&(De(e,s,!0),t.preventDefault())})).on("keyup",(t=>{if(t.which===fe.SPACE){let e=i(t.target),a=p.children(rt);c(a,!e.hasClass("a-Chip-label")),t.preventDefault()}}))},_isSearchBarCollapsible:function(){let t=this.options;return 0!==t.maxChips&&(t.collapsibleSearchBar||this.isMobile&&null===t.collapsibleSearchBar)},_checkSearchBarCollapse:function(){let t=this.element;if(this._isSearchBarCollapsible()){let e=this.getFacetCount(!0);t.toggleClass(Y,0===e&&!this.facetUIisExpanded&&"true"!==i(this.searchId).attr("aria-expanded")&&!i(document.activeElement).closest("."+c)[0])}else t.hasClass(Y)&&t.removeClass(Y)},_setSearchTerms:function(){let t=this.searchBarInstance,e=Ie(this.options.searchItem),a=[];t.getValue().forEach((t=>{t.value.startsWith("S:")&&a.push(t.value)})),a.forEach((e=>{t.removeValueChip(e)})),e.forEach((e=>{t.addValueChip("S:"+e,e)}))},_updateAppliedChip:function(t,e,s,i){let n,r=this.searchBarInstance,l=s;if(t.type===ae&&t.flexibleOperator&&(Array.isArray(l)?(n=l[0],l=s[1]||[""]):(l=l.split(Xt),n=l[0],l=l[1]||[""])),l.length>0&&""!==l[0]||!i){let s,i,o=this.element.find(".a-Chips.a-Chips--applied").children(`[${gt}="${e}"]`);i=t.type===ae&&t.flexibleOperator?Ve(t,l,n)||"":l.length>1?""+l.length:l.length>0?Ve(t,l[0]):"",o[0]?o.find(v).text(i):(r.addValueChip(""+e,i,t.label),o=this.element.find(".a-Chips.a-Chips--applied").children(`[${gt}="${e}"]`)),s=o.find(v),l.length>1?s.attr(Ft," "+a.formatMessage("APEX.FS.COUNT_SELECTED",i)):s.removeAttr(Ft),r.updatedValueChip()}else i&&r.removeValueChip(""+e)},_updateSuggestionChips:function(){let t=this.options,e=t.numberFormat,s=t.numberFormatOptions,i=t.numberFormatThreshold;if(0===t.maxChips)return;let n=0,r=0,l=!1,o=null,c=null;for(let h=0;h<t.controls.length;h++){let u=t.controls[h],p=wa(u),d=this.suggestionChips$.children(`[${Ct}="${h}"]`),f=this.facetValueCounts[u.name],m=this.hiddenControls.includes(u.name),g=m;if(d[0]){if((t.maxChips>=0&&n>=t.maxChips||!p)&&(g=!0),u.suggestedValues){let t=Be(u,f),r=this._getControlElementByIndex(u,h),p=d.hasClass(Z);if(t&&!r.is(":visible")||(g=!0),d.toggle(!g),g&&p&&(l=!0,c=d),!g){let r=d.find(".a-Chip-text"),c=d.find(".a-Chip-count"),h=t.r;if(l&&(l=!1,o=d),r.attr(gt,h).children(".a-Chip-value").text(t.d),n+=1,h&&c[0]&&f){let t=f[h]||0;t=0===t?"":Xe(t,e,i,s),c.text(t).attr(Ft,t?" "+a.formatMessage("APEX.FS.COUNT_RESULTS",t):"")}}}!m&&p&&t.moreFiltersChip&&(!g&&u.suggestedValues||(r+=1))}}let h=!(0===n||t.feedback&&this.totalResourceCount<10);this.suggestionChips$.parent().toggle(h),h&&t.moreFiltersChip&&this.suggestionChips$.children().last().toggle(r>0),l&&(o=this.suggestionChips$.children().not(".js-moreFilters").filter(":visible").last()),o&&o[0]&&De(o,c)},_searchFilter:function(e,a){const s=e?new RegExp(t.escapeRegExp(e),"ig"):null;let i=[],n=this.options;e=e.toLowerCase();for(let a=0;a<n.controls.length;a++){const s=n.controls[a],r=wa(s),l="a-ComboSelect-itemHighlight";let o=s.label,c=we(o,e,l);if(!this.hiddenControls.includes(s.name)&&(e&&c?i.push({d:c,r:""+a,i:s.icon||"icon-search-facet"}):!e&&r&&i.push({d:t.escapeHTML(o),r:""+a,i:s.icon||"icon-search-facet"}),e)){let t=s.values;if(t)for(let n=0;n<t.length;n++){let r=t[n],c=Ve(s,r.r);o=c,s.includeLabel&&(o=s.label+": "+o),(c.toLowerCase().includes(e)||e.startsWith((s.label+Xt).toLowerCase())&&o.toLowerCase().includes(e))&&i.push({d:we(o,e,l),r:a+Xt+r.r,i:r.i||s.icon||"icon-search-facet"})}}}if(n.searchSuggestions)for(let t=0;t<n.searchSuggestions.length;t++){let a=n.searchSuggestions[t];a.toLowerCase().includes(e)&&i.push({d:s?a.replace(s,(t=>`<span class='a-ComboSelect-itemHighlight'>${t}</span>`)):a,r:"S:"+a,i:"icon-search-suggestion"})}a(i)},_openMoreFilters:function(e){let a=this.moreFiltersPopup$,s=this.element,n=this.options,r=this.idPrefix+"_moreFilters",l=r+"Lbl",o=n.controls;a||(a=i(`<div class='a-FS-overflowFacetsContent' style='display:none;'><div class="${A}" id="${r}"><span class="u-vh" id="${l}">${ke("FACETS_LIST")}</span><div class="${E}"><div class="${T}"></div></div></div></div>`),this.element.after(a),a.popup(be(!0,{},n.defaultConfigPopup,{autoOpen:!1,title:ke("OPEN_CONFIG"),maxHeight:400,classes:{"ui-dialog":"a-FS-facetOverflowPopup"},parentElement:e||this.element.find(".js-moreFilters")})).on("popupclose",(()=>{this.facetUIisExpanded=!1,this._checkSearchBarCollapse()})),Ze(a),this.moreFiltersPopup$=a);let c=[],h={type:"list",showCounts:!1,hideRadioButton:!0,multiple:!1,values:c},u=0;for(let t=0;t<o.length;t++){let e=o[t],a=wa(e);!this.hiddenControls.includes(e.name)&&a&&(!e.suggestedValues||u>=n.maxChips)&&c.push({d:e.label,r:t,i:e.icon||"fa fa-cube"}),e.suggestedValues&&a&&(u+=1)}let p,d=ea[h.type],f=t.htmlBuilder();d.render(f,r,l,h),a.find(O).html(f.toString()),p=i("#"+r+" "+O),d.init(p,h,((t,e)=>{a.popup("close"),this._applyFilterChip(_e(e[0]),null,null)})),this._isSearchBarCollapsible()&&s.hasClass(Y)&&s.removeClass(Y),this.facetUIisExpanded=!0,a.popup("option","parentElement",e||this.element.find(".js-moreFilters")).popup("open")},_applyFilterChip:function(t,e,a){let s=this.options,n=this.element,r=s.controls[t],l=this.searchBarInstance;this._isSearchBarCollapsible()&&n.hasClass(Y)&&n.removeClass(Y),e?(Le(r,e),this._setFCValueByIndex(t,xe(e)),this._changed(),i(this.searchId).trigger(Pt)):(l.addValueChip(""+t,a||"",r.label),l.activate(""+t),this._updateSuggestionChips())},_makeSetValueFn:function(){const t=this.options;return(e,a,s)=>{const i=t.controls.indexOf(e);if(this.searchBarInstance&&this._updateAppliedChip(e,i,a),Le(e,a=$e(a)),t.batch||xa(e)){let s,n;if(!t.externalApply){let n,r;if(e.type===Kt&&void 0!==e._groupIndex)for(n="",r="",s=e._groupIndex+1;s<t.controls.length;s++){let e=t.controls[s];if(e.type!==Kt)break;n+="|"+this.currentValues[e.name],r+="|"+Ae(e)}else if(e.type===ae&&e.flexibleOperator){const t=Te(a);""!==t?(n=this.currentValues[e.name],r=a):(n=this.currentValues[e.name].split(Xt)[1]||"",r=t)}else n=this.currentValues[e.name],r=a;i>=0&&!xa(e)&&this.element.find("#"+this.idPrefix+"_"+i).closest("."+y).find("."+_)[n===r?"hide":"show"]()[0].scrollIntoView(!1)}if(n=this.facetValuesNeeded.length,n>0){for(s=0;s<n;s++)this.facetCountsNeeded.push(this.facetValuesNeeded[s]);this._delayFetchCountsFor()}}else a!==this.currentValues[e.name]&&(this.currentValues[e.name]=a,this._changed());"S"===t.uiMode&&s&&this.facetUIisExpanded&&(this.facetUIPopup$&&this.facetUIPopup$.popup("isOpen")&&this.facetUIPopup$.popup("close"),this.moreFiltersPopup$&&this.moreFiltersPopup$.popup("isOpen")&&this.moreFiltersPopup$.popup("close"))}},_initFilterable:function(e,a,s){const n="S"===this.options.uiMode;let r,l=i("#"+s+"_f");return l.val(""),l.closest(P).on(Vt,".js-clearInput",(function(){l.val("").trigger(Lt)})),n&&e.closest(K).off(Ht).on(Ht,(function(){oa(e,a)})),r=e.find(D).filterable({enhanced:!0,input:l,children:j,filterCallback:function(e,s){const n=i(this),r=n.find(se).val(),l=ea[a.type],o=n.hasClass("is-disabled")&&a.hideEmpty,c=n.find(".label"),h=l.getLabelForValue(a,r);let u=we(h,s,"a-FS-itemOptionHighlight"),p=!0;return 0===e&&(a.filteredItemsDisplayed=0,a.matchFilterItems$=i()),!u&&s||o||(a.matchFilterItems$=a.matchFilterItems$.add(n),a.filteredItemsDisplayed=a.filteredItemsDisplayed+1,p=!1),u?c.html(u):c.html(a.escape?t.escapeHTML(h):l.getLabelForValue(a,r,!1,!1)),p}}),r},_clearAll:function(t){let e,a,s=this.options;for(t&&this.searchId&&(i(this.searchId).val(""),Oe(s.searchItem,""),"S"===s.uiMode&&this._setSearchTerms()),e=0;e<s.controls.length;e++)a=s.controls[e],a.type!==te&&this._clear(a);this._changed()},_getControlElementByIndex:function(e,a){const s="#"+t.escapeCSS(this.idPrefix+"_"+a);let n=i(s);return!n[0]||n.hasClass(F)?n=i(s+"_b").find(O):n.hasClass(m)?n=n.next().find(O):xa(e)&&e.type!==Kt&&(n=n.find(O)),n},_getControl:function(t){let e=t.closest("."+y).attr(Ct);return this.options.controls[e]},_reset:function(){let t=this.options.controls;this._clearSessionState(),this.element.find("."+k).each((function(){let e=i(this),a=t[e.attr(Ct)];e.collapsible(a._origCollapsed?"collapse":"expand"),a.initialCollapsed=a._origCollapsed})),this._cleanupCharts(),this.chartConfig={};for(let e=0;e<t.length;e++){let a=t[e];a.initialChart=a._origChart||!1}this._initCharts()},_clearSessionState:function(){[Ut,Gt,Wt,qt].forEach((t=>{this.sessionStore.removeItem(t)}))},_changed:function(){this.options.disabled||this.pendingRefresh||this.pendingFetch?this.pendingChange=!0:(this._trigger(jt,{}),setTimeout((()=>{this._fetchCounts()}),200)),$a(this.options.controls)&&this._enableDisableFilterDialogButton()},_fetchCounts:function(){this.options.feedback?this._sendFetchCounts():this._updateControls({counts:{}},!0)},_clear:function(t){let e,a=this.options.controls,s=a.indexOf(t);if(t.type===te&&s>=0)for(let t=s+1;t<a.length&&a[t].type===Kt;t++)this._clear(a[t]);else t.type===ae&&t.flexibleOperator?(e=Ee(t),e=e?`${e}:`:"",Le(t,e),this._setFCValueByIndex(s,e)):(Le(t,""),s>=0&&this._setFCValueByIndex(s,[]))},_setFCValue:function(t){let e=t[0].id,a=xe(t.val()),s=Pe(this.options.controls,e);s>=0&&(this._setFCValueByIndex(s,a),this._changed())},_setFCValueByIndex:function(t,e){let a,s,i=this.options.controls[t];this._setValue(i,t,e),a=ea[i.type],s=this._getControlElementByIndex(i,t),s.length&&a.setValue(s,i,e,"S"===this.options.uiMode)},_setValue:function(t,e,a,s){void 0===s&&(s=$e(a)),this.currentValues[t.name]=s,this.searchBarInstance&&this._updateAppliedChip(t,e,a,!0)},_initCharts:function(){const t=new RegExp(Qt+"$");let e=this.options;if(e.showCharts)if(this.chartDashboard$=i("<div class='a-FS-facetsDashboard'></div>"),typeof e.showCharts===Dt){i(e.showCharts).html(this.chartDashboard$);for(let t=0;t<e.controls.length;t++){let a=e.controls[t];e.showCharts&&a.showCounts&&a.showChart&&a.initialChart&&this._addChart(a,null)}this.currentCharts.length&&this._updateCharts()}else{let a,s;if(e.defaultChartDialog)a="dialog",s=e.defaultChartDialog;else{if(!e.defaultChartPopup)throw new Error("Missing chart dialog or popup options");a="popup",s=e.defaultChartPopup}this.chartWidget=a,this.chartsPopup$=i("<div class='a-FS-chartsDialog' style='display:none;' ></div>"),this.chartsPopup$.insertAfter(this.element)[a](be({},s,{autoOpen:!1})).html(this.chartDashboard$).on("dialogbeforeclose popupbeforeclose",(()=>{let e=this.chartsPopup$.find("oj-chart").prop(bt);e&&(e=e.replace(t,""),this._removeChart(e,!0))}))}},_render:function(){"S"===this.options.uiMode?this._renderSmartFilterMode():this._renderFacetedSearchMode()},_sendFetchCounts:function(){let t=[];for(let e=0;e<this.hiddenControls.length;e++){let a=this.hiddenControls[e],s=this.options.controls.find((t=>t.name===a));this.facetValuesNeeded.includes(a)||this.currentCharts.includes(a)||!this.chartsLoaded&&s.initialChart||t.push(a)}this._send("FETCH_COUNTS",je(t),!0)},_sendFetchCountsFor:function(){this._send("FETCH_COUNTS_FOR",je(this.facetCountsNeeded),!1)},_send:function(t,e,a){let s,i,n=this.options;i=n.filteredRegionItemsToSubmit?[...this.facetControlItems,...n.filteredRegionItemsToSubmit.split(",").filter((t=>t))]:this.facetControlItems,this.lock(),s=apex.server.plugin(n.ajaxIdentifier,{pageItems:i,x01:t,x02:e,x03:je(this.facetValuesNeeded)},{dataType:"json",refreshObject:"#"+n.regionStaticId}),this.facetValuesNeeded=[],this.facetCountsNeeded=[],s.done((t=>{this._updateControls(t,a),this._updateCharts()})),s.always((()=>{this.unlock()}))},_delayFetchCountsFor:function(){this.delayFetchTimer&&clearTimeout(this.delayFetchTimer),this.delayFetchTimer=setTimeout((()=>{this.delayFetchTimer=null,this.facetCountsNeeded.length>0&&this._sendFetchCountsFor()}),100)},_updateControls:function(e,n){let r,l,o,h,u,p,d,m=e.counts,C=e.values,b=this.options,F="S"===b.uiMode,v=b.numberFormat,S=b.numberFormatOptions,k=b.numberFormatThreshold,$=this.element,I=t.htmlBuilder(),A=i(document.activeElement),E=!1,T=0;function O(t){return Xe(t,v,k,S)}if(!n||"compact"!==v&&!0!==v||"resolved"===s.resourcesLoaded().state()||(v=!1,s.resourcesLoaded((()=>{this._updateControls(e,n)}))),n?this.facetValueCounts=m||null:m&&this.facetValueCounts&&be(this.facetValueCounts,m),b.batch&&n&&$.find("."+_).hide(),void 0!==e.totalCount&&(this.totalResourceCount=e.totalCount),n&&b.multipleSearches&&b.currentFacets){let t=Ie(b.searchItem);if(t.length>0){I.markup(`<li class='${f} ${f}--search'>`);for(let e=0;e<t.length;e++){let s=t[e];Ke(I,s,a.formatMessageNoEscape("APEX.FS.CLEAR_VALUE",s),s,-1),T+=1}I.markup("</li>")}}r=null,l=null;for(let e=0;e<b.controls.length;e++){let s,_,F,v,S,k,$,x=null,L=null,V=b.controls[e],B=this.idPrefix+"_"+e,M=m&&m[V.name],N=C&&C[V.name],R=ea[V.type],j=this._getControlElementByIndex(V,e),H=!0;if(V.type!==te){if(V.type!==Kt&&(l=null),k=i(`#${t.escapeCSS(B)}`),V.type===Kt&&(k=k.closest("."+y).children(g)),V.lovValuesOptimizationSort&&M){N=[],Object.keys(M).forEach((t=>{N.push({r:t,d:t})})),xe(Ae(V)).forEach((t=>{t&&!(t in M)&&N.push({r:t,d:t})})),"desc"===V.lovValuesOptimizationSort?N.sort(((t,e)=>(t=t.d)>(e=e.d)?-1:e>t?1:0)):N.sort(((t,e)=>(t=t.d)>(e=e.d)?1:e>t?-1:0))}if(N&&(V.values=N,this._updateControlValues(V,R,j,B,B+"_lbl")),M&&R.update&&R.update(j,B,V,M,O),s=Ae(V,!0),V.type===Kt){let t=e+1;o+=s,(t>=b.controls.length||b.controls[t].type!==Kt)&&(x=""!==o,h.update(u,p,d))}else x=V.type===ae&&V.flexibleOperator?""!==Te(s):""!==s;if(null!==x&&(k.parent().toggleClass("has-value",x),!x&&A.hasClass("js-clear")&&A.closest(k).length&&(E=!0)),V.type===ae&&V.flexibleOperator&&(H=""!==xe(s)[1]),n&&b.currentFacets&&""!==s&&H){F=V.label,l&&(L=F=l),_=xe(s),V.type===ae&&V.flexibleOperator&&($=_[0],_=[_[1]]),null!==L&&L===r||(r&&I.markup("</li>"),I.markup(`<li class="${f}${V.includeLabel?" "+f+"--includeLabel":""}">`),xa(V)?qe(I,F,`${c}-currentLabel ${w}`,null,null,null,Pe(b.controls,V.name)):V.includeLabel&&I.markup("<span class='a-FS-currentLabel'>").content(F).markup(Ot),r=L);for(let t=0;t<_.length;t++)s=_[t],F=Ve(V,s,$),v=F,V.includeLabel&&(v=V.label+" "+v),v=a.formatMessageNoEscape("APEX.FS.CLEAR_VALUE",v),Ke(I,F,v,s,e),T+=1;null!==L&&L===r||I.markup("</li>")}if(S=j.find(".js-toggleOverflow"),S.length){(S.closest("."+y).find(P).find(se).val()||"").length>0&&V.filterValues&&j.find(D).filterable("refresh"),this._updateDisplayedItems(S)}}else l=V.label,o="",h=R,u=j,p=B,d=V}if(n&&(r&&I.markup("</li>"),b.currentFacets&&(A.is(".a-FS-clear,.a-FS-clearAll")&&A.closest(this.currentFacetsArea$).length&&(E=!0),T>1&&I.markup(`<li class='${f} ${f}--all'><button class='a-FS-clearAll' type='button'>`).content(ke("CLEAR_ALL")).markup("</button></li>"),!0===b.currentFacets&&this.currentFacetsArea$.toggle(T>0||!0===b.showTotalCount),this.currentFacets$.html(I.toString()),this.currentFacets$.find(`.${w}`).on(Vt,(t=>{const e=i(t.currentTarget).attr(Ct);let a=b.controls[e];void 0!==a._groupIndex&&(a=b.controls[a._groupIndex]),this.filterDialogPopup$.find(x).parent().hide(),this.filterDialogFacet=a.name,this._toggleFacets(a.name),this.filterDialogPopup$.popup("option","parentElement",t.target).popup("option",St,a.label).popup("option","relativePosition","below").popup("open")}))),this.totalCount$&&(this.totalCount$.text(O(this.totalResourceCount)),$.add(this.currentFacetsArea$||i()).find("."+W).toggle(0!==this.totalResourceCount)),F&&(this._updateSuggestionChips(),this._checkSearchBarCollapse())),E){let t=A.closest(".a-FS-control").find(ot).first();!t[0]&&A.parent().hasClass("a-FS-currentItem")&&(t=this.currentFacetsArea$.find(ot).first()),t[0]?t.trigger(Pt):this.focus()}},_updateControlValues:function(e,a,s,n,r){let l,o,c,h,u=t.htmlBuilder(),p=e.values,d=xe(Ae(e,!0)),f=this._makeSetValueFn(),m=i(document.activeElement),g=i("#"+n+"_f");m.hasClass(R)&&(m=i(document.activeElement).find(se)),m.closest(s).length&&(c=m.val()),Me(e),a.render(u,n,r,e,!0),s.html(u.toString()),c&&(h=s.find(`input[value='${t.escapeCSS(c)}']`).parent(),h.removeClass(pt),h.parent(".apex-item-subgroup").removeClass(dt),h.trigger(Pt)),o=!1;for(let t=0;t<d.length;t++){l=!1;for(let e=0;e<p.length;e++)if(d[t]===p[e].r){l=!0;break}l||(d.splice(t,1),t-=1,o=!0)}if(o&&Le(e,$e(d)),a.init(s,e,f),a.setValue(s,e,d),a.hasFilter(e)){let t,a=g.val();t=this._initFilterable(s,e,n),a&&(g.val(a),t.filterable("refresh"))}e.lovValuesOptimizationSort||this.hiddenControls.includes(e.name)!==(0===p.length)&&this._toggleVisibility(e.name,p.length>0,!1,!0)},_addSearchTerm:function(t){let e=this.options.searchItem,a=Ie(e);a.includes(t)||(a.push(t),Oe(e,a.join("\n")),this._changed())},_removeSearchTerm:function(t){let e,a=this.options.searchItem,s=Ie(a);e=s.indexOf(t),e>=0&&(s.splice(e,1),Oe(a,s.join("\n")),this._changed())},_toggleVisibility:function(t,e,a,s){const i=this.options.controls,n=Pe(i,t);let r,l,o;n>=0&&(l=i[n],r=this.hiddenControls.indexOf(t),e?r>=0&&(this.hiddenControls.splice(r,1),l.hasFeedback&&!s&&(this.facetCountsNeeded.push(t),this._delayFetchCountsFor())):r<0&&this.hiddenControls.push(t),o=this._getControlElementByIndex(l,n),l.type!==Kt&&(o=o.closest("."+y)),o.toggle(e),a&&!e&&(this._clear(l),this._removeChart(t)))},_updateCharts:function(){let e=this.options,a=e.controls,s=this.facetValueCounts,i=this.currentCharts,n=(t,e)=>e.items[0].value-t.items[0].value;if(s)for(let r=0;r<i.length;r++){let l,o,c,h,u,p,d,f,m,g=!1,C=i[r],b=this.chartConfig[C],_=[],F=Pe(a,C),v=a[F],S=ea[v.type];if(v.type===te){for(l=F+1;l<a.length&&a[l].type===Kt;l++){if(m=Ae(a[l]),m){g=!0;break}}for(l=F+1;l<a.length&&a[l].type===Kt;l++){let t=a[l];o=t.altLabel||t.label,c=s[t.name],c&&(m=Ae(t),u=c[t.value],u>0&&(!g||m)&&_.push({name:o,items:[{id:l,value:u,name:o}]}))}}else if(c=s[C],c)for(d=v.values||[{r:v.value,l:v.altLabel||v.label}],m=Xt+Ae(v)+Xt,m!==Xt+Xt&&(g=!0),l=0;l<d.length;l++)f=d[l],o=S.useGetlabelForCharts&&S.getLabelForValue?S.getLabelForValue(v,f.r):f.l||t.stripHTML(f.d),u=c[f.r],u>0&&(!g||m.includes(Xt+f.r+Xt))&&_.push({name:o,items:[{id:l,value:u,name:o}]});if(v.orderByCount&&_.sort(n),p=g?_.length:Math.min(_.length,b.topN||e.chartTopNValues),p<_.length){let t=0,e=ke("CHART_OTHERS");for(l=p;l<_.length;l++)t+=_[l].items[0].value;_[p]={name:e,items:[{id:d.length,value:t,name:e}]},_.length=p+1}h=Je(C)[0],h.groups=[""],h.valueFormats={value:{converter:{format:t=>Xe(t,e.numberFormat,e.numberFormatThreshold,e.numberFormatOptions)},tooltipLabel:ke("CHART_VALUE_LABEL")}},h.translations={labelSeries:v.label},h.series=_}},_addChart:function(e,a,s,n){var r,l,o=this.options,c=e.name,h=this.currentCharts;function u(t,e){t.legend.rendered="pie"===e?"off":"on",t.styleDefaults.dataLabelPosition="pie"===e?"outsideSlice":"outsideBarEdge",t.refresh()}n=n||this.chartConfig[c]||{type:"bar",topN:o.chartTopNValues},this._persistChartConfig(),this.chartConfig[c]=n,r=i(function(e,a){var s,i,n=ke("REMOVE_CHART"),r=t.htmlBuilder();return"bar"===a?(i=ut,s=ke("CHART_PIE")):(a="pie",i=ht,s=ke("CHART_BAR")),r.markup('<div class="'+V+'"><div class="a-FS-facetChart-header"><h3 class="a-FS-facetChart-title">').content(e.label).markup('</h3><div class="a-FS-facetChart-controls">').markup('<button type="button" class="a-FS-changeChartType js-changeChartType a-Button a-Button--noLabel a-Button--withIcon"').attr("data-type",a).attr(St,s).attr(Ft,s).markup(">"),Qe(r,i),r.markup('</button><button type="button" class="a-FS-removeChart js-removeChart a-Button a-Button--noLabel a-Button--withIcon"').attr(St,n).attr(Ft,n).markup(">"),Qe(r,"icon-multi-remove"),r.markup(`</button>${Tt}${Tt}<div class="a-FS-facetChart-body"><oj-chart id="`).attr(e.name+Qt).markup('" style="width:100%;height:100%;" legend.position="bottom" hover-behavior="dim" hide-and-show-behavior="withRescale" sorting="descending" animation-on-display="auto" animation-on-data-change="auto"').attr("type",a).markup("></oj-chart></div></div>"),r.toString()}(e,n.type)),this._trigger("beforeAddChart",{},{count:h.length+1,chartName:c,chart:r[0]}),(l=r.find("oj-chart")[0]).dataLabel=t=>{let e,a,s=Xe(t.value,o.numberFormat,o.numberFormatThreshold,o.numberFormatOptions);return t.totalValue?(e=Math.round(100*t.value/t.totalValue)+"%",a=t.series+" - "+e+" ("+s+")"):a=""+s,a},r.find(".js-removeChart").on(Vt,(()=>{this._removeChart(c)})),r.find(".js-changeChartType").on(Vt,(t=>{let e,a,s,n,r=i(t.target).closest("button"),l=r.attr("data-type"),o=r.closest("."+V).find("oj-chart")[0];"bar"===l?(e="pie",a=ke("CHART_BAR"),s=ht,n=ut):(e="bar",a=ke("CHART_PIE"),s=ut,n=ht),r.attr("data-type",e).attr(St,a).attr(Ft,a).children(".a-Icon").removeClass(n).addClass(s),o.type=e,u(o,e),this.chartConfig[c].type=e,this._persistChartConfig()})),s&&s.length?(s.append(r),h.push(c)):(!0===this.options.showCharts&&h.length>0&&this._removeChart(h[0]),this.chartDashboard$.append(r),h.push(c),!0===this.options.showCharts?("popup"===this.chartWidget&&this.chartsPopup$.popup("option","parentElement",a),this.chartsPopup$[this.chartWidget]("open")):this._persistOpenCharts()),setTimeout((()=>{u(l,n.type)}),0)},_removeChart:function(t,e){var a=this.currentCharts,s=a.indexOf(t),i=Je(t).closest("."+V);s>=0&&(a.splice(s,1),i.remove(),!0===this.options.showCharts?e||this.chartsPopup$[this.chartWidget]("close"):this._persistOpenCharts(),this._trigger("afterRemoveChart",{},{count:a.length,chartName:t}))},_persistOpenCharts:function(){this.options.persistState&&this.sessionStore.setItem(Gt,JSON.stringify(this.currentCharts))},_persistChartConfig:function(){this.options.persistState&&this.sessionStore.setItem(Wt,JSON.stringify(this.chartConfig))},_persistClientFilteringConfig:function(){this.options.persistState&&this.sessionStore.setItem(qt,JSON.stringify(this.clientFilteringConfig))}});const ea=[];function aa(t,e){ea[t]=e}function sa(t,e,a,s,i){let n,r=B+" apex-item-group--rc ";r+=a?" checkbox_group apex-item-checkbox":" radio_group apex-item-radio",s.listClasses&&(r+=" "+s.listClasses),s.hideRadioButton&&!a&&(r+=" a-FS--hideRadio"),s.hideEmpty&&(r+=" a-FS--hideEmpty"),i?n={name:Ft,value:i}:e&&(n={name:vt,value:e}),t.markup('<div tabindex="-1" role="listbox"').attr(n.name,n.value).attr(_t,r).optionalAttr("aria-multiselectable",a?"true":null).markup(">")}function ia(t){t.markup(Tt)}function na(t,e,a,s,i,n,r,l,o){const c=e+"_"+a;t.markup("<div").optionalAttr(bt,o).attr(_t,s).attr(kt,"option").attr("tabindex","0").optionalAttr(ft,i.order).markup("><input").attr("type",l?"checkbox":"radio").attr("tabindex","-1").attr(_t,pt).attr(bt,c).optionalAttr("name",l?null:e+"_r").attr("value",i.r).markup("><label").attr("for",c).markup(">"),i.i&&t.markup("<span class='a-Icon ").attr(i.i).markup("'></span>"),t.markup("<span class='label'>")[n?"content":"markup"](i.d).markup(Ot),r&&t.markup(`<span class='${H}'></span>`),t.markup("</label></div>")}function ra(t,a,s,i,n){let r,l,o=!1,c=null,h=i.multiple,u=i.values,p=!1!==i.escape,d=0;for(sa(t,s,h,i,n),l=u.length+1,i.maxItemsDisplayed>0&&u.length>i.maxItemsDisplayed+i.showAllGrace&&(l=i.maxItemsDisplayed),r=0;r<u.length;r++){let e=u[r],s=R,n=M;if(r>=l&&(s+=` ${pt}`,n+=` ${pt}`),e.g&&e.g!==c){let s=a+"_lsg_"+d;d+=1,c&&t.markup(Tt),c=e.g,o=!0,t.markup("<div role='group'").attr(_t,n).attr(vt,s).markup(`><div class='apex-group-label' role='presentation' id='${s}'>`).content(e.g).markup(Tt)}na(t,a,r,s,e,p,i.showCounts,h)}if(c&&t.markup(Tt),ia(t),i.hasGroups=o,o&&((i.checkedFirst||i.disabledLast||i.orderByCount)&&e.warn("Facets list options orderByCount, checkedFirst and disabledLast ignored when list has groups"),i.orderByCount=i.checkedFirst=i.disabledLast=!1),void 0!==i.showMoreStepSize){let e=ke(ne),a=ke(re);t.markup('<div class="a-FS-listFooter">').markup(`<button class="a-FS-toggleOverflow js-toggleOverflow js-showMore ${pt}" type="button"`).attr(Ft,e+": "+i.label).markup(">").content(e).markup("</button>").markup(`<span class="a-FS-listFooterButtonSeparator ${pt}">/</span>`).markup(`<button class="a-FS-toggleOverflow js-toggleOverflow js-showLess ${pt}" type="button"`).attr(Ft,a+": "+i.label).markup(">").content(a).markup("</button>").markup("</div>")}}function la(t,e,a){t.find(j).removeClass(X).attr($t,"false").removeAttr(xt),t.find(":checked").each((function(){let t,s=this.value;i(this).parent().addClass(X).attr($t,"true").attr(xt,"true"),e&&(t=this.value.split(Yt),2===t.length&&(s={b:t[0],e:t[1]})),a.push(s)}))}function oa(t,e){if(!xa(e)){let a=ea[e.type].controlItemOptions(t,e),s=a.find("input:checked").first().parent();a.attr(yt,"-1"),s.length>0?s.attr(yt,"0"):a.first().attr(yt,"0")}}function ca(t,e,a){const s=i(t).find(se)[0],n=i(t).hasClass(q);s&&["checkbox","radio"].includes(s.type)&&(n||a&&(!a||s.checked)||(s.checked=!s.checked,i(s).trigger(Lt,e)))}function ha(t,e,a){const s=t.which,n=`${j}${lt}${e.multiple&&e.hideEmpty?":not("+J+")":""}`;if(s===fe.UP||s===fe.DOWN){const e=i(t.target);if(e.hasClass(B))e.find(n).first().trigger(Pt);else{const t=e.closest(j),a=s===fe.UP?"prevAll":"nextAll",i=t[a](n).first(),r=t.closest(N)[a]().first();if(i[0])i.trigger(Pt);else if(r[0]){let t,e=r.find(n);t=s===fe.UP?e.last():e.first(),t.trigger(Pt)}}t.preventDefault()}else if(s===fe.ENTER||s===fe.SPACE){const e=i(t.target).filter(j)[0];e&&ca(e,{enter:s===fe.ENTER},a),t.preventDefault()}}function ua(t,e){let a=i(t.target).filter(j)[0];a||(a=i(t.target).closest("div.apex-item-option")[0]),a&&ca(a,{enter:!1},e)}function pa(t,e,a){let s=t.find(D),i=e.type===ie;s.on(Lt,((n,r)=>{let l,o,c=r&&r.enter||!1,h=[],u=t.find(D);if(la(s,i,h),fa(t,e),h.length>0&&!e.multiple&&i&&!e.noManualEntry&&Va(t,e,[]),i&&e.multiple&&!e.noManualEntry){const a=Ia(e)?t.find(et)[0]?._wrappedElement$:t.find(et),s=Ia(e)?t.find(st)[0]?._wrappedElement$:t.find(st);l=Re(a.val(),e),o=Re(s.val(),e),Ta(e,l,o)&&h.push({b:l,e:o})}a(e,h,c),[ee,ie].includes(e.type)&&oa(u,e)})).on("keydown",(t=>{ha(t,e)})).on(Vt,ua)}function da(t,e,s,i,n){const r=s.values,l=t.find(D),o=xe(Ae(s));for(let l=0;l<r.length;l++){let c,h=r[l],u=e+"_"+l,p=i[h.r]||0,d=t.find("#"+u),f=d.parent(),m=f.find(G),g=s.hasFeedback&&0===p&&!o.some((t=>{if(s.type===ie){let e=(xe(h.r)||[{b:"",e:""}])[0];return t.b===e.b&&t.e===e.e}return t===h.r}));f.toggleClass(q,g),[Kt,Zt].includes(d[0].type)&&(d.attr(At,g),d.parent(j).attr("aria-disabled",g)),c=0===p?"":n(p),m.attr(mt,p).text(c).attr(Ft,c?" "+a.formatMessage("APEX.FS.COUNT_RESULTS",c):"")}[ee,ie].includes(s.type)&&oa(l,s),ma(t,s)}function fa(t,e){e.hasFeedback||setTimeout((function(){ma(t,e)}),350)}function ma(e,a){let s=a.orderByCount,n=a.checkedFirst,r=a.disabledLast;if(n||r||s){let l,o,c=i(document.activeElement),h=e.find(D);c.hasClass(R)&&(c=i(document.activeElement).find(se)),c.closest(h).length&&(o=c.val()),l=h.children().toArray().sort(((t,e)=>{var a=0;function l(t){var e=i(t);return 2+(n&&e.hasClass(X)?-1:0)+(r&&e.hasClass(q)?2:0)}function o(t){return _e(i(t).find(G).attr(mt))||0}function c(t){return _e(i(t).attr(ft))}return(n||r)&&(a=l(t)-l(e)),s&&0===a&&(a=o(e)-o(t)),0===a&&(a=c(t)-c(e)),a})),h.children().detach(),h.append(l),o&&h.find(`input[value='${t.escapeCSS(o)}']`).parent().trigger(Pt),[ee,ie].includes(a.type)&&oa(h,a)}}function ga(e,a,s,i=!0){let n=e.values;typeof a===Mt&&(a=(a.b||"")+Yt+(a.e||""));for(let r=0;r<n.length;r++){let l,o=n[r];if(a===o.r)return l=o.l&&i?o.l:void 0===s&&!e.escape||s?t.stripHTML(o.d):o.d,l}return null}function Ca(e,a,s){let i=[],n=e.find(D);e.find(se).prop("checked",!1).parent().removeClass(X).attr($t,"false").removeAttr(xt);for(let a=0;a<s.length;a++){let n=s[a];typeof n===Mt&&(n=(n.b||"")+Yt+(n.e||"")),e.find("input[value='"+t.escapeCSS(n)+"']").prop("checked",!0).parent().addClass(X).attr($t,"true").attr(xt,"true").length||i.push(s[a])}return[ee,ie].includes(a.type)&&oa(n,a),fa(e,a),i}function ba(t,e){e._noCtrlApply||t.markup(`<button class="a-Button ${U}" type="button" disabled>`).content(ke("GO")).markup("</button>")}function _a(t,e,a,s,i,n){const r=i?null:n;t.markup('<input type="number" value=""').attr("class",`apex-item-text ${a}`).attr(bt,e).optionalAttr(It,s.min).optionalAttr(wt,s.max).optionalAttr("step",s.step).optionalAttr(vt,i).optionalAttr(Ft,r).markup(">")}function Fa(t,e,a,s,i,r,l){const o=!!(""+s.formatMask).toLowerCase().includes("hh")||null,c=n.format(new Date,s.formatMask),h=r?null:l;t.markup('<a-date-picker value=""').attr("class",a).attr(bt,e).attr("valid-example",c).attr("show-on",i||xa(s)?Vt:Pt).optionalAttr(vt,r).optionalAttr(Ft,h).optionalAttr(It,Ne(s.min,s)).optionalAttr(wt,Ne(s.max,s)).optionalAttr("show-time",o).optionalAttr("format",s.formatMask).markup("></a-date-picker>")}function va(){return ke("RANGE_BEGIN")}function Sa(t){return t.rangeText}function ya(){return ke("INPUT_VALUE")}function ka(t,e,a,s,i,n){const r=s?tt:at,l=s?va():null,o=e+"_lbl";switch(i.prefixText&&t.markup("<span").attr(bt,o).markup(` class="${it}Prefix">`).content(i.prefixText).markup(Ot),i.dataType){case he:case ue:case pe:case de:Fa(t,e,r,i,n,null,l);break;case ce:_a(t,e,r,i,null,l);break;default:throw new Error(`${Bt}${i.dataType}`)}i.suffixText&&t.markup("<span").attr(bt,o).markup(` class="${it}Suffix">`).content(i.suffixText).markup(Ot)}function $a(t){let e=!1;return t.forEach((t=>{if(t.displayAs===Rt)return e=!0,!0})),e}function xa(t){return t?.displayAs===Rt||t?._groupDisplayAs===Rt}function Ia(t){return[he,ue,pe,de].includes(t.dataType)}function wa(t,e){let a;return e&&t._children?.length>0?(t._children.forEach((t=>{if(""!==Ae({name:t}))return a=!0,!1})),!a):""===Ae(t)}function Aa(t){return void 0===t?"":t}function Ea(e,a,s,i,n){let r=`${t.escapeCSS(a)}_ib`;e.markup(`<div class="${it} ${it}--${Ia(i)?"date-picker":"number"}">`),ka(e,r,0,!0,i,n),r=`${a}_ie`,e.markup(`<label for="${t.escapeHTMLAttr(r)+(Ia(i)?"_input":"")}" class="${it}To">`).content(Sa(i)).markup("</label>"),ka(e,r,0,!1,i,n),ba(e,i),e.markup(Tt)}function Ta(t,e,a){return!t.allowOpen&&""!==e&&""!==a||t.allowOpen&&(""!==e||""!==a)}function Oa(e,a){const s=e.attr("id"),n=`${s}_error_placeholder`;let o,c,h,u=!0;switch(l.clearErrors(s),i("#"+t.escapeCSS(n)).remove(),a.dataType){case he:case ue:case pe:case de:o=r(s),h=o.getValidity(),h.valid||(u=!1);break;case ce:case oe:break;default:throw new Error(`${Bt}${a.dataType}`)}if(!u){c=[ee,ie].includes(a.type)&&e.hasClass(tt)?va():[ee,ie].includes(a.type)&&e.hasClass(at)?Sa(a):ya();let t=i("<div>");t.addClass("a-Form-error").attr(bt,n).attr("data-template-id",ve),e.append(t),l.showErrors([{type:l.TYPE.ERROR,location:["inline"],pageItem:s,message:o.getValidationMessage(c)}]),e.closest(`.${y}`).find(`.${_}`).hide()}return u}function La(t,e,a){let s=Ia(e)?t.find(et)[0]?._wrappedElement$:t.find(et),i=Ia(e)?t.find(st)[0]?._wrappedElement$:t.find(st),n="keyup change";function r(s,i,n,r=!1){let l=[];e.multiple&&e.values.length>0&&(la(t.find(D),!0,l),fa(t,e)),s&&l.push({b:Re(i,e),e:Re(n,e)}),a(e,l,r)}Ia(e)&&(n=Lt),t.find(nt).on(n,(function(){const a=s.val(),n=i.val(),l=Ta(e,a,n),o=t.find(et),c=t.find(st),h=Oa(o,e),u=Oa(c,e);if(h?c.attr(It,a):c.removeAttr(It),u?o.attr(wt,n):o.removeAttr(wt),e.values&&e.values.length>0&&!e.multiple&&(""!==a||""!==n)&&h&&u&&Ca(t,e,[]),e._noCtrlApply)if(xa(e)){const e=t.closest(`.${ct}`).find(`.${U}`);l&&h&&u?(e.prop(At,!1),r(l,a,n)):e.prop(At,!0)}else!e._complete&&h&&u&&r(l,a,n);else t.find(`.${U}`).prop(At,!l||!(h&&u))})).on("keydown",se,(function(a){let n=a.which;if(n===fe.ENTER&&a.preventDefault(),n===fe.ENTER||n===fe.ESCAPE&&e._complete){const a=s.val(),n=i.val(),l=Ta(e,a,n),o=t.find(et),c=t.find(st),h=Oa(o,e),u=Oa(c,e);h?c.attr(It,a):c.removeAttr(It),u?o.attr(wt,n):o.removeAttr(wt),h&&u&&r(l,a,n,!0)}})),t.find(`.${U}`).on(Vt,(function(){let t=s.val(),a=i.val();r(Ta(e,t,a),t,a)}))}function Pa(t,e){const s=Ia(t)?a.formatMessageNoEscape:a.formatMessage;return""===e.b?s(t.currentLabelOpenLow,Aa(Ne(e.e,t))):""===e.e?s(t.currentLabelOpenHi,Aa(Ne(e.b,t))):s(t.currentLabel,Aa(Ne(e.b,t)),Aa(Ne(e.e,t)))}function Va(t,e,a){let s=Ia(e)?t.find(et)[0]?._wrappedElement$:t.find(et),i=Ia(e)?t.find(st)[0]?._wrappedElement$:t.find(st);typeof a===Mt?(s.val(Ne(a.b,e)),i.val(Ne(a.e,e)),Ia(e)&&(a.e&&s.attr(wt,a.e),a.b&&i.attr(It,a.b))):(s.val(""),i.val("")),t.find(`.${U}`).attr(At,!Ta(e,s.val(),i.val()))}function Ba(t){let e,a,s;return s=t.closest(K),e=s.find(P),a=(e.find(`${se}[type="search"]`).val()||"").length>0,a}function Da(t,e){let a,s;return Ba(t)?a=e.matchFilterItems$:(s=t.closest(K),a=s.find(j),e.hideEmpty&&(a=a.not("."+q))),a}function Ma(t,e){const a=Da(t,e);return a.length===a.not(dt).length}function Na(t,e){return Da(t,e).length>e.showAllCount+e.showAllGrace||e.showAllCount===le}function Ra(t){return t.actionsFilter||t.filterValues||!1}function ja(){return!1}function Ha(t,e,a){return a?e?t.find(".a-FS-inputOperatorValue > input:checked").val():t.find(".a-FS-inputOperatorValue").val():null}i.apex.facets.addControlType=aa,aa("list",{render:function(t,e,a,s,i,n){ra(t,e,a,s,n)},init:function(t,e,a){pa(t,e,a)},update:function(t,e,a,s,i){da(t,e,a,s,i)},getLabelForValue:function(t,e,a,s){return ga(t,e,a,s)},setValue:function(t,e,a){Ca(t,e,a)},canBeFiltered:function(t,e){return Na(t,e)},isFiltered:Ba,controlItemOptions:function(t,e){return Da(t,e)},allItemsDisplayed:function(t,e){return Ma(t,e)},hasFilter:Ra}),aa(te,{render:function(){},init:function(){},update:function(t,e,a){ma(t,a)},setValue:function(){},hasFilter:ja}),aa(Kt,{render:function(t,e,a,s){na(t,e,"cb",R,{d:s.label,r:s.value,i:s.icon,order:s.order},s.escape,s.showCounts,!0,e)},init:function(t,e,a){t.on(Lt,(function(){let s=t.find(se),i="",n=s.prop("checked");n&&(i=s.val()),t.toggleClass(X,n),a(e,i)})).on("keydown",(t=>{ha(t,e)})).on(Vt,ua)},update:function(t,e,s,i,n){let r,l=i[s.value]||0,o=t.find(se),c=t.find(G),h=s.hasFeedback&&0===l;t.toggleClass(q,h),o.attr(At,h),r=0===l?"":n(l),c.attr(mt,l).text(r).attr(Ft,r?" "+a.formatMessage("APEX.FS.COUNT_RESULTS",r):"")},getLabelForValue:function(t){return t.altLabel||t.label},setValue:function(t,e,a){var s=t.find(se),i=s.val()===a[0];t.toggleClass(X,i),s.prop("checked",i)},hasFilter:ja}),aa(ie,{render:function(t,e,a,s,i,n){ra(t,e,a,s,n),s.noManualEntry||Ea(t,e,0,s,i)},init:function(t,e,a){pa(t,e,a),e.noManualEntry||La(t,e,a)},update:function(t,e,a,s,i){da(t,e,a,s,i)},getLabelForValue:function(t,e,a,s){let i=ga(t,e,a,s);return null!==i||t.noManualEntry||(i=Pa(t,e)),i},setValue:function(t,e,a){let s=Ca(t,e,a);e.noManualEntry||(s=s.length>0?s[0]:"",Va(t,e,s))},canBeFiltered:function(t,e){return Na(t,e)},isFiltered:Ba,controlItemOptions:function(t,e){return Da(t,e)},allItemsDisplayed:function(t,e){return Ma(t,e)},hasFilter:Ra}),aa("range",{render:function(t,e,a,s,i){Ea(t,e,0,s,i)},init:function(t,e,a){La(t,e,a)},getLabelForValue:function(t,e){return Pa(t,e)},setValue:function(t,e,a){Va(t,e,a[0])},hasFilter:ja}),aa(ae,{render:function(t,e,a,s,i){const n=e+"_i",r=ya();let l,o=a;switch(s.flexibleOperator&&(t.markup("<div class='a-FS-inputOperator'>"),function(t,e,a,s,i,n){let r=["EQ","NEQ"];switch(s.dataType){case ce:case he:case ue:case pe:case de:r=r.concat(["LT","LTE","GT","GTE"]);break;case oe:r=r.concat(["STARTS","NSTARTS","C","NC"]);break;default:throw new Error(`${Bt}${s.dataType}`)}n?(sa(t,void 0,!1,s,ke("INPUT_OPERATOR")),r.forEach((function(s,i){na(t,`${e}_${i}`,"irg",`${R} ${a}`,{d:ke(`INPUT_OPERATOR.${s}`),r:s,order:i},!0,!1,!1)})),ia(t)):(t.markup(`<select class="selectlist apex-item-select ${a}" size="1" aria-required="true" value=""`).attr(bt,e).optionalAttr("step",s.step).optionalAttr(Ft,ke("INPUT_OPERATOR")).markup(">"),r.forEach((e=>{t.markup("<option").optionalAttr("selected",e===s.operator?"true":"").attr("value",e).markup(">").content(ke(`INPUT_OPERATOR.${e}`)).markup("</option>")})),t.markup("</select>"))}(t,n+"fo","a-FS-inputOperatorValue",s,0,i),t.markup("</div>")),t.markup("<div class='a-FS-input'>"),s.inputLabel&&(l=n+"_lbl",o+=" "+l,t.markup("<span").attr(bt,l).markup(' class="a-FS-inputLabel">').content(s.inputLabel).markup(Ot)),s.suffixText&&(l=n+"_lbls",o+=" "+l),s.dataType){case he:case ue:case pe:case de:Fa(t,n,C,s,i,l,r);break;case ce:_a(t,n,C,s,l,r);break;case oe:!function(t,e,a,s,i){const n=s?null:i;t.markup('<input type="text" value=""').attr("class",`apex-item-text ${a}`).attr(bt,e).optionalAttr(vt,s).optionalAttr(Ft,n).markup(">")}(t,n,C,l,r);break;default:throw new Error(`${Bt}${s.dataType}`)}s.suffixText&&t.markup("<span").attr(bt,l).markup(" class='a-FS-inputSuffix'>").content(s.suffixText).markup(Ot),ba(t,s),t.markup(Tt)},init:function(e,a,s,n){const r=Ia(a)?e.find(".a-FS-inputValue")[0]?._wrappedElement$:e.find(b),l=e.find(b),o=e.find(".a-FS-inputOperatorValue");let c="keyup change";function h(t,e,i=!1){let n=[];t&&n.push(t),n.push(Re(e,a)),s(a,n,i)}a.flexibleOperator&&(n?o.on("keydown",(t=>{const s=r.val();ha(t,a,!0),t.which===fe.ENTER&&""!==s&&h(Ha(e,n,a.flexibleOperator),s)})).on(Vt,(t=>{const s=r.val();ua(t,!0),""!==s&&h(Ha(e,n,a.flexibleOperator),s,!0)})).on("keyup change",(t=>{const s=i(t.target),n=e.find(".apex-item-radio");let r;s.prop("checked")&&(r=s.val()),r&&(Ca(n,a,[r]),oa(e,a))})):o.on(Lt,t.debounce((()=>{const t=r.val(),s=Oa(l,a);""!==t&&s&&h(Ha(e,n,a.flexibleOperator),t,!0)}),400))),Ia(a)&&(c=Lt),e.find(".a-FS-input").on(c,(()=>{const t=r.val(),s=""!==t,i=Oa(l,a);a._noCtrlApply?!a._complete&&i&&h(Ha(e,n,a.flexibleOperator),t,!0):xa(a)?e.closest(`.${ct}`).find(`.${U}`).prop(At,!s||!i):e.find(`.${U}`).attr(At,!s||!i)})).on("keydown",se,(function(t){const s=r.val(),i=t.which;if(i===fe.ENTER&&t.preventDefault(),i===fe.ENTER||i===fe.ESCAPE&&a._complete){Oa(l,a)&&h(Ha(e,n,a.flexibleOperator),s,!0)}})),e.find(`.${U}`).on(Vt,(function(){const t=r.val();h(Ha(e,n,a.flexibleOperator),t,!0)}))},getLabelForValue:function(t,e,s){let i;if(t.currentLabel&&t.currentLabel!==ge){if(i=t.currentLabel,!i.includes("%0"))throw new Error(`Current label attribute of the ${t.name} facet must include %0.`)}else i=`${ge}_${s||t.operator}`;return Ia(t)?a.formatMessageNoEscape(i,Aa(Ne(e,t))):a.formatMessage(i,Aa(Ne(e,t)))},controlItemOptions:function(t,e){return Da(t,e)},setValue:function(t,e,a,s){const i=t.find(b);if(e.flexibleOperator){let i=a;Array.isArray(a)?(i=a[0]||e.operator,a=a.pop()):(i=(a=a.split(Xt))[0],a=a[1]),function(t,e,a,s){const i=t.find(".a-FS-inputOperatorValue"),n=t.find(".apex-item-radio");s=s.split(Xt)[0]||e.operator,a?(Ca(n,e,[s]),oa(n,e)):i.val(s)}(t,e,s,i)}Array.isArray(a)&&(a=a[0]||""),a=Ne(a,e),i.val(a),t.find(`.${U}`).attr(At,""===a)},hasFilter:ja}),aa("starRating",{render:function(e,s,i,n){var r,l,o,c,h,u,p=n.values.length;if(n.multiple=!1,n.escape=!1,n.checkedFirst=n.disabledLast=!1,""===n.maxSuffixText&&(n.maxSuffixText=" "),n.activeIcon)for(r=0;r<p;r++){for(o=n.values[r],c="<span class='star-rating-stars' aria-hidden='true'>",h=n.activeColor||"red",u=n.activeIcon,l=0;l<p;l++){if(l>=o.r){if(u=n.inactiveIcon||u,!n.inactiveColor)break;h=n.inactiveColor}c+="<span class='"+t.escapeHTMLAttr(u)+"' style='color:"+t.escapeHTMLAttr(h)+";'></span>"}c+=o.r<p?n.suffixText||"":n.maxSuffixText||n.suffixText||"",c+="</span><span class='u-vh'>"+a.formatMessage(o.r<p?n.itemLabel:n.maxItemLabel||n.itemLabel,o.r)+Ot,o.d=c}ra(e,s,i,n)},init:function(t,e,a){pa(t,e,a)},update:function(t,e,a,s,i){da(t,e,a,s,i)},getLabelForValue:function(t,e){return a.formatMessage(e<t.values.length?t.itemLabel:t.maxItemLabel||t.itemLabel,e)},setValue:function(t,e,a){Ca(t,e,a)},hasFilter:ja,useGetlabelForCharts:!0}),aa("selectList",{render:function(t,e,a,s){var i,n,r,l=null,o=s.values;function c(e,a){t.markup("<option").attr("value",a).markup(">").content(e).markup("</option>")}for(r="selectlist apex-item-select",s.hideEmpty&&(r+=" a-FS--hideEmpty"),t.markup(`<div class='a-FS-selectListFilter'><select aria-labelledby='${a}'`).attr(_t,r).markup(">"),c(s.nullLabel,""),i=0;i<o.length;i++)(n=o[i]).g&&n.g!==l&&(l&&t.markup("</optgroup>"),l=n.g,t.markup("<optgroup").attr("label",n.g).markup(">")),c(n.d,n.r);l&&t.markup("</optgroup>"),t.markup("</select></div>")},init:function(e,a,s){const n=t.debounce((function(){s(a,[i(this).val()])}),400);e.find(".apex-item-select").on(Lt,n)},update:function(e,a,s,i){var n,r,l,o,c,h=s.values;for(n=0;n<h.length;n++)l=i[(r=h[n]).r]||0,o=e.find("option[value='"+t.escapeCSS(r.r)+"']"),c=s.hasFeedback&&0===l,s.showCounts&&o.text(r.d+(l>0?" ("+l+")":"")),o.toggleClass(q,c)},getLabelForValue:function(t,e){return ga(t,e)},setValue:function(t,e,a){a=a.length>0?a[0]:"",t.find(".apex-item-select").val(a)},hasFilter:ja})}(apex.util,apex.debug,apex.lang,apex.locale,apex.jQuery,apex.date,apex.item,apex.message,apex.widget);