/*!
 Copyright (c) 2022, Oracle and/or its affiliates.
 */
((e,t,a,i,r,n)=>{"use strict";t.share=async e=>{const r="sql_query",s=null!==e.action.attribute01?n.applyTemplate(e.action.attribute01):null;let o={text:n.applyTemplate(e.action.attribute02)};s&&(o.title=s);const l=t=>{if(t.startsWith("r/")){t=e.action.attribute09+t}return t.startsWith("http")||(t=window.location.origin+t),t},c=async a=>{try{await navigator.share(a),t.resume(e.resumeCallback,!1)}catch(a){i.warn(a),t.resume(e.resumeCallback,!0)}},u=async e=>{(e=new URL(l(e))).searchParams.delete("session"),e=e.href,o.url=e,await c(o)},p=async(a,n)=>{let s=[];for(const e of a){let t,a,i;n===r?(t=`data:${e.mimetype};base64,${e.blob}`,a=e.filename,i=e.mimetype):(t=e,a=new URL(l(t)).pathname.split("/").pop());const o=await fetch(t),c=await o.blob();s.push(new File([c],a,{type:i||c.type,lastModified:(new Date).getTime()}))}navigator.canShare({files:s})?(o.files=s,await c(o)):(i.error("Those files cannot be shared."),t.resume(e.resumeCallback,!0))};if(navigator.canShare){const i=e.action.attribute03;if("current_page"===i)await u(window.location.href);else if("url"===i){u(e.action.attribute04)}else if("files"===i){const i=e.action.attribute05;if("file_url"===i){const t=e.action.attribute06?.split(/\r?\n/);p(t,i)}else if(i===r){const r=e.action.attribute08;a.plugin(e.action.ajaxIdentifier,{pageItems:r},{async:!e.action.waitForResult,loadingIndicator:"body",loadingIndicatorPosition:"page",success:e=>{p(e,i)},error:(a,i,r)=>{t.handleAjaxErrors(a,i,r,e.resumeCallback)}})}}}else i.warn("Web share is not supported on this device."),t.resume(e.resumeCallback,!0)},e((()=>{navigator.canShare||(t.initDaEventList(),t.gEventList.forEach((e=>e.actionList.forEach((t=>{"BUTTON"===e.triggeringElementType&&"NATIVE_SHARE"===t.action&&r(e.triggeringButtonId).hide()})))))}))})(apex.jQuery,apex.da,apex.server,apex.debug,apex.item,apex.util);