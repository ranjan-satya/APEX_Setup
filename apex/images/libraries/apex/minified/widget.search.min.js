/*!
 * Copyright (c) 2022, 2023, Oracle and/or its affiliates. All rights reserved.
 */
!function(e,t,n,s,a){"use strict";const r="search",i="a-SearchResults",o=i+"-count",l=i+"-list",u=i+"-item",c=i+"-emptySearch",d=i+"-noData",h=i+"-pagination",g=i+"-pageNav",p=g+"--prev",f=g+"--next",m="a-Icon",_=i+"-pageRange",P="u-vh",$="a-Button";function E(e){return n.getMessage(e)}function v(e,...t){return n.formatMessage(e,...t)}s.widget("apex.search",{widgetEventPrefix:r,options:{regionId:null,regionStaticId:null,ajaxIdentifier:null,lazyLoading:!1,itemsToSubmit:null,externalPageItem:null,ajaxFetchWhenNoQuery:!1,usesOverallSort:!1,searchAsYouType:!1,minCharacters:0,showResultCount:!1,resultCountSelector:null,noQueryEnteredMessage:null,resultsPerPage:null,overrideNoDataFoundMessage:null},_create:function(){let n=this.options,i=this.element,o=this;t.trace(`Search Region '${i[0].id}' created. Options: `,n),this._super(),a.create(n.regionStaticId,(function(e){e.type="Search",e.widgetName=r,e.widget=function(){return i},e.refresh=function(){o._refetch()},apex.widget.util.makeInterfaceFromWidget(e,i,r,["openConfig"],["ajaxIdentifier","regionStaticId"])})),0===n.minCharacters&&(n.minCharacters=1),o.pagination={firstRow:1},o._searchItem=apex.item(n.externalPageItem),o._searchItem$=s("#"+e.escapeCSS(n.externalPageItem)),o._render(),o._addEventHandlers(),o._refetch()},_getItemValue:function(){return this._searchItem.getValue().trim()},_destroy:function(){this._removeEventHandlers(),this.element.removeClass(i).empty()},_render:function(){let e,t=this.options,n=this.element,a=n.find("."+l);e=t.showResultCount&&!t.resultCountSelector?s(`<div class="${o}" aria-live="polite"></div>`):s(`<div class="${o} ${P}" aria-live="polite"></div>`),0===a.length&&(a=s(`<ol class="${l}"></ol>`),n.html(a)),e.insertBefore(a),this._setResultsCount("0")},_refetch:function(){let e,t=this.options,n=this.element,s=this._getItemValue();s.length>0?this._fetch(s):t.ajaxFetchWhenNoQuery?this._fetch():t.lazyLoading?t.noQueryEnteredMessage&&n.find("."+l).empty().append(`<li class="${c}">${E(t.noQueryEnteredMessage)}</li>`):(e=`gSearch${t.regionId}data`,window[e]?.configs?.length>0?this._renderResults(window[e]):t.noQueryEnteredMessage&&n.find("."+l).empty().append(`<li class="${c}">${E(t.noQueryEnteredMessage)}</li>`))},_reset:function(){this._render()},_addEventHandlers:function(){let t,n=this,a=this.options,r=this.pagination;a.searchAsYouType?n._searchItem$.on("keyup",e.debounce((function(){r.firstRow=1,t=this.value.trim(),t.length>=a.minCharacters?n._fetch(t):t.length<=0&&a.ajaxFetchWhenNoQuery?n._fetch():n._clear()}),400)):n._searchItem$.on("keypress",(function(e){13===e.which&&(r.firstRow=1,t=this.value.trim(),t.length>0?n._fetch(t):t.length<=0&&a.ajaxFetchWhenNoQuery?n._fetch():n._clear(),e.preventDefault())})),a.resultsPerPage&&(s(document).on("click","button."+p,e.debounce((function(){s(this).attr("aria-controls")===a.regionStaticId&&(r.firstRow-=a.resultsPerPage,s(this).attr("disabled",!0),n._fetch(n._getItemValue(),(function(){s(this).attr("disabled",!1)})))}),20)),s(document).on("click","button."+f,e.debounce((function(){s(this).attr("aria-controls")===a.regionStaticId&&(r.firstRow+=a.resultsPerPage,s(this).attr("disabled",!0),n._fetch(n._getItemValue(),(function(){s(this).attr("disabled",!1)})))}),20)))},_removeEventHandlers:function(){this._searchItem$.off("keyup keypress"),s(document).off("click","button."+g)},_clear:function(){let e=this.options,t=this.element,n=t.find("."+l),s=t.find("."+h);e.noQueryEnteredMessage?n.empty().append(`<li class="${c}">${E(e.noQueryEnteredMessage)}</li>`):n.html(""),s.remove(),this._setResultsCount("0")},_setResultsCount:function(e){let n,a=this.options,r=this.element,i=parseInt(e,10);isNaN(i)?(t.error("Number of results obtained is not a valid number",e),i=0):n=1===i?E("APEX.SEARCH.1_RESULT_FOUND"):v("APEX.SEARCH.N_RESULTS_FOUND",i),a.resultCountSelector&&a.resultCountSelector.length>0?s(a.resultCountSelector).empty().append(i):r.find("."+o).text(n)},_fetch:function(e,t){let n,s=this,a=s.options,r=s.pagination.firstRow,i={action:"SEARCH"};return s.element.trigger("apexbeforerefresh"),e&&e.length>0&&(i.query=e),a.resultsPerPage&&(i.firstRow=r,i.maxRows=a.resultsPerPage),n=apex.server.plugin(a.ajaxIdentifier,{pageItems:a.itemsToSubmit,x02:JSON.stringify(i)},{dataType:"json",queue:{name:"perform_search_"+a.regionStaticId,action:"replace"}}),n.done((e=>{this._renderResults(e)})),n.always((()=>{s.element.trigger("apexafterrefresh"),t&&t()})),n},_renderResults:function(e){let n=this.options,a=this.element,r=a.find("."+l),i=a.find("."+h),o=this.pagination.firstRow,y=o-1+n.resultsPerPage,S="",I='disabled="disabled"',R=0,b=0,A=0,C=0;r.html(""),i.remove(),e?(n.resultsPerPage?r.attr("start",o):r.removeAttr("start"),e.configs?e.configs.length>0&&e.configs.forEach((function(e){R=0,A+=e.results.length,C+=e.resultsCount?e.resultsCount:0,e.results.every((function(e){return(!n.resultsPerPage||R!==n.resultsPerPage&&b!==n.resultsPerPage)&&(r.append(`<li class="${u}">${e.row}</li>`),R+=1,b+=1,!0)})),0===R&&e.noDataFound&&!n.overrideNoDataFoundMessage&&r.append(`<li class="${d}">${e.noDataFound}</li>`)})):n.usesOverallSort?(C+=e.resultsCount?e.resultsCount:0,e.results.length>0?(A+=e.results.length,b=0,e.results.every((function(e){return(!n.resultsPerPage||b!==n.resultsPerPage)&&(r.append(`<li class="${u}">${e.row}</li>`),b+=1,!0)})),0===b&&e.noDataFound&&!n.overrideNoDataFoundMessage&&(t.trace(e.noDataFound),r.append(`<li class="${d}">${e.noDataFound}</li>`))):e.noDataFound&&!n.overrideNoDataFoundMessage&&r.append(`<li class="${d}">${e.noDataFound}</li>`)):t.error("Invalid JSON output returned from the server",e),0===b&&n.overrideNoDataFoundMessage&&r.append(`<li class="${d}">${n.overrideNoDataFoundMessage}</li>`),this._setResultsCount(C),n.resultsPerPage&&b>0&&(1===o&&A>n.resultsPerPage||o>1)&&(A<=n.resultsPerPage&&(y=o-1+b,S='disabled="disabled"'),a.attr("aria-label",v("APEX.SEARCH.RESULTS_X_TO_Y",o,y)),o>1&&(I=""),s(`<div class="${h}" role="region" aria-label="${E("APEX.SEARCH.PAGINATION")}">\n                                    <button class="${$} ${g} ${p}" type="button" aria-label="${E("APEX.GV.PREV_PAGE")}" title="${E("APEX.GV.PREV_PAGE")}" aria-controls="${n.regionStaticId}" ${I}>\n                                        <span class="${m} icon-prev" aria-hidden="true"></span>\n                                    </button>\n                                    <span class="${_}" title="${E("APEX.GV.PAGE_RANGE")}" aria-live="polite">\n                                        <span class="${P}">${E("APEX.GV.PAGE_RANGE")}</span>\n                                        ${o} - ${y}\n                                    </span>\n                                    <button class="${$} ${g} ${f}" type="button" aria-label="${E("APEX.GV.NEXT_PAGE")}" title="${E("APEX.GV.NEXT_PAGE")}" aria-controls="${n.regionStaticId}" ${S}>\n                                        <span class="${m} icon-next" aria-hidden="true" ></span>\n                                    </button>\n                                </div>`).insertAfter(r))):(t.trace("No results available."),n.noQueryEnteredMessage&&r.append(`<li class="${c}">${E(n.noQueryEnteredMessage)}</li>`)),a.removeClass("is-placeholder").removeAttr("aria-hidden")}})}(apex.util,apex.debug,apex.lang,apex.jQuery,apex.region);