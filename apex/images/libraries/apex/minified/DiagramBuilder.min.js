(()=>{var{mvc:e}=joint,t=class extends e.Listener{constructor(e,t){super(e),this.context=e,this.config=t}startListening(){}trigger(t,...n){e.Events.trigger.call(this,t,...n)}on(){e.Events.on.call(this,...arguments)}off(){e.Events.off.call(this,...arguments)}destroy(){this.stopListening()}},{highlighters:n}=joint,i="cell-highlight-{0}",o=0;function r(e,t={}){const{duration:r=0,...s}=t,a=i.replace("{0}",o);var c;return function(e,t,i){const{deep:o=!0,layer:r="back",padding:s=5,className:a="cell-highlight",attrs:l={stroke:"var(--a-diagram-cell-highlight, orange)","stroke-width":2},...c}=i;n.mask.add(e,{selector:"root"},t,{deep:o,layer:r,padding:s,className:a,attrs:l,...c})}(e,a,s),r>0&&(c=a,setTimeout((()=>l(e,c)),r)),o+=1,a}function s(e,t){l(e,t)}function a(e,t){const n=e.model,i=t.isElement()||t.isLink()?t:n.getCell(t);if(i)return i.findView(e)}function l(e,t){null==t?n.mask.remove(e):n.mask.remove(e,t)}var c={NORMAL:"normal",MANHATTAN:"manhattan",ORTHOGONAL:"orthogonal",RIGHT_ANGLE:"rightAngle",ADVANCED_MANHATTAN:"advancedManhattan",ADVANCED_RIGHT_ANGLE:"advancedRightAngle"};Object.freeze(c);var h=c;function d(e,t,n){return Object.defineProperty(e,t,{configurable:!1,writable:!1,enumerable:!0,value:n})}function g(e,t){const n={};return Object.entries(t).forEach((([e,t])=>{n[e]={configurable:!1,writable:!1,enumerable:!0,value:t}})),Object.defineProperties(e,n)}var{dia:u}=joint,p=class extends u.Element{defaults(){return{...super.defaults,type:"apex.Base"}}initialize(e){super.initialize(...arguments),e?.rtl&&this.changeToRtl(this.attributes.attrs)}changeToRtl(){}text(){}glyph(e=""){return arguments.length?this.attr("glyph/text",e):this.attr("glyph/text")}glyphColor(e="#ffffff"){return arguments.length?this.attr("glyph/fill",e):this.attr("glyph/fill")}isReadOnly(){return!0===this.prop("readOnly")}allow(e){const t=`allow${e.charAt(0).toUpperCase()}${e.slice(1)}`;return!1!==this.get(t)}hasMenu(){return!1!==this.get("hasMenu")}isSelectable(){return!1!==this.get("selectable")}statusIcon(e=""){return arguments.length?(e=null==e?"":e,this.attr("statusIcon/text",e)):this.attr("statusIcon/text")}statusIconColor(e="#000000"){return arguments.length?this.attr("statusIcon/fill",e):this.attr("statusIcon/fill")}};g(p,{ALLOW_LINK_OUT:"linkOut",ALLOW_LINK_IN:"linkIn",ALLOW_REMOVE:"remove",ALLOW_TYPE_CHANGE:"typeChange",ALLOW_TEXT_CHANGE:"textChange",ALLOW_GLYPH_CHANGE:"glyphChange"});var{shapes:E}=joint,f=class extends E.standard.Link{static getLabelCfg(e="",t={}){const{position:n={}}=t,{distance:i=.5,offset:o=0}=n;let{cls:r=""}=t;return r&&(r=Array.isArray(r)?r:r.split(" ")),{cls:r,markup:[{tagName:"rect",selector:"body"},{tagName:"text",selector:"label"}],attrs:{label:{text:e,textWrap:{width:150,height:100,ellipsis:!0},fill:"var(--a-diagram-label-text-color, #000)",fontFamily:"var(--a-diagram-label-font-family, sans-serif)",fontSize:"var(--a-diagram-label-font-size, 12px)",textAnchor:"middle",yAlignment:"middle",pointerEvents:"none"},body:{ref:"label",fill:"var(--a-diagram-label-background-color, #aaa)",width:"calc(w + 10)",height:"calc(h + 6)",x:"calc(w / -2 - 5)",y:"calc(h / -2 - 3)",rx:5}},position:{distance:i,offset:o}}}static getLabelTextPath(){return"attrs/label/text"}static getLinkDesignationCfg(e={}){const{glyph:t="",distance:n=.5,designation:i,tooltip:o="",tooltipPosition:r="bottom"}=e;let{cls:s=""}=e;s&&(s=Array.isArray(s)?s:s.split(" "));const a={designation:i,cls:s,markup:[{tagName:"circle",selector:"body"},{tagName:"text",selector:"label"}],attrs:{label:{text:t,fontFamily:"apex-5-icon-font",fontSize:"var(--a-diagram-link-icon-font-size, 14px)",textAnchor:"middle",yAlignment:"middle",pointerEvents:"none",fill:"var(--a-diagram-link-icon-text-color, #fff)"},body:{ref:"label",fill:"var(--a-diagram-link-icon-background-color, #666)",r:13,cx:0,cy:0}},position:{distance:n}};return o&&(a.attrs["."]={"data-tooltip":o,"data-tooltip-position":r}),a}isReadOnly(){return!0===this.prop("readOnly")}allow(e){const t=`allow${e.charAt(0).toUpperCase()}${e.slice(1)}`;return!1!==this.get(t)}hasMenu(){return!1!==this.get("hasMenu")}isSelectable(){return!1!==this.get("selectable")}removeVertex(e,t){const n=this.vertices();e=isFinite(e)&&null!==e?0|e:-1;const i=n.splice(e,1),o=this.vertices(n,t);return this.trigger("remove:vertex",this,i[0],e),o}};function m(e){return"number"==typeof e.x&&"number"==typeof e.y&&2===Object.keys(e).length}function L(e){return Object.assign(e,{left:e.x,right:e.x+e.width,top:e.y,bottom:e.y+e.height})}g(f,{ALLOW_SOURCE_CHANGE:"sourceChange",ALLOW_TARGET_CHANGE:"targetChange",ALLOW_LABEL_CHANGE:"labelChange",ALLOW_DESGINATION_CHANGE:"designationChange",ALLOW_REMOVE:"remove"});var{dia:y}=joint;function O(e,t,n){return e.getElements().find((e=>e.get(t)===n))}function C(e,t){return O(e,"id",t)}function N(e,t,n){return e.getLinks().find((e=>e.get(t)===n))}function T(e,t){return N(e,"id",t)}function _(e,t){return function(e,t,n){return e.getCells().find((e=>e.get(t)===n))}(e,"id",t)}function b(e,t){return e.getElements().find((e=>{const{x:n,y:i}=e.position();return n===t.x&&i===t.y}))}function R(e,t){return null==t?null:"string"==typeof t?T(e,t)||null:t instanceof y.Link?t:null!=t.id&&T(e,t.id)||null}function k(e,t){return null==t?null:"string"==typeof t?_(e,t)||null:t instanceof y.Link||t instanceof y.Element?t:null!=t.id&&_(e,t.id)||null}function A(e,t){return t.map((t=>k(e,t))).filter((e=>null!=e))}function w(e={},t){const{name:n="topLeft",args:i={}}=e,{dx:o="50%",dy:r="50%"}=i,s=(()=>{let{x:e,y:i}=t;switch(n){case"topRight":e+=t.width;break;case"modelCenter":e+=t.width/2,i+=t.height/2;break;case"top":e+=t.width/2;break;case"bottom":e+=t.width/2,i+=t.height;break;case"left":i+=t.height/2;break;case"right":e+=t.width,i+=t.height/2;break;case"bottomLeft":i+=t.height;break;case"bottomRight":e+=t.width,i+=t.height}return{x:e,y:i}})();return"number"==typeof o?{x:s.x+o,y:s.y+r}:{x:s.x+Math.round(parseFloat(o)/100*t.width),y:s.y+Math.round(parseFloat(r)/100*t.height)}}var{g:v}=joint;function x(e,t,n={}){const{padding:i=0,animation:o=!0,strict:r=!0,center:s=!0}=n,{paper:a}=e.options,l=L(e.getVisibleArea()),c=l.center();let{x:h,y:d}=c;if(t.isElement()){const n=t.getBBox();L(n),e.isElementVisible(t,{strict:r})||(s?e.scrollToElement(t,{animation:o}):(n.x<l.x+i?h=h+(n.x-l.x)-i:n.right>l.right-i&&(h=h+n.right-l.right+i),n.y<l.y+i?d=d+(n.y-l.y)-i:n.bottom>l.bottom-i&&(d=d+n.bottom-l.bottom+i),e.scroll(h,d,{animation:o})))}else{const{ratio:r=0}=n,c=t.findView(a);a.requireView(c);const g=c.getPointAtRatio(r),{x:u,y:p}=g;e.isPointVisible(g,i)||(s?e.scrollToLink(t,{animation:o}):(u<l.x+i?h=h+(u-l.x)-i:u>l.right-i&&(h=h+u-l.right+i),p<l.y+i?d=d+(p-l.y)-i:p>l.bottom-i&&(d=d+p-l.bottom+i),e.scroll(h,d,{animation:o})))}}function P(e,t=[]){e.freeze(),t.forEach((t=>{t.findView(e).requestConnectionUpdate()})),e.unfreeze()}function I(e){P(e,e.model.getLinks())}function D(e){const t=h,n=e.model,i=e.options.defaultRouter.name,o=i===t.MANHATTAN||i===t.ADVANCED_MANHATTAN,r=n.getLinks().filter((e=>{const n=e.router()?.name;return!(null!=n||!o)||(n===t.MANHATTAN||n===t.ADVANCED_MANHATTAN)}));r.length&&P(e,r)}function S(e,t,n=.5){const i=e.paper,o=i.model,r=e.model,s=t.model,{x:a,y:l}=t.getPointAtRatio(n),c=s.vertices(),h=s.target(),d=s.source();let g=r.getBBox();if(h.id===r.id||d.id===r.id)return;i.freeze();const u=v.Point(a-g.width/2,l-g.height/2).snapToGrid(i.options.gridSize);r.position(u.x,u.y);let p=c.map((e=>({vertex:e,ratio:t.getClosestPointRatio(e)})));s.target(r);const E=i.getDefaultLink();E.source(r),E.target(h),o.addCell(E),i.requireView(r),g=r.getBBox(),p=p.filter((e=>!g.containsPoint(e.vertex))),E.vertices(p.filter((e=>e.ratio>n)).map((e=>e.vertex))),s.vertices(p.filter((e=>e.ratio<=n)).map((e=>e.vertex))),i.unfreeze()}function M(e,t){(t=R(e,t))&&function(e,t,n){if(t=R(t,e),!t)return;const i=t.label(n);i?.designation&&(n=1);t.removeLabel(n)}(t,0,e)}function V(e,t){e[Array.isArray(t)?"removeCells":"removeCell"](t)}function G(e=[]){let t=(e=Array.isArray(e)?e:[e]).every((e=>e.allow(p.ALLOW_REMOVE)&&!e.isReadOnly()));if(t){const n=[];t=e.every((t=>{const{graph:i}=t;return i.getConnectedLinks(t).every((t=>{if(n.includes(t.id))return!0;n.push(t.id);const i=t.getSourceElement(),o=t.getTargetElement(),r=!!i&&e.includes(i),s=!!o&&e.includes(o);return!t.isReadOnly()&&(!(!r||!s)||!(r&&(t.prop("requireSourceElement")||!t.allow(f.ALLOW_SOURCE_CHANGE)))&&!(s&&(t.prop("requireTargetElement")||!t.allow(f.ALLOW_TARGET_CHANGE))))}))}))}return t}function B(e=[]){return(e=Array.isArray(e)?e:[e]).every((e=>!e.isReadOnly()&&e.allow(f.ALLOW_REMOVE)))}var H=/(top|bottom|center)?(right$|left$|center$)?/i,U={mPosition(){if(!Object.hasOwn(this.options,"position"))return;let e,t;const[,n="center",i="center"]=H.exec(this.options.position);switch(n.toLowerCase()){case"top":t=0;break;case"bottom":t="100%";break;default:t="50%"}switch(i.toLowerCase()){case"left":e=0;break;case"right":e="100%";break;default:e="50%"}this.options.x=e,this.options.y=t}},{elementTools:K,util:z}=joint,W=class extends K.Connect{preinitialize(){super.preinitialize(...arguments),this.name="connect-button",this.events={mousedown:"mousedown",mouseup:"mouseup",mouseleave:"mouseleave"},this.documentEvents={mousemove:"drag",touchmove:"drag",mouseup:"dragend",touchend:"dragend",touchcancel:"dragend"},this.children=[{tagName:"circle",selector:"button",attributes:{r:10,fill:"var(--a-diagram-button-background-color, #eee)",stroke:"var(--a-diagram-button-border-color, #666)",cursor:"pointer"}},{tagName:"text",selector:"label",textContent:"",attributes:{"font-family":"apex-5-icon-font","dominant-baseline":"central","text-anchor":"middle","pointer-events":"none",fill:"#666",stroke:"none",style:"user-select: none"}}]}constructor(){super(...arguments),Object.assign(this,U)}onRender(){this.mPosition(),super.onRender()}mousedown(e){this.isMouseDown=!0,e.stopPropagation()}mouseup(e){const{position:t,x:n,y:i}=this.options;this.isMouseDown=!1,this.relatedView.notify("element:connectbutton:pointerup",this,t,{x:n,y:i},e)}mouseleave(e){this.isMouseDown&&!this.isDragging&&this.dragLinkStart(e)}dragLinkStart(e){const{paper:t,relatedView:n}=this,i=z.normalizeEvent(e),{x:o,y:r}=t.clientToLocalPoint(i.clientX,i.clientY);this.isDragging=!0,n.dragLinkStart(i,this.getMagnetNode(),o,r,this.options.position),t.undelegateEvents(),this.delegateDocumentEvents(null,i.data),this.focus()}dragend(e){const{linkView:t}=this.relatedView.eventData(e),{model:n}=t;if(this.isMouseDown=!1,this.isDragging=!1,super.dragend(e),n.hasLoop()){const{position:e}=this.options,t=n.target().anchor,i={},o={},r={},s=this.relatedView.model.getBBox(),a=w(t,s),l=30;let c;switch(e){case"top":c=this.getTargetSide(t,s,"horizontal"),i.x=s.x+s.width/2,i.y=o.y=s.y-l,o.x=r.x="right"===c?s.x+s.width+l:s.x-l,r.y=a.y;break;case"bottom":c=this.getTargetSide(t,s,"horizontal"),i.x=s.x+s.width/2,i.y=o.y=s.y+s.height+l,o.x=r.x="right"===c?s.x+s.width+l:s.x-l,r.y=a.y;break;case"left":c=this.getTargetSide(t,s,"vertical"),i.x=o.x=s.x-l,i.y=s.y+s.height/2,o.y=r.y="top"===c?s.y-l:s.y+s.height+20,r.x=a.x;break;default:c=this.getTargetSide(t,s,"vertical"),i.x=o.x=s.x+s.width+l,i.y=s.y+s.height/2,o.y=r.y="top"===c?s.y-l:s.y+s.height+20,r.x=a.x}n.vertices([i,o,r])}}getTargetSide(e,t,n){if("vertical"===n){const{dy:n}=e.args;return("string"==typeof n?parseFloat(n)>=50:n>=t.y+t.height/2)?"bottom":"top"}const{dx:i}=e.args;return("string"==typeof i?parseFloat(i)>=50:i>=t.x+t.width/2)?"right":"left"}},{elementTools:F}=joint,j=class e extends F.Button{preinitialize(){super.preinitialize(...arguments),this.name="menu-button",this.children=e.MARKUP_SHAPE_ELEMENT}constructor(){super(...arguments),Object.assign(this,U)}onRender(){this.mPosition(),super.onRender(...arguments)}onPointerDown(e){super.onPointerDown(...arguments),this.relatedView.notify("cell:menubutton:pointerdown",this,e)}};d(j,"MARKUP_SHAPE_ELEMENT",[{tagName:"rect",selector:"button",attributes:{width:20,height:20,x:-10,y:-10,rx:3,fill:"var(--a-diagram-element-menu-button-background-color, #fff)",cursor:"pointer","user-select":"none"}},{tagName:"text",selector:"label",textContent:"",attributes:{"font-family":"apex-5-icon-font","font-size":14,"dominant-baseline":"central","text-anchor":"middle","pointer-events":"none",fill:"var(--a-diagram-element-menu-button-text-color, #666)",stroke:"none",style:"user-select: none"}}]),d(j,"MARKUP_TERMINATOR_ELEMENT",[{tagName:"circle",selector:"button",attributes:{r:10,fill:"var(--a-diagram-element-terminator-menu-button-background-color, #eee)",stroke:"var(--a-diagram-element-terminator-menu-button-border-color, #666)",cursor:"pointer"}},{tagName:"text",selector:"label",textContent:"",attributes:{"font-family":"apex-5-icon-font","dominant-baseline":"central","text-anchor":"middle","pointer-events":"none",fill:"var(--a-diagram-element-terminator-menu-button-text-color, #666)",stroke:"none",style:"user-select: none"}}]),d(j,"MARKUP_LINK",[{tagName:"circle",selector:"button",attributes:{r:10,fill:"var(--a-diagram-link-menu-button-background-color, #eee)",stroke:"var(--a-diagram-link-menu-button-border-color, #666)",cursor:"pointer"}},{tagName:"text",selector:"label",textContent:"",attributes:{"font-family":"apex-5-icon-font","dominant-baseline":"central","text-anchor":"middle","pointer-events":"none",fill:"var(--a-diagram-link-menu-button-text-color, #666)",stroke:"none",style:"user-select: none"}}]);var{linkTools:Y,util:q}=joint,$=class extends Y.Button{preinitialize(){super.preinitialize(...arguments),this.name="add-element-button",this.events={mousedown:"onPointerDown",touchstart:"onPointerDown",mouseup:"onPointerUp",touchend:"onPointerUp",touchcancel:"onPointerUp"},this.children=[{tagName:"circle",selector:"button",attributes:{r:15,fill:"var(--a-diagram-link-placeholder-background-color, #666)",stroke:"var(--a-diagram-link-placeholder-border-color, none)",cursor:"pointer"}},{tagName:"text",selector:"label",textContent:"",attributes:{"font-family":"apex-5-icon-font","font-size":20,"dominant-baseline":"central","text-anchor":"middle","pointer-events":"none",fill:"var(--a-diagram-link-placeholder-text-color, #fff)",stroke:"none",x:0,style:"user-select: none"}}]}onRender(){super.onRender(),this.showOffsetConnector()}onRemove(){super.onRemove(),this.hideOffsetConnector()}show(){super.show(),this.showOffsetConnector()}hide(){super.hide(),this.hideOffsetConnector()}onPointerDown(e){super.onPointerDown(e),this.relatedView.notify("link:addelement:pointerdown",this,this.getLinkPoint(),e)}onPointerUp(e){this.relatedView.notify("link:addelement:pointerup",this,this.getLinkPoint(),e)}getLinkPoint(){const e=this.relatedView,{model:t}=e,n=t.offsetConnectorRatio(),i=null==n?t.offsetConnectorLength():null;return null!=n?e.getPointAtRatio(n):e.getPointAtLength(i)}showOffsetConnector(){const{toggleOffsetConnector:e=!1,offset:t=-30,distance:n="50%"}=this.options,{relatedView:i}=this,{model:o}=i;if(e){q.isPercentage(n)?o.offsetConnectorRatio(parseFloat(n)/100,t):o.offsetConnectorLength(n,t),i.showOffsetConnector()}}hideOffsetConnector(){const{toggleOffsetConnector:e=!1}=this.options,{relatedView:t}=this;e&&t.hideOffsetConnector()}},{linkTools:Z}=joint,X=class extends Z.SourceArrowhead{preinitialize(){super.preinitialize(...arguments);this.tagName="rect",this.attributes={x:-7,y:-7,width:14,height:14,rx:4,fill:"#33334F",stroke:"#FFFFFF","stroke-width":2,cursor:"move",class:"source-arrowhead"}}onPointerDown(e){super.onPointerDown(e),this.relatedView.notifyPointerdown(...arguments),this.relatedView.notify("link:arrowhead:pointerdown",this,this.ratio,e)}onPointerUp(e){super.onPointerUp(e),this.relatedView.notify("link:arrowhead:pointerup",this,this.ratio,e)}},{linkTools:J}=joint,Q=class extends J.TargetArrowhead{onPointerDown(e){super.onPointerDown(e),this.relatedView.notifyPointerdown(...arguments),this.relatedView.notify("link:arrowhead:pointerdown",this,this.ratio,e)}onPointerUp(e){super.onPointerUp(e),this.relatedView.notify("link:arrowhead:pointerup",this,this.ratio,e)}},{linkTools:ee}=joint,te=class extends ee.SourceAnchor{onPointerUp(e){super.onPointerUp(e);const{relatedView:t}=this;t.notify("link:anchor:pointerup",this,"source",t.model.prop(["source","anchor"]),e)}},{linkTools:ne}=joint,ie=class extends ne.TargetAnchor{onPointerUp(e){super.onPointerUp(e);const{relatedView:t}=this;t.notify("link:anchor:pointerup",this,"target",t.model.prop(["target","anchor"]),e)}},{V:oe}=joint;function re(){return!!navigator.userAgent.match(/Version\/[\d.]+.*Safari/)}var{util:se}=joint,ae="var(--a-diagram-element-font-family, sans-serif)",le="var(--a-diagram-element-font-size, 14px)",ce=!0;function he(e){return"string"==typeof e&&e.includes("calc")}var de=class e extends p{static attributes={"text-wrap":{qualify:se.isPlainObject,set:function(t,n,i,o){const r={},s=t.width||0;if(se.isPercentage(s))r.width=n.width*parseFloat(s)/100;else{if(he(s))throw new Error("(text-wrap: width) calc attribute is not implemented");null===t.width?r.width=1/0:r.width=s<=0?n.width+s:s}const a=t.height||0;if(se.isPercentage(a))r.height=n.height*parseFloat(a)/100;else{if(he(a))throw new Error("(text-wrap: height) calc attribute is not implemented");null===t.height||(r.height=a<=0?n.height+a:a)}let l,c=t.text;if(void 0===c&&(c=o.text),void 0!==c){l=(t.breakText||se.breakText)(""+c,r,{"font-weight":o["font-weight"],"font-size":o["font-size"],"font-family":o["font-family"],lineHeight:o["line-height"],"letter-spacing":o["letter-spacing"]},{svgDocument:this.paper.svg,ellipsis:t.ellipsis,hyphen:t.hyphen,separator:t.separator,maxLineCount:t.maxLineCount,preserveSpaces:t.preserveSpaces})}else l="";e.getAttributeDefinition("text").set.call(this,l,n,i,o)}}};preinitialize(){super.preinitialize(...arguments),this.padding=10,this.markup=[{tagName:"rect",selector:"body"},{tagName:"g",selector:"decoration",children:[{tagName:"path",selector:"decorationBackground"},{tagName:"path",selector:"decorationPattern"},{tagName:"text",selector:"glyph"}]},{tagName:"text",selector:"label"},{tagName:"text",selector:"statusIcon"}],Object.defineProperty(this,"safari",{value:re(),enumerable:!0})}initialize(){super.initialize(...arguments),this.on("change",this.onAttributeChange),this.sizeText(this.attr("label/text"))}measureText(e,t){return function(e,t,n){const i=oe("text").attr(n).text(t);i.appendTo(e);const o=i.getBBox();return i.remove(),o}(document.querySelector("svg"),e,t)}onAttributeChange(e,{propertyPath:t,propertyValue:n}){"attrs/label/text"===t&&this.sizeText(n)}sizeText(e){const t=se.breakText(e,{width:this.attr("label/textWrap/width")},{"font-size":le,"font-family":ae},{ellipsis:ce,maxLineCount:3}),{width:n,height:i}=this.size(),{height:o}=this.measureText(t,{"font-size":le,"font-family":ae});let r=o+2*this.padding<60?60:10*Math.ceil(o/10)+2*this.padding;r%20>0&&(r+=r%20);const s=this.safari?Math.round(r/2):Math.round((r-o)/2);this.attr("label/y",s),i!==r&&this.resize(n,r)}defaults(){const t=e.CORNER_RADIUS,n=60,i=this.safari;return{...super.defaults(),type:"apex.Shape",size:{width:220,height:60},attrs:{body:{fill:"var(--a-diagram-element-background-color, #fff)",x:26,rx:t,ry:t,width:"calc(w - 26)",height:"calc(h)"},decoration:{transform:"translate(0 calc(h / 2 - 30))"},decorationBackground:{width:n,height:n,rx:t,ry:t,fill:"var(--a-diagram-element-icon-background-color, #aaa)"},decorationPattern:{width:n,height:n,rx:t,ry:t,fill:"none"},glyph:{ref:"decorationBackground",text:"",fontFamily:"apex-5-icon-font",fontSize:24,x:"calc(w / 2)",y:"calc(h / 2)",textAnchor:"middle",...!i&&{dominantBaseline:"central"},...i&&{textVerticalAnchor:"middle"},fill:"var(--a-diagram-element-icon-color, #000)"},statusIcon:{text:"",fontFamily:"apex-5-icon-font",fontSize:16,width:"calc(h)",x:"calc(w - 4)",y:4,textAnchor:"end",...!i&&{dominantBaseline:"text-before-edge"},...i&&{textVerticalAnchor:"top"},fill:"#000000"},label:{...!i&&{dominantBaseline:"text-before-edge"},...i&&{textVerticalAnchor:"middle"},textAnchor:"start",text:"",textWrap:{width:140,ellipsis:ce,maxLineCount:3},x:70,fontSize:le,fontFamily:ae,fill:"var(--a-diagram-element-text-color, #333)"}}}}changeToRtl(e){e.body.x=0,e.decoration.transform="translate(calc(w - 60) calc(h / 2 - 30))",e.statusIcon.x=4,e.label.x=150}text(e=""){return arguments.length?this.attr("label/text",e):this.attr("label/text")}decorationBackgroundColor(e){return arguments.length?this.attr("decorationBackground/fill",e):this.attr("decorationBackground/fill")}decorationPattern(e){return arguments.length?this.attr("decorationPattern/fill",e):this.attr("decorationBackground/fill")}};g(de,{CORNER_RADIUS:6});var{dia:ge,V:ue}=joint,pe="var(--a-diagram-link-placeholder-border-color, none)",Ee="var(--a-diagram-link-placeholder-background-color, #666)",fe="var(--a-diagram-link-placeholder-text-color, #fff)",me=class extends ge.ToolView{preinitialize(){super.preinitialize(...arguments),this.name="placeholder",this.events={mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",mousedown:"onPointerDown",mouseup:"onPointerUp"},this.radius=15,this.tagName="g",this.children=[{tagName:"circle",selector:"button",attributes:{r:this.radius,cx:0,fill:Ee,stroke:pe,cursor:"pointer","user-select":"none"}},{tagName:"text",selector:"label",textContent:"",attributes:{"font-family":"apex-5-icon-font","font-size":20,"dominant-baseline":"central","text-anchor":"middle","pointer-events":"none",fill:fe,stroke:"none",x:0,style:"user-select: none"}}],this.options={scale:null}}constructor(e){super(),Object.assign(this.options,e)}onRender(){this.renderChildren(),this.update()}update(){const{ratio:e,translate:t}=this,n=this.relatedView,i=n.getTangentAtRatio(e),{scale:o}=this.options;let r;if(i){if(r=i.start,t){const e=i.end.x-i.start.x,n=i.end.y-i.start.y,s=Math.sqrt(Math.pow(e,2)+Math.pow(n,2)),a=e/s,l=n/s*this.radius*(o||1),c=a*this.radius*(o||1);r.x+=c*t,r.y+=l*t}}else r=n.getPointAtRatio(e);let s=ue.createSVGMatrix().translate(r.x,r.y);return o&&(s=s.scale(o)),this.vel.transform(s,{absolute:!0}),this}setColors({stroke:e,fill:t,glyph:n,reset:i=!1}={}){const{button:o,label:r}=this.childNodes;i?this.resetColors():(e&&o.setAttribute("stroke",e),t&&o.setAttribute("fill",t),n&&r.setAttribute("fill",n))}resetColors(){this.setColors({stroke:pe,fill:Ee,glyph:fe})}getLinkPoint(){return this.relatedView.getPointAtRatio(this.ratio)}onMouseEnter(e){this.relatedView.notify("link:placeholder:mouseenter",this,this.ratio,this.getLinkPoint(),e)}onMouseLeave(e){this.relatedView.notify("link:placeholder:mouseleave",this,this.ratio,this.getLinkPoint(),e)}onPointerDown(e){this.guard(e)||this.relatedView.notify("link:placeholder:pointerdown",this,this.ratio,this.getLinkPoint(),e)}onPointerUp(e){this.guard(e)||this.relatedView.notify("link:placeholder:pointerup",this,this.ratio,this.getLinkPoint(),e)}},Le=class extends me{preinitialize(){super.preinitialize(...arguments),this.name="source-placeholder",this.ratio=0,this.translate=-1}},ye=class extends me{preinitialize(){super.preinitialize(...arguments),this.name="target-placeholder",this.ratio=1,this.translate=1}},{linkTools:Oe}=joint,Ce=class extends Oe.Boundary{preinitialize(){this.attributes={fill:"none",stroke:"var(--a-diagram-cell-selection, #333)","stroke-width":.5,"stroke-dasharray":"5, 5","pointer-events":"none"}}},{linkTools:Ne,util:Te}=joint,_e=class extends Ne.Vertices{#e;onHandleWillChange(e,t){this.focus();const{relatedView:n,options:i}=this,[o,r,s]=n.paper.getPointerArgs(t);n.model.startBatch("vertex-move",{ui:!0,tool:this.cid}),this.eventData(t).vertexAdded||(this.#e={...n.model.vertex(e.options.index)}),i.stopPropagation||n.notifyPointerdown(o,r,s)}onHandleChanged(e,t){const{options:n,relatedView:i}=this,{model:o}=i;let r=!0;if(n.vertexAdding&&this.updatePath(),!n.redundancyRemoval)return void i.checkMouseleave(Te.normalizeEvent(t));const s=o.vertex(e.options.index);if(i.removeRedundantLinearVertices({ui:!0,tool:this.cid})&&this.render(),this.blur(),i.model.stopBatch("vertex-move",{ui:!0,tool:this.cid}),this.eventData(t).vertexAdded){i.model.stopBatch("vertex-add",{ui:!0,tool:this.cid});-1===o.vertices().findIndex((e=>e.x===s.x&&e.y===s.y))&&(r=!1)}const[a,l,c]=i.paper.getPointerArgs(t);if(r){const{x:t,y:n}=s,{x:o,y:r}=this.#e||{};i.notify("link:vertexhandle:pointerup",this,e,{x:t,y:n},{x:o,y:r},a,l,c)}this.#e=null,n.stopPropagation||i.notifyPointerup(a,l,c),i.checkMouseleave(a)}},{linkTools:be,util:Re}=joint,ke=class extends be.Segments{#t;onHandleChangeStart(e,t){const{relatedView:n}=this,{model:i}=n;this.#t={vertices:i.vertices(),source:Re.cloneDeep(i.source()),target:Re.cloneDeep(i.target())},super.onHandleChangeStart(e,t)}onHandleChangeEnd(e,t){const{relatedView:n}=this,{model:i}=n;super.onHandleChangeEnd(e,t);const[o,r,s]=n.paper.getPointerArgs(t),a=this.#t,l={vertices:i.vertices(),source:i.source(),target:i.target()},c=[],h={},d={};(l.vertices.length!==a.vertices.length||l.vertices.length&&!Re.isEqual(l.vertices,a.vertices))&&c.push("vertices"),Re.isEqual(l.source,a.source)||c.push("source"),Re.isEqual(l.target,a.target)||c.push("target"),c.forEach((e=>{h[e]=l[e],d[e]=a[e]})),this.#t=null,n.notify("link:segmenthandle:pointerup",this,e,h,d,o,r,s)}},{dia:Ae}=joint,we=Object.freeze({BOUNDARY:"boundary",VERTICES:"vertices",SOURCE_PLACEHOLDER:"source-placeholder",TARGET_PLACEHOLDER:"target-placeholder",SOURCE_ARROWHEAD:"source-arrowhead",TARGET_ARROWHEAD:"target-arrowhead",SOURCE_ANCHOR:"source-anchor",TARGET_ANCHOR:"target-anchor",SEGMENTS:"segments",MENU_BUTTON:"menu-button",REMOVE_BUTTON:"remove-button",ADD_ELEMENT_BUTTON:"add-element-button"}),ve=Object.freeze({LINK_HOVERED:"link-hovered",LINK_SELECTED:"link-selected"}),xe=(Object.freeze({CONNECT:"connect-button",MENU_BUTTON:"menu-button"}),Object.freeze({ELEMENT_SELECTED:"element-selected",ELEMENT_SELECTED_HOVERED:"element-selected-hovered",ELEMENT_HOVERED:"element-hovered"})),Pe="link-placeholders",Ie={[we.BOUNDARY]:0,[we.VERTICES]:10,[we.SOURCE_PLACEHOLDER]:20,[we.TARGET_PLACEHOLDER]:30,[we.SOURCE_ARROWHEAD]:40,[we.TARGET_ARROWHEAD]:50,[we.SOURCE_ANCHOR]:60,[we.TARGET_ANCHOR]:70,[we.SEGMENTS]:80,[we.MENU_BUTTON]:90,[we.ADD_ELEMENT_BUTTON]:100},De=Object.freeze({[xe.ELEMENT_SELECTED_HOVERED]:(e,t)=>{const n=e.allow(p.ALLOW_LINK_OUT),i=[];return e.hasMenu()&&i.push(new j({...He(e),markup:Ue(e),scale:Me})),!t&&n&&i.push(new W({position:"top",scale:Me}),new W({position:"right",scale:Me}),new W({position:"bottom",scale:Me}),new W({position:"left",scale:Me})),i},[xe.ELEMENT_SELECTED]:(e,t)=>{const n=e.allow(p.ALLOW_LINK_OUT),i=[];return e.hasMenu()&&i.push(new j({...He(e),markup:Ue(e),scale:Me})),!t&&n&&i.push(new W({position:"top",scale:Me}),new W({position:"right",scale:Me}),new W({position:"bottom",scale:Me}),new W({position:"left",scale:Me})),i},[xe.ELEMENT_HOVERED]:(e,t)=>{const n=e.allow(p.ALLOW_LINK_OUT),i=[];return e.hasMenu()&&i.push(new j({...He(e),markup:Ue(e),scale:Me})),!t&&n&&i.push(new W({position:"top",scale:Me}),new W({position:"right",scale:Me}),new W({position:"bottom",scale:Me}),new W({position:"left",scale:Me})),i}}),Se=Object.freeze({[ve.LINK_SELECTED]:(e,t)=>{const{model:n,paper:i}=e,o=n.hasMenu(),r=[new Ce({padding:6*Me})];return t||(n.allow(f.ALLOW_SOURCE_CHANGE)&&r.push(new X({scale:Me})),n.allow(f.ALLOW_TARGET_CHANGE)&&r.push(new Q({scale:Me}),new $({scale:Me,offset:-30,distance:"50%",toggleOffsetConnector:!0})),n.router()?.name!==h.NORMAL&&i.options.defaultRouter.name!==h.NORMAL||r.push(new ke({scale:Me,stopPropagation:!0})),o&&r.push(new j({offset:20,distance:-30,markup:Ue(n),scale:Me})),r.push(new _e({scale:Me,stopPropagation:!0}),new te({scale:Me,snap:Be}),new ie({scale:Me,snap:Be}))),r},[ve.LINK_HOVERED]:(e,t)=>{const{model:n}=e,i=[];return t||(i.push(new _e({scale:Me,vertexAdding:!1,stopPropagation:!0})),n.allow(f.ALLOW_SOURCE_CHANGE)&&i.push(new X({scale:Me})),n.allow(f.ALLOW_TARGET_CHANGE)&&i.push(new Q({scale:Me}))),i}}),Me=1;function Ve(e=[]){return e.sort(((e,t)=>(Ie[e.name]||0)-(Ie[t.name]||0))),e}function Ge(e,t,n){const{model:i}=e;if(null==i.graph)return;const o=new Ae.ToolsView({name:t,tools:n});e.addTools(o)}function Be(e,t,n,i,o,r){const s=r.options.snapRadius,a=e=>Math.round(e/s)*s;return e.x=a(e.x),e.y=a(e.y),e}function He(e){const t=e.get("rtl");return e instanceof de?{x:t?12:"calc(w - 12)",y:"calc(h - 12)"}:{x:t?"15%":"85%",y:"85%"}}function Ue(e){return e.isElement()?e instanceof de?j.MARKUP_SHAPE_ELEMENT:j.MARKUP_TERMINATOR_ELEMENT:j.MARKUP_LINK}function Ke(e){const{model:t}=e;if($e(e,we.SOURCE_PLACEHOLDER)||!t.allow(f.ALLOW_SOURCE_CHANGE))return;const n=$e(e,we.TARGET_PLACEHOLDER);e.hasTools(ve.LINK_HOVERED)?Ge(e,ve.LINK_HOVERED,Ve([...Se[ve.LINK_HOVERED](e),new Le({scale:Me}),...n?[new ye({scale:Me})]:[]])):e.hasTools(ve.LINK_SELECTED)?Ge(e,ve.LINK_SELECTED,Ve([...Se[ve.LINK_SELECTED](e),new Le({scale:Me}),...n?[new ye({scale:Me})]:[]])):Ge(e,Pe,Ve([new Le({scale:Me}),...n?[new ye({scale:Me})]:[]]))}function ze(e){if(!$e(e,we.SOURCE_PLACEHOLDER))return;const t=$e(e,we.TARGET_PLACEHOLDER);e.hasTools(ve.LINK_HOVERED)?Ge(e,ve.LINK_HOVERED,Ve([...Se[ve.LINK_HOVERED](e),...t?[new ye({scale:Me})]:[]])):e.hasTools(ve.LINK_SELECTED)?Ge(e,ve.LINK_SELECTED,Ve([...Se[ve.LINK_SELECTED](e),...t?[new ye({scale:Me})]:[]])):Ge(e,Pe,Ve([...t?[new ye({scale:Me})]:[]]))}function We(e){const{model:t}=e;if($e(e,we.TARGET_PLACEHOLDER)||!t.allow(f.ALLOW_TARGET_CHANGE))return;const n=$e(e,we.SOURCE_PLACEHOLDER);e.hasTools(ve.LINK_HOVERED)?Ge(e,ve.LINK_HOVERED,Ve([...Se[ve.LINK_HOVERED](e),new ye({scale:Me}),...n?[new Le({scale:Me})]:[]])):e.hasTools(ve.LINK_SELECTED)?Ge(e,ve.LINK_SELECTED,Ve([...Se[ve.LINK_SELECTED](e),new ye({scale:Me}),...n?[new Le({scale:Me})]:[]])):Ge(e,Pe,Ve([new ye({scale:Me}),...n?[new Le({scale:Me})]:[]]))}function Fe(e){if(!$e(e,we.TARGET_PLACEHOLDER))return;const t=$e(e,we.SOURCE_PLACEHOLDER);e.hasTools(ve.LINK_HOVERED)?Ge(e,ve.LINK_HOVERED,Ve([...Se[ve.LINK_HOVERED](e),...t?[new Le({scale:Me})]:[]])):e.hasTools(ve.LINK_SELECTED)?Ge(e,ve.LINK_SELECTED,Ve([...Se[ve.LINK_SELECTED](e),...t?[new Le({scale:Me})]:[]])):Ge(e,Pe,Ve([...t?[new Le({scale:Me})]:[]]))}function je(e,t,n=!1){if(!Se[t]||e.hasTools(t))return;const i=$e(e,we.SOURCE_PLACEHOLDER),o=$e(e,we.TARGET_PLACEHOLDER);Ge(e,t,Ve([...Se[t](e,n),...i?[new Le({scale:Me})]:[],...o?[new ye({scale:Me})]:[]]))}function Ye(e,t,n=!1){De[t]&&!e.hasTools(t)&&Ge(e,t,De[t](e.model,n))}function qe(e,t=!0){const{model:n}=e;if(n.isElement()||!t)e.removeTools();else{if(!(e.hasTools(ve.LINK_SELECTED)||e.hasTools(ve.LINK_HOVERED)))return;const t=$e(e,we.SOURCE_PLACEHOLDER),n=$e(e,we.TARGET_PLACEHOLDER);t||n?Ge(e,Pe,[...t?[new Le({scale:Me})]:[],...n?[new ye({scale:Me})]:[]]):e.removeTools()}}function $e(e,t){return!!e._toolsView?.tools.some((e=>e.name===t))}function Ze(e,t){return e._toolsView?.tools.find((e=>e.el.contains(t)))}function Xe(e,t){return e._toolsView?.tools.find((n=>t(e,n)))}var{ui:Je}=joint;function Qe(e,t={}){const{width:n,closeButton:i=!1,duration:o=2e3,target:r,foregroundContainerCls:s}=t,a={delay:o,duration:200,properties:{opacity:0}};e=function(e=""){return e.replace(/</g,"&lt;").replace(/>/g,"&gt;")}(e),Je.FlashMessage.close();const l=new Je.FlashMessage({openAnimation:{duration:0},closeAnimation:a,closeButton:i,width:n,content:e});if(l.open(r),s?.length){const e=Array.isArray(s)?s:s.split(" ");l.el.querySelector(".fg").classList.add(...e)}}var et={STR_ZOOM_LEVEL:"zoomLevel"};Object.freeze(et);var tt,nt=et,it={left:"right",right:"left",top:"bottom",bottom:"top"},ot=160,rt="allow-drop",st=class extends t{#n;startListening(){const{graph:e,paper:t,stencil:n,paperScroller:i,navigator:o}=this.context;Object.assign(this.context,{allowDropConnectOnElement:()=>{},allowDropConnectOnLink:()=>{},allowDropConnectOnPlaceholder:()=>{},...this.context}),this.stopListening(),this.listenTo(t,{"blank:pointerdown":Mt,"cell:mouseenter":vt,"cell:mouseleave":St,"link:pointerup":yt,"link:placeholder:mouseenter":It,"link:placeholder:mouseleave":Dt,"link:placeholder:pointerup":Pt,"link:placeholder:pointerdown":xt,"element:pointerdown":ht,"element:pointerup":dt,scale:ct}),this.listenTo(e,{readonly:at,reset:mt,add:Nt,remove:Tt,beforeremove:_t,"change:position":Rt,"change:size":kt,"change:designation":Lt,"change:source":Ot,"change:target":Ct}),this.listenTo(n,{"element:dragstart":gt,"element:drop":Et,"element:dragend":pt,"element:drag":ut}),this.listenTo(o,{visibility:lt}),this.maybeCancelDrag=this.maybeCancelDrag.bind(this),document.addEventListener("keydown",this.maybeCancelDrag,!0),this.#n=new ResizeObserver((()=>{o.updateCurrentView()})),this.#n.observe(i.el)}maybeCancelDrag(e){const{stencil:t,stencilDraggedView:n}=this.context;n&&"Escape"===e.key&&(e.stopImmediatePropagation(),t.cancelDrag())}useKeyboard(e){const{paper:t,readOnly:n,hoveredView:i,selection:o}=this.context,{collection:r}=o,s=1===r.length?r.at(0):null,a=i?i.model:null,l=a&&s===a;if(this.context.usingKeyboard=e,e){if(i&&!l&&qe(i),s){const e=s.isElement(),n=s.findView(t),i=e?xe.ELEMENT_SELECTED_HOVERED:ve.LINK_SELECTED;c=i,n.hasTools(c)||(e?Ye(n,i):je(n,i))}}else s&&s.isElement()&&s!==a&&qe(s.findView(t)),i&&(a.isElement()?Ye(i,l?xe.ELEMENT_SELECTED_HOVERED:xe.ELEMENT_HOVERED,n||a.isReadOnly()):je(i,l?ve.LINK_SELECTED:ve.LINK_HOVERED,n||a.isReadOnly()));var c}destroy(){super.destroy(),this.#n.unobserve(this.context.paperScroller.el),document.removeEventListener("keydown",this.maybeCancelDrag)}};function at(e,t){const{graph:n,paper:i,paperScroller:o}=e;e.readOnly=t,n.getLinks().forEach((e=>{const n=e.findView(i);n&&(t?(ze(n),Fe(n)):e.isReadOnly()||(e.getSourceCell()||Ke(n),e.getTargetCell()||We(n)))})),o.adjustPaper()}function lt(e,t){const{navigator:n}=e,i="visible"===t;e.navigatorVisible=i,i&&I(n.targetPaper)}function ct(e,t){const{locale:n,style:i,el:o}=e;Qe(`${n[nt.STR_ZOOM_LEVEL].replaceAll("{0}",10*Math.round(10*t))}`,{foregroundContainerCls:i.toastForegroundContainerCls,target:o})}function ht(e,t){e.paperDraggedElementView=t}function dt(e){e.paperDraggedElementView=null}function gt(e,t){e.stencilDraggedView=t}function ut(e,t,n){const{hoveredView:i,dropConnectOnElements:o}=e;if(i){if(!e.hoveredView.model.isElement()||!o||!1===Bt(e,i,t))return;wt(e,n)}}function pt(e){e.stencilDraggedView=null}function Et(e,t,n,i,o,r,a){const{paper:l,graph:c,dropConnectOnElements:h,dropConnectOnLinks:d,snaplines:g}=e;if(!r||r.model.isReadOnly())return;const{model:u}=t,{model:p}=r;if(null!=tt&&s(r,tt),!p.isElement()||h&&!1!==Bt(e,r,t,!0)){if(p.isLink()){if(a instanceof me){if(!1===Ht(e,r,t,a,!0))return}else if(!d||!1===Gt(e,r,t,!0))return}if(p.isElement()){const{x:e,y:n}=p.position(),s=ft(p,i-e,o-n),{x:a,y:h}=p.position(),{width:d,height:g}=p.size(),{width:E,height:f}=u.size();let m=a,L=h;switch(s){case"left":m=a-ot-E,L=h+(g-f)/2;break;case"right":m=a+p.size().width+ot,L=h+(g-f)/2;break;case"bottom":m=a+(d-E)/2,L=h+p.size().height+ot;break;default:m=a+(d-E)/2,L=h-ot-f}u.position(m,L);const y=l.getDefaultLink();y.set({source:r.getLinkEnd(r.el,i,o,y,"source",s),target:t.getLinkEnd(t.el,i,o,y,"target",it[s])}),c.addCell(y)}else{const e=Ze(r,n.target);if(Vt(e)){const n=e.ratio;0===n?p.source(u):1===n?p.target(u):S(t,r,n)}else{const e=r.getClosestPointRatio({x:i,y:o});S(t,r,e)}}g.enable()}}function ft(e,t,n){const{width:i,height:o}=e.size(),r=o*t/i,s=o-r;return["left","right","top","bottom"][t<0||i<=t||n<0||o<=n?-1:n<r?n<s?2:1:n<s?0:3]||"out"}function mt(e,{models:t=[]}){const{paper:n,readOnly:i}=e;e.hoveredView=null,i||t.forEach((e=>{e.isLink()&&!e.isReadOnly()&&bt(n,e)}))}function Lt(e,t,n){const{linkDesignations:i,style:o}=e,r=t.labels().findIndex((e=>"designation"in e));if(r>-1&&null==n)t.removeLabel(r);else if(n){let e,s,a;"object"==typeof n?({typeId:e,tooltip:s,tooltipPosition:a}=n):e=n;const l=i.find((t=>t.typeId===e));if(l){const n=f.getLinkDesignationCfg({distance:30,glyph:l.glyph,designation:e,tooltip:s,tooltipPosition:a,cls:o.linkDesignationCls||[]});r>-1?t.label(r,n):t.insertLabel(0,n)}else t.designation(null)}}function yt(e,t,n){const{action:i,arrowhead:o}=t.eventData(n);if("arrowhead-move"===i){const{model:e}=t;"source"===o?e.getSourceCell()?$e(t,we.SOURCE_PLACEHOLDER)&&ze(t):Ke(t):e.getTargetCell()?$e(t,we.TARGET_PLACEHOLDER)&&Fe(t):We(t)}}function Ot(e,t){const{paper:n,readOnly:i}=e,o=t.findView(n),r=o._dragData?.action;"arrowhead-move"===r||i||(t.getSourceCell()?$e(o,we.SOURCE_PLACEHOLDER)&&ze(o):Ke(o))}function Ct(e,t){const{paper:n}=e,i=t.findView(n),o=i._dragData?.action;"arrowhead-move"!==o&&(t.getTargetCell()?$e(i,we.TARGET_PLACEHOLDER)&&Fe(i):We(i))}function Nt(e,t,n,{ui:i}){const{paper:o,readOnly:r,elementProps:s={},linkProps:a={}}=e,l=t.isElement()?s:a;for(let e in l)if(Object.hasOwn(l,e)){void 0===t.prop(e)&&t.prop(e,s[e])}t.isElement()?At(e):i||r||t.isReadOnly()||bt(o,t)}function Tt(e,t){e.hoveredView&&e.hoveredView.model===t&&(e.hoveredView=null)}function _t(e,t){const{graph:n}=e;if(t.isElement()){const e=t.get("onRemoveKeepOutboundLinks"),i=t.get("onRemoveKeepInboundLinks");e&&n.getConnectedLinks(t,{outbound:!0}).forEach((function(e){const n=w(e.source().anchor,t.getBBox());e.source(n)})),i&&n.getConnectedLinks(t,{inbound:!0}).forEach((function(e){const n=w(e.target().anchor,t.getBBox());e.target(n)}))}}function bt(e,t){const n=t.getSourceCell(),i=t.getTargetCell(),o=t.findView(e);n||Ke(o),i||We(o)}function Rt(e){At(e)}function kt(e){At(e)}function At({paper:e,navigator:t,navigatorVisible:n}){D(e),t&&n&&D(t.targetPaper)}function wt(e,t){const n=e.hoveredView,{model:i}=n,{paper:o}=e,{x:r,y:s}=o.clientToLocalPoint(t.clientX,t.clientY),{x:a,y:l}=i.position();n.el.dataset.dropConnectSide=ft(i,r-a,s-l)}function vt(e,t,n){const{selection:i,readOnly:o,dropConnectOnElements:s,dropConnectOnLinks:a,stencilDraggedView:l,snaplines:c,usingKeyboard:h,style:d}=e,{collection:g}=i,{model:u,el:p}=t,E=1===g.length&&g.has(u);if(e.hoveredView!==t&&(o&&(u.isElement()?p.style="cursor: default":p.querySelector('[joint-selector="wrapper"]').style="cursor: default"),e.hoveredView=t,!h)){if(d.hoverCls?.length&&!l){const{hoverCls:e}=d;p.classList.add(...Array.isArray(e)?e:e.split(" "))}if(u.isElement())s&&l&&!u.isReadOnly()&&!1!==Bt(e,t,l)&&(tt=r(t),wt(e,n),c.disable(),c.hide()),l||Ye(t,E?xe.ELEMENT_SELECTED_HOVERED:xe.ELEMENT_HOVERED,o||u.isReadOnly());else{if(!u.isReadOnly()){!Vt(Ze(t,n.target))&&a&&l&&!1!==Gt(e,t,l)&&(tt=r(t),c.disable(),c.hide())}l||je(t,E?ve.LINK_SELECTED:ve.LINK_HOVERED,o||u.isReadOnly())}}}function xt(e,t,n,i,o,r){r.stopPropagation()}function Pt(e,t,n,i){const{paperDraggedElementView:o}=e,r=t.model;o&&!1!==Ht(e,t,o,n,!0)&&(0===i?r.source(o.model):1===i?r.target(o.model):S(o,t,i))}function It(e,t,n,i,o,r){const{paper:a,dropConnectOnLinks:l,stencilDraggedView:c,paperDraggedElementView:h,snaplines:d}=e,{relatedTarget:g}=r,u=a.findView(g),p=c||h;p&&!1!==Ht(e,t,p,n)&&(n.el.classList.add(rt),n.setColors({stroke:"var(--a-diagram-link-placeholder-highlight-border-color, none)",fill:"var(--a-diagram-link-placeholder-highlight-background-color, orange)",glyph:"var(--a-diagram-link-placeholder-highlight-text-color, #000)"})),l&&u&&u===t&&c&&(s(u,tt),d.enable())}function Dt(e,t,n,i,o,s){const{paper:a,dropConnectOnLinks:l,hoveredView:c,stencilDraggedView:h,snaplines:d}=e,{relatedTarget:g}=s,u=a.findView(g);n.el.classList.remove(rt),n.resetColors(),l&&u&&u===c&&h&&(tt=r(u),d.disable(),d.hide())}function St(e,t){const{selection:n,readOnly:i,paper:o,dropConnectOnLinks:r,dropConnectOnElements:a,snaplines:l,usingKeyboard:c,style:h}=e,{model:d,el:g}=t,{collection:u}=n,p=1===u.length&&u.has(d);if(i&&(g.style=""),e.hoveredView=null,!c){if(h.hoverCls?.length){const{hoverCls:e}=h;g.classList.remove(...Array.isArray(e)?e:e.split(" "))}d.isElement()&&(a&&(null!=tt&&s(t,tt),l.enable()),qe(t)),d.isLink()&&(r&&(null!=tt&&s(t,tt),l.enable()),p?(o.requireView(d),je(t,ve.LINK_SELECTED,i||d.isReadOnly())):qe(t,!0))}}function Mt(e,t,n,i){const{paperScroller:o,keyboard:r}=e;r.isActive("shift",t)||o.startPanning(t,n,i)}function Vt(e){return e&&(e instanceof Le||e instanceof ye)}function Gt(e,t,n,i=!1){const{readOnly:o,allowDropConnectOnLink:r}=e,s=t.model,a=n.model;return!(o||s.isReadOnly()||!s.allow(f.ALLOW_TARGET_CHANGE)||!a.allow(p.ALLOW_LINK_IN)||!a.allow(p.ALLOW_LINK_OUT))&&r(t,n,i)}function Bt(e,t,n,i=!1){const{readOnly:o,allowDropConnectOnElement:r}=e,s=t.model,a=n.model;return!(o||s.isReadOnly()||!s.allow(p.ALLOW_LINK_OUT)||!a.allow(p.ALLOW_LINK_IN))&&r(t,n,i)}function Ht(e,t,n,i,o=!1){const{readOnly:r,allowDropConnectOnPlaceholder:s}=e,a=t.model,l=n.model,c=i.ratio;if(r||a.isReadOnly())return!1;if(0===c){if(!a.allow(f.ALLOW_SOURCE_CHANGE)||!l.allow(p.ALLOW_LINK_OUT))return!1}else if(1===c){if(!a.allow(f.ALLOW_TARGET_CHANGE)||!l.allow(p.ALLOW_LINK_IN))return!1}else if(!a.allow(f.ALLOW_TARGET_CHANGE)||!l.allow(p.ALLOW_LINK_OUT)||!l.allow(p.ALLOW_LINK_IN))return!1;return s(t,n,i,o)}function Ut(e,t){return e.filter((e=>!t.includes(e)))}var Kt={SINGLE:"single",MULTI:"multi",NONE:"none"};Object.freeze(Kt);var zt=Kt,Wt=["remove","rotate","resize"],Ft=class extends t{startListening(){const{graph:e,selection:t,paper:n}=this.context,{collection:i}=t;this.context.hoveredView=null,this.stopListening(),this.listenTo(e,{readonly:this.#i,remove:jt}),this.listenTo(i,{reset:Zt,add:qt,remove:$t}),this.listenTo(n,{"blank:pointerdown":Qt,"cell:pointerup":Jt,"cell:mouseenter":this.#o,"cell:mouseleave":this.#r})}#i(e,t){e.readOnly=t}#o(e,t){e.hoveredView=t}#r(e){e.hoveredView=null}};function jt(e,t){const{selection:n}=e,{collection:i}=n;i.has(t)&&i.remove(t)}function Yt(e){const{selection:t}=e,{collection:n}=t,i=n.models.some((e=>e.isElement()&&e.isReadOnly()));t.options.allowTranslate=!i}function qt(e,t,n){const{paper:i,selection:o}=e;if(1===n.length){const t=n.first();en(e,i.requireView(t))}else n.length>1&&(Xt(i,n.models),tn(e,o,e.multiSelectionHandles,Wt));o.trigger("change",o,{added:Array.isArray(t)?t:[t],removed:[]}),Yt(e)}function $t(e,t,n){const{paper:i,selection:o}=e;if(1===n.length){const t=n.first();en(e,i.requireView(t))}o.trigger("change",o,{added:[],removed:Array.isArray(t)?t:[t]}),Yt(e)}function Zt(e,t,{previousModels:n}){const{paper:i,selection:o}=e,r=t.models,s=n,a=Ut(r,s),l=Ut(s,r);if(1===t.length){const n=t.first(),r=i.requireView(n);n.isLink()&&o.destroySelectionBox(n),en(e,r)}else t.length>1&&tn(e,o,e.multiSelectionHandles,Wt);(a.length||l.length)&&(Xt(i,l),o.trigger("change",o,{added:a,removed:l}),Yt(e))}function Xt(e,t=[]){(t=Array.isArray(t)?t:[t]).forEach((t=>{t.isElement()?qe(e.findViewByModel(t)):qe(e.findViewByModel(t),!0)}))}function Jt(e,t,n){const{model:i}=t,{selection:o,keyboard:r,mode:s}=e,{collection:a}=o,l=i.isLink()||a.find((e=>e.isLink())),c=a.includes(i);i.isSelectable()&&i.graph&&(r.isActive("ctrl meta",n)?s===zt.SINGLE?c?a.reset([]):a.reset([i]):c?a.remove(i):l?a.reset([i]):a.add(i):c||a.reset([i]))}function Qt(e,t,n,i){const{paper:o,paperScroller:r,keyboard:s,selection:a,mode:l}=e;l===zt.MULTI&&s.isActive("shift",t)?a.startSelecting(t):(Xt(o,a.collection.models),a.collection.reset([]),r.startPanning(t,n,i))}function en(e,t){const{hoveredView:n,readOnly:i,paper:o}=e,{model:r}=t;if(r.isElement()){Ye(t,n===t?xe.ELEMENT_SELECTED_HOVERED:xe.ELEMENT_SELECTED,i||r.isReadOnly())}else o.requireView(r),je(t,ve.LINK_SELECTED,i||r.isReadOnly())}function tn(e,t,n,i){Ut(i,n.map((e=>e.name))).forEach((e=>t.removeHandle(e))),n.forEach((n=>{if(function(e,t){return"function"==typeof e.hasHandle?e.hasHandle(t):e.handles?.findIndex((e=>e.name===t))>-1}(t,n.name)){const e=function(e,t){return"function"==typeof e.getHandle?e.getHandle(t):e.handles?.find((e=>e.name===t))}(t,n.name);e.position!==n.position&&t.changeHandle(n.name,{position:n.position})}else t.addHandle({name:n.name,position:n.position}),t.on(`action:${n.name}:pointerdown`,(t=>n.action(e,t)))}))}function nn(e,t,{add:n=!1,scrollTo:i=!1,mode:o,paperScroller:r}={}){if(o===zt.NONE)return;const{collection:s}=e,a=s.models,l=(t=Array.isArray(t)?t:[t]).findIndex((e=>e.isLink()))>-1;if(t.findIndex((e=>e.isElement()))>-1&&l)t=t.filter((e=>e.isElement()));else if(l)return void s.reset([t[0]]);o===zt.SINGLE&&(n=!1,t.length=t.length?1:0),n?1===a.length&&a[0].isLink()?s.reset(t):s.add(t):s.reset(t),i&&r&&!r.isElementVisible(t[0])&&r.scrollToElement(t[0],{animation:!0})}function on(e,t){const{collection:n}=e;t&&t.length?n.remove(t):n.reset([])}var rn={DESELECT:"deselect",CYCLE_UP:"cycleUp",CYCLE_DOWN:"cycleDown",CYCLING_MODE_CHANGE:"cyclingModeChange",CELL_MENU_SHOW:"menuShow",CELL_REMOVE:"cellRemove",SELECTION_MOVE_UP:"selMoveUp",SELECTION_MOVE_DOWN:"selMoveDown",SELECTION_MOVE_LEFT:"selMoveLeft",SELECTION_MOVE_RIGHT:"selMoveRight",PAPER_PAN_UP:"paperPanUp",PAPER_PAN_DOWN:"paperPanDown",PAPER_PAN_LEFT:"paperPanLeft",PAPER_PAN_RIGHT:"paperPanRight",ELEMENT_CONNECT_TOP_TRIGGER:"elConnectUpTrigger",ELEMENT_CONNECT_BOTTOM_TRIGGER:"elConnectDownTrigger",ELEMENT_CONNECT_LEFT_TRIGGER:"elConnectLeftTrigger",ELEMENT_CONNECT_RIGHT_TRIGGER:"elConnectRightTrigger",LINK_PLACEHOLDER_SOURCE_TRIGGER:"linkPlaceholderSourceTrigger",LINK_PLACEHOLDER_TARGET_TRIGGER:"linkPlaceholderTargetTrigger",LINK_ADD_ELEMENT_BUTTON_TRIGGER:"linkAddElementButtonTrigger",ZOOM_IN:"zoomIn",ZOOM_OUT:"zoomOut",ZOOM_RESET:"zoomReset"};Object.freeze(rn);var sn=rn,{g:an}=joint,ln="beforeaction",cn="keyboardCycleIndex",hn=sn,dn={[hn.DESELECT]:function e(t,n){const{keyboardController:i}=t;if(!mn(t,e,n))return;i.setUsingKeyboard(!0),on(t.selection)},[hn.CYCLE_UP]:function e(t,n){const{cellCache:i}=t;i.length>0&&mn(t,e,n)&&Nn(t,"up",n)},[hn.CYCLE_DOWN]:function e(t,n){const{cellCache:i}=t;i.length>0&&mn(t,e,n)&&Nn(t,"down",n)},[hn.CYCLING_MODE_CHANGE]:function e(t,n){const i=un,o=[i.CYCLE_CELLS,i.CYCLE_ELEMENTS,i.CYCLE_LINKS],r=t.cyclingMode||i.CYCLE_CELLS;let s=o.indexOf(r)+1;if(!mn(t,e,n))return;t.keyboardController.setUsingKeyboard(!0),n.preventDefault(),s>=o.length&&(s=0);t.cyclingMode=o[s],On(t),Cn(t)},[hn.CELL_MENU_SHOW]:function e(t,n){const{selection:i,paper:o,keyboardController:r}=t,{collection:s}=i;if(r.setUsingKeyboard(!0),n.preventDefault(),!mn(t,e,n))return;if(1===s.length){const e=s.at(0);if(!e.hasMenu())return;const t=e.findView(o),i=Xe(t,((e,t)=>t instanceof j));i&&(o.requireView(e),t.notify("cell:menubutton:keyboardtrigger",i,n))}},[hn.CELL_REMOVE]:function e(t,n){const{graph:i,selection:o,keyboardController:r}=t,s=o.collection.toArray();if(!mn(t,e,n))return;if(r.setUsingKeyboard(!0),n.preventDefault(),!s.length)return;s[0].isLink()?B(s)&&V(i,s):G(s)&&V(i,s)},[hn.SELECTION_MOVE_UP]:function e(t,n){mn(t,e,n)&&Ln(t,"up",n)},[hn.SELECTION_MOVE_DOWN]:function e(t,n){mn(t,e,n)&&Ln(t,"down",n)},[hn.SELECTION_MOVE_LEFT]:function e(t,n){mn(t,e,n)&&Ln(t,"left",n)},[hn.SELECTION_MOVE_RIGHT]:function e(t,n){mn(t,e,n)&&Ln(t,"right",n)},[hn.PAPER_PAN_UP]:function e(t,n){mn(t,e,n)&&yn(t,"up",n)},[hn.PAPER_PAN_DOWN]:function e(t,n){mn(t,e,n)&&yn(t,"down",n)},[hn.PAPER_PAN_LEFT]:function e(t,n){mn(t,e,n)&&yn(t,"left",n)},[hn.PAPER_PAN_RIGHT]:function e(t,n){mn(t,e,n)&&yn(t,"right",n)},[hn.ELEMENT_CONNECT_TOP_TRIGGER]:function e(t,n){An(t)&&Tn(t,"top",e,n)},[hn.ELEMENT_CONNECT_BOTTOM_TRIGGER]:function e(t,n){An(t)&&Tn(t,"bottom",e,n)},[hn.ELEMENT_CONNECT_LEFT_TRIGGER]:function e(t,n){An(t)&&Tn(t,"left",e,n)},[hn.ELEMENT_CONNECT_RIGHT_TRIGGER]:function e(t,n){An(t)&&Tn(t,"right",e,n)},[hn.LINK_PLACEHOLDER_SOURCE_TRIGGER]:function e(t,n){kn(t)&&_n(t,"source",e,n)},[hn.LINK_PLACEHOLDER_TARGET_TRIGGER]:function e(t,n){kn(t)&&_n(t,"target",e,n)},[hn.LINK_ADD_ELEMENT_BUTTON_TRIGGER]:function e(t,n){kn(t)&&_n(t,"addelementbutton",e,n)},[hn.ZOOM_IN]:function(e,t){const{paperScroller:n,maxZoom:i}=e;t.preventDefault(),n.zoom(.1,{max:i,grid:.1})},[hn.ZOOM_OUT]:function(e,t){const{paperScroller:n,minZoom:i}=e;t.preventDefault(),n.zoom(-.1,{min:i,grid:.1})},[hn.ZOOM_RESET]:function(e,t){const{paperScroller:n}=e;t.preventDefault(),n.zoom(1,{absolute:!0})}},gn=[hn.PAPER_PAN_DOWN,hn.PAPER_PAN_LEFT,hn.PAPER_PAN_RIGHT,hn.PAPER_PAN_UP,hn.ZOOM_IN,hn.ZOOM_OUT,hn.ZOOM_RESET],un=class extends t{#s=!1;startListening(){const{graph:e,keyboard:t,selectionMode:n,map:i={esc:hn.DESELECT,"shift+up shift+right":hn.CYCLE_UP,"shift+down shift+left":hn.CYCLE_DOWN,"shift+F10":hn.CELL_MENU_SHOW,up:hn.SELECTION_MOVE_UP,down:hn.SELECTION_MOVE_DOWN,left:hn.SELECTION_MOVE_LEFT,right:hn.SELECTION_MOVE_RIGHT,w:hn.PAPER_PAN_UP,s:hn.PAPER_PAN_DOWN,a:hn.PAPER_PAN_LEFT,d:hn.PAPER_PAN_RIGHT,i:[hn.ELEMENT_CONNECT_TOP_TRIGGER,hn.LINK_ADD_ELEMENT_BUTTON_TRIGGER],k:[hn.ELEMENT_CONNECT_BOTTOM_TRIGGER,hn.LINK_ADD_ELEMENT_BUTTON_TRIGGER],j:[hn.ELEMENT_CONNECT_LEFT_TRIGGER,hn.LINK_PLACEHOLDER_SOURCE_TRIGGER],l:[hn.ELEMENT_CONNECT_RIGHT_TRIGGER,hn.LINK_PLACEHOLDER_TARGET_TRIGGER],"delete backspace":hn.CELL_REMOVE,"shift+c":hn.CYCLING_MODE_CHANGE,"ctrl+plus meta+plus":hn.ZOOM_IN,"ctrl+minus meta+minus":hn.ZOOM_OUT,"ctrl+0 meta+0":hn.ZOOM_RESET}}=this.context;this.context.cellCache=[],this.context.keyboardController=this,this.stopListening(),this.listenTo(e,{readonly:pn,"add remove reset":En,"change:source change:target":fn});let o={};for(let e in i)if(Object.hasOwn(i,e)){let t=i[e];if(Array.isArray(t)){const i=t.filter((e=>!("none"===n&&!gn.includes(e))&&dn[e])),r=i.length;1===r?o[e]=dn[i[0]]:r>1&&(o[e]=(e,t)=>{i.forEach((n=>dn[n].call(this,e,t)))})}else if(dn[t]){if("none"===n&&!gn.includes(t))continue;o[e]=dn[t]}}"multi"===n&&Object.assign(o,{"keydown:shift":bn,"keyup:shift":Rn}),this.listenTo(t,o),this.useMouse=this.useMouse.bind(this)}setUsingKeyboard(e){this.#s!==e&&(this.#s=e,this.trigger("change:usage",this,e),e&&document.addEventListener("mousemove",this.useMouse))}useMouse(){this.setUsingKeyboard(!1),document.removeEventListener("mousemove",this.useMouse)}destroy(){super.destroy(),document.removeEventListener("mousemove",this.useMouse)}};function pn(e,t){e.readOnly=t}function En(e){On(e),Cn(e)}function fn(e,t){const{paper:n}=e,i=t.findView(n),o=i._dragData?.action;"arrowhead-move"!==o&&Cn(e)}function mn(e,t,n){const{keyboardController:i}=e,o=Object.entries(dn).find((([,e])=>e===t))[0],r={process:!0};return i.trigger(ln,i,o,n,r),!1!==r.process}function Ln(e,t,n){const{selection:i,paper:o,paperScroller:r,keyboardController:s,readOnly:a}=e,{collection:l}=i,c=l.length,h=o.options.gridSize||1;let d=0,g=0;if(s.setUsingKeyboard(!0),n.preventDefault(),!a){switch(t){case"up":g=-h;break;case"down":g=h;break;case"left":d=-h;break;case"right":d=h}if(c){const{models:e}=l;if(!e.some((e=>e.isReadOnly()))){const n=o.scale();i.translateSelectedElements(d,g,{keyboard:!0});const s=i.$selectionWrapper[0];let{left:a=0,top:l=0}=s.style;if(a=parseFloat(a),l=parseFloat(l),s.style.left=`${a+d*n.sx}px`,s.style.top=`${l+g*n.sy}px`,1!==c||r.isElementVisible(e[0],{strict:!1})){const n=an.Rect.fromRectUnion(...e.reduce(((e,t)=>(e.push(t.getBBox()),e)),[])),i=r.getVisibleArea();if(!!!i.intersect(n)){const o=i.center();let s;const{y:a,x:l,width:c,height:h}=n;switch(t){case"up":s=e.filter((e=>{const{y:t,height:n}=e.getBBox();return t+n===a+h}));break;case"down":s=e.filter((e=>{const{y:t}=e.getBBox();return t===a}));break;case"left":s=e.filter((e=>{const{x:t,width:n}=e.getBBox();return t+n===l+c}));break;case"right":s=e.filter((e=>{const{x:t}=e.getBBox();return t===l}))}if(s.length){x(r,s.reduce(((e,t)=>o.distance(t.getBBox().center())<o.distance(e.getBBox().center())?t:e),s[0]),{animation:!1,center:!1})}}}else x(r,e[0],{animation:!1,center:!1})}}}}function yn(e,t,n){const{paper:i,paperScroller:o,keyboardController:r}=e,s=i.options.gridSize||1,a=o.getVisibleArea().center();let l=0,c=0;switch(r.setUsingKeyboard(!0),n.preventDefault(),t){case"up":c=-s;break;case"down":c=s;break;case"left":l=-s;break;case"right":l=s}const h=a.translate(l,c),d=o.zoom();o.scroll(h.x*d,h.y*d)}function On(e){const{graph:t,cyclingMode:n=un.CYCLE_CELLS}=e;let i;switch(n){case un.CYCLE_ELEMENTS:i="getElements";break;case un.CYCLE_LINKS:i="getLinks";break;default:i="getCells"}const o=t[i]().filter((e=>e.isSelectable()));e.cellCache=o.sort(((e,t)=>e.prop(cn)-t.prop(cn)))}function Cn(e){const{graph:t,cyclingMode:n}=e;let i=0;t.getElements().filter((e=>!t.getConnectedLinks(e,{inbound:!0}).length)).forEach((e=>{t.bfs(e,(e=>{n!==un.CYCLE_LINKS?(e.prop(cn,i),i+=1):e.unset(cn,{silent:!0});t.getConnectedLinks(e,{outbound:!0}).forEach((e=>{n!==un.CYCLE_ELEMENTS?(e.prop(cn,i),i+=1):e.unset(cn,{silent:!0})}))}))}))}function Nn(e,t="up",n){const{selection:i,paperScroller:o,cellCache:r,keyboardController:s}=e,{collection:a}=i;let l,c,h=0;if(s.setUsingKeyboard(!0),n.preventDefault(),a.length)for(c=a.reduce(((e,t)=>e.prop(cn)<t.prop(cn)?t:e),a.at(0)),h=r.indexOf(c)+("up"===t?1:-1),h=h>=r.length?0:h<0?h=r.length-1:h;a.has(l=r[h]);)h+=1;l||(l="up"===t?r[0]:r[r.length-1]),nn(i,l),x(o,l)}function Tn(e,t,n,i){const{selection:o,paper:r,keyboardController:s}=e,{collection:a}=o;s.setUsingKeyboard(!0),i.preventDefault();const l=a.at(0),c=l.findView(r),h=Xe(c,((e,n)=>n instanceof W&&n.options.position===t));if(h&&mn(e,n,i)){r.requireView(l);const{position:e,x:t,y:n}=h.options;c.notify("element:connectbutton:keyboardtrigger",h,e,{x:t,y:n},i)}}function _n(e,t,n,i){const{paper:o,selection:r,keyboardController:s}=e;s.setUsingKeyboard(!0),i.preventDefault();const a=r.collection.at(0),l="source"===t?Le:"target"===t?ye:$,c=a.findView(o),h=Xe(c,((e,t)=>t instanceof l));h&&mn(e,n,i)&&(o.requireView(a),"source"===t||"target"===t?c.notify("link:placeholder:keyboardtrigger",h,h.ratio,h.getLinkPoint(),i):c.notify("link:addelement:keyboardtrigger",h,h.getLinkPoint(),i))}function bn(e){const{paperScroller:t}=e;t.setCursor("crosshair")}function Rn(e){const{paperScroller:t}=e;t.setCursor("grab")}function kn({selection:e}){const{collection:t}=e;return 1===t.length&&t.at(0).isLink()}function An({selection:e}){const{collection:t}=e;return 1===t.length&&t.at(0).isElement()}g(un,{CYCLE_LINKS:"cycleLinks",CYCLE_ELEMENTS:"cycleElements",CYCLE_CELLS:"cycleCells"});var wn=class extends de{preinitialize(){super.preinitialize(...arguments),this.markup=[{tagName:"rect",selector:"body"},{tagName:"g",selector:"decoration",children:[{tagName:"circle",selector:"decorationBackground"},{tagName:"circle",selector:"decorationPattern"},{tagName:"text",selector:"glyph"}]},{tagName:"text",selector:"label"},{tagName:"text",selector:"statusIcon"}]}defaults(){const e=super.defaults();return{...e,type:"apex.Circle",attrs:{...e.attrs,decorationBackground:{cx:30,cy:30,r:30,fill:"#aaa"},decorationPattern:{cx:30,cy:30,r:30,fill:"#aaa"}}}}},{dia:vn,g:xn}=joint,Pn=class extends vn.ElementView{initialize(){super.initialize(...arguments);const e=this.model,t=e.prop("typeId"),n=e.get("type").toLowerCase(),[i,o]=n.split(".");let r=e.prop("cls");r=r?Array.isArray(r)?r:r.split(" "):[],r=r.map((e=>e.replaceAll("{0}",i).replaceAll("{1}",o)));const s=this.el,a=s.classList;a.add(`${n.replaceAll(".","-")}-element`),r.length&&a.add(...r);const l=e.get("filters");l?.length&&s.setAttribute("filter",l.reduce(((e,t)=>`${e} url(#${t})`),"")),s.dataset.typeId=t}getChildEl(e){return this.el.querySelector(`[joint-selector="${e}"]`)}drag(e){super.drag(...arguments);const{model:t}=this,{graph:n}=t,{x:i,y:o}=t.position(),r=this.eventData(e),{initialPosition:s,lastPosition:a}=r,l=i-(null!=a?a.x:s.x),c=o-(null!=a?a.y:s.y);if(l||c){n.getConnectedLinks(t).forEach((function(e){const t=e.getSourceElement(),n=e.getTargetElement();t&&t===n&&e.translate(l,c)}))}this.eventData(e,{lastPosition:{x:i,y:o}})}dragLinkStart(e,t,n,i,o){this.model.startBatch("add-link");const r=this.addLinkFromMagnet(t,n,i,o);r.notifyPointerdown(e,n,i),r.eventData(e,r.startArrowheadMove("target",{whenNotAllowed:"remove"})),this.eventData(e,{linkView:r})}addLinkFromMagnet(e,t,n,i){const o=this.paper,r=o.model,s=o.getDefaultLink(this,e);return s.set({source:this.getLinkEnd(e,t,n,s,"source",i),target:{x:t,y:n}}).addTo(r,{async:!1,ui:!0}),s.findView(o)}customizeLinkEnd(e,t,n,i,o,r,s){const{paper:a}=this,{connectionStrategy:l}=a.options;if("function"==typeof l){const c=l.call(a,e,this,t,new xn.Point(n,i),o,r,a,s);if(c)return c}return e}},In=class extends Pn{},Dn=class extends In{},Sn=class extends de{preinitialize(){super.preinitialize(...arguments),this.markup=[{tagName:"rect",selector:"body"},{tagName:"g",selector:"decoration",children:[{tagName:"path",selector:"decorationBackground"},{tagName:"path",selector:"decorationPattern"},{tagName:"text",selector:"glyph"}]},{tagName:"text",selector:"label"},{tagName:"text",selector:"statusIcon"}]}defaults(){const e=super.defaults(),t=de.CORNER_RADIUS,n=`M ${t} 0 L 60 0 L 60 calc(h) L ${t} calc(h) C ${t} calc(h) 0 calc(h) 0 calc(h - ${t}) L 0 ${t} C 0 ${t} 0 0 ${t} 0`;return{...e,type:"apex.Rect",attrs:{...e.attrs,decoration:{height:"calc(h)",width:60},decorationBackground:{...e.attrs.decorationBackground,d:n,fill:"var(--a-diagram-element-rect-background-color, #aaa)"},decorationPattern:{...e.attrs.decorationPattern,d:n}}}}changeToRtl(e){super.changeToRtl(e);const t=60,n=de.CORNER_RADIUS,i=`M 0 0 L ${t-n} 0 C 60 0 60 6 60 6 L 60 calc(h - ${n}) C 60 calc(h) ${t-n} calc(h) ${t-n} calc(h) L 0 calc(h) L 0 0`;e.decoration.transform="translate(calc(w - 60) 0)",e.decorationBackground.d=i,e.decorationPattern.d=i}},Mn=class extends In{},Vn=class extends de{preinitialize(){super.preinitialize(...arguments),this.markup=[{tagName:"rect",selector:"body"},{tagName:"g",selector:"decoration",children:[{tagName:"path",selector:"decorationBackground"},{tagName:"path",selector:"decorationPattern"},{tagName:"text",selector:"glyph"}]},{tagName:"text",selector:"label"},{tagName:"text",selector:"statusIcon"}]}defaults(){const e=super.defaults(),t="M 34.2 1.9 L 58.1 25.8 C 58.1 25.8 62.4 30 58.1 34.2 L 34.2 58.1 C 34.2 58.1 30 62.4 25.8 58.1 L 1.9 34.2 C 1.9 34.2 -2.4 30 1.9 25.8 L 25.8 1.9 C 25.8 1.9 30 -2.4 34.2 1.9";return{...e,type:"apex.Diamond",attrs:{...e.attrs,decorationBackground:{...e.attrs.decorationBackground,d:t,fill:"var(--a-diagram-element-diamond-background-color, #aaa)"},decorationPattern:{...e.attrs.decorationPattern,d:t}}}}},{g:Gn,V:Bn}=joint,Hn=class extends In{getNodeBBox(e){const t=Math.round,{x:n,y:i,width:o,height:r}=this.getNodeBoundingRect(e),s=new Gn.Rect(t(n),t(i),t(o),t(r)),a=this.getRootTranslateMatrix().multiply(this.getNodeRotateMatrix(e)),l=this.getNodeMatrix(e);return Bn.transformRect(s,a.multiply(l))}},Un=class extends p{preinitialize(){super.preinitialize(...arguments),this.markup=[{tagName:"circle",selector:"body"},{tagName:"text",selector:"glyph"},{tagName:"g",selector:"statusIconContainer",children:[{tagName:"circle",selector:"statusIconBackground"},{tagName:"text",selector:"statusIcon"}]}],Object.defineProperty(this,"safari",{value:re(),enumerable:!0})}defaults(){const e=this.safari;return{...super.defaults(),type:"apex.Terminator",size:{width:60,height:60},attrs:{body:{cx:"calc(h / 2)",cy:"calc(h / 2)",r:"calc(h / 2)",fill:"var(--a-diagram-element-terminator-background-color, #000)"},glyph:{text:"",fontFamily:"apex-5-icon-font",fontSize:"calc(h / 2)",width:"calc(h)",x:"calc(h / 2)",y:"calc(h / 2)",textAnchor:"middle",...!e&&{dominantBaseline:"central"},...e&&{textVerticalAnchor:"middle"},fill:"var(--a-diagram-element-terminator-text-color, #fff)"},statusIconContainer:{display:"none",transform:"translate(calc(w - 10) 10)"},statusIconBackground:{x:10,y:10,r:10,fill:"var(--a-diagram-element-terminator-text-color, #fff)",stroke:"var(--a-diagram-element-terminator-background-color, #000)"},statusIcon:{text:"",fontFamily:"apex-5-icon-font",fontSize:14,width:20,x:0,y:0,textAnchor:"middle",...!e&&{dominantBaseline:"central"},...e&&{textVerticalAnchor:"middle"},fill:"#000000"}}}}changeToRtl(e){e.statusIconContainer.transform="translate(10 10)"}statusIcon(e=""){return arguments.length?(e=null==e?"":e,this.attr("statusIconContainer/display",""===e?"none":""),this.attr("statusIcon/text",e)):this.attr("statusIcon/text")}},Kn=class extends Pn{},zn=class extends de{preinitialize(){super.preinitialize(...arguments),this.markup=[{tagName:"rect",selector:"body"},{tagName:"g",selector:"decoration",children:[{tagName:"path",selector:"decorationBackground"},{tagName:"path",selector:"decorationPattern"},{tagName:"text",selector:"glyph"}]},{tagName:"text",selector:"label"},{tagName:"text",selector:"statusIcon"}]}defaults(){const e=super.defaults(),t=de.CORNER_RADIUS,n=`M ${t} 0 L 60 0 L 60 calc(h) L ${t} calc(h) C ${t} calc(h) 0 calc(h) 0 calc(h - ${t}) L 0 ${t} C 0 ${t} 0 0 ${t} 0`;return{...e,type:"apex.Unconfigured",attrs:{...e.attrs,decoration:{height:"calc(h)",width:60},decorationBackground:{...e.attrs.decorationBackground,d:n,fill:"#eee",stroke:"#aaa",strokeWidth:1,strokeDasharray:"3,3"},decorationPattern:{...e.attrs.decorationPattern,d:n},body:{...e.attrs.body,stroke:"#aaa",strokeWidth:1,strokeDasharray:"3,3"},label:{...e.attrs.label,fill:"#aaa"},glyph:{...e.attrs.glyph,fill:"#aaa"}}}}changeToRtl(e){super.changeToRtl(e);const t=60,n=de.CORNER_RADIUS,i=`M 0 0 L ${t-n} 0 C 60 0 60 6 60 6 L 60 calc(h - ${n}) C 60 calc(h) ${t-n} calc(h) ${t-n} calc(h) L 0 calc(h) L 0 0`;e.decoration.transform="translate(calc(w - 60) 0)",e.decorationBackground.d=i,e.decorationPattern.d=i}},Wn=class extends In{},{dia:Fn}=joint,jn=class extends Fn.Element{preinitialize(){super.preinitialize(...arguments),this.markup=[{tagName:"g",selector:"decoration",children:[{tagName:"path",selector:"decorationBackground"},{tagName:"text",selector:"glyph"}]}]}defaults(){return{...super.defaults,type:"apex.BaseSmall",size:{width:60,height:60},attrs:{decorationBackground:{width:"calc(h)",height:"calc(h)",fill:"#aaa"},glyph:{text:"",fontFamily:"apex-5-icon-font",fontSize:"calc(h / 2.5)",width:"calc(h)",x:"calc(h / 2)",y:"calc(h / 2)",textAnchor:"middle",textVerticalAnchor:"middle",fill:"#fff"}}}}glyph(e=""){return arguments.length?this.attr("glyph/text",e):this.attr("glyph/text")}glyphColor(e="#ffffff"){return arguments.length?this.attr("glyph/fill",e):this.attr("glyph/fill")}decorationBackgroundColor(e="#eee"){return arguments.length?this.attr("decorationBackground/fill",e):this.attr("decorationBackground/fill")}},Yn=class extends jn{preinitialize(){super.preinitialize(...arguments),this.markup=[{tagName:"path",selector:"body"},{tagName:"g",selector:"decoration",children:[{tagName:"circle",selector:"decorationBackground"},{tagName:"text",selector:"glyph"}]}]}defaults(){const e=super.defaults();return{...e,type:"apex.CircleSmall",attrs:{...e.attrs,decorationBackground:{cx:"calc(h / 2)",cy:"calc(h / 2)",r:"calc(h / 2)",fill:"#aaa"}}}}},qn=class extends jn{preinitialize(){super.preinitialize(...arguments),this.markup=[{tagName:"g",selector:"decoration",children:[{tagName:"path",selector:"decorationBackground"},{tagName:"text",selector:"statusIcon"},{tagName:"text",selector:"glyph"}]}]}defaults(){const e=super.defaults();return{...e,type:"apex.DiamondSmall",attrs:{...e.attrs,decorationBackground:{...e.attrs.decorationBackground,d:"M 0 calc(h / 2) L calc(w / 2) 0 L calc(w) calc(h / 2) L calc(w / 2) calc(h) Z"}}}}},$n=class extends jn{preinitialize(){super.preinitialize(...arguments),this.markup=[{tagName:"g",selector:"decoration",children:[{tagName:"rect",selector:"decorationBackground"},{tagName:"text",selector:"statusIcon"},{tagName:"text",selector:"glyph"}]}]}defaults(){const e=super.defaults();return{...e,type:"apex.RectSmall",attrs:{...e.attrs,decorationBackground:{...e.attrs.decorationBackground,width:"calc(w)",height:"calc(h)"}}}}},Zn="var(--a-diagram-link-border-color, #666)",Xn="var(--a-palette-danger, #f00)",Jn=class extends f{preinitialize(){super.preinitialize(...arguments),this.markup=[{tagName:"path",selector:"wrapper",attributes:{fill:"none",cursor:"pointer",stroke:"transparent","stroke-linecap":"round"}},{tagName:"path",selector:"line",attributes:{fill:"none","pointer-events":"none"}},{tagName:"path",selector:"offsetConnector"}]}constructor(){super(...arguments),this.prop("error")&&(this.attr("line/stroke",Xn),this.attr("line/targetMarker/stroke",Xn))}defaults(){return{...super.defaults,type:"apex.SingleLink",designation:null,attrs:{...super.defaults.attrs,line:{...super.defaults.attrs.line,stroke:Zn,targetMarker:{type:"path",stroke:Zn,"stroke-width":2,fill:"none",d:"M 6 -6 L 0 0 L 6 6"}},offsetConnector:{d:"M 0 0 0 -30",stroke:Zn,strokeDasharray:"4 4","stroke-width":2}}}}error(e){if(!arguments.length)return this.prop("error")||!1;{this.prop("error",e);const t=e?Xn:Zn;this.attr("line/stroke",t),this.attr("line/targetMarker/stroke",t)}}route(e,t="var(--a-diagram-route-default, #808080)"){e?this.attr({line:{stroke:t,"stroke-width":4,targetMarker:{stroke:t,fill:t,d:"M 11 -7 L -3 0 L 11 7Z"}}}):(this.attr({line:{"stroke-width":2,targetMarker:{fill:"none",d:"M 6 -6 L 0 0 L 6 6"}}}),this.error()?this.error(!0):this.error(!1))}designation(e){if(!arguments.length)return this.prop("designation");this.prop("designation",e)}offsetConnectorRatio(e,t=0){if(!arguments.length)return this.attr("offsetConnector/atConnectionRatio");this.removeAttr("offsetConnector/atConnectionLength"),this.attr("offsetConnector/atConnectionRatio",e),this.attr("offsetConnector/d",`M 0 0 0 ${t}`)}offsetConnectorLength(e,t=0){if(!arguments.length)return this.attr("offsetConnector/atConnectionLength");this.removeAttr("offsetConnector/atConnectionRatio"),this.attr("offsetConnector/atConnectionLength",e),this.attr("offsetConnector/d",`M 0 0 0 ${t}`)}},{dia:Qn,g:ei,util:ti,V:ni}=joint,ii={TOOLS:Qn.CellView.Flags.TOOLS,RENDER:"RENDER",UPDATE:"UPDATE",LABELS:"LABELS",SOURCE:"SOURCE",TARGET:"TARGET",CONNECTOR:"CONNECTOR"},oi=class extends Qn.LinkView{initialize(){super.initialize(...arguments);const e=this.model,t=e.get("type").toLowerCase(),[n,i]=t.split(".");let o=e.prop("cls");o=o?Array.isArray(o)?o:o.split(" "):[],o=o.map((e=>e.replaceAll("{0}",n).replaceAll("{1}",i)));const r=this.el,s=r.classList;s.add(`${t.replaceAll(".","-")}-link`),o.length&&s.add(...o),re()&&this.listenTo(e,"change:attrs",(()=>{r.style.display="none",requestAnimationFrame((()=>r.style.display=""))}))}onRender(){super.onRender(...arguments),this.hideOffsetConnector()}addCls(e){this.el.classList.add(e)}removeCls(e){this.el.classList.remove(e)}showOffsetConnector(){this.findNode("offsetConnector").style.display=""}hideOffsetConnector(){this.findNode("offsetConnector").style.display="none"}renderLabels(){const e=this._V,t=this._labelCache={},n=this._labelSelectors={},i=this.model,o=i.attributes.labels||[],r=o.length;let s=e.labels;if(0===r)return s&&s.remove(),this;s?s.empty():(s=e.labels=ni("g").addClass("labels"),this.options.labelsLayer&&(s.addClass(ti.addClassNamePrefix(ti.result(this,"className"))),s.attr("model-id",i.id)));for(let e=0;e<r;e++){const r=o[e],a=this._normalizeLabelMarkup(this._getLabelMarkup(r.markup));let l,c;if(a)l=a.node,c=a.selectors;else{const e=i._builtins.defaultLabel,t=this._normalizeLabelMarkup(this._getLabelMarkup(e.markup)),n=i._getDefaultLabel(),o=this._normalizeLabelMarkup(this._getLabelMarkup(n.markup))||t;l=o.node,c=o.selectors}if(l.setAttribute("label-idx",e),r.cls){const e=Array.isArray(r.cls)?r.cls:r.cls.split(" ");l.classList.add(...e)}r.designation&&(l.dataset.designation=r.designation),s.append(l),t[e]=l;const h=this.selector;if(c[h])throw new Error("dia.LinkView: ambiguous label root selector.");c[h]=l,n[e]=c}return s.parent()||this.mountLabels(),this.updateLabels(),this}updateLabels(){if(!this._V.labels)return this;const e=this.model,t=e.get("labels")||[],n=this.can("labelMove"),i=e._builtins.defaultLabel.attrs,o=e._getDefaultLabel(),r=o.markup,s=o.attrs,a=o.size;for(let e=0,o=t.length;e<o;e++){const o=this._labelCache[e];this.isDesignationLabel(o)?o.setAttribute("cursor","pointer"):o.setAttribute("cursor",n?"move":"default");const l=this._labelSelectors[e],c=t[e],h=c.markup,d=c.attrs,g=c.size,u=this._mergeLabelAttrs(h||r,d,s,i),p=this._mergeLabelSize(g,a);this.updateDOMSubtreeAttributes(o,u,{rootBBox:new ei.Rect(p),selectors:l})}return this}dragLabelStart(e,t,n){const i=e.currentTarget;this.isDesignationLabel(i)?(this.eventData(e,{stopPropagation:!0}),this.paper.delegateDragEvents(this,e.data)):super.dragLabelStart(e,t,n)}dragArrowheadEnd(e,t,n){const i=this.eventData(e),{paper:o}=this;o.options.snapLinks?this._snapArrowheadEnd(i):this._connectArrowheadEnd(i,t,n),o.linkAllowed(this,i)?(this._finishEmbedding(i),this._notifyConnectEvent(i,e)):this._disallow(i),this._afterArrowheadMove(i)}isDesignationLabel(e){return!!e.dataset.designation}confirmUpdate(e,t={}){if(this.hasFlag(e,ii.SOURCE)){if(!this.updateEndProperties("source"))return e;e=this.removeFlag(e,ii.SOURCE)}if(this.hasFlag(e,ii.TARGET)){if(!this.updateEndProperties("target"))return e;e=this.removeFlag(e,ii.TARGET)}const{paper:n,sourceView:i,targetView:o}=this;if(n&&(i&&!n.isViewMounted(i)||o&&!n.isViewMounted(o)))return e;if(this.hasFlag(e,ii.RENDER)){if(this.render(),this.updateHighlighters(!0),this.updateTools(t),e=this.removeFlag(e,[ii.RENDER,ii.UPDATE,ii.LABELS,ii.TOOLS,ii.CONNECTOR]),re()){const{el:e}=this,t=Array.from(e.childNodes),n=document.createDocumentFragment();for(let i=0,o=t.length;i<o;i++)e.removeChild(t[i]),n.appendChild(t[i]);e.appendChild(n)}return e}let r=!1;const{model:s}=this,{attributes:a}=s;let l=this.hasFlag(e,ii.LABELS);l&&(this.onLabelsChange(s,a.labels,t),e=this.removeFlag(e,ii.LABELS),r=!0);const c=this.hasFlag(e,ii.UPDATE),h=this.hasFlag(e,ii.CONNECTOR);return(c||h)&&(c?t.translateBy&&s.isRelationshipEmbeddedIn(t.translateBy)?this.translate(t.tx,t.ty):this.update():(this.updatePath(),this.updateDOM()),this.updateTools(t),e=this.removeFlag(e,[ii.UPDATE,ii.TOOLS,ii.CONNECTOR]),l=!1,r=!0),l&&this.updateLabelPositions(),r&&this.updateHighlighters(),this.hasFlag(e,ii.TOOLS)&&(this.updateTools(t),e=this.removeFlag(e,ii.TOOLS)),e}},{ui:ri}=joint,si="none",ai="subgraph",li=class extends ri.Selection{translateSelectedElements(e,t){const n={},{collection:i}=this,{graph:o,translateConnectedLinks:r}=this.options;i.toArray().forEach((s=>{if(n[s.id])return;const a={selection:this.cid};if(s.translate(e,t,a),n[s.id]=!0,s.getEmbeddedCells({deep:!0}).forEach((function(e){n[e.id]=!0})),r!==si){o.getConnectedLinks(s).forEach((function(o){if(!n[o.id]){if(r===ai){const e=o.getSourceCell();if(e&&!i.get(e))return;const t=o.getTargetCell();if(t&&!i.get(t))return;if(!e||!t)return;if(e&&e===t)return}o.translate(e,t,a),n[o.id]=!0}}))}}))}onResetElements(e,{previousModels:t=[]}){this.destroyAllSelectionBoxes(t),e.toArray().forEach(this.createSelectionBox.bind(this)),this.updateSelectionWrapper()}createSelectionBox(e){const t=e.findView(this.options.paper);t&&(t.el.classList.add("selected"),t.el.dataset.selectionHighlightId=r(t,{padding:1,className:"selection-highlight",layer:"front",attrs:{stroke:"var(--a-diagram-cell-selection, orange)","stroke-width":2}}),this.showSelected(),this._boxCount+=1)}destroyAllSelectionBoxes(e=[]){e.forEach((e=>{const t=e.findView(this.options.paper);t&&(e.isElement()&&s(t,t.el.dataset.selectionHighlightId),t.el.classList.remove("selected"))})),this._boxCount=0,this.hide()}destroySelectionBox(e){const t=e.findView(this.options.paper);s(t,t.el.dataset.selectionHighlightId),this._boxCount=this._boxCount-1,this._boxCount||this.hide()}_updateSelectionBoxes(){this._boxCount?(this.showSelected(),this.updateSelectionWrapper()):this.hide()}},ci={BEFORE_KEYBOARD_ACTION:"beforekeyboardaction",BLANK_POINTERDOWN:"blankpointerdown",BLANK_POINTERUP:"blankpointerup",BLANK_CONTEXT_MENU:"blankcontextmenu",CELL_Z_INDEX_CHANGE:"zindexchange",ELEMENT_ADD:"elementadd",ELEMENT_REMOVE:"elementremove",ELEMENT_POINTERDOWN:"elementpointerdown",ELEMENT_POINTERUP:"elementpointerup",ELEMENT_POSITION_CHANGE:"elementpositionchange",ELEMENT_MENUBUTTON_POINTERDOWN:"elementmenubuttonpointerdown",ELEMENT_MENUBUTTON_KEYBOARDTRIGGER:"elementmenubuttonkeyboardtrigger",ELEMENT_CONNECTBUTTON_POINTERUP:"elementconnectbuttonpointerup",ELEMENT_CONNECTBUTTON_KEYBOARDTRIGGER:"elementconnectbuttonkeyboardtrigger",ELEMENT_MOUSEENTER:"elementmouseenter",ELEMENT_MOUSELEAVE:"elementmouseleave",ELEMENT_DROP:"elementdrop",ELEMENT_BEFORE_DROP:"elementbeforedrop",LINK_ADD:"linkadd",LINK_REMOVE:"linkremove",LINK_SOURCE_CHANGE:"linksourcechange",LINK_TARGET_CHANGE:"linktargetchange",LINK_VERTICES_CHANGE:"linkverticeschange",LINK_VERTEX_REMOVE:"linkvertexremove",LINK_DESIGNATION_CHANGE:"linkdesignationchange",LINK_LABEL_ADD:"linklabeladd",LINK_LABEL_REMOVE:"linklabelremove",LINK_LABEL_CHANGE:"linklabelchange",LINK_POINTERDOWN:"linkpointerdown",LINK_POINTERUP:"linkpointerup",LINK_MOUSEENTER:"linkmouseenter",LINK_MOUSELEAVE:"linkmouseleave",LINK_SOURCE_PLACEHOLDER_POINTERDOWN:"linksourceplaceholderpointerdown",LINK_SOURCE_PLACEHOLDER_POINTERUP:"linksourceplaceholderpointerup",LINK_SOURCE_PLACEHOLDER_KEYBOARDTRIGGER:"linksourceplaceholderkeyboardtrigger",LINK_TARGET_PLACEHOLDER_POINTERDOWN:"linktargetplaceholderpointerdown",LINK_TARGET_PLACEHOLDER_POINTERUP:"linktargetplaceholderpointerup",LINK_TARGET_PLACEHOLDER_KEYBOARDTRIGGER:"linktargetplaceholderkeyboardtrigger",LINK_PLACEHOLDER_POINTERDOWN:"linkplaceholderpointerdown",LINK_PLACEHOLDER_POINTERUP:"linkplaceholderpointerup",LINK_PLACEHOLDER_KEYBOARDTRIGGER:"linkplaceholderkeyboardtrigger",LINK_SOURCE_ANCHOR_POINTERUP:"linksourceanchorpointerup",LINK_TARGET_ANCHOR_POINTERUP:"linktargetanchorpointerup",LINK_ADDELEMENTBUTTON_POINTERDOWN:"linkaddelementbuttonpointerdown",LINK_ADDELEMENTBUTTON_POINTERUP:"linkaddelementbuttonpointerup",LINK_ADDELEMENTBUTTON_KEYBOARDTRIGGER:"linkaddelementbuttonkeyboardtrigger",LINK_MENUBUTTON_POINTERDOWN:"linktmenubuttonpointerdown",LINK_MENUBUTTON_KEYBOARDTRIGGER:"linkmenubuttonkeyboardtrigger",LINK_VERTEXHANDLE_POINTERUP:"linkvertexhandlepointerup",LINK_SEGMENTHANDLE_POINTERUP:"linksegmenthandlepointerup",SELECTION_CHANGE:"selectionchange"};Object.freeze(ci);var hi=ci,{ui:di}=joint;function gi(e){return e<=0?0:e>=1?1:.5-Math.cos(e*Math.PI)/2}var ui=class extends di.PaperScroller{scrollToLink(e,t={}){const{ratio:n=0,animation:i}=t,{paper:o}=this.options,r=e.findView(o).getPointAtRatio(n);return this.scroll(r.x,r.y,{animation:i})}isElementVisible(e,t={}){const{padding:n=0,strict:i=!1}=t;this.checkElement(e,"isElementVisible");const o=e.getBBox();return i?(o.inflate(n/this.zoom()),!!this.getVisibleArea().containsRect(o)):!!this.getVisibleArea().intersect(o)}isPointVisible(e,t={}){const{padding:n=0}=t,i=this.getVisibleArea();return n&&i.inflate(-n/this.zoom()),i.containsPoint(e)}scroll(e,t,n){const i=this.options.paper.matrix(),o=this.getClientSize(),r={},{isNumber:s}=joint.util;if(s(e)){var a=o.width/2;r.scrollLeft=this.getScrollLeftFromLTR(e*i.a-a+i.e+(this._padding.left||0))}if(s(t)){var l=o.height/2;r.scrollTop=t*i.d-l+i.f+(this._padding.top||0)}if(n&&n.animation)this._cancelAnimation&&this._cancelAnimation(),this._cancelAnimation=function(e,t,n){const{duration:i=400,timingFunction:o=gi,complete:r}=n,s=Date.now(),a=s+i,l=e.scrollLeft,c=e.scrollTop,h=t.scrollLeft||l,d=t.scrollTop||c,g=h-l,u=d-c;let p;return function t(){const n=Date.now(),i=o((n-s)/(a-s)),h=Math.round(l+g*i),d=Math.round(c+u*i);e.scrollLeft=h,e.scrollTop=d,n>=a?r&&r():Math.round(e.scrollLeft)===h||Math.round(e.scrollTop)===d?p=setTimeout(t,0):r&&r()}(),()=>clearTimeout(p)}(this.el,r,n.animation);else{const{el:e}=this;void 0!==r.scrollLeft&&(e.scrollLeft=r.scrollLeft),void 0!==r.scrollTop&&(e.scrollTop=r.scrollTop)}}startAutoResizePaper(){const{options:e}=this,{paper:t,autoResizePaper:n}=e;n||(e.autoResizePaper=!0,this.listenTo(t,"render:done",this.onPaperRenderDone),this.adjustPaper())}stopAutoResizePaper(){const{options:e}=this,{paper:t,autoResizePaper:n}=e;n&&(e.autoResizePaper=!1,this.stopListening(t,"render:done",this.onPaperRenderDone))}},{dia:pi}=joint,Ei=class extends pi.Graph{disconnectOutboundLinks(e,t){this.getConnectedLinks(e,{outbound:!0}).forEach((function(e){e.set("source",{x:0,y:0},t)}))}disconnectInboundLinks(e,t){this.getConnectedLinks(e,{inbound:!0}).forEach((function(e){e.set("target",{x:0,y:0},t)}))}_removeCell(e,t,n){(n=n||{}).clear||(this.trigger("beforeremove",e,n),n.disconnectLinks?this.disconnectLinks(e,n):this.removeLinks(e,n)),this.get("cells").remove(e,{silent:!0}),e.graph===this&&(e.graph=null)}},{V:fi,g:mi}=joint;function Li(){return function(e,t,n,i){const o=this.paper.options.connectionPointNamespace;let r=o.boundary;if(t.model instanceof de){const n=e.start,i=e.end,a=s(t,"decorationBackground","decoration"),l=s(t,"body"),c=[];let h=new mi.Point(i.x,i.y);if(l&&a&&!l.containsPoint(n)&&!a.containsPoint(n))return c.push(...a.intersectionWithLine(e)||[]),c.push(...l.intersectionWithLine(e)||[]),h=c.reduce(((e,t)=>{if(null==e)return t;return t.distance(n)<e.distance(n)?t:e}),c[0]),h;r=o.bbox}else if(t.model instanceof Un){const n=e.start,i=e.end,a=s(t,"statusIconBackground","statusIconContainer"),l=s(t,"body"),c=[];let h=new mi.Point(i.x,i.y);if(a&&!l.containsPoint(n)&&!a.containsPoint(n))return c.push(...a.intersectionWithLine(e)||[]),c.push(...l.intersectionWithLine(e)||[]),h=c.reduce(((e,t)=>{if(null==e)return t;return t.distance(n)<e.distance(n)?t:e}),c[0]),h;r=o.boundary}return r.call(this,e,t,n,i);function s(e,t,n){const i=e.getChildEl(t),o=e.getChildEl(n);if("none"===o?.getAttribute("display"))return;const r=e.model.getBBox();let s;switch(i.nodeName){case"path":s=mi.Path.parse(i.getAttribute("d"));break;case"rect":s=new mi.Rect(parseFloat(i.getAttribute("x"))||0,parseFloat(i.getAttribute("y"))||0,parseFloat(i.getAttribute("width")),parseFloat(i.getAttribute("height")));break;case"circle":{const e=parseFloat(i.getAttribute("r"));s=new mi.Ellipse(new mi.Point(parseFloat(i.getAttribute("cx"))||0,parseFloat(i.getAttribute("cy"))||0),e,e);break}}if(s){let e=0,t=0;if(o){const n=fi.decomposeMatrix(fi.transformStringToMatrix(o.getAttribute("transform")));e=n.translateY,t=n.translateX}return"function"==typeof s.translate?s.translate(r.x+t,r.y+e):(s.x+=r.x+t,s.y+=r.y+e),s}}}}var{routers:yi}=joint;function Oi(e,t){const n=h;switch(e){case n.MANHATTAN:case n.ADVANCED_MANHATTAN:case n.ORTHOGONAL:return{name:e,args:{padding:20,...t}};default:return{name:e}}}var{dia:Ci}=joint,Ni=class extends Ci.Paper{linkAllowed(e,t){if(!(e instanceof Ci.LinkView))throw new Error("Must provide a linkView.");const n=e.model,i=this.options,o=this.model,r=o.constructor.validations;return!(!i.multiLinks&&!r.multiLinks.call(this,o,n))&&(!(!i.linkPinning&&!r.linkPinning.call(this,o,n))&&!("function"==typeof i.allowLink&&!i.allowLink.call(this,e,this,t)))}},{dia:Ti,ui:_i,util:bi}=joint,Ri=class extends _i.Stencil{onDrop(e,t,n,i){const{options:o}=this,{paper:r,graph:s}=o,{embeddingMode:a}=r.options,{model:l}=e;s.startBatch("stencil-drag");const c=o.dragEndClone(l);if(l===c||!(c instanceof Ti.Cell))throw new Error("ui.Stencil: `dragEndClone` must return a clone of the cell");const h=r.findView(t.target)||null,d=h?Ze(h,t.target):null;this.trigger("element:beforedrop",e,c,t,n.x,n.y,h,d),this.drop(c,n,i),a&&l.isElement()&&(e.eventData(t,{model:c,paper:r,initialParentId:bi.uuid(),whenNotAllowed:"remove"}),e.finalizeEmbedding(e.eventData(t))),s.getCell(c)?(this.trigger("element:drop",c.findView(r),t,n.x,n.y,h,d),this.removePaperAfterDragging(l)):this.onDropInvalid(e,t,n,i),s.stopBatch("stencil-drag")}},{util:ki}=joint,Ai={isEqual:ki.isEqual};Object.freeze(Ai);var wi=Ai,{dia:vi,ui:xi,shapes:Pi,connectionStrategies:Ii,g:Di,util:Si,mvc:Mi}=joint,Vi=class{#a;#l;#c;#h;#d;#g;#u;#p;#E;#f;#m;#L;#y;#O=[];#C=[];#N;#T=!1;#_=[];#b;#R;#k;#A;#w;#v;#x={rtl:"rtl"===document.dir?.toLowerCase(),el:null,paperEl:".paper",stencilEl:".stencil",navigatorEl:".navigator",elements:[],stencilElements:[],selectionMode:zt.MULTI,linkDesignations:[],routeHighlights:[],requireLinkSourceElement:!1,requireLinkTargetElement:!1,readOnly:!1,renderStencil:!0,onElementRemoveKeepOutboundLinks:!1,onElementRemoveKeepInboundLinks:!1,dropConnectOnLinks:!0,allowDropConnectOnLink:()=>{},dropConnectOnElements:!0,allowDropConnectOnElement:()=>{},allowDropConnectOnPlaceholder:()=>{},paperWidth:2e3,paperHeight:2e3,showNavigator:!0,navigatorWidth:192,navigatorHeight:128,initialZoom:1,minZoom:.5,maxZoom:2,defaultRouter:h.NORMAL,keyboardNavigation:!0,keyboardNavigationMap:void 0,drawGrid:!1,style:{elementCls:[],linkCls:[],linkLabelCls:[],linkDesignationCls:[],paperCls:[],stencilCls:[],navigatorCls:[],focusCls:["is-focused"],hoverCls:["is-hovered"],toastForegroundContainerCls:[],legacyCls:["joint-apex-legacy-offset"]},locale:{[nt.STR_ZOOM_LEVEL]:"Zoom level {0}%"}};get#P(){return Object.freeze({allowLinkIn:!0,allowLinkOut:!0,hasMenu:!0,cls:[],onRemoveKeepInboundLinks:this.#x.onElementRemoveKeepInboundLinks,onRemoveKeepOutboundLinks:this.#x.onElementRemoveKeepOutboundLinks})}constructor(e){Si.assign(this,Mi.Events),Si.assign(Pi,{apex:{Circle:wn,CircleView:Dn,Rect:Sn,RectView:Mn,Diamond:Vn,DiamondView:Hn,Terminator:Un,TerminatorView:Kn,Unconfigured:zn,UnconfiguredView:Wn,CircleSmall:Yn,DiamondSmall:qn,RectSmall:$n,SingleLink:Jn,SingleLinkView:oi}}),this.#v=e.linkDesignations||[];const t=Si.merge(this.#x,e);this.#I(),this.#D(t.el),this.#S(),this.#M(),this.#V(),this.#G(),this.#B(),this.#H(),this.#U(),this.#K(t.elements),this.#z(),this.#W(),this.#F(t),this.#j()}#I(){const e=this.#x;0!==e.initialZoom&&(e.initialZoom=Math.min(e.maxZoom,Math.max(e.initialZoom,e.minZoom))||1)}#F(e){this.#a=new st({el:this.#R,graph:this.#h,paper:this.#d,paperScroller:this.#g,stencil:this.#E,keyboard:this.#m,selection:this.#u,navigator:this.#L,snaplines:this.#p,navigatorVisible:e.showNavigator,linkDesignations:this.#v,dropConnectOnLinks:e.dropConnectOnLinks,allowDropConnectOnLink:e.allowDropConnectOnLink,dropConnectOnElements:e.dropConnectOnElements,allowDropConnectOnElement:e.allowDropConnectOnElement,allowDropConnectOnPlaceholder:e.allowDropConnectOnPlaceholder,readOnly:e.readOnly,style:e.style,locale:e.locale,elementProps:{onRemoveKeepOutboundLinks:!!e.onElementRemoveKeepOutboundLinks,onRemoveKeepInboundLinks:!!e.onElementRemoveKeepInboundLinks}}),this.#a.startListening(),e.selectionMode!==zt.MULTI&&e.selectionMode!==zt.SINGLE||(this.#l=new Ft({graph:this.#h,paper:this.#d,paperScroller:this.#g,selection:this.#u,multiSelectionHandles:[],keyboard:this.#m,clipboard:this.#f,mode:e.selectionMode,readOnly:e.readOnly}),this.#l.startListening()),e.keyboardNavigation&&(this.#c=new un({graph:this.#h,paper:this.#d,selection:this.#u,keyboard:this.#m,clipboard:this.#f,paperScroller:this.#g,selectionMode:e.selectionMode,readOnly:e.readOnly,map:e.keyboardNavigationMap,minZoom:e.minZoom,maxZoom:e.maxZoom}),this.#c.startListening(),this.listenTo(this.#c,{"change:usage":this.#Y}))}#q(e){return this.#d.definePattern({attrs:{width:60,height:500},markup:[{tagName:"image",attributes:{"xlink:href":e,preserveAspectRatio:"xMinYMin slice"}}]})}#j(){const e=hi;this.listenTo(this.#h,{add:t=>{this.#$(t.isElement()?e.ELEMENT_ADD:e.LINK_ADD,t)},remove:(t,n,{silent:i=!1})=>{i||this.#$(t.isElement()?e.ELEMENT_REMOVE:e.LINK_REMOVE,t)},"change:position":(t,n,i={})=>{const{keyboard:o=!1}=i;this.#$(e.ELEMENT_POSITION_CHANGE,t,n,o)},"change:source":(t,n)=>{this.#$(e.LINK_SOURCE_CHANGE,t,n)},"change:target":(t,n)=>{this.#$(e.LINK_TARGET_CHANGE,t,n)},"change:vertices":(t,n)=>{this.#$(e.LINK_VERTICES_CHANGE,t,n)},"remove:vertex":(t,n,i)=>{this.#$(e.LINK_VERTEX_REMOVE,t,n,i)},"change:labels":(t,n,i)=>{if("designation"in t.changed)this.#$(e.LINK_DESIGNATION_CHANGE,t,t.changed.designation);else{const o=!!t.designation();if(o&&([,...n]=n),n.length){const{propertyPath:r,propertyValue:s,propertyPathArray:a,rewrite:l=!1}=i,c=Object.keys(s),h=a[1]-(o?1:0);r.includes(f.getLabelTextPath())?this.#$(e.LINK_LABEL_CHANGE,t,n,n[h],"text",s):1===c.length&&"position"===c[0]?this.#$(e.LINK_LABEL_CHANGE,t,n,n[h],"position",s.position):this.#$(e.LINK_LABEL_ADD,t,n,n[h],l)}else this.#$(e.LINK_LABEL_REMOVE,t,n)}},"change:z":(t,n)=>{this.#$(e.CELL_Z_INDEX_CHANGE,t,n)}}),this.listenTo(this.#d,{"cell:pointerdown":(t,n,i,o)=>{const{model:r}=t;this.#$(r.isElement()?e.ELEMENT_POINTERDOWN:e.LINK_POINTERDOWN,t,{x:i,y:o},n)},"cell:pointerup":(t,n,i,o)=>{const{model:r}=t;this.#$(r.isElement()?e.ELEMENT_POINTERUP:e.LINK_POINTERUP,t,{x:i,y:o},n)},"cell:menubutton:pointerdown":function(t,n,i){const o=e[t.model.isElement()?"ELEMENT_MENUBUTTON_POINTERDOWN":"LINK_MENUBUTTON_POINTERDOWN"];this.#$(o,t,n,i)},"cell:menubutton:keyboardtrigger":function(t,n,i){const o=e[t.model.isElement()?"ELEMENT_MENUBUTTON_KEYBOARDTRIGGER":"LINK_MENUBUTTON_KEYBOARDTRIGGER"];this.#$(o,t,n,i)},"element:connectbutton:pointerup":function(t,n,i,o,r){this.#$(e.ELEMENT_CONNECTBUTTON_POINTERUP,t,n,i,o,r)},"element:connectbutton:keyboardtrigger":function(t,n,i,o,r){this.#$(e.ELEMENT_CONNECTBUTTON_KEYBOARDTRIGGER,t,n,i,o,r)},"link:mouseenter":(t,n)=>{const i=this.clientToLocalPoint(n.clientX,n.clientY);this.#$(e.LINK_MOUSEENTER,t,i,n)},"link:mouseleave":(t,n)=>{const i=this.clientToLocalPoint(n.clientX,n.clientY);this.#$(e.LINK_MOUSELEAVE,t,i,n)},"link:addelement:pointerdown":function(t,n,i,o){this.#$(e.LINK_ADDELEMENTBUTTON_POINTERDOWN,t,n,i,o)},"link:addelement:pointerup":function(t,n,i,o){this.#$(e.LINK_ADDELEMENTBUTTON_POINTERUP,t,n,i,o)},"link:addelement:keyboardtrigger":function(t,n,i,o){this.#$(e.LINK_ADDELEMENTBUTTON_KEYBOARDTRIGGER,t,n,i,o)},"link:placeholder:pointerdown":(t,n,i,o,r)=>{o={...this.toGridSize(o)},0===i?this.#$(e.LINK_SOURCE_PLACEHOLDER_POINTERDOWN,t,n,i,o,r):1===i&&this.#$(e.LINK_TARGET_PLACEHOLDER_POINTERDOWN,t,n,i,o,r),this.#$(e.LINK_PLACEHOLDER_POINTERDOWN,t,n,i,o,r)},"link:placeholder:pointerup":(t,n,i,o,r)=>{o={...this.toGridSize(o)},0===i?this.#$(e.LINK_SOURCE_PLACEHOLDER_POINTERUP,t,n,i,o,r):1===i&&this.#$(e.LINK_TARGET_PLACEHOLDER_POINTERUP,t,n,i,o,r),this.#$(e.LINK_PLACEHOLDER_POINTERUP,t,n,i,o,r)},"link:placeholder:keyboardtrigger":(t,n,i,o,r)=>{o={...this.toGridSize(o)},0===i?this.#$(e.LINK_SOURCE_PLACEHOLDER_KEYBOARDTRIGGER,t,n,i,o,r):1===i&&this.#$(e.LINK_TARGET_PLACEHOLDER_KEYBOARDTRIGGER,t,n,i,o,r),this.#$(e.LINK_PLACEHOLDER_KEYBOARDTRIGGER,t,n,i,o,r)},"link:anchor:pointerup":(t,n,i,o,r)=>{const s=e["source"===i?"LINK_SOURCE_ANCHOR_POINTERUP":"LINK_TARGET_ANCHOR_POINTERUP"];this.#$(s,t,n,o,r)},"link:vertexhandle:pointerup":(t,n,i,o,r,s)=>{this.#$(e.LINK_VERTEXHANDLE_POINTERUP,t,n,i,o,r,s)},"link:segmenthandle:pointerup":(t,n,i,o,r,s)=>{this.#$(e.LINK_SEGMENTHANDLE_POINTERUP,t,n,i,o,r,s)},"blank:pointerdown":(t,n,i)=>{this.#$(e.BLANK_POINTERDOWN,{x:n,y:i},t)},"blank:pointerup":(t,n,i)=>{this.#$(e.BLANK_POINTERUP,{x:n,y:i},t)},"blank:contextmenu":(t,n,i)=>{this.#$(e.BLANK_CONTEXT_MENU,{x:n,y:i},t)}}),this.listenTo(this.#u,{change:(e,t)=>{this.#$(hi.SELECTION_CHANGE,e.collection.models,t)}}),this.listenTo(this.#E,{"element:beforedrop":(t,n,i,o,r,s,a)=>{this.#$(e.ELEMENT_BEFORE_DROP,t,n,{x:o,y:r},s,a,i)},"element:drop":(t,n,i,o)=>{this.#$(e.ELEMENT_DROP,t,{x:i,y:o},n)}}),this.#c&&this.listenTo(this.#c,{beforeaction:(t,n,i,o)=>{this.#$(e.BEFORE_KEYBOARD_ACTION,n,i,o)}})}#Y(e,t){this.#a.useKeyboard(t)}#$(e,...t){if(!e||"string"!=typeof e)throw new Error("Event name must be specified.");this.isEventSuspended(e)||this.trigger(e,...t)}#D(e){const t=this.#x,{paperCls:n,stencilCls:i,navigatorCls:o,legacyCls:r}=t.style;if(this.#R="string"==typeof e?document.querySelector(e):e,!this.#R)throw new Error('Diagram Builder: Render-to HTML element not found. Fix it by setting the "el" config to an existing element or its selector.');this.#R.getAttribute("tabindex")||this.#R.setAttribute("tabindex",0),r?.length&&re()&&this.#R.classList.add(...Array.isArray(r)?r:r.split(" "));let s="string"==typeof t.paperEl?this.#R.querySelector(t.paperEl):t.paperEl;s||(s=document.createElement("div"),this.#R.appendChild(s)),n?.length&&s.classList.add(...Array.isArray(n)?n:n.split(" ")),this.#k=s;const{renderStencil:a}=t;if(a){let e="string"==typeof t.stencilEl?this.#R.querySelector(t.stencilEl):t.stencilEl;e||(e=document.createElement("div"),this.#R.appendChild(e)),i?.length&&e.classList.add(...Array.isArray(i)?i:i.split(" ")),this.#A=e}let l="string"==typeof t.navigatorEl?this.#R.querySelector(t.navigatorEl):t.navigatorEl;l||(l=document.createElement("div"),this.#R.appendChild(l)),o?.length&&l.classList.add(...Array.isArray(o)?o:o.split(" ")),this.#w=l,this.#R.addEventListener("mousedown",this.#Z,!0),this.#R.addEventListener("touchstart",this.#Z,!0),this.onFocus=this.onFocus.bind(this),this.onBlur=this.onBlur.bind(this),this.#R.addEventListener("focus",this.onFocus),this.#R.addEventListener("blur",this.onBlur)}#Z(){this.focus()}#S(){this.#h=new Ei({},{cellNamespace:Pi})}#M(){const{drawGrid:e,initialZoom:t,paperWidth:n,paperHeight:i,requireLinkSourceElement:o,requireLinkTargetElement:r,style:s,defaultRouter:a}=this.#x,l=new Ni({async:!0,gridSize:10,drawGrid:!!e&&{name:"mesh",args:{color:!0===e?"var(--a-diagram-grid-color, #eee)":e}},width:n,height:i,sorting:Ni.sorting.APPROX,linkPinning:!0,model:this.#h,cellViewNamespace:Pi,connectionStrategy:function(e,t,n,i,o,r,s,a){if(a){const t=10;let n=0,i=0;switch(a){case"top":i=t;break;case"bottom":i=-t;break;case"right":n=-t;break;case"left":n=t}e.anchor={name:a,args:{dx:n,dy:i}}}else Ii.pinRelative(e,t,n,i)},defaultLink:new Jn({requireSourceElement:!!o,requireTargetElement:!!r,cls:s.linkCls,labelCls:s.linkLabelCls}),defaultRouter:Oi(a),defaultConnector:{name:"rounded"},defaultConnectionPoint:Li(),defaultLinkAnchor:{name:"connectionClosest"},snapLabels:!0,interactive:e=>{const{model:t}=e,n=t.isReadOnly(),i=this.isReadOnly()||n;return{elementMove:!i,linkMove:!1,labelMove:!i}},allowLink:(e,t,n)=>{const{model:i}=e,o=i[n.arrowhead]();if(m(o)){const{x:e,y:t}=this.#d.localToClientPoint(o.x,o.y),n=document.elementFromPoint(e,t),i=this.#d.findView(n);if(i&&i instanceof vi.ElementView)return!1}return this.#X(i.getSourceCell(),i.getTargetCell(),e)},validateConnection:(e,t,n,i,o,r)=>this.#X(e?.model,n?.model,r)});this.#d=l;const c=new ui({paper:l,scrollWhileDragging:!0,cursor:"grab",padding:30,autoResizePaper:!0,allowNewOrigin:"any",baseWidth:500,baseHeight:500,contentOptions:()=>{const e=this.#h.getBBox();if(this.isReadOnly())return{contentArea:e||new Di.Rect(0,0,300,200),allowNewOrigin:"any",allowNegativeBottomRight:!0,padding:30,gridWidth:0,gridHeight:0};const t=new Di.Rect(0,0,this.#x.paperWidth,this.#x.paperHeight);e?.inflate(30);return{contentArea:t.union(e)}}});this.#k.appendChild(c.el),c.render(),1!==t&&0!==t&&c.zoom(t,{absolute:!0}),this.#g=c,this.#J()}#J(){this.#h.getCells().length?this.#g.centerContent({useModelGeometry:!0}):this.#g.center()}#X(e,t,n){const i=n.model,o=i.get("requireSourceElement"),r=i.get("requireTargetElement"),s=!1!==e?.allow(p.ALLOW_LINK_OUT),a=!1!==t?.allow(p.ALLOW_LINK_IN),l=this.#x,c=l.readOnly||e&&e.isReadOnly()||t&&t.isReadOnly(),{allowConnection:h}=l;return!c&&((!o||e instanceof vi.Element)&&((!r||t instanceof vi.Element)&&(!(!s||!a)&&(!(e instanceof vi.Link||t instanceof vi.Link)&&("function"!=typeof h||!1!==h(e,t,n))))))}#V(){yi[h.ADVANCED_MANHATTAN]=function(e,t,n){const{model:i}=n,o=i.getSourceElement(),r=i.getTargetElement();if(o){const e=o.getBBox(),n=w(i.source().anchor,e);t.startDirections=[e.sideNearestToPoint(n)]}else delete t.startDirections;if(r){const e=r.getBBox(),n=w(i.target().anchor,e);t.endDirections=[e.sideNearestToPoint(n)]}else delete t.endDirections;return yi.manhattan(e,t,n)},yi[h.ADVANCED_RIGHT_ANGLE]=function(e,t,n){return t.useVertices=!0,yi.rightAngle(e,t,n)}}#G(){this.#f=new xi.Clipboard,this.#u=new li({useModelGeometry:!0,translateConnectedLinks:xi.Selection.ConnectedLinksTranslation.SUBGRAPH,boxContent:!1,paper:this.#d,allowCellInteraction:!0,filter:e=>!e.isSelectable()})}#B(){this.#m=new xi.Keyboard({filter:e=>{const{target:t}=e;return this.#R.contains(t)}})}#U(){new xi.Tooltip({rootTarget:document.body,target:"[data-tooltip]",padding:15,animation:{delay:"1s"}})}#z(){const{renderStencil:e,rtl:t}=this.#x;let n=this.#x.stencilElements;const i=[];t&&(n=[...n].reverse()),n.forEach((e=>{const t=this.#y.find((t=>t.typeId===e));if(t){const e=t.stencilElement.clone();e.resize(30,30),i.push(e)}}));const o=i.length,r=30*o+5*(o-1)+10,s=new Ri({graph:this.#h,paper:this.#g,width:r,height:40,dropAnimation:!0,layout:{columnWidth:30,columns:o,rowHeight:30,resizeToFit:!0,columnGap:5,marginX:5,marginY:5},snaplines:this.#p,canDrag:()=>!this.#x.readOnly,dragStartClone:e=>{const t=e.prop("typeId");return this.#y.find((e=>e.typeId===t)).element.clone()},paperOptions:{background:{color:"#eee"}}});this.#E=s;const a=s.render();e&&(this.#A.style.width=`${r}px`,this.#A.style.height="40px",this.#x.readOnly&&this.#Q(),this.#A.appendChild(a.el),s.load(i))}#Q(){this.#A&&(this.#A.style.visibility="hidden")}#ee(){this.#A&&(this.#A.style.visibility="visible")}#H(){this.#p=new xi.Snaplines({paper:this.#d,usePaperGrid:!0,distance:5})}#W(){const e=new xi.Navigator({paperScroller:this.#g,width:this.#x.navigatorWidth,height:this.#x.navigatorHeight,zoom:!1,padding:0,paperOptions:{async:!0,cellViewNamespace:Pi,sorting:Ni.sorting.APPROX,background:{color:"#fff"},defaultRouter:Oi(this.#x.defaultRouter),defaultConnector:{name:"rounded"},defaultConnectionPoint:Li()}});this.#L=e,this.#w.appendChild(e.el),e.render(),this.#x.showNavigator?this.#te(!0):this.#te(!1)}#K(e){let t=this.#x.style.elementCls||[];t=Array.isArray(t)?t:t.split(" ");const n=e.map((e=>{const{type:n,typeId:i,tooltip:o,stencilTooltip:r,glyph:s="",glyphColor:a,decorationPattern:l}=e;let{cls:c=""}=e;const h=Si.merge({},this.#P),d=n.split("."),g={filters:this.#O,rtl:this.#x.rtl};c=c||[],g.cls=[...t,...Array.isArray(c)?c:c.split(" ")];const u=new(d.reduce(((e,t)=>e[t]),Pi))(g);u.prop("typeId",i);const p=[...d];p[p.length-1]=`${p[p.length-1]}Small`;let E=p.reduce(((e,t)=>e[t]),Pi);E||(E=d.reduce(((e,t)=>e[t]),Pi));const f=new E({});if(f.prop("typeId",i),l){const e=this.#q(l);u.prop("decorationPattern",l),u.decorationPattern(`url(#${e})`)}return o&&("string"==typeof u?u.attr("root",{dataTooltip:o,dataTooltipPosition:"top"}):u.attr("root",{dataTooltip:o.text||"",dataTooltipPosition:o.position||"top"})),r&&("string"==typeof r?f.attr("root",{dataTooltip:r,dataTooltipPosition:"top"}):f.attr("root",{dataTooltip:r.text||"",dataTooltipPosition:r.position||"top"})),u.glyph(s),f.glyph(s),a&&(u.glyphColor(a),f.glyphColor(a)),Object.entries(h).forEach((([t,n])=>{void 0===u.prop(t)&&u.prop(t,t in e?e[t]:n)})),{typeId:i,element:u,stencilElement:f,cfg:e}}));this.#y=n}#ne(e,t={}){const{text:n="",x:i=0,y:o=0,...r}=t,s=this.#y.find((t=>t.typeId===e));if(s){const e=s.element.clone();e.text(n);for(let t in r)Object.hasOwn(r,t)&&e.prop(t,r[t]);return e.position(i,o),e}}get graph(){return this.#h}get paper(){return this.#d}get paperScroller(){return this.#g}get selection(){return this.#u}get stencil(){return this.#E}get snaplines(){return this.#p}get navigator(){return this.#L}onFocus(){let e=this.#x.style.focusCls;this.#T=!0,e?.length&&this.#R.classList.add(...Array.isArray(e)?e:e.split(" "))}onBlur(){let e=this.#x.style.focusCls;this.#T=!1,e?.length&&this.#R.classList.remove(...Array.isArray(e)?e:e.split(" "))}getShapes(){return Pi}getVisibleArea(){return this.#g.getVisibleArea()}getVisibleAreaCenter(){const{x:e,y:t,width:n,height:i}=this.#g.getVisibleArea();return{x:e+n/2,y:t+i/2}}isElementVisible(e,t=!1){return e=this.#ie(e),this.#g.isElementVisible(e,{strict:t})}toGridSize(e){const t=this.#d.options.gridSize||1;return 2===arguments.length?Di.Point(arguments[0],arguments[1]).snapToGrid(t):m(e)?Di.Point(e.x,e.y).snapToGrid(t):Di.snapToGrid(e,t)}attachElementToLink(e,t,n={}){const i=this.#d;if(e=this.#ie(e),t=this.#oe(t),!e||!t)return;const o=t.findView(i),{point:r}=n;let{ratio:s}=n;r&&(this.requireView(o),s=o.getClosestPointRatio(r)),S(e.findView(i),o,s)}addElement(e,t={}){if(this.isReadOnly())return;let{async:n=!1,verticalAlign:i="top",horizontalAlign:o="left",x:r,y:s,highlight:a=!1,addToLink:l=null,...c}=t;const h=this.#h,d=this.#ne(e,{x:r,y:s,...c}),{x:g,y:u}=this.getVisibleAreaCenter();if(!d)return;const{width:p,height:E}=d.size();if(l)h.addCell(d,{async:n}),this.attachElementToLink(d,l.link,{point:l.point,ratio:l.ratio});else{if(null==r||null==s)({x:r,y:s}=this.toGridSize(g-p/2,u-E/2));else{switch(o){case"center":r-=p/2;break;case"right":r-=p}switch(i){case"center":s-=E/2;break;case"bottom":s-=E}({x:r,y:s}=this.toGridSize(r,s))}({x:r,y:s}=function(e,t,n){let{x:i,y:o}=t;for(;b(e,{x:i,y:o});)i+=n,o+=n;return{x:i,y:o}}(h,{x:r,y:s},this.#d.options.gridSize)),d.position(r,s),h.addCell(d,{async:n})}return a&&this.highlight(d,{duration:2e3}),d}removeElement(e,t={}){const{force:n=!1}=t,i=this.#ie(e);i&&!this.isReadOnly()&&(n||G(i))&&i.remove()}changeElementType(e,t){const n=this.#ie(e);if(n&&!this.isReadOnly()&&!n.isReadOnly()&&n.allow(p.ALLOW_TYPE_CHANGE)){const e=n.text(),{x:i,y:o}=n.position(),r=["attrs","decorationPattern","id","position","size","type","typeId",...Object.keys(this.#P)],s={};Object.entries(n.attributes).forEach((([e,t])=>{r.includes(e)||(s[e]=t)}));const a=this.#ne(t,{text:e,x:i,y:o,...s});this.#re(),function(e,t,n){const i=e.getConnectedLinks(t,{inbound:!0}).map((e=>({target:e.target(),vertices:e.vertices(),link:e}))),o=e.getConnectedLinks(t,{outbound:!0}).map((e=>({source:e.source(),vertices:e.vertices(),link:e}))),r=n.get("id");e.addCell(n,{async:!1}),i.forEach((({link:e,target:t,vertices:n})=>{t.id=r,e.target(t),e.vertices(n)})),o.forEach((({link:e,source:t,vertices:n})=>{t.id=r,e.source(t),e.vertices(n)})),t.remove()}(this.#h,n,a),this.#se()}}#re(){this.#d.freeze(),this.#N&&this.#L.targetPaper.freeze()}#se(){this.#d.unfreeze(),this.#N&&this.#L.targetPaper.unfreeze()}#ie(e){return t=this.#h,null==(n=e)?null:"string"==typeof n?C(t,n)||null:n instanceof y.Element?n:null!=n.id&&C(t,n.id)||null;var t,n}#oe(e){return R(this.#h,e)}#ae(e){return k(this.#h,e)}#te(e){this.#w.style.display=e?"block":"none",this.#L[e?"unfreeze":"freeze"](),this.#N=e,this.#L.trigger("visibility",e?"visible":"hidden")}#le(){const{minZoom:e}=this.#x;this.#g.zoomToFit({minScale:e,maxScale:1,padding:15})}#ce(e){const{initialZoom:t}=this.#x,n=0===t;this.isReadOnly()&&e&&Object.hasOwn(e,"route")?(this.highlightRoute(e.route,n),this.#_?n||this.#J():(n&&this.#le(),this.#J())):(n&&this.#le(),this.#J())}addLink(e,t,n={}){const{highlight:i=!1,async:o=!1,...r}=n;if(this.#x.readOnly)return;const s=this.#d.getDefaultLink(),a=m(e),l=m(t),c=!a&&this.#ie(e),h=!l&&this.#ie(t),{requireLinkSourceElement:d=!1,requireLinkTargetElement:g=!1}=this.#x;for(let e in r)Object.hasOwn(r,e)&&s.prop(e,r[e]);return!a&&!c||!l&&!h||d&&a||g&&l?void 0:(s.source("string"==typeof e?c:e),s.target("string"==typeof t?h:t),this.#h.addCell(s,{async:o}),i&&this.highlight(s,{duration:2e3}),s)}removeLink(e,t={}){const{force:n=!1}=t;(e=this.#oe(e))&&!this.isReadOnly()&&(n||B(e))&&e.remove()}setLinkDesignation(e,t){(e=this.#oe(e))&&!this.isReadOnly()&&!e.isReadOnly()&&e.allow(f.ALLOW_DESGINATION_CHANGE)&&e.designation(t)}setLinkTarget(e,t){if((e=this.#oe(e))&&!this.isReadOnly()&&!e.isReadOnly()&&e.allow(f.ALLOW_TARGET_CHANGE)){const n=m(t),i=this.#ie(t);e&&(n||i)&&e.target("string"==typeof t?i:t)}}getLinkTarget(e){return e=this.#oe(e),e?.target()}setLinkTargetAnchor(e,t){if((e=this.#oe(e))&&!this.isReadOnly()&&!e.isReadOnly()){const n=e.target();if(n){const i={...n};i.anchor=t,e.target(i)}}}getLinkTargetAnchor(e){e=this.#oe(e);const t=e?.target();return t?.anchor||null}setLinkSource(e,t){if((e=this.#oe(e))&&!this.isReadOnly()&&!e.isReadOnly()){const n=m(t),i=this.#ie(t);e&&(n||i)&&e.source("string"==typeof t?i:t)}}getLinkSource(e){return e=this.#oe(e),e?.source()}setLinkSourceAnchor(e,t){if((e=this.#oe(e))&&!this.isReadOnly()&&!e.isReadOnly()){const n=e.source();if(n){const i={...n};i.anchor=t,e.source(i)}}}getLinkSourceAnchor(e){e=this.#oe(e);const t=e?.source();return t?.anchor||null}setLinkVertices(e,t=[]){!(e=this.#oe(e))||this.isReadOnly()||e.isReadOnly()||e.vertices(t)}getLinkVertices(e){return e=this.#oe(e),e?.vertices()}highlight(e,t){return e instanceof vi.CellView?r(e,t):function(e,t,n={}){const i=a(e,t);if(i)return r(i,n)}(this.#d,e,t)}unhighlight(e,t){e instanceof vi.CellView?s(e,t):function(e,t,n){const i=a(e,t);i&&s(i,n)}(this.#d,e,t)}setLinkLabel(e,t,n={}){(e=this.#oe(e))&&!this.isReadOnly()&&!e.isReadOnly()&&e.allow(f.ALLOW_LABEL_CHANGE)&&(n.cls=this.#x.style.linkLabelCls,function(e,t,n="",i={}){const{rewrite:o=!1,...r}=i;if(!(t=R(e,t)))return;let s=t.labels(),a=s.length,l=0;s[0]?.designation?(l=1,1===a?t.label(l,f.getLabelCfg(n,r)):o?t.label(l,f.getLabelCfg(n,r),{rewrite:o}):t.prop(`labels/${l}/${f.getLabelTextPath()}`,n)):a?o?t.label(l,f.getLabelCfg(n,r),{rewrite:o}):t.prop(`labels/${l}/${f.getLabelTextPath()}`,n):t.label(l,f.getLabelCfg(n,r))}(this.#h,e,t,n))}removeLinkLabel(e){(e=this.#oe(e))&&!this.isReadOnly()&&!e.isReadOnly()&&e.allow(f.ALLOW_LABEL_CHANGE)&&M(this.#h,e)}elementAt(e){return this.#h.getElements()[e]||null}linkAt(e){return this.#h.getLinks()[e]||null}load(e={}){this.deselect(),this.unhighlightRoute();const{cells:t=[]}=e,n=[];t.forEach((e=>{const{typeId:t}=e,i={};if(t){const o=this.#y.find((e=>e.typeId===t)),{text:r="",statusIcon:s,...a}=e;if(o){const t=o.element,l=t.prop("decorationPattern");let c;l&&(c=this.#q(l)),i.filters=this.#O,i.rtl=this.#x.rtl,i.type=t.get("type"),Object.keys(this.#P).forEach((n=>{i[n]=n in e?e[n]:t.prop(n)})),i.cls=[...t.get("cls")||[]],i.attrs={label:{text:r},glyph:{text:t.glyph()},statusIcon:{text:s?.glyph||"",...s?.color&&{fill:e.statusIcon.color}},...l&&{decorationPattern:{fill:`url(#${c})`}}},Object.assign(i,a),n.push(i)}}else{const t=[],{designation:o,requireSourceElement:r=!!this.#x.requireLinkSourceElement,requireTargetElement:s=!!this.#x.requireLinkTargetElement,labels:a,...l}=e;let c=this.#x.style.linkCls||[],h=this.#x.style.linkLabelCls||[],d=this.#x.style.linkDesignationCls||[];if(i.type="apex.SingleLink",i.cls=c,o){let e,n,r=o;"object"==typeof o&&({typeId:r,tooltip:e,tooltipPosition:n}=o);const s=this.#v.find((e=>e.typeId===r));if(s){const a=f.getLinkDesignationCfg({distance:30,glyph:s.glyph,designation:r,cls:d,tooltip:e,tooltipPosition:n});t.push(a),i.designation=o}}a&&a.forEach((e=>{const n=f.getLabelCfg(e.text||"",{...e.position&&{position:{distance:e.position.distance||.5,offset:e.position.offset||0}},cls:h});t.push(n)})),t.length&&(i.labels=t),Object.assign(i,{requireSourceElement:r,requireTargetElement:s,...l}),n.push(i)}})),n.length?(this.#h.fromJSON({cells:n}),this.#ce(e)):(this.clear(),this.isReadOnly()&&this.paperScroller.adjustPaper(),requestAnimationFrame((()=>{this.#J()})))}clear(e=!1,t=!0){this.#h.clear({silent:e}),t&&this.#g.center()}setElementText(e,t){const n=this.#ie(e);n&&!this.isReadOnly()&&!n.isReadOnly()&&n.allow(p.ALLOW_TEXT_CHANGE)&&n.text(t)}getElementText(e){const t=this.#ie(e);return t&&t.text()}getElements(){return this.#h.getElements()}getElementAt(e){return this.#h.getElements()[e]||null}getElementById(e){return C(this.#h,e)}getElementBy(e,t){return O(this.#h,e,t)}getElementIds(){return this.#h.getElements().map((e=>e.get("id")))}getLinks(){return this.#h.getLinks()}getLinkAt(e){return this.#h.getLinks()[e]||null}getLinkBy(e,t){return N(this.#h,e,t)}getLinkById(e){return T(this.#h,e)}select(e,{add:t=!1,scrollTo:n=!1}={}){e=Array.isArray(e)?e:[e],(e=A(this.#h,e)).length&&(nn(this.#u,e,{add:t,mode:this.#x.selectionMode}),n&&this.scrollIntoView(e[0]))}deselect(e){e&&(e=Array.isArray(e)?e:[e],e=A(this.#h,e)),on(this.#u,e)}getSelection(){return[...this.#u.collection.models]}requireView(e){(e=this.#ae(e))&&this.#d.requireView(e)}zoom(e,t=!1){if(!arguments.length)return this.getZoom();const n=this.#x;this.#g.zoom(e,{absolute:t,min:n.minZoom,max:n.maxZoom})}getZoom(){return this.#g.zoom()}clientToLocalPoint(e){const{x:t,y:n}=m(e)?e:{x:arguments[0],y:arguments[1]};return this.#d.clientToLocalPoint(t,n)}setReadOnly(e){e=!!e;const t=this.#x;t.readOnly!==e&&(t.readOnly=e,this.deselect(),this.graph.trigger("readonly",e),t.renderStencil&&(e?this.#Q():this.#ee()),e||this.unhighlightRoute())}getReadOnly(){return this.#x.readOnly}isReadOnly(){return this.getReadOnly()}startDragging(e,t){const n=this.#ne(e);this.isReadOnly()||this.#E.startDragging(n,t)}cancelDrag(){this.#E.cancelDrag()}hitTestElement(e,t){if(!(e=this.#ie(e)))return;const n=e.getBBox({rotate:!0});return m(t)?n.containsPoint(t):!!Array.isArray(t)&&t.filter((e=>n.containsPoint(e)))}showNavigator(){this.#te(!0)}hideNavigator(){this.#te(!1)}isNavigatorShown(){return this.#N}toFront(e){(e=(e=Array.isArray(e)?e:[e]).map((e=>this.#ae(e))).filter((e=>e))).length&&(this.#re(),function(e){(e=Array.isArray(e)?e:[e]).forEach((e=>e.toFront({deep:!0})))}(e),this.#se())}toBack(e){(e=(e=Array.isArray(e)?e:[e]).map((e=>this.#ae(e))).filter((e=>e))).length&&(this.#re(),function(e){(e=Array.isArray(e)?e:[e]).forEach((e=>e.toBack({deep:!0})))}(e),this.#se())}drawGrid(e){this.#d.setGrid({name:"mesh",args:{color:e}}),this.#d.drawGrid()}setDefaultRouter(e,t={}){const n=this.#d,i=this.#L.targetPaper,o=Oi(e,t);n.options.defaultRouter=i.options.defaultRouter={name:o.name,args:o.args},I(n),this.#N&&I(i)}getDefaultRouter(){return this.#d.options.defaultRouter}setLinkRouter(e,t,n={}){if(e=this.#oe(e))if(t){const i=Oi(t,n);e.router({name:i.name,args:i.args})}else e.unset("router")}getLinkRouter(e){if(e=this.#oe(e))return e.router()}scrollIntoView(e,t={}){x(this.#g,e,t)}destroy(){this.#R.removeEventListener("mousedown",this.#Z),this.#R.removeEventListener("touchstart",this.#Z),this.#R.removeEventListener("focus",this.onFocus),this.#R.removeEventListener("blur",this.onBlur),this.stopListening(),this.#a.destroy(),this.#l&&this.#l.destroy(),this.#c.destroy()}getCellZIndex(e){return this.#ae(e)?.get("z")}setCellZIndex(e,t){this.#ae(e)?.set("z",t)}suspendEvents(e){e=Array.isArray(e)?e:[e];const t=Object.values(hi);e.forEach((e=>{t.includes(e)&&!this.isEventSuspended(e)&&this.#C.push(e)}))}resumeEvents(e){e=Array.isArray(e)?e:[e],this.#C=this.#C.filter((t=>!e.includes(t)))}isEventSuspended(e){return this.#C.includes(e)}focus(){this.#R.focus()}hasFocus(){return this.#R.contains(document.activeElement)}showToast(e,t=3e3,n=!1){Qe(e,{foregroundContainerCls:this.#x.style.toastForegroundContainerCls,target:this.#R,duration:t,closeButton:n})}getElementConnectedLinks(e,t={}){let{outbound:n,inbound:i}=t;if(e=this.#ie(e))return n||i||(n=!0,i=!0),this.#h.getConnectedLinks(e,{outbound:!!n,inbound:!!i})}getElementLoopedLinks(e){if(e=this.#ie(e))return this.getElementConnectedLinks(e,{outbound:!0}).filter((e=>{const t=e.getTargetCell(),n=e.getSourceCell();return n&&t===n}))}setElementsConfig(e=[]){this.#K(e)}highlightRoute(e=[],t=!0,n={}){const i=this.#d,o=this.#h,r=this.#g,s=this.#x,a=[],{zoomAnimation:l=!1}=n,c=this.#L?.targetPaper;if(!s.readOnly)return;this.#_&&this.unhighlightRoute();const h=this.#x.routeHighlights.reduce(((e,t)=>(e[t.typeId]=t,e)),{}),d=e.map((e=>{const t=e.highlightTypeId,n=t?h[t]:null,i=e instanceof vi.Cell?e:this.#ae("string"==typeof e?e:e.cellId);a.push(i);return{cell:i,color:e.color??n?.color??"var(--a-diagram-route-default, #808080)",glyph:e.glyph??n?.glyph,glyphColor:e.glyphColor??n?.glyphColor,allowHighlightedOutboundLinks:n?.allowHighlightedOutboundLinks??!0}})).filter((e=>e.cell));if(d.length){this.#_=d.map((e=>e.cell)),this.#b=[];const e=this.#b;for(let t=d.length;t--;){const n=d[t],{cell:i,color:o}=n;if(!e.find((e=>e.cell===i))){const t={cell:i,color:o};if(i.isElement()){const e=i.statusIcon(),o=e?i.statusIconColor():null,{glyph:r="",glyphColor:s="#000000"}=n;r!==i.statusIcon()&&(t.prevGlyph=e,t.newGlyph=r),s!==i.statusIconColor()&&(t.prevGlyphColor=o,t.newGlyphColor=s)}e.push(t)}}e.reverse(),e.forEach((e=>{const{cell:t}=e;if(t.isElement()){const n={padding:0,className:"route-highlight",attrs:{stroke:e.color,"stroke-width":4}};if(e.highlightId=this.highlight(t,n),c){const i=c.findViewByModel(t),o=this.highlight(i,n);e.navigatorHighlightId=o}"newGlyph"in e&&(t.statusIcon(e.newGlyph),delete e.newGlyph),"newGlyphColor"in e&&(t.statusIconColor(e.newGlyphColor),delete e.newGlyphColor)}else t.findView(i).addCls("route-link"),t.route(!0,e.color);delete e.color}));if(d.filter((e=>e.cell.isLink())).forEach((e=>{const{cell:t}=e,n=t.getSourceElement(),o=d.find((e=>e.cell===n));o&&!1===o.allowHighlightedOutboundLinks&&(t.findView(i).removeCls("route-link"),t.route(!1),this.#b.splice(this.#b.findIndex((e=>e.cell===t)),1))})),t){const{width:e,height:t}=r.getClientSize(),n=r.getVisibleArea(),i=(g=this.#_.filter((e=>e.isElement())),null!=u?[...new Map(g.filter(Boolean).map((e=>[e[u],e]))).values()]:[...new Set(g)]),a=i.length;let c,h;for(;i.length&&(c=o.getCellsBBox(i),h=new Di.Rect(c).scale(s.minZoom,s.minZoom),!n.containsRect(c));){if(e>=h.width&&t>=h.height){const e=s.minZoom,t=i.length===a?r.zoom():s.minZoom;c.inflate(30),r[l?"transitionToRect":"zoomToRect"](c,{minScale:e,maxScale:t,scaleGrid:.1});break}i.shift()}}}var g,u}unhighlightRoute(){const e=this.#b,t=this.#d,n=this.#L?.targetPaper;e?.length&&e.forEach((e=>{const{cell:i,highlightId:o,prevGlyph:r,prevGlyphColor:s,navigatorHighlightId:a}=e;if(i.isElement()){if(this.unhighlight(i,o),i.statusIcon()!==r&&i.statusIcon(r),i.statusIconColor()!==s&&i.statusIconColor(s),a){const e=n.findViewByModel(i);this.unhighlight(e,a)}}else i.findView(t).removeCls("route-link"),i.route(!1)})),this.#b=null,this.#_=[]}hasHighlightedRoute(){return!!this.#_.length}getHighlightedRoute(){return this.#_}};g(Vi,{Event:hi,Router:h,KeyboardAction:sn,SelectionMode:zt,Locale:nt,Util:wi}),window.DiagramBuilder=Vi})();
/*!
 * Copyright (c) 2023, 2024, Oracle and/or its affiliates.
 */
/*!
 * Copyright (c) 2024, Oracle and/or its affiliates.
 */