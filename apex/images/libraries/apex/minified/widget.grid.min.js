/*!
 Copyright (c) 2015, 2024, Oracle and/or its affiliates.
*/
!function(t,e,l,s,i,o,n,a){"use strict";const r="a-GV",h=r+"--variableHeight",d=".a-GV-altMessage",c="a-GV-hdr",u="."+c,f="a-GV-bdy",p="."+f,m="a-GV-w-hdr",g="."+m,C="a-GV-w-scroll",_="."+C,v="a-GV-table",w="a-GV-row",b="."+w,I="."+v,S="tr",x="td,th",H="a-GV-cell",R="."+H,y="js-ScrollFiller",k="."+y,$="a-GV-header",D="."+$,M="a-GV-headerGroup",E="."+M,A="a-GV-headerLabel",F="a-GV-columnControls",T="."+F,G="a-GV-columnHandle",W="a-GV-rowHeader",V="u-selector",P=V+" "+V+"--single",L="js-selector-vh",N="."+V,O=N+",."+L,z="a-GV-table--checkbox",B="a-GV-selHeader",K="."+B,q=K+D,j=".a-GV-header,.a-GV-headerGroup,.a-GV-cell,.a-GV-controlBreakHeader",U=".a-GV-header,.a-GV-headerGroup",X="a-GV-controlBreak",Y="."+X,Q="a-GV-controlBreakHeader",J="."+Q,Z="."+H+",."+Q,tt="js-tabTrap",et="."+tt,lt="js-autoAdd",st="js-toggleBreak",it="."+st,ot=".a-GV-floatingItem",nt="a-GV-floatingItemContent",at="."+nt,rt="a-GV-expandCollapse",ht="."+rt,dt="a-GV-overflowCellHeading",ct="."+dt,ut="is-selected",ft="."+ut,pt="is-focused",mt="is-hover",gt="."+mt,Ct="is-disabled",_t="is-expanded",vt="is-active",wt="."+vt+R,bt="is-deleted",It="is-readonly",St="is-error",xt="is-warning",Ht="tr."+bt,Rt="is-aggregate",yt="aria-selected",kt="aria-multiselectable",$t="aria-readonly",Dt="aria-label",Mt="aria-description",Et="aria-hidden",At="aria-haspopup",Ft="aria-expanded",Tt="aria-checked",Gt="aria-roledescription",Wt="aria-pressed",Vt="aria-disabled",Pt="aria-modal",Lt="aria-owns",Nt="u-RTL",Ot="a-GV-frozen",zt="a-GV-frozen--start",Bt="a-GV-frozen--startLast",Kt="a-GV-frozen--endLast",qt=":visible",jt=":tabbable",Ut=":disabled,.js-asc,.js-desc",Xt=".js-load",Yt="click",Qt="none",Jt="sequence",Zt="label",te="true",ee="false",le="set",se="unset",ie="toggle",oe="range",ne="add",ae="none",re="all",he="columnReorder",de=40,ce="body",ue="class",fe="title",pe="style",me="role",ge="rowheader",Ce="gridcell",_e="abbr",ve="colspan",we="data-idx",be="data-id",Ie="data-rownum",Se="tabIndex",xe="tabindex",He="start",Re="end",ye="left",ke="right",$e="center",De="left",Me=t.hasOwnProperty,Ee=Object.entries,Ae=a.extend,Fe=Array.isArray,Te=a.ui.keyCode,Ge=navigator.appVersion.includes("Mac"),We=t.invokeAfterPaint,Ve=t=>parseInt(t,10);let Pe=0;const Le={begin:function(t,e,l){1===l.length&&e.records&&1===e.records.length?this.text="":(this.table=!0,this.text="<table><tbody>")},beginRow:function(){this.table&&(this.text+="<tr>")},cell:function(e,l,s,i){this.table?this.text+=`<td>${t.escapeHTML(i)}</td>`:this.text+=t.escapeHTML(i)},endRow:function(){this.table&&(this.text+="</tr>")},end:function(){this.table&&(this.text+="</tbody></table>")},toString:function(){return this.text}};function Ne(t,e){let l="";return t===He?l=" u-tS":t===Re?l=" u-tE":t===ye?l=" u-tL":t===ke?l=" u-tR":t!==$e||e||(l=" u-tC"),l}function Oe(t,e,l){let s;return t.highlight&&(s=e.highlights[t.highlight],s&&s.cssClass?l+=" "+s.cssClass:l+=" "+t.highlight),l}function ze(t,e,l,s,i){let o=w;return t.agg?(o+=" "+Rt,o+=" a-GV-aggregate--"+t.agg,t.grandTotal&&(o+=" is-grandTotal")):(t.hidden&&(o+=" u-hidden"),s.isDisabled(i,t)&&(o+=" "+Ct),(t.sel||l)&&(o+=" "+ut),t.deleted?o+=" "+bt:(t.inserted?o+=" is-inserted":t.updated&&(o+=" is-updated"),o=Oe(t,e,o),s.allowEdit(i)||(o+=" "+It)),t.error?o+=" "+St:t.warning&&(o+=" "+xt)),o}function Be(t,e,l,s,i,o,n){let a,r=!1,h=H;return h+=Ne(t.alignment),t.columnCssClasses&&(h+=" "+t.columnCssClasses),t.cellCssClassesColumn&&(h+=" "+o.getValue(n,t.cellCssClassesColumn)),i&&([ut,pt,vt,Ot,Bt,Kt].forEach((t=>{i.hasClass(t)&&(h+=" "+t)})),a=/(^|\s)a-GV-frozen--(start|end)\d+(\s|$)/.exec(i.attr(ue)),a&&(h+=" "+a[0].trim())),l&&(l.error?h+=" "+St:l.warning?h+=" "+xt:e.deleted||(l.changed?h+=" is-changed":l.stale&&(h+=" is-stale")),h=Oe(l,s,h),l.disabled&&(h+=" "+Ct),r=l.ck),(r||t.readonly)&&(h+=" "+It),t.usedAsRowHeader&&!e.agg&&(h+=" "+W),h}function Ke(t){return s.getMessage("APEX.GV."+t)}function qe(t,...e){return s.formatMessage("APEX.GV."+t,...e)}const je=t.binarySearch;function Ue(t,e){return t.offset-e.offset}function Xe(t){return t.parent().children().index(t)}function Ye(t){let e=a(t.toString());return e.find("a,button,input,select,textarea").prop(Se,-1),e}function Qe(t){return a(t).closest(j)}function Je(t){return a(t).closest(Z)}function Ze(t){return a(t).closest(R)}function tl(t,e){let l,s,i=t.children();return i.last().hasClass(M)?(s=0,i.each((function(){if(s+=Ve(a(this).attr(ve))||1,s>e)return l=a(this),!1}))):l=i.eq(e),l}function el(t){let e;return t.hasClass(M)?(e=0,t.parent().children().each((function(){if(this===t[0])return!1;e+=Ve(a(this).attr(ve))||1}))):e=Xe(t),e}const ll="keydown.gridGlobalEscape";function sl(t){a(ce).on(ll,(function(e){e.which===Te.ESCAPE&&(a(ce).off(ll),t())}))}function il(){a(ce).off(ll)}function ol(t){let e=t.groupName||null;return e&&t.useGroupFor&&t.useGroupFor.indexOf("heading")<0&&(e=null),e}function nl(t){return t.closest(S)}function al(t,e,l){t.hasClass(B)?t.find(N).trigger(Yt):(l._activateColumnHeader(e,t),e.preventDefault())}a.widget("apex.grid",a.apex.tableModelViewBase,Ae(!0,{widgetEventPrefix:"grid",options:{columns:null,columnGroups:null,columnSort:!0,columnSortMultiple:!0,resizeColumns:!0,reorderColumns:!0,collapsibleControlBreaks:!0,aggregateLabels:{},aggregateTooltips:{},tabbableCellContent:"a,button,input,span[role='checkbox']",allowEditMode:!0,allowDelete:!0,allowInsert:!0,allowCopy:!0,skipReadonlyCells:!1,rowHeader:Qt,rowHeaderCheckbox:!1,rowHeaderLabelColumn:null,rowHeaderWidth:null,selectCells:!1,multiple:!1,multipleCells:!0,selectAll:!0,allowSelectHidden:!1,selectionStatusMessageKey:"APEX.GV.SELECTION_COUNT",selectionStateItem:null,tooltip:{tooltipClass:"a-GV-tooltip"},dataTransferFormats:[{format:"text/plain",writer:Object.create({begin:function(){this.text=""},beginRow:function(t){t>0&&(this.text+="\r\n")},cell:function(t,e,l,s){t>0&&(this.text+="\t"),this.text+=s},endRow:function(){},end:function(){},toString:function(){return this.text}})},{format:"text/html",writer:Object.create(Le)}],constrainNavigation:!0,selectionChange:null,currentCellChange:null,activateColumnHeader:null,activateCell:null,expansionChange:null,cancelColumnHeader:null,sortChange:null,columnReorder:null,columnResize:null,modeChange:null,pageChange:null},_create:function(){const e=this,s=this.options,i=this.element;l.info(`Grid '${i[0].id}' created. Model: ${s.modelName}`),i.addClass(r).attr(me,"grid"),s.multiple&&i.attr(kt,te),s.editable||i.attr($t,te),s.fixedRowHeight||i.addClass(h),this.forwardKey=Te.RIGHT,this.backwardKey=Te.LEFT,"rtl"===i.css("direction")&&(i.addClass(Nt),this.forwardKey=Te.LEFT,this.backwardKey=Te.RIGHT),this._enforceOptionConstraints(),this._super(),Pe+=1,this.idPrefix=i[0].id||"agv_"+Pe,this.tableHeader$=null,this.tableData$=null,this.lastEditModeCell=null,this.controlBreaks=[],this.editMode=!1,this.columns=null,this.columnsStale=!0,this.columnGroups=null,this.lastFrozenColIndex=-1,this.endFrozenColIndex=-1,this.lastFocused=null,this.lastRow$=null,this.focusInHeader=!1,this.lastHoverCell=null,this.lastHoverRow=null,this.lastColIndex=null,this.columnControls$=null,this.scrollTimerId=null,this.deactivateDelayTimer=null,this.lastFloatingPos={},this.allSelected=!1,this.hasSelection=!1,this.activateContext=null,this.gotoCellPending=null,this._initContextMenu(S,(function(t){return a(t.target).closest("a").length>0||e.editMode}),(function(t){var l;if((l=Ze("keydown"===t.type?e.lastFocused:t.target)).length){if(e.options.selectCells){if(!l.hasClass(ut))return l}else if(!l.parent().hasClass(ut))return l;return!0}return!1}),(function(t){e.options.selectCells?t.selectedRange=e.getSelectedRange():t.selectedRecords=e.getRecords(t.selection)})),this._initModel(s.modelName),this._on(this._eventHandlers),s.allowCopy&&o.addHandler(i[0],(function(t){return!e.editMode&&!s.disabled&&(e._copy(t),!0)})),this._selNotifyDelay=t.debounce(this._selChangeNotify,1),this._selNotifyLongDelay=t.debounce(this._selChangeNotify,350),this._updateHighlights(),this.refresh(),this._setSelectionMode(),s.disabled&&this._setOption("disabled",s.disabled)},_eventHandlers:{resize:function(t){t.target===this.element[0]&&(this.resize(),t.stopPropagation())},click:function(t){const e=this.options,l=a(t.target);let s,i;if(l.closest("a,button,.a-GV-footer").length)return s=l.closest(U),void(s.length?(this.focusInHeader=!0,this.lastColIndex=null,this._select(s,t,!0,!1)):(s=l.closest(Z),s.length&&!this.editMode&&(this.focusInHeader=!1,this.lastColIndex=null,this._select(s,ae,!1,!1),l.trigger("focus"))));if(!(l.closest(ot).length>0)){if(s=l.closest(q),s.length)return this.focusInHeader=!0,this.lastColIndex=null,void(e.rowHeaderCheckbox&&e.multiple&&e.selectAll&&!e.selectCells?(i=s.find(N).attr(Tt)===te,i?this.setSelection(a()):!e.pagination.scroll&&e.persistSelection&&t.shiftKey?(this.focusInHeader=!1,this._select(this._getAllSelectableRows().map((function(){return a(this).children()[0]})),ne,!1,!1),this.focusInHeader=!0):this.selectAll(),this._select(s,t,!0,!1),this._setFocusable(s[0])):this._select(s,t,!0,!1));if(s=l.closest(E),s.length)return this.focusInHeader=!0,this.lastColIndex=null,this._select(s,t,!0,!1),void t.preventDefault();if(s=l.closest(D),s.length&&0===l.closest("button").length)return this.focusInHeader=!0,this.lastColIndex=null,this._select(s,t,!0,!1),this._activateColumnHeader(t,s),void t.preventDefault();if(s=l.closest(K),s.length)return e.rowHeaderCheckbox&&!e.selectCells&&(t.ctrlKey=!0,t.shiftKey=!1),this.focusInHeader=!1,this.lastColIndex=null,this._select(s,t,!0,!1),void t.preventDefault();if(s=l.closest(R),s.length)return this.focusInHeader=!1,this.lastColIndex=null,void(s.hasClass(vt)||(this._checkInteractWithCellItem(t,l,s),this._select(s,t,!0,!1),t.preventDefault()));s=l.closest(J),s.length&&(this.focusInHeader=!1,this.lastColIndex=null,this._select(s,t,!0,!1),t.preventDefault())}},dblclick:function(t){const e=this.options,l=a(t.target).closest(R).not(K);l.length&&(e.editable&&e.allowEditMode?this.editMode||this.setEditMode(!0,!0):this._fireActivate(t,l))},mousedown:function(t){const e=a(t.target);if(0!==(t.originalEvent||t).button||e.closest("a,button,.a-GV-footer").length)return void(this.focusInHeader=e.closest(U).length>0);if(e.closest(ht).length||!this.editMode)return void t.preventDefault();const l=e.closest(R);this.editMode&&l.length&&!l.hasClass(vt)&&(this.activateContext=t.clientX-t.target.getClientRects()[0].x,this._checkInteractWithCellItem(null,e,l))},keydown:function(t){const e=this,l=this.options,s=t.which,i=a(t.target);let o,n,r,h,d,c,u,f,p=null;function m(t,l){let s=null;for(let i=t+=l;i>=0&&i<e.columns.length;i+=l)if(!e.columns[i].hidden){s=i;break}return s}function g(){t.ctrlKey=!1,l.pagination.scroll&&e.firstPage(),p=e.tableData$.children().first().children().first(),e.focusInHeader=!1}function C(){t.ctrlKey=!1,l.pagination.scroll&&e.lastPage(),p=e.tableData$.children(qt).last(),p.hasClass(y)?(p=null,e.element.one("gridpagechange",(()=>{e._select(e.tableData$.children().last().children().last(),{type:"keydown",shiftKey:t.shiftKey},!0,!1)}))):p=p.children().last(),e.focusInHeader=!1}function _(t,l){e.element.one("gridpagechange",(()=>{setTimeout((()=>{e._select(e.tableData$.children()[t]().children().eq(l),null,!0,!0)}),0)}))}function v(){const l=e.element.find(Xt);if(l[0]){if(l[0].disabled)return!0;l[0].focus(),t.preventDefault()}return!1}if(!(i.closest(".a-GV-footer").length>0)){if(s!==Te.PAGE_UP&&s!==Te.PAGE_DOWN||(d=this.viewportHeight/this.avgRowHeight),s===Te.HOME)!this.editMode&&this.lastFocused&&(this.lastColIndex=null,t.ctrlKey&&!Ge?g():p=this.lastRow$.first(),t.preventDefault());else if(s===Te.END)!this.editMode&&this.lastFocused&&(this.lastColIndex=null,t.ctrlKey&&!Ge?C():p=this.lastRow$.last(),t.preventDefault());else if(s===Te.PAGE_DOWN){if((!this.editMode||Qe(this.lastFocused).hasClass(B))&&!t.altKey){if(this.focusInHeader){n=Qe(this.lastFocused);let t=n.closest("thead").children(),e=t.length-t.index(n.parent());n=this._getNextCellDown(Qe(this.lastFocused),e)}else n=Je(this.lastFocused);if(p=this._getNextCellDown(n,d),!p)if(l.pagination.loadMore){if(v())return}else if(!l.pagination.scroll){let t=this.model.getTotalRecords();(t<0||this.pageOffset+this.pageCount<t)&&(_("first",el(n)),this.nextPage())}t.preventDefault()}}else if(s===Te.PAGE_UP)this.focusInHeader||this.editMode&&!Qe(this.lastFocused).hasClass(B)||t.altKey||(n=Je(this.lastFocused),p=this._getPrevCellUp(n,d,!0),p||!l.pagination.scroll&&this.pageOffset>0&&(_("last",el(n)),this.previousPage()),t.preventDefault());else if(s===Te.DOWN){if(n=Qe(this.lastFocused),l.columnSort&&t.altKey&&n.hasClass($))return void e._sortChange(t,n,"desc");if((!this.editMode||this.focusInHeader||n.hasClass(B)||n.hasClass(Q))&&this.lastFocused)if(t.altKey)Ge&&t.altKey&&C();else{if(p=this._getNextCellDown(n,1),!p&&l.pagination.loadMore&&v())return;(p||l.constrainNavigation)&&t.preventDefault()}i.closest("[data-menu]").length&&t.stopPropagation()}else if(s===Te.UP){if(n=Qe(this.lastFocused),l.columnSort&&t.altKey&&n.hasClass($))return void e._sortChange(t,n,"asc");(!this.editMode||this.focusInHeader||n.hasClass(B)||n.hasClass(Q))&&this.lastFocused&&(t.altKey?Ge&&t.altKey&&g():(i.is(Xt)?(this.focus(),t.preventDefault()):p=this._getPrevCellUp(n,1),(p||l.constrainNavigation)&&t.preventDefault()),t.stopPropagation())}else if(s===this.backwardKey){if(t.altKey||t.metaKey)return;if(n=Qe(this.lastFocused),(t.ctrlKey||t.shiftKey)&&(n.hasClass($)||n.hasClass(M))&&(!n.hasClass(B)||l.rowHeader===Jt||l.rowHeader===Zt)&&(h=Ve(n.attr(we)),!isNaN(h)||t.ctrlKey||l.rowHeader===Jt||l.rowHeader===Zt))if(h>=0&&(r=this.columns[h]),t.shiftKey&&l.reorderColumns){if(t.preventDefault(),n.hasClass(M))c=Xe(n.parent()),h>0&&(this.moveColumnGroup(c,h,h-1),n=a(this.lastFocused).closest(E));else if(h=m(h,-1),null!==h)return void this.moveColumn(r,h)}else if(t.ctrlKey&&l.resizeColumns&&!n.hasClass(M))return void(r?n.outerWidth()>de&&(f=n.outerWidth()-10,f<de&&(f=de),this.setColumnWidth(r,f)):e.rowHeaderWidth>de&&(f=e.rowHeaderWidth-10,f<de&&(f=de),e.rowHeaderWidth=f,this._calculateColumnWidths(n,!0)));(!this.editMode||this.focusInHeader||n.hasClass(Q))&&this.lastFocused&&(this.lastColIndex=null,o=this.lastRow$.index(n),o>0&&(o-=1,p=this.lastRow$.eq(o)),t.preventDefault())}else if(s===this.forwardKey){if(t.altKey)return;if(n=Qe(this.lastFocused),(t.ctrlKey||t.shiftKey)&&(n.hasClass($)||n.hasClass(M))&&(!n.hasClass(B)||l.rowHeader===Jt||l.rowHeader===Zt)&&(h=Ve(n.attr(we)),!isNaN(h)||t.ctrlKey||l.rowHeader===Jt||l.rowHeader===Zt))if(h>=0&&(r=this.columns[h]),t.shiftKey&&l.reorderColumns){if(t.preventDefault(),n.hasClass(M))c=Xe(n.parent()),h<this.columnGroups[c].length-1&&(this.moveColumnGroup(c,h,h+1),n=a(this.lastFocused).closest(E));else if(h=m(h,1),null!==h)return void this.moveColumn(r,h)}else if(t.ctrlKey&&l.resizeColumns&&!n.hasClass(M))return void(r?this.setColumnWidth(r,n.outerWidth()+10):(e.rowHeaderWidth+=10,this._calculateColumnWidths(n,!0)));(!this.editMode||this.focusInHeader||n.hasClass(Q))&&this.lastFocused&&(this.lastColIndex=null,o=this.lastRow$.index(n),o<this.lastRow$.length-1&&(o+=1,p=this.lastRow$.eq(o)),t.preventDefault())}else if(65===s&&t.ctrlKey&&!this.editMode&&l.multiple&&l.selectAll&&!l.selectCells)!l.pagination.scroll&&l.persistSelection&&t.shiftKey?this._select(this._getAllSelectableRows().map((function(){return a(this).children()[0]})),ne,!1,!1):this.selectAll(null),t.preventDefault();else if(s===Te.SPACE){if("BUTTON"===t.target.nodeName)return;n=Qe(this.lastFocused),n.hasClass($)&&t.preventDefault(),!n.hasClass(H)||this.editMode&&!n.hasClass(B)||this._checkInteractWithCellItem(t,i,n)||t.preventDefault()}else if(s===Te.ENTER){if(!i.hasClass(rt)&&i.closest("a,button,.js-uses-enter").length>0)return;if(n=i.filter(K).find(N),n.length)return void n.trigger(Yt);n=Qe(this.lastFocused),this.editMode&&(n.hasClass(H)||n.hasClass(Q))?(t.shiftKey?(p=this._getPrevCellUp(n,1,!0),t.shiftKey=!1):p=this._getNextCellDown(n,1),this.activateContext=-1):(t.preventDefault(),l.editable&&l.allowEditMode&&n.hasClass(H)&&!n.hasClass(B)?this.setEditMode(!0,!0):n.hasClass($)?al(n,t,this):l.editable&&l.allowEditMode||!n.hasClass(H)||this._fireActivate(t,n))}else if(113===s)n=Ze(this.lastFocused),n.length&&l.editable&&l.allowEditMode&&!this.editMode&&this.setEditMode(!0,!0);else if(s===Te.ESCAPE)l.editable&&l.allowEditMode&&this.editMode&&this._doEscapeKey(t);else if(s===Te.DELETE){if(l.editable&&l.allowDelete&&!this.editMode&&!this.focusInHeader){u=this.getSelectedRecords();for(let t=0;t<u.length;t++)this.model.allowDelete(u[t])||(u.splice(t,1),t-=1);u.length>0&&this.model.deleteRecords(u)}}else 45===s?l.editable&&l.allowInsert&&!this.editMode&&!l.selectCells&&this.model.allowAdd()&&(u=this.getSelectedRecords(),u.length>0?this.model.insertNewRecord(null,u[u.length-1]):this.model.insertNewRecord()):112===s&&t.altKey?this._doHelpKey():s===Te.TAB&&this.editMode&&(this.activateContext=-1,this.lastKeyTab=!0);p&&(this._select(p,t,!0,!0),t.preventDefault())}},keyup:function(t){const e=t.which,l=a(t.target);let s;if(!(l.closest(".a-GV-footer").length>0)&&e===Te.SPACE){if(s=l.filter(K).find(N),s.length)return s.trigger(Yt),void t.preventDefault();s=Qe(this.lastFocused),s.hasClass($)?al(s,t,this):!s.hasClass(H)||this.editMode&&!s.hasClass(B)||this._select(s,t,!0,!0)}},focusin:function(t){let e,l,s=null,i=this,o=a(t.target);if(o.closest(ot).length)this._clearDeactivate();else if(e=o.closest(j),0!==e.length)if(e.addClass(pt),this.lastEditModeCell!==e[0]){if(this.editMode){let n=this.activateContext;this.focusInHeader=!1,l=a(this.lastEditModeCell),this._clearDeactivate(),l.length&&this._deactivateCell(l),e.hasClass(H)||e.hasClass(Q)?!e.hasClass(B)&&!e.hasClass(Q)||this.lastKeyTab?(o.closest("a,button").length&&(s=t.target),setTimeout((function(){i.editMode&&!e.hasClass(vt)&&i._activateCell(e,s,n)}),0)):(this._clearTabTraps(),this.lastEditModeCell=null,this._setFocusable(t.target),this._setTabTraps(e)):(this.focusInHeader=!0,this.lastEditModeCell=null,this._setFocusable(t.target))}else this._setFocusable(t.target);this.lastKeyTab=!1,this.activateContext=null}else this._clearDeactivate();else o.hasClass(tt)||(this.lastEditModeCell=null)},focusout:function(t){const e=a(t.target).closest(j),l=this._getColumnMetadata(e),s=l&&this.columnItems[l.property];e.removeClass(pt),this.editMode&&e.hasClass(H)&&(null===this.lastEditModeCell&&this._clearTabTraps(),s&&s.item.isDisabled()||this._beginDeactivate(e))},mousemove:function(t){var e,l,s,i,o,n=a(t.target),r=this.options,h=n.closest(j);t=t.originalEvent||t,h.length?h[0]!==this.lastHoverCell&&((e=h.parent())[0]!==this.lastHoverRow&&(this._clearHoverStates(),this.lastHoverRow=e[0],!e.hasClass(w)&&!e.hasClass(X)||this.columnReordering||this.columnWidthDragging||this._setRowHoverState(e)),this.lastHoverCell=h[0],this.columnControls$.hide(),this.columnHandle$.hide(),"TH"!==h[0].nodeName||h.hasClass(H)||e.hasClass(X)||(i=this.columns[h.attr(we)],!r.columnSort||this.columnReordering||this.columnWidthDragging||h.hasClass(B)||h.hasClass(M)||!i.canSort||(h.append(this.columnControls$.show()),this._updateColumnControls(i)),!r.reorderColumns||0!==t.buttons||this.columnReordering||this.columnWidthDragging||h.hasClass(B)||(this.columnReorderCell$=h,h.append(this.columnHandle$.show().css(De,""))),!r.resizeColumns||this.columnReordering||this.columnWidthDragging||h.hasClass(B)&&r.rowHeader!==Jt&&r.rowHeader!==Zt||(l=h.closest("div")[0],s=h[0].offsetLeft+l.offsetLeft-l.scrollLeft,this.element.hasClass(Nt)||(s+=h.outerWidth()),this.columnWidthHandle$.show().css(De,s-this.columnWidthHandle$.width()/2),o=h.attr(we),this.columnWidthCell$=o?this._columnFromIndex(o):this.element.find(D+K)))):null!==this.lastHoverCell&&(this.lastHoverCell=null,this.lastHoverRow=null,this._clearHoverStates())},mouseleave:function(){null!==this.lastHoverCell&&(this.lastHoverCell=null,this.lastHoverRow=null,this._clearHoverStates())}},_doEscapeKey:function(t){const e=Ze(this.lastFocused);e.length&&this._setFocusable(e[0]),e.trigger("focus"),this.setEditMode(!1),e.length&&this._setFocus(this._getCellFocusable(e)),t.stopPropagation()},_doHelpKey:function(){const t=Qe(this.lastFocused);if(!t.hasClass(B)&&!t.hasClass(M)&&!t.hasClass(Q)){let e=this._getColumnMetadata(t);e&&e.helpid&&(this.editMode&&t.trigger("focus"),apex.theme.popupFieldHelp(e.helpid,apex.env.APP_SESSION))}},_initTooltips:function(e){var s,i=this;a.ui.tooltip?(this.tooltipOptions&&(this.element.find(p).filter(":data('ui-tooltip')").tooltip("destroy"),this.tooltipOptions=null),e&&((s=this.tooltipOptions=Ae(!0,{show:apex.tooltipManager.defaultShowOption(),tooltipClass:"a-GV-tooltip"},e)).items=x,s._originalContent=s.content,s.content=function(e){let l,o,n,r=a(this),h=r.parent(),d=null,c=null,u=i._getColumnMetadata(r);return l=h.attr(be),l&&(d=i.model.getRecordMetadata(l)),u&&d&&d.fields&&(c=d.fields[u.property]),d&&(c&&(c.error||c.warning)?(o=c.error?St:xt,n=c.message):(d.error||d.warning)&&r.hasClass(B)?(o=d.error?St:xt,n=d.message):d.agg&&u&&(o="",n=i.options.aggregateTooltips[d.agg+"|"+u.property]),n)?`<span class='${o}'>${t.escapeHTML(n)}</span>`:s._originalContent?s._originalContent.call(this,e,i.model,d,c,u):null},s.open=function(t,e){e.tooltip.find("."+St).length&&e.tooltip.addClass(St),e.tooltip.find("."+xt).length&&e.tooltip.addClass(xt)},this.element.find(p+","+u).tooltip(s))):l.warn("tooltip option ignored because missing tooltip widget dependency")},_destroy:function(){const t=this.element;this._tableModelViewDestroy(),t.removeClass(r+" "+Ct+" "+Nt).removeAttr(me).removeAttr(kt).removeAttr($t).removeAttr(Vt).empty(),o.removeHandler(t[0]),l.info(`Grid '${t[0].id}' destroyed. Model: ${this.options.modelName}`),this.tableData$=null,this._initModel(null),this.gridStyles$&&this.gridStyles$.remove(),this._destroyContextMenu()},_setOption:function(t,e){const s=this.element,i=this.options;if(l.info(`Grid '${s[0].id}' set option '${t}' to:`,e),this._checkContextMenuOptions(t,e),"allowCopy"===t)throw new Error(`Grid ${t} cannot be set`);"editable"===t&&!e&&this.editMode?this.setEditMode(!1):"multiple"===t&&this.setSelection(a()),this._super(t,e),this._enforceOptionConstraints(),"disabled"===t?(s.toggleClass(Ct,e),e?s.attr(Vt,te):s.removeAttr(Vt),this.lastFocused&&(e?this.lastFocused.tabIndex=-1:this._setFocusable(this.lastFocused)),e&&this.resize()):"selectCells"===t?this._setSelectionMode():"multiple"===t?(e?s.attr(kt,te):s.removeAttr(kt),i.rowHeader!==Qt&&i.rowHeaderCheckbox&&this.refreshColumns(),this.refresh()):"modelName"===t?(this.editMode&&this.setEditMode(!1),this._initModel(e),this.refresh(!1)):"highlights"===t?this._updateHighlights():"tooltip"===t?this._initTooltips(e):"hideEmptyFooter"===t?this._updateTotalRecords():"fixedRowHeight"===t?(s.toggleClass(h,!e),this._refreshGrid()):["rowHeader","rowHeaderCheckbox","rowHeaderLabelColumn","columnSort","resizeColumns","reorderColumns","editable","selectAll","autoAddRecord","footer","pagination","rowsPerPage"].includes(t)&&("editable"===t&&(e?s.removeAttr($t):s.attr($t,te)),this._refreshGrid())},_enforceOptionConstraints:function(){const t=this.options,e=this.element;function s(t,l){return parseFloat(e.css(t))||l}if(t.rowHeaderCheckbox&&t.rowHeader===Qt&&(l.warn("Option rowHeaderCheckbox cannot be true when rowHeader is 'none'."),t.rowHeaderCheckbox=!1),!t.multiple||t.rowHeader!==Qt&&t.rowHeaderCheckbox||!apex.userHasTouched()||(t.rowHeader===Qt&&(t.rowHeader="plain"),t.rowHeaderCheckbox=!0),t.editable&&t.allowEditMode||(t.autoAddRecord=!1),t.rowHeader!==Qt)if(t.rowHeaderWidth)this.rowHeaderWidth=t.rowHeaderWidth;else{let e;e=t.rowHeader===Jt||t.rowHeader===Zt?t.rowHeaderCheckbox?s("--js-gv-row-header-width-ctrl-text",72):s("--js-gv-row-header-width-text",54):t.rowHeaderCheckbox?s("--js-gv-row-header-width-ctrl",34):s("--js-gv-row-header-width-plain",16),this.rowHeaderWidth=e}},refresh:function(t){const e=this,s=this.options,i=this.element;let o,n,r,h,d,c,f,m,g,C,v=!1,w=null,I=null,H=null;if(l.info("Grid '"+i[0].id+"' refreshed. Model: "+s.modelName),!0!==t&&(v=this._paginationHasFocus()),void 0===t&&(t=a(document.activeElement).closest(i[0]).length>0),!this._refreshCheckIfVisible())return;if(this._checkDelayRefresh(t))return;w=i.find(wt),w.length&&this._deactivateCell(w),w=a(this.lastFocused).closest(x),h=Xe(w),d=w.parent().attr(be),this.focusInHeader?this.columnsStale&&this.columns&&(H=Xe(a(this.lastFocused).closest(S)),o=a(this.lastFocused).closest("th").attr(we),o&&(o=this.columns[o].property),this.lastFocused=null):this.lastFocused=null;let y=this.modelChanged;if(this.modelChanged=!1,!this.tableData$||s.persistSelection&&!s.selectCells)s.persistSelection&&(C=this.hasSelection,this.hasSelection=!1);else if(s.selectCells)n=this.getSelection(),n.length>0&&(w=n[0].first(),r=Xe(w),I={rowIndex:Xe(w.parent()),colIndex:r});else{n=this.getSelection(),I=[];for(let t=0;t<n.length;t++)f=n[t].first().attr(be),void 0!==f&&I.push(f);0===I.length&&(I=null)}if(!s.hasSize&&this.tableData$){let t=i.find(p);t.css("min-height",t.height()+"px")}this._refreshPagination(i.find(_)),this.columnsStale||!this.columns?this._initGrid():(this.tableData$.empty(),this._clearChildrenRowCache(),this._updateScrollHandler(i.find(_))),this.controlBreaks=[],this._updateStatus(),this.noData||this.resize(),m=i.find(u),null!==H&&o&&(g=s.columns[0][o],g&&(o=g.seq-1,m.find("thead").each((function(){if(w=a(this).children().eq(H).find("th[data-idx='"+o+"']"),w.length)return!1}))),w&&w.length||(w=m.find("thead").first().find(S).eq(H).children().first()),w&&w.length&&(e._select(w,null,t,!1,!0),t=!1)),this.allSelected=!1,this._addPageOfRecords((function(){let l,o,u,f=!1;if(v&&(e._restorePaginationFocus(v),t=!1),i.find(D+" "+N).attr(Vt,e.noData?te:ee).toggleClass(Ct,e.noData),s.hasSize?e._calculateColumnWidths(null,!0,!0):i.find(p).css("min-height",""),e.lastHoverCell=null,e.lastHoverRow=null,e.activeRecord&&e.activeRecord!==e.model.getRecordMetadata(e.activeRecordId)?.record&&e._deactivateRow((()=>{})),!e.lastFocused||!a(e.lastFocused).is(qt)){let t=i.find("[data-id='"+d+"']");t[0]||(t=i.children(p).find("tbody .a-GV-row").first()),e.lastRow$=null,e.lastFocused=e._getCellFocusable(t.children().eq(h>=0?h:0)),e.lastFocused?(e.selectAnchor=a(e.lastFocused).closest(R)[0],!s.selectCells&&e.selectAnchor&&(e.selectAnchor=e.selectAnchor.parentNode),e.focusInHeader=!1):(e.lastFocused=e._getCellFocusable(m.find("thead").first().find(S).last().children().first()),e.focusInHeader=!0),e.lastFocused&&!s.disabled&&(u=e.lastFocused,e._setFocusable(e.lastFocused),e._setCurrentRow(e.lastFocused))}if(I){if(s.selectCells)e.tableData$.find(b).length>I.rowIndex&&(r=I.colIndex,c=e.tableData$,l=c.find(b).eq(I.rowIndex).children(),r>=l.length&&(r=l.length-1),e.setSelection([l.eq(r)]),f=!0);else{n=[];for(let t=0;t<I.length;t++)o=e.model.getRecord(I[t]),o&&n.push(o);n.length>0&&(f=0!==e.setSelectedRecords(n,!1,!0))}f&&!y||e._selNotifyDelay(!0,null)}else s.persistSelection&&(C||y)&&e._selNotifyDelay(!0,null);u&&f&&(e._setFocusable(u),e._setCurrentRow(u)),e._updateHeaderFooter(m),t&&e.focus()}))},focus:function(){this.lastFocused&&(this.lastFocused.focus(),this.focusInHeader=a(this.lastFocused).closest(U).length>0)},gotoCell:function(t,e){var s,i,o,n,a=this.options,r=!1,h=null,d=null,c=this.element.find("[data-id='"+t+"']");if(this.gotoCellPending=null,this.tableData$){if(e&&((h=a.columns[0][e])?h.hidden&&h.canHide&&(h.hidden=!1,r=!0,this.refreshColumns(),this.gotoCellPending={record:t,column:e}):l.warn("Warning column not found "+e)),!c.length){if(!(s=this.model.getRecord(t)))return void l.warn("Warning record not found "+t);i=this.model.indexOf(s),this.gotoCellPending={record:t,column:e},a.pagination.scroll?(o=this.scrollParent$,n=Math.floor(i*this.avgRowHeight),o.scrollTop(n)):(this.pageOffset=Math.floor(i/this.pageSize)*this.pageSize,r=!0)}r&&this.refresh(!1),this.gotoCellPending||(e&&h&&(d=this._cellFromColumn(c,e)),d||(d=c.children().first()),this._select(d,null,!0,!1))}},getActiveCellFromColumnItem:function(t){var e,l=null;if(this.activeRecordId){e=this.element.find("[data-id='"+this.activeRecordId+"']");for(const[s,i]of Object.entries(this.columnItems))t===i.item.node&&(l=this._cellFromColumn(e,s))}return l},inEditMode:function(){return this.editMode},setEditMode:function(t,e=!1){let s,i,o=!1,n=this;const a=()=>{this.columnItemsContainer$.off("change.gridedit"),this.activeRecord=null,this.activeRecordId=null},r=()=>{t=!!t,this.lastFloatingPos={},s=t!==this.editMode,this.editMode=t,this.element.toggleClass("a-GV--editMode",t),i=Ze(this.lastFocused),i.length&&(t?this._activateCell(i,null,e?-1:null):(this.lastEditModeCell=null,this._clearDeactivate(),this._deactivateCell(i),this.activeRecord&&(this._deactivateRow(a),o=!0))),s&&(t?this.columnItemsContainer$.on("change.gridedit",(function(t){let e,l,s;if(n.activeRecord)for(e=0;e<n.columns.length;e++)if(l=n.columns[e],l.elementId===t.target.id){s=l.property,n.setActiveRecordValue(s);break}})):o||a(),apex.message.ariaMessage(Ke(t?"ENTER_EDIT_MODE":"LEAVE_EDIT_MODE")),this._trigger("modeChange",null,{editMode:t}))};this.tableData$&&(this.options.editable?r():t&&l.warn("Grid is not editable."))},getSelection:function(){let t=[];return this.tableData$&&(this.options.selectCells?this.tableData$.find(ft).parent(S).each(((e,l)=>{t.push(a(l).find(ft).filter(x))})):this.tableData$.find(ft).filter(S).each(((e,l)=>{t.push(a(l))}))),t},setSelection:function(t,e,l){let s,i=null,o=this.options.multiple,n=[];if(this.tableData$){if(this.options.selectCells)Fe(t)||(t=[t]),s=t[0].first()[0],n.push(t[t.length-1].last()[0]),s!==n[0]&&(this._select(a(s),null,null,!1,!1),i={type:"click",shiftKey:!0});else if(Fe(t)){let e=t.length;!o&&e>1&&(e=1);for(let l=0;l<e;l++)s=t[l].children(x)[0],s&&n.push(s)}else t.each((function(){if(s="TR"===this.nodeName?a(this).children(x)[0]:a(this).closest(x)[0],s&&(n.push(s),!o))return!1}));this._setSelection(n,i,e,l)}},_setSelection:function(t,e,l,s){let i=this.lastFocused,o=this.focusInHeader;this.focusInHeader=!1,this._select(a(t),e,l,!1,s),l||(this.focusInHeader=o,o&&(this._setFocusable(i),this._setCurrentRow(i)))},selectAll:function(t,e){const l=[],s=this.options,i=this.tableData$;i&&s.multiple&&s.selectAll&&!s.selectCells&&(i.children(b).each((function(){l.push(a(this).children()[0])})),this._setSelection(l,re,t,e))},getCurrentCell:function(){return this.lastFocused?Qe(this.lastFocused):a()},setCurrentCell:function(t,e){(t=t.first()).is(j)&&t.closest(this.element)[0]&&(this._setFocusable(t[0]),e&&this.focus())},getRecords:function(t){var e,l,s,i=[];for(e=0;e<t.length;e++)void 0!==(l=t[e].attr(be))&&(s=this.model.getRecord(l))&&i.push(s);return i},getColumnForCell:function(t){return this._getColumnMetadata(t)},getSelectedRange:function(){var t,e,l,s,i,o,n,a=null;if(this.options.selectCells)for(a={columns:[],recordIds:[],values:[]},t=this.getSelection(),e=0;e<t.length;e++){if(i=t[e],0===e)for(l=0;l<i.length;l++)n=this._getColumnMetadata(i.eq(l)),a.columns.push(n?n.property:null);for(o=i.first().parent().attr(be),a.recordIds.push(void 0!==o?o:null),s=[],l=0;l<i.length;l++)s.push(i.eq(l).text());a.values.push(s)}return a},getSelectedRecords:function(){const t=this.options;return t.selectCells?[]:t.persistSelection?this.model.getSelectedRecords():this.getRecords(this.getSelection())},setSelectedRecords:function(t,e,l){let s=0,i=t.length,o=[],n=new Set,r=this.tableData$;if(!r||this.options.selectCells||this.renderInProgress)return-1;!this.options.multiple&&i>1&&(i=1);for(let e=0;e<i;e++)n.add(this.model.getRecordId(t[e]));if(r.children(b).each((function(){var t=a(this),e=t.attr(be);n.has(e)&&(n.delete(e),o.push(t.children()[0]),s+=1)})),this._setSelection(o,null,e,l),this.options.persistSelection){for(let t of n){this.model.getRecord(t)&&(this.model.setSelectionState(t,!0),s+=1)}0!==o.length||l||this._selNotifyDelay(!0,null)}return s},activateRow:function(t,e){const l=a(this.lastEditModeCell),s=t.parent().attr(be);let i=!1;this.editMode&&s===this.activeRecordId||(this.element.one("apexbeginrecordedit",(function(){e()})),i=!0),this.editMode?(l.length&&(l.removeClass(pt),this._deactivateCell(l)),t.addClass(pt),this._activateCell(t)):(this.lastFocused=t[0],this.setEditMode(!0)),i||e()},activateCell:function(t){const e=a(this.lastEditModeCell);return!!this.editMode&&(e.length&&(e.removeClass(pt),this._deactivateCell(e)),t.addClass(pt),this._activateCell(t))},copyDownSelection:function(t,e){return this._setSelectionValues(1,t,e)},fillSelection:function(t,e,l){return this._setSelectionValues(0,e,l,t)},_setSelectionValues:function(t,e,l,s){var i,o,n,r=this,h=this.editMode,d=this.lastFocused,c=0,u=this.options;function f(){for(var t,e,s;;){if(c>=i.length||!o.length){(s=a(r.lastEditModeCell)).removeClass(pt),h?s.length&&r._deactivateCell(s):r.setEditMode(!1),r.setSelection(i),a(d).trigger("focus"),l&&l();break}if(c>0&&(n=u.selectCells?i[c]:i[c].children()),c+=1,t=n.first().parent().attr(be),r.model.allowEdit(r.model.getRecord(t))){e=n.first(),!u.selectCells&&u.rowHeader!==Qt&&n.length>=2&&(e=n.eq(1)),r.activateRow(e,(function(){setTimeout(p,0)}));break}}}function p(){var t;function e(){var t,e,l,s=[];for(t=0;t<o.length;t++)e=o[t],r.activateCell(n.eq(e.index))&&(l=e.item.reinit(e.value,e.displayValue))&&s.push(l);if(s.length>0)for(let t=0;t<s.length;t++)s[t]();setTimeout(f,0)}r.activeLockCount>0?(t=r.activeUnlockCallback,r.activeUnlockCallback=function(){t&&t(),e()}):e()}return!((i=this.getSelection()).length<=t)&&(e||(e=[],u.selectCells?this.getSelectedRange().columns.forEach((function(t){t&&e.push(t)})):this.columns.forEach((function(t){var l=t.property;!l||t.hidden||t.virtual||t.noCopy||r.model.isIdentityField(l)||!t.elementId||t.readonly||e.push(l)}))),n=u.selectCells?i[c]:i[c].children(),this.activateRow(n.first(),(function(){o=[],n.each((function(l){var i,n,h,d=a(this),c=r._getColumnMetadata(d);c&&e.indexOf(c.property)>=0&&c.elementId&&(n={index:l,item:i=r.columnItems[c.property].item},1===t?(n.value=i.getValue(),h=i.displayValueFor(n.value),n.value!==h&&(n.displayValue=h)):s.v&&s.d?(n.value=s.v,n.displayValue=s.d):n.value=s,o.push(n))})),f()})),!0)},resize:function(){const t=this.element,e=this.options,l=t.height(),s=t.width(),i=t.children(u),o=t.children(p);let n,a,r;null!==t[0].offsetParent&&(o.length&&!this.pendingRefresh?(r=this.tableData$.prev().height(),t.find(p+" "+I).css("margin-top",-(r+Ve(this.tableHeader$.find("th").first().css("border-bottom-width")))),n=s,t.find(_+","+g).width(n),e.hasSize&&(a=l-i.height()-this._footerHeight(),o.children(_).addBack().height(a)),this._calculateColumnWidths(null,!0,e.hasSize||this.tableData$.parent().width()>n),this._initPageSize(),this._updateHeaderFooter(i)):this.renderInProgress||this.refresh())},expandControlBreak:function(t){this._expandCollapseControlBreak(t,!0)},collapseControlBreak:function(t){this._expandCollapseControlBreak(t,!1)},getColumns:function(){return this.columns},refreshColumns:function(){this.columnsStale=!0},setColumnWidth:function(t,e){var l=this._updateColumnWidth(t,e,!0);this._trigger("columnResize",null,{header$:l[1],column:l[0],width:e})},hideColumn:function(t){var e=this._columnName(t);this.options.columns[0][e].hidden=!0,this._refreshGrid()},showColumn:function(t){var e=this._columnName(t);this.options.columns[0][e].hidden=!1,this._refreshGrid()},freezeColumn:function(t){var e,l,s=this.columns,i=this._columnName(t);for(e=0;e<s.length&&(l=s[e],e<s.length-1&&(l.frozen=!0),l.property!==i);e++);this._refreshGrid()},unfreezeColumn:function(t){var e,l,s=this._columnName(t);for(e=this.columns.length-1;e>=0&&((l=this.columns[e]).frozen=!1,l.property!==s);e--);this._refreshGrid()},moveColumn:function(t,e){var l=this._moveColumn(t,e);this._refreshGrid(),l.header$=this._columnFromIndex(e),this._trigger(he,null,l)},moveColumnGroup:function(t,e,l){var s,i,o,n,a,r,h,d=[];if(!(o=this.columnGroups[t]))throw new Error("Invalid column group level: "+t);for(n=-1,s=0;s<o.length;s++)i=o[s],s===e&&(n=i.start,a=i.end),s===l&&(r=-1===n?i.start:i.end);if(l>e)for(s=n;s<=a;s++)(h=this._moveColumn(this.columns[n],r)).newPosition=r-(a-s),h.oldPosition=s,d.push(h),this._updateColumns();else for(s=a;s>=n;s--)(h=this._moveColumn(this.columns[a],r)).newPosition=r+(s-n),h.oldPosition=s,d.push(h),this._updateColumns();for(this._refreshGrid(),s=0;s<d.length;s++)(h=d[s]).header$=this._columnFromIndex(h.newPosition),this._trigger(he,null,h)},_refreshGrid:function(){const t=this.element.find(wt);t.length&&this._deactivateCell(t),this.refreshColumns(),this.refresh()},_cellFromColumn:function(t,e){var s,i,o=this.columns,n=this.options,a=null,r=0;if(!n.columns[0][e])return l.warn("Warning column not found "+e),null;for(n.rowHeader!==Qt&&(r=1),s=0;s<o.length;s++)if(!(i=o[s]).hidden){if(i.property===e){a=t.children().eq(r);break}r+=1}return s>=o.length&&l.warn("Warning column is hidden "+e),a},_columnFromIndex:function(t){return this.element.find(".a-GV-header[data-idx='"+t+"']")},_columnName:function(t){var e;if(e="object"==typeof t?t.property:t,!this.options.columns[0][e])throw new Error("Unknown column: "+e);return e},_moveColumn:function(t,e){var l,s,i,o,n=this.columns,a=this._columnName(t);for(i=-1,l=0;l<n.length;l++)if((s=n[l]).property===a){i=l;break}if(o=n[e].seq,i!==e){if(i<e)for(l=e;l>i;l--)n[l].seq=n[l-1].seq;else for(l=e;l<i;l++)n[l].seq=n[l+1].seq;return n[i].frozen=e<=this.lastFrozenColIndex,n[i].seq=o,{column:s,newPosition:e,oldPosition:i}}},_updateColumns:function(){let t,e,l,s,i,o,n,a,r,h,d,c,u,f={},p=this.options,m=p.columns[0];this.columns=[],this.columnsStale=!1,this.columnGroups=[],this.breakColumns=[],this.fieldToColumnIndex={};for(const[t,e]of Ee(m))e.property=t,e.domId=e.elementId?e.elementId+"_HDR":this.idPrefix+"_h_"+e.property,e.seq=e.seq||"0",this.columns.push(e);for(this.columns.sort((function(t,e){return t.seq-e.seq})),this.lastFrozenColIndex=-1,u=p.rowHeader!==Qt?1:0,t=0;t<this.columns.length;t++)if(l=this.columns[t],!l.hidden){if(!l.frozen)break;u<20&&(u+=1,this.lastFrozenColIndex=t)}for(this.endFrozenColIndex=-1,t=this.columns.length-1;t>0;t--)if(l=this.columns[t],!l.hidden){l.frozen&&(this.endFrozenColIndex=t);break}for(h=p.rowHeader!==Qt?1:0,t=0;t<this.columns.length;t++)l=this.columns[t],l.controlBreakIndex>0&&this.breakColumns.push(l),l.hidden||(this.fieldToColumnIndex[l.property]=h,h+=1);for(this.breakColumns.sort((function(t,e){return t.controlBreakIndex-e.controlBreakIndex})),i=null,n=null,a=null,d=!0,h=0,o=0,e=0,c=[],t=0;t<this.columns.length;t++)if(l=this.columns[t],!l.hidden){if(null===i&&(i=[],this.columnGroups.push(i)),r=ol(l),r!==n||t===this.lastFrozenColIndex+1){if(n=r,a&&(a.span=h-o,a.end=e,a.children=c,c=[]),o=h,r){if(a=Ae({},p.columnGroups[r]),!a)throw new Error("Unknown column group name: "+r);a.heading&&(d=!1,f[r]||(a.domId=this.idPrefix+"_g_"+r)),a.property=r,i.push(a)}else a={},i.push(a);a.start=t,t<=this.lastFrozenColIndex&&(a.frozen=!0,f[r]=1)}c.push(l),h+=1,e=t,null===a&&(a={start:t},this.lastFrozenColIndex>=0&&(a.frozen=!0),i.push(a))}for(a&&(a.span=h-o,a.end=e,a.children=c),d&&(this.columnGroups=[],i=null);i;){for(s=i,i=null,n=null,a=null,d=!0,h=0,c=[],t=0;t<s.length;t++){if(l=s[t],r=l.parentGroupName||null,r!==n||l.frozen!==(!!a&&a.frozen)){if(n=r,null===i&&(i=[],this.columnGroups.unshift(i),h>0&&(a={},l.frozen&&(a.frozen=!0),i.push(a))),a&&(a.span=h-o,a.children=c,c=[]),o=h,r){if(a=Ae({},p.columnGroups[r]),!a)throw new Error("Unknown column group name: "+r);a.heading&&(d=!1,f[r]||(a.domId=this.idPrefix+"_g_"+r)),a.property=r,i.push(a)}else a={},i.push(a);a.start=l.start,l.frozen&&(a.frozen=!0,f[r]=1)}c.push(l),a.end=l.end,h+=l.span}a&&(a.span=h-o,a.end=l.end,a.children=c),d&&(this.columnGroups.shift(),i=null)}},_initGrid:function(){const e=this,s=this.options,i=this.element,o="scroll.gvss";let r,h,d,c,f,m,C,v,w,b,I,S=0,x=0,H=null;function R(){S!==x&&(r[0].scrollLeft=S=x,h[0].scrollLeft=S,b.css(De,S)),H=null}function y(){var t=e.element.find(wt);e.floatingItem$.hasClass(_t)?e._collapseFloatingItem(t):e._expandFloatingItem(t)}l.info("Grid render and initialize."),this._updateColumns(),this.columnItems||this._initColumnItems(this.columns),this._renderGrid(),i.find(u+" "+jt).prop(Se,-1),s.tooltip&&this._initTooltips(s.tooltip),s.rowHeader!==Qt&&s.rowHeaderCheckbox&&(this.tableHeader$.parent().addClass(z),this.tableData$.parent().addClass(z)),r=i.find(g),h=i.find(_),d=i.children(p),v=d.find("col"),w=d.find("thead").find(".a-GV-header"),I=this.tableData$.parent().width()-t.getScrollbarSize().width,r.add(h).width(I),v.each((function(t){var l=a(this),s=e.columns[l.attr(we)];s&&(s.width?s.curWidth=s.width:s.curWidth=s.defWidth=w.eq(t).width(),s.curWidth<de&&(s.curWidth=de))})),b=this.tableData$.parent().parent().find(Xt),h.on(o,(function(){x=this.scrollLeft,H||(H=We(R))})),r.on(o,(function(){x=this.scrollLeft,H||(H=We(R))})),f=this.element.find(et),this.tabTraps$=f,2===f.length?m=0:(3===f.length&&(m=1,C=0),f.eq(C).on("focus",(function(){a(this).hasClass(lt)&&e._autoAddRecord(e.activeRecord)}))),f.eq(m).on("focus",(function(){var t,l,s=a(e.lastEditModeCell).closest("tbody").find(jt).add(e.lastEditModeCell),i=s.index(e.lastEditModeCell);i>0?(e.activateContext=-1,s.first().trigger("focus")):(t=a(jt),l=e.element.find(jt).first(),i=t.index(l),t.eq(i-1).trigger("focus"))})),f.eq(m+1).on("focus",(function(){var t,l,s=a(e.lastEditModeCell).closest("tbody").find(jt).add(e.lastEditModeCell),i=s.index(e.lastEditModeCell);a(this).hasClass(lt)?e._autoAddRecord(e.activeRecord):i<s.length-1?(e.activateContext=-1,s.last().trigger("focus")):(t=a(jt),l=e.tableData$.find(jt).last(),i=t.index(l),t.eq(i+1).trigger("focus"))})),f.prop(Se,-1),s.reorderColumns&&this._initColumnReorder(),this.columnWidthHandle$=a(),s.resizeColumns&&this._initColumnResize(),this.columnControls$.on("click","button",(function(t){var l=a(t.target);e._sortChange(t,l.closest(D),l.closest("button").hasClass("js-asc")?"asc":"desc")})),this.floatingItem$.draggable({handle:".a-GV-cellMoveHandle",containment:"body",stop:function(t,l){var s=e._getColumnMetadata(e.element.find(wt)).property;e.lastFloatingPos[s]={left:l.position.left,top:l.position.top}}}).on("keydown",(function(t){var l=t.which;if(t.ctrlKey&&117===l)return y(),!1;112===l&&t.altKey?e._doHelpKey():l===Te.ESCAPE&&e._doEscapeKey(t)})).on("mousedown",(function(t){a(t.target).hasClass("a-GV-cellMoveHandle")&&e._clearDeactivate()})).on("focusin",(function(){e._clearDeactivate()})).on("focusout",(function(){e.lastEditModeCell&&e._beginDeactivate(a(e.lastEditModeCell))})).children(ht).on(Yt,y),n.TouchProxy.addTouchListeners(this.floatingItem$[0]),this._initPagination(i.find(u),h),this.breakColumns.length>0&&s.collapsibleControlBreaks&&i.find(p).on("click",it,(function(){s.disabled||(c=a(this).closest(Y),e._expandCollapseControlBreak([c],!c.hasClass(_t)))}))},_initColumnReorder:function(){var t,e,l,s,i,o,r,h,d,c,f,p,m,C,_=this.element.hasClass(Nt),v=this.element.find(u),w=this;v.append(this.columnMoveMarker$),C=Ve(w.columnHandle$.css("margin-left")),_&&(C=-C),w.columnHandle$.draggable({appendTo:this.element,containment:v,cursor:"move",cursorAt:_?{right:-2*C}:{left:0},axis:"x",helper:function(){var t=a("<div class='a-GV-header-dragHelper'></div>"),e=w.columnReorderCell$;return t.append(e.find(".a-GV-headerLabel,."+G).clone()).width(e.outerWidth()).height(e.outerHeight()),"fixed"===v.css("position")&&t.css("position","fixed"),t},start:function(n,u){let C=w.columnReorderCell$.outerHeight();w.columnControls$.hide(),w._trigger("cancelColumnHeader",n,{}),t=w.columnReorderCell$.parent().offset().top-w.element.offset().top,e=t+w.element[0].offsetTop,o=v.css("position"),h="absolute",r=102,d=-v.offset().left,"relative"!==o&&("fixed"===o&&(d=0,t=e=w.columnReorderCell$.parent()[0].offsetTop+v[0].offsetTop,h="fixed"),r=Ve(v.css("z-index"))+1),c=-w.columnMoveMarker$.width()/2,u.helper.css({top:e+"px",position:h,transform:"translateY("+C+"px)","z-index":r}),p=u.helper.outerWidth(),w.columnMoveMarker$.show().css({top:t+"px",left:w.columnReorderCell$.offset().left+d+(_?w.columnReorderCell$.width():0)+"px",position:h,height:C+"px","z-index":r}),w.columnReorderCell$.find(".a-GV-headerLabel,.a-GV-header-sort").hide(),w.columnHandle$.hide(),w.columnWidthHandle$.hide(),sl((function(){w.columnReorderCancel=!0})),f=Ve(w.columnReorderCell$.attr(we)),w.hdrScrollParent=w.element.find(g)[0],m=w.hdrScrollParent.scrollLeft,l=[],i=null,(s=nl(w.columnReorderCell$)).children().each((function(){var t=a(this),e=!0,s=t.offset().left+d;t.parent().parent().parent().parent()[0]===w.hdrScrollParent&&(s+=m,e=!1),l.push({colIdx:Ve(t.attr(we)),start:s,end:s+t.outerWidth(),frozen:e})})),w.columnReordering=!0,w.columnReorderCancel=!1},drag:function(t){var e=w.hdrScrollParent.scrollLeft,s=Ve(w.columnMoveMarker$.css(De));function o(){var o,n,a,r=!1,h=t.pageX-C+d+w.hdrScrollParent.scrollLeft;for(o=0;o<l.length;o++)if(h>=(n=l[o]).start&&h<n.end){o!==i&&(i=o,a=_?(n.colIdx<f?n.end:n.start)+c:(n.colIdx<f?n.start:n.end)+c,n.frozen||(a-=w.hdrScrollParent.scrollLeft),s=a,e=w.hdrScrollParent.scrollLeft,w.columnMoveMarker$.css(De,a+"px"),r=!0);break}r||e===w.hdrScrollParent.scrollLeft||(a=s-(w.hdrScrollParent.scrollLeft-e),w.columnMoveMarker$.css(De,a+"px"))}w.columnReorderCancel?t.preventDefault():(o(),w._headerScrollCheck(t.pageX-C,p)?w.scrollTimerId||w._headerScrollStart(t.pageX-C,p,o):w.scrollTimerId&&w._headerScrollStop())},stop:function(){var t=null;null!==i&&(t=l[i].colIdx),isNaN(t)&&i+1<l.length&&(t=l[i+1].colIdx),isNaN(t)||(w.columnReordering=!1,w.columnReorderCell$.find(".a-GV-headerLabel,.a-GV-header-sort").show(),t===f&&(w.columnHandle$.show(),w.columnWidthHandle$.show(),w.columnControls$.show()),w.columnMoveMarker$.hide(),w.lastHoverCell=null,il(),w.scrollTimerId&&w._headerScrollStop(),w.columnReorderCancel||null===t||t===f||(w.columnReorderCell$.hasClass(M)?w.moveColumnGroup(Xe(s),f,t):w.moveColumn(w.columns[f],t),w.focus()))}}),n.TouchProxy.addTouchListeners(w.columnHandle$[0])},_initColumnResize:function(){var t,e,l,s=this,i=this.element.hasClass(Nt)?-1:1,o=this.element.find(u),r=o.find(S).last();this.columnWidthHandle$=a("<div class='a-GV-columnWidthHandle'></div>").appendTo(o).css("top",r[0].offsetTop).height(r.height()),this.columnWidthHandle$.draggable({axis:"x",containment:o,start:function(i,o){s.columnWidthDragging=!0,s.columnWidthCancel=!1,s.columnWidthStartPos=o.position.left,s.columnWidthStartWidth=s.columnWidthCell$.first().outerWidth(),t=o.helper.outerWidth(),s.hdrScrollParent=s.element.find(g)[0],l=s.columnWidthCell$.parent().parent().parent().parent()[0]!==s.hdrScrollParent,e=s.hdrScrollParent.scrollLeft,sl((function(){s.columnWidthCancel=!0}))},drag:function(o,n){function a(t){var o,a,r=s.columnWidthStartWidth+i*(n.position.left-s.columnWidthStartPos);o=s.hdrScrollParent.scrollWidth,l||(r+=s.hdrScrollParent.scrollLeft-e),r>de&&(s.columnWidthCell$.hasClass(B)?(s.rowHeaderWidth=r,s._calculateColumnWidths()):s._updateColumnWidth(s._getColumnMetadata(s.columnWidthCell$.first()),r)),(a=s.hdrScrollParent.scrollWidth-o)<0&&!t&&s.hdrScrollParent.scrollLeft!==e&&(s.hdrScrollParent.scrollLeft+=a,e+=a)}s.columnWidthCancel?o.preventDefault():(a(),s._headerScrollCheck(n.offset.left,t)?s.scrollTimerId||s._headerScrollStart(n.offset.left,t,(function(){a(!0)})):s.scrollTimerId&&s._headerScrollStop())},stop:function(t,o){var n=s.columnWidthStartWidth+i*(o.position.left-s.columnWidthStartPos);l||(n+=s.hdrScrollParent.scrollLeft-e),s.columnWidthDragging=!1,il(),s.scrollTimerId&&s._headerScrollStop(),s.columnWidthCancel&&(n=s.columnWidthStartWidth),n<de&&(n=de),s.columnWidthCell$.hasClass(B)?(s.rowHeaderWidth=n,s._calculateColumnWidths(null,!0)):s.setColumnWidth(s._getColumnMetadata(s.columnWidthCell$.first()),n)}}),n.TouchProxy.addTouchListeners(this.columnWidthHandle$[0])},_updateColumnWidth:function(t,e,l){var s,i,o,n=this._columnName(t);return(s=this.options.columns[0][n]).width=e,s.curWidth=e,o=this.columns.indexOf(s),i=this._columnFromIndex(o),this._calculateColumnWidths(i,l),[s,i]},_calculateColumnWidths:function(e,l,s){var i,o,n,r,h,d,c,u,f,m=this.options.hasSize,g=this.element,C=this;function v(t){var e,l;for(e=t+1;e<C.columns.length;e++)if(!(l=C.columns[e]).hidden&&!l.noStretch&&e!==f)return!1;return!0}function w(t,e){var l=0,s=0,i=e.parent().find("col");return t.parent().find("col").each((function(t){var e,o,n=a(this),r=n.attr(we);e=r?(o=C.columns[r]).curWidth:C.rowHeaderWidth,(0===t&&!o||o.frozen)&&t<20&&(g.css("--a-gv-frozen-offset-"+(t+1),s+"px"),s+=e),n[0].width=e,i[t].width=e,l+=e})),g.css("--a-gv-scroll-pad-start",s+"px"),e.parent().width(l),t.parent().width(l),l}if(s)for(i=0;i<this.columns.length;i++)(o=this.columns[i]).curWidth=o.width||o.defWidth,o.curWidth<de&&(o.curWidth=de);if(e&&(h=e.parent().parent()[0],f=Ve(e.attr(we))),n=h&&h!==this.tableHeader$[0]?this.tableData$.parent().width():w(this.tableData$,this.tableHeader$),l&&(r=g.find(_)[0].clientWidth,m&&0===this.tableData$.children().length&&(r-=t.getScrollbarSize().width),n<r)){if((r=r-n-1)>10)for(u=r,i=0;i<this.columns.length;i++)(o=this.columns[i]).hidden||o.frozen||o.noStretch||i===f||(v(i)?o.curWidth+=u:(c=Math.floor(r*(o.curWidth/n)),o.curWidth+=c,u-=c));else for(i=this.columns.length-1;i>0;i--)if(!((o=this.columns[i]).hidden||o.frozen||o.noStretch||i===f)){o.curWidth=o.curWidth+r;break}w(this.tableData$,this.tableHeader$)}m&&(d=g.children(p),this._adjustSizeForScrollBars(d.height(),d.find(_).width()))},_addFrozenClasses:function(t,e,l,s){if(l.frozen){let i=l.span||1;void 0===s&&(s=l.end),s===this.endFrozenColIndex?t+=" "+Ot+" a-GV-frozen--end1"+Kt:s<=this.lastFrozenColIndex&&(t+=" "+Ot+" "+zt+e,s===this.lastFrozenColIndex&&(t+=" "+Bt),e+=i)}return[t,e]},_renderGrid:function(){const e=this,l=this.element,i=this.options,o=i.hasSize||i.stickyTop,n=t.htmlBuilder(),a="<table role='presentation' class='"+v+"'>",r="<span class='"+tt+" u-vh is-focusable' aria-hidden='true' tabindex='-1'></span>";let h,d,u;function p(t){i.rowHeader!==Qt&&t.markup("<col").optionalAttr("width",e.rowHeaderWidth).markup("/>");for(let l=0;l<e.columns.length;l++){const s=e.columns[l];s.hidden||t.markup("<col").optionalAttr("width",s.width).attr(we,l).markup("/>")}}function g(l,o){const n=e.columns,a=o?"visibility:hidden;":null;let r,h;function c(t){t.markup(`<tr class='${w}' role='row' `).optionalAttr(pe,a).markup(">")}for(let t=0;t<e.columnGroups.length;t++){const s=e.columnGroups[t];c(l),h=1,i.rowHeader!==Qt&&(r=M+" "+B+" "+Ot+" "+zt+"1",e.lastFrozenColIndex<0&&(r+=" "+Bt),h+=1,l.markup(`<th role='columnheader' class='${r}'`).attr(Gt,Ke("GROUP_CONTEXT")).optionalAttr(pe,a).markup(">"));for(let t=0;t<s.length;t++){const i=s[t],n=o?null:i.domId;r=M,r+=Ne(i.headingAlignment||$e,!0),[r,h]=e._addFrozenClasses(r,h,i),l.markup("<th role='columnheader' ").attr(ue,r).attr(Gt,Ke("GROUP_CONTEXT")).attr(ve,i.span).attr(we,t).optionalAttr(pe,a).markup(" tabindex='-1'><span class='"+A+"'").optionalAttr("id",n).markup(">"+(i.heading||"")).markup("</span></th>")}l.markup("</tr>")}c(l),h=1,i.rowHeader!==Qt&&(r=$+" "+B+" "+Ot+" "+zt+"1",e.lastFrozenColIndex<0&&(r+=" "+Bt),h+=1,l.markup(`<th role='columnheader' class='${r}'`).attr(_e,i.multiple?Ke("ROWS_SELECTION"):Ke("ROW_SELECTION")).optionalAttr(pe,a).markup(`><span class='u-vh ${A}'></span>`),i.rowHeaderCheckbox&&i.multiple&&i.selectAll&&l.markup(`<span class='${V}'`).attr(me,"checkbox").attr(Tt,ee).attr(Dt,Ke("SELECT_ALL_ROWS")).attr(fe,Ke("SELECT_ALL")).markup("></span>"),i.rowHeader===Jt?l.markup("<span class='a-GV-rownum' aria-hidden='true'></span>"):i.rowHeader===Zt&&l.markup("<span class='a-GV-rowLabel'></span>"),l.markup("</th>"));for(let c=0;c<n.length;c++){const f=n[c],p=o?null:f.domId;let m,g,C,_,v,w;f.hidden||(r=$,r+=Ne(f.headingAlignment||$e,!0),f.isRequired&&(r+=" is-required"),f.elementId&&!f.readonly||(r+=" "+It),f.headingCssClasses&&(r+=" "+f.headingCssClasses),[r,h]=e._addFrozenClasses(r,h,f,c),g=null,1===f.sortIndex&&("asc"===f.sortDirection?g="ascending":"desc"===f.sortDirection&&(g="descending")),f.sortDirection&&(m=qe("asc"===f.sortDirection?"SORTED_ASCENDING":"SORTED_DESCENDING",d?f.sortIndex:"")),C=i.activateColumnHeader&&!f.noHeaderActivate,v=null,_="",w=null,f.sortDirection&&d&&f.heading.length>0&&(v=t.stripHTML(f.heading)),C&&0===f.heading.length&&(v=" ",_=Ke("BLANK_HEADING"),w=s.getMessage("VISUALLY_HIDDEN_LINK")),l.markup("<th role='columnheader' ").attr(ue,r).attr(we,c).optionalAttr(pe,a).optionalAttr(_e,v).markup(" tabindex='-1'><span ").attr(ue,w?"u-vh "+A:A).optionalAttr("onmouseover",i.columnSort&&f.canSort?"void(0);":null).optionalAttr("aria-sort",u?g:null).optionalAttr("id",p).optionalAttr(me,C?"link":null).optionalAttr(Gt,w).optionalAttr(At,C?"dialog":null).markup(">").markup(_||f.heading).markup("</span>"),f.sortDirection&&(l.markup("<span class='a-GV-header-sort'").optionalAttr(Et,u).optionalAttr(me,d?"img":null).optionalAttr(Dt,d?m:null).markup("><span aria-hidden='true'").attr(ue,"a-Icon "+("asc"===f.sortDirection?"icon-irr-sort-asc":"icon-irr-sort-desc")).attr(fe,m).markup("></span>"),d&&l.markup("<span aria-hidden='true'>").content(f.sortIndex).markup("</span>"),l.markup("</span>")),l.markup("</th>"))}l.markup("</tr>")}h=0;for(let t=0;t<this.columns.length;t++)this.columns[t].sortDirection&&(h+=1);u=1===h,d=h>1,n.markup(`<div class='${c}${o?" "+c+"--fixed":""}'><div class='${m}'>${a}`),p(n),n.markup("<thead role='rowgroup'>"),g(n,!1),n.markup(`</thead></table></div></div><div class='${f}'>`),this._renderAltDataMessages(n,this.idPrefix),n.markup(`<div class='${C}' tabindex='-1'>${a}`),p(n),n.markup("<thead role='rowgroup' style='visibility:hidden'>"),g(n,!0),n.markup("</thead><tbody></tbody></table>"),this._renderLoadMore(n,Ke("PAGINATION_LANDMARK")),n.markup("</div>"),i.autoAddRecord&&n.markup(r),n.markup("</div>"),i.editable&&(n.markup("<div class='a-GV-floatingItem' tabindex='-1' style='display: none;'").attr("id",this.idPrefix+"_floatingItem_dialog").markup("><h1").attr("class","u-vh "+dt).attr(Et,"true").attr(Gt,s.getMessage("APEX.DIALOG.VISUALLY_HIDDEN_TITLE")),n.markup(`></h1><div class='a-GV-cellMoveHandle'></div><button type='button' class='${rt}' tabindex='-1'><span aria-hidden='true' class='a-Icon'></span></button>${r}<div class='${nt}'></div>${r}</div>`)),this._renderFooter(n,this.idPrefix),i.columnSort&&(n.markup(`<div class='${F}' style='display:none'`).attr(me,"group").attr(Dt,Ke("SORT_OPTIONS")).markup(">"),this._renderButton(n,"a-Button js-asc","icon-up-chevron",Ke("SORT_ASCENDING")),this._renderButton(n,"a-Button js-desc","icon-down-chevron",Ke("SORT_DESCENDING")),n.markup("</div>")),i.reorderColumns&&n.markup(`<div class='${G}' style='display:none'></div><div class='a-GV-colMoveMarker' style='display:none'><span class='a-GV-colMoveMarker-x'></span></div>`),this.floatingItem$&&this.floatingItem$.remove(),l.html(n.toString()),this.pageKey=null,this.tableHeader$=l.find(".a-GV-hdr .a-GV-table>thead"),this.tableData$=l.find(".a-GV-table>tbody"),this._clearChildrenRowCache(),this.columnControls$=l.find(T),this.columnControls$.find("button").attr(xe,-1),this.columnHandle$=l.find("."+G),this.columnMoveMarker$=l.find(".a-GV-colMoveMarker"),this.floatingItem$=l.find(ot)},_calcSpanAllColumns:function(t){let e,l,s=this.lastFrozenColIndex>=0||this.options.rowHeader!==Qt,i=0;null!=t&&s?t?(e=0,l=this.lastFrozenColIndex+1,this.options.rowHeader!==Qt&&(i+=1)):(e=this.lastFrozenColIndex+1,l=this.columns.length):(e=0,l=this.columns.length);for(let t=e;t<l;t++)this.columns[t].hidden||(i+=1);return i},_getHeaderHeight:function(){return this.element.find(u).outerHeight()},_selectedCount:function(){const t=this.options;let e=0;if(this.tableData$)return e=t.selectCells?this.tableData$.find(ft).filter(x).length:t.persistSelection?this.model.getSelectedCount():this.tableData$.find("tr.is-selected").length,e},_selectedStatusMessage:function(t){return this.options.selectCells?qe("SELECTION_CELL_COUNT",t):this._super(t)},_deletedRowsHidden:function(){this.element.find(Ht).removeClass(ut).removeAttr(yt)},_deletedCount:function(){return this.tableData$.find(Ht).length},_hasControlBreaks:function(){return this.breakColumns.length>0},_controlBreakSelector:function(){return Y},_getFixedRecordHeight:function(){let t,e=this.tableData$.find(S).filter(qt).first();return e.length?t=e.outerHeight():(e=a(`<tr class='${w}'><td class='${H}' style='visibility: hidden;'>T</td></tr>`),this.tableData$.append(e),t=e.outerHeight(),e.remove()),t},_getDataContainer:function(){return this.tableData$},_insertFiller:function(t,e){let l=a(t.toString());return e?e.last().before(l):this.tableData$.html(l),this._clearChildrenRowCache(),l},_insertData:function(t,e,l){const s=this.options;let i,o,n,r=Ye(t);e?e.last()[l](r):this.tableData$.append(r),this._clearChildrenRowCache(),this.allSelected&&s.pagination.scroll&&!s.persistSelection&&(o=r.map((function(t,e){return a(e).children()[0]})),n=this.focusInHeader,this.focusInHeader=!1,this._select(o,ne,null,!1),this.focusInHeader=n),s.selectCells||this.prevSelCount===this._selectedCount()||this._selNotifyDelay(!0),!s.pagination.scroll&&s.persistSelection&&this._updateSelectAll(),s.hasSize&&(i=this.element.children(p),this._adjustSizeForScrollBars(i.height(),i.find(_).width())),this.gotoCellPending&&setTimeout((()=>{this.gotoCell(this.gotoCellPending.record,this.gotoCellPending.column)}),0)},_controlBreakData:function(e){const l=this.options;let s="";for(let i=0;i<this.breakColumns.length;i++){let o,n,a=this.breakColumns[i];i>0&&(s+=", "),o=this.model.getValue(e,a.property),null===o&&(o=""),"object"==typeof o&&Me(o,"d")?o=o.d:(n=this.columnItems[a.property],n&&(o=n.item.displayValueFor(o))),""===o&&l.showNullAs&&(o=l.showNullAs),!1!==a.escape&&(o=t.escapeHTML(o)),(a.label||a.heading)&&(s+=`<span class='a-GV-breakLabel'>${a.label?t.escapeHTML(a.label):a.heading}:</span> `),s+=`<span class='a-GV-breakValue'> ${o}</span>`}return{label:s,controlBreakId:this.model.getControlBreakId(e)}},_renderBreak:function(t,e,l,s){const i=this.options,o=l.label,n=this._getControlBreak(s+1,!0);n?e=n.expanded:(this.controlBreaks.push({offset:s+1,label:o,expanded:e}),this.controlBreaks.sort(Ue));const a=this.lastFrozenColIndex>=0||i.rowHeader!==Qt;let r=Q;if(a&&(r+=" "+Ot+" "+zt+"1"),t.markup(`<tr role='row' class='${X}${e?" "+_t:""}'`).attr(be,l.controlBreakId).optionalAttr(Ie,null!=s?s+1:null).markup(`><th role='rowheader' class='${r}'`).attr(ve,this._calcSpanAllColumns(!0)).markup(">"),i.collapsibleControlBreaks){let l,s;e?(l="icon-down-arrow",s=Ke("BREAK_COLLAPSE")):(l="icon-right-arrow",s=Ke("BREAK_EXPAND")),this._renderButton(t,"a-Button "+st,l,s,e)}t.markup("<span class='a-GV-controlBreakLabel'>").markup(o).markup("</span></th>"),a&&t.markup(`<th role="rowheader" class="${Q}" colspan="${this._calcSpanAllColumns(!1)}"></th>`),t.markup("</tr>"),this.controlBreakCollapsed=!e},_renderFillerRecord:function(t,e){t.markup(`<tr aria-hidden="true" class="${e}"><td `).attr(ve,this._calcSpanAllColumns()).markup("></td></tr>")},_renderRecord:function(t,e,l,s,i){this._renderRow(t,e,l,s,i)},_insertRecord:function(e,l,s,i,o){const n=t.htmlBuilder();let r,h=[];return!e&&this._hasControlBreaks()&&((e=a(this.lastFocused).closest(Y)).length||(e=this.tableData$.find(Y).first()),e&&this._expandCollapseControlBreak([e],!0),o="after"),this._renderRow(n,l,null,s,i),r=Ye(n),h.push(r[0]),"after"===o&&e?e.after(r):this.tableData$.prepend(r),this._clearChildrenRowCache(),a(h)},_afterInsert:function(t){const e=!!this.element.find("."+pt).length||a(document.activeElement).hasClass(lt);let l,s=t[0].find(R).first();for(let e=0;e<this.columns.length;e++)if(l=this.columns[e],!l.hidden&&!l.readonly&&this.columnItems[l.property]){s=tl(t[0],this.fieldToColumnIndex[l.property]);break}setTimeout((()=>{this.focusInHeader=!1,this._select(s,null,e,!1,!1),e&&this.options.editable&&!this.editMode&&this.setEditMode(!0)}),0)},_updateRecordField:function(e,l,s,i){var o,n,a,r,h=this.fieldToColumnIndex[s],d=t.htmlBuilder();void 0!==h&&(o=tl(e,h),!this.editMode||l!==this.activeRecord||this.ignoreItemChange||i.agg||(n=this.columnItems[s])&&this._setColumnItemValue(n.item,l,s),o.hasClass(vt)||(a=this.options.columns[0][s],r=null,i.fields&&(r=i.fields[a.property]),d=t.htmlBuilder(),this._renderFieldDataValue(d,a,l,i,r),o.html(d.toString())))},_checkAllHidden:t.debounce((function(){const t=this.options.pagination;this.tableData$.children(b).is(":visible")?!t.scroll||t.loadMore||t.virtual||this.tableData$.height()<this.scrollParent$.height()&&this._addNextPage():(this.noData$.show(),this.noData$.parent().children().not(d).hide(),this.noData=!0)}),10),_updateRecordState:function(t,e,l,s,i){const o=this.options,n=!this.tooltipOptions;let r=ze(s,o,t.hasClass(ut),this.model,l),h=r.includes(" "+Ct);if(t.attr(ue,r),h?(t.attr(Vt,te),t.hasClass(ut)&&this._select(t.children(x).first(),se,a(document.activeElement).closest(t[0]).length>0,null)):t.removeAttr(Vt),"hidden"===i)return this.noData&&!s.hidden&&(this.noData$.hide(),this.noData$.parent().children().not(d).show(),this.noData=!1),void(this.noData||this._checkAllHidden());if(n&&(s.message?t.first().find(K).attr(fe,s.message):t.first().find(K).removeAttr(fe)),s.fields)for(const[e,i]of Ee(s.fields)){let a,h=this.fieldToColumnIndex[e];void 0!==h&&(a=tl(t,h),r=Be(o.columns[0][e],s,i,o,a,this.model,l),a.attr(ue,r),n&&(i.message?a.attr(fe,i.message):a.removeAttr(fe)))}},_removeRecord:function(t){t.remove()},_identityChanged:function(t,e){const l=this._elementsFromRecordIds([t])[0];l&&(l.attr(be,e),this.activeRecordId===t&&(this.activeRecordId=e))},_replaceRecord:function(e,l,s,i,o){const n=t.htmlBuilder();let r,h,d,c,u,f,p,m,g=null,C=null,_=[],v=e.children().first().find(".a-GV-rownum").text()||null;v&&(v=Ve(v)-1),this.activeRecordId===s&&(this.activeRecord=this.activeRecordId=null),h=e.hasClass(ut),d=e.find(this.lastFocused).length,d&&(m=this.lastFocused,u=Qe(m).hasClass(pt)),c=e.find(this.lastEditModeCell).length&&a(this.lastEditModeCell).hasClass(pt),c&&(m=this.lastEditModeCell),m&&(g=0,C=Xe(Je(m))),this._renderRow(n,l,v,i,o),r=Ye(n),_.push(r[0]),e.last().replaceWith(r),this._clearChildrenRowCache(),r=a(_),h&&r.add(r.find(".a-GV-selHeader .u-selector,.a-GV-selHeader ."+L).attr(Tt,te)).addClass(ut).attr(yt,te),c?this._activateCell(tl(r.eq(g),C)):d&&(p=tl(r.eq(g),C),f=this._getCellFocusable(p),this._setFocusable(f),this._setCurrentRow(p[0]),u&&this._setFocus(f))},_removeFocus:function(t){let e,l,s;e=a(this.lastFocused).closest(S),(e[0]===t[0]||t.length>1&&e[0]===t[1])&&(l=Ze(this.lastFocused),s=this._getNextCellDown(l,1),s||(s=this._getPrevCellUp(l,1)),s&&this._select(s,null,!0,!1))},_elementsFromRecordIds:function(e){let l=[];for(let s=0;s<e.length;s++){let i=this.tableData$[0].querySelector(`[data-id="${t.escapeCSS(e[s])}"]`);i&&l.push(a(i))}return l},_getControlBreak:function(t,e){let l,s=null;return this.breakColumns.length>0&&(l=je(this.controlBreaks,{offset:t},Ue),s=this.controlBreaks[l],e||s&&s.offset===t||(s=this.controlBreaks[l-1])),s},_renderRow:function(t,e,l,i,o){const n=this.options,a=this.columns,r=!this.tooltipOptions,h=Ke("SELECT_ROW");let d,c,u,f,p,m,g,C,_=1,v=null,w=null,b=null,I=!1;d=ze(o,n,null,this.model,e),I=d.includes(" "+Ct),o.agg?v=o.grandTotal?n.aggregateLabels[o.agg].overallLabel:n.aggregateLabels[o.agg].label:o.message&&r&&(w=o.message),m=void 0!==o.serverOffset?o.serverOffset+1:"",null===this.controlBreakCollapsed&&this._hasControlBreaks()&&(this.controlBreakCollapsed=!1,C=this._getControlBreak(m),C&&(C.expanded||this._controlBreakData(e).label!==C.label||(this.controlBreakCollapsed=!0))),t.markup("<tr role='row'").attr(be,i).optionalAttr(Ie,m).optionalAttr(Vt,I?te:null).attr(ue,d).optionalAttr(fe,v).optionalAttr(yt,o.sel?te:null).optionalAttr(pe,this.controlBreakCollapsed&&!o.agg?"display:none;":null).markup(">"),n.rowHeader!==Qt&&(g=o.agg||n.rowHeader===Zt,d=H+" "+B+" "+Ot+" "+zt+"1",g&&(d+=" "+W),this.lastFrozenColIndex<0&&(d+=" "+Bt),_+=1,t.markup("<th role='gridcell'").attr(ue,d).optionalAttr(fe,w).markup(">"),o.agg||(n.multiple?(c=n.rowHeaderCheckbox?V:L,f="checkbox",p=s.getMessage("APEX.CHECKBOX.VISUALLY_HIDDEN_CHECKBOX")):(c=n.rowHeaderCheckbox?P:L,f="radio",p=s.getMessage("APEX.RADIO.VISUALLY_HIDDEN_RADIO")),n.rowHeaderCheckbox&&o.sel&&(c+=" "+ut),t.markup("<span ").attr(ue,c).attr(me,f).optionalAttr(Gt,n.rowHeaderCheckbox?null:p).attr(Tt,o.sel?te:ee).attr(Dt,h).optionalAttr(fe,n.rowHeaderCheckbox?h:null).markup("></span>"),n.rowHeader===Jt&&t.markup("<span class='a-GV-rownum' aria-hidden='true'>").content(m).markup("</span>")),g&&(t.markup("<span class='a-GV-rowLabel'>"),o.agg?t.content(n.aggregateLabels[o.agg][o.grandTotal?"overallLabel":"label"]):n.rowHeaderLabelColumn&&t.markup(this.model.getValue(e,n.rowHeaderLabelColumn)),t.markup("</span>")),t.markup("</th>"));for(let l=0;l<a.length;l++){const s=a[l];u=null,o.fields&&(u=o.fields[s.property]),s.hidden||(d=Be(s,o,u,n,null,this.model,e),b=null,r&&(u&&u.message?b=u.message:o.agg&&(b=n.aggregateTooltips[o.agg+"|"+s.property])),[d,_]=this._addFrozenClasses(d,_,s,l),t.markup("<td tabindex='-1'").attr(me,s.usedAsRowHeader?ge:Ce).attr(ue,d).optionalAttr(fe,b).markup(">"),this._renderFieldDataValue(t,s,e,o,u),t.markup("</td>"))}t.markup("</tr>")},_getColumnMetadata:function(t){var e,l;if(t.hasClass(H))e=Xe(t),l=this.tableHeader$.children().last().children().eq(e);else{if(!t.hasClass($))return null;l=t}return e=Ve(l.attr(we)),isNaN(e)?null:this.columns[e]},_activateColumnHeader:function(t,e){const l=this._getColumnMetadata(e);l.noHeaderActivate||this._trigger("activateColumnHeader",t,{header$:e,column:l})},_activateRow:function(t){var e,l,s,i,o,n,a,r=t.parent(),h=r.attr(be),d=this;for(i=this.model.getRecord(h),o=this.model.getRecordId(i),a=this.model.allowEdit(i),n=this.model.getRecordMetadata(o),r.addClass(vt),this._beginSetColumnItems(),e=0;e<this.columns.length;e++)s=this.columns[e].property,(l=this.columnItems[s])&&this._setColumnItemValue(l.item,i,s,a?n:null);this.activeRecord=i,this.activeRecordId=o,this._endSetColumnItems(),setTimeout((function(){d._triggerBeginEditing(d.activeRecord,d.activeRecordId)}),0)},_deactivateRow:function(t){var e,l,s,i,o,n,a=this.element.find(".a-GV-row.is-active");if(this.activeLockCount>0)this.activeUnlockCallback=t;else{if(a.removeClass(vt),(i=this.model.getRecordMetadata(this.activeRecordId))&&!i.deleted&&this.model.allowEdit(this.activeRecord))for(e=0;e<this.columns.length;e++){let t=this.columns[e];s=t.property,(l=this.columnItems[s])&&((n=l.item.isDisabled())?this.model.setValidity("valid",this.activeRecordId,s):l.item.getValidity().valid||this.model.setValidity("error",this.activeRecordId,s,l.item.getValidationMessage(t.label||t.heading)),((o=i.fields?i.fields[s]:null)&&o.disabled||n)&&(o||(i.fields||(i.fields={}),o={},i.fields[s]=o),o.disabled=n))}this._triggerEndEditing(this.activeRecord,this.activeRecordId),this.activeRecord=null,this.activeRecordId=null,t()}},_beginDeactivate:function(t,e){this.deactivateDelayTimer||(this.deactivateDelayTimer=setTimeout((()=>{this.lastEditModeCell=null,this._deactivateCell(t),e&&(this.dontFocusEditableItem=!0,t.trigger("focus")),this.deactivateDelayTimer=null}),10))},_clearDeactivate:function(){this.deactivateDelayTimer&&(clearTimeout(this.deactivateDelayTimer),this.deactivateDelayTimer=null)},_setTabTraps:function(t){let e,l,s,i=this.options.autoAddRecord,o=i&&this.model.allowAdd(),n=this.tabTraps$;t.attr(xe,-1),e=this._nextCellWithWrap(t).attr(xe,0),this._prevCellWithWrap(t).attr(xe,0),s=null,i?(s=0,l=2):l=1,null!==s&&(i&&this.onLastPage&&0===e.length&&o?n.eq(s).prop(Se,0).addClass(lt):n.eq(s).prop(Se,e.length?0:-1).removeClass(lt)),i&&this.onLastPage&&0===e.length&&o?n.eq(l).prop(Se,0).toggleClass("js-last",!e.length).addClass(lt):n.eq(l).prop(Se,0).toggleClass("js-last",!e.length).removeClass(lt)},_clearTabTraps:function(){this.element.find(".a-GV-cell[tabindex='0'],.a-GV-controlBreakHeader[tabindex='0']").attr(xe,-1),this.tabTraps$.prop(Se,-1)},_activateCell:function(e,l,s){let i,o,n=this,r=!1,h=null,d=null,c=e.hasClass(Q);function u(t){(l=l||n._getCellFocusable(t))!==t[0]&&l.focus()}function f(){let l=0,c=e.outerHeight();if(i=n._getColumnMetadata(e),i&&(h=n.columnItems[i.property]),h&&n.model.allowEdit(n.activeRecord)&&!i.readonly&&!e.hasClass(It)){if(e.addClass(vt),o=h.item.getPopupSelector(),o&&a(document.body).on("focusin.gridpopup",(function(t){a(t.target).closest(o).length&&n._clearDeactivate()})).on("focusout.gridpopup",(function(t){if(a(t.target).closest(o).length){let t=a(n.lastEditModeCell);n._beginDeactivate(t,!0)}})),d=h.element$.height(),h.element$=h.element$.detach(),e.css("height",c+"px").empty(),d>c?(n.floatingItem$.children(at).append(h.element$),n._expandFloatingItem(e)):e.append(h.element$),n._activateColumnItem(h,i.domId),!n.dontFocusEditableItem&&!h.item.isDisabled()){h.item.setFocus();let i=document.activeElement;if("INPUT"===i.nodeName&&["text","search","password","tel","email","url"].includes(i.type.toLowerCase())){let o=a(i),r=i.value,h=n.element.hasClass(Nt),d=e.css("text-align");if(d===ye?d=He:d===ke&&(d=Re),s<0||0===r.length)i.setSelectionRange(0,r.length,h?"forward":"backward");else{if(null!=s){let i,h,c=a(`<span class="${H}" style="position:absolute;top:0;white-space:nowrap;">${t.escapeHTML(r)}</span>`);n.element.append(c),i=c.width(),h=i/r.length,(s-=d===Re?Math.max(0,e.outerWidth()-Ve(o.css("paddingRight"))-i):d===$e?Math.max(0,(e.outerWidth()-Ve(o.css("paddingRight"))-i)/2):Ve(o.css("paddingLeft")))<0&&(s=0),l=Math.round(s/h),c.remove()}i.setSelectionRange(l,l)}}}n.dontFocusEditableItem=!1,r=!0,n._savedActivationtarget&&(n._interactWithCellItem(a.Event("activate",{target:n._savedActivationtarget}),e,i,h.item),n._savedActivationtarget=null)}else u(e)}if(this.lastEditModeCell=e[0],e.parent().hasClass(ut)?this.lastRow$&&this.lastRow$.index(e)>=0||this._setCurrentRow(e[0]):this._select(e,null,!1,!1),this._setFocusable(e[0]),this._setTabTraps(e),!this.activeRecord||this.activeRecordId!==e.parent().attr(be)){if(this.activeRecord)return void this._deactivateRow((function(){c?u(e):(n._activateRow(e),f())}));c?u(e):this._activateRow(e)}return c?u(e):f(),r},_checkInteractWithCellItem:function(t,e,l){let s,i=!1,o=this._getColumnMetadata(l),n=o&&this.columnItems[o.property];return n&&(n=n.item,n&&n.getInteractionSelector&&(s=n.getInteractionSelector(),e.closest(s).length&&(t?(this._interactWithCellItem(t,l,o,n),i=!0):this._savedActivationtarget=e[0]))),i},_interactWithCellItem:function(t,e,l,s){const i=e.parent().attr(be),o=this.model.getRecord(i);"activate"===t.type?s.onInteraction(t):!this.model.allowEdit(o)||l.readonly||e.hasClass(It)||s.onInteraction(t,this.model,o,l.property)},_expandFloatingItem:function(e){const l=this.element.hasClass(Nt)?"right top":"left top",s=e.outerWidth(),i=this._getColumnMetadata(e),o=i.property,n=i.label||i.heading;let a,r,h;e.attr(Lt,this.floatingItem$.attr("id")),this.floatingItem$.find(ct).removeAttr(Et).html(t.escapeHTML(Ke("FLOATING_ITEM.DIALOG.TITLE"))),this.floatingItem$.find(ht).removeAttr(Ft).removeAttr(At).attr(Dt,Ke("FLOATING_ITEM.DIALOG.HIDE_DIALOG")),this.floatingItem$.attr("role","dialog").attr(Pt,"true").attr(Dt,Ke("FLOATING_ITEM.DIALOG.TITLE")).attr(Mt,n).css("position","").css("min-width",s+"px").appendTo(ce).show().addClass(_t).draggable("enable").attr("data-owning-region",this.element[0].id).find(ht+" span").removeClass("icon-ig-expand").addClass("icon-ig-restore"),this.floatingItem$.children(at).show().css({width:"",height:""}),h=this.lastFloatingPos[o],h?this.floatingItem$.css({left:h.left,top:h.top}):this.floatingItem$.position({my:l,at:l,of:e,collision:"fit fit"}),this.floatingItem$.find(et).not(".js-last").attr(xe,0),a=this._getColumnMetadata(e),a&&(r=this.columnItems[a.property],r.item.isDisabled()||r.item.setFocus())},_collapseFloatingItem:function(t){var e=t.innerWidth(),l=t.innerHeight();t.removeAttr(Lt),this.floatingItem$.find(ct).attr(Et,"true").empty(),this.floatingItem$.find(ht).attr(Ft,"false").attr(At,"dialog").attr(Dt,Ke("FLOATING_ITEM.SHOW_DIALOG")),this.floatingItem$.attr("role","none").removeAttr(Pt).removeAttr(Dt).removeAttr(Mt).css({position:"relative",left:"",top:""}).appendTo(t).draggable("disable").removeClass(_t+" ui-state-disabled").removeAttr("data-owning-region").find(ht+" span").removeClass("icon-ig-restore").addClass("icon-ig-expand"),this.floatingItem$.children(at).hide().width(e).height(l),this.floatingItem$.find(ht).trigger("focus"),this.floatingItem$.find(et).not(".js-last").attr(xe,-1)},_deactivateCell:function(e){var l,s,i,o,n=null;if(!(e.length<=0)&&(this._clearTabTraps(),this._setFocusable(e[0]),(l=this._getColumnMetadata(e))&&(n=this.columnItems[l.property]),n&&e.hasClass(vt))){if(a(document.body).off(".gridpopup"),this._setModelValue(e,n.item,this.activeRecord,l.property),!(i=this.model.getRecordMetadata(this.activeRecordId)))return;o=null,i.fields&&(o=i.fields[l.property]),this.debugDontDeactivateCell?e.addClass(pt+" "+vt):(this.floatingItem$.appendTo(ce),this._deactivateColumnItem(n),this.floatingItem$.hide(),s=t.htmlBuilder(),this._renderFieldDataValue(s,l,this.activeRecord,i,o),e.html(s.toString()).css("height","")),this._updateRecordState(this.lastRow$.parent(),this.activeRecordId,this.activeRecord,i)}},_finishEditing:function(t){const e=a(this.lastEditModeCell);if(e.length){let t=e.hasClass(pt);this._clearDeactivate(),this._deactivateCell(e),t&&this._activateCell(e)}t.resolve()},_setFocus:function(t,e=null){if(t.tabIndex=0,e&&"keydown"===e.type){const e=a(t).closest(j);if(e[0])return t.focus({preventScroll:!0}),void e[0].scrollIntoView({block:"nearest"})}t.focus()},_setFocusable:function(e){const l=this.options.tabbableCellContent,s=Qe(e),i=s.closest(S),o=this.getCurrentCell();let n,a,r,h=i.attr(Ie),d=null;if((s.hasClass(Q)||s.hasClass(M))&&(d=this.lastColIndex),null===d&&(d=el(s)),d+=1,this.lastFocused){const t=Qe(this.lastFocused);s[0]!==t[0]&&(t.add(t.find(l).not(Ut)).prop(Se,-1),t.hasClass(W)&&setTimeout((function(){t.attr(me,ge)}),10))}s.hasClass(W)&&s.attr(me,Ce),i.hasClass(X)?(h+="b",a=Ke("BREAK_CONTEXT")):i.hasClass(Rt)?a=Ke("AGG_CONTEXT"):(h!==this.curRowNum&&d!==this.curColNum?a=qe("ROW_COLUMN_CONTEXT",h,d):h!==this.curRowNum&&(a=qe("ROW_CONTEXT",h)),r=this._getControlBreak(Ve(h)),r&&r.offset!==this.curControlBreak&&(a=Ke("BREAK_CONTEXT")+" "+t.stripHTML(r.label)+"."+a)),n=0,s.children(".a-GV-columnItem")[0]||(n=s.find(l).not(Ut).prop(Se,0).length),n||s.prop(Se,0),this.lastFocused=e,a&&apex.message.ariaMessage(a),this.curRowNum=h,this.curColNum=d,this.curControlBreak=r?r.offset:null,this.getCurrentCell()[0]!==o[0]&&setTimeout((()=>{this._trigger("currentCellChange")}),1)},_getCellFocusable:function(t){const e=t.find(this.options.tabbableCellContent).not(Ut);return e[0]?e[0]:t[0]},_getPrevCellUp:function(t,e,l){var s,i=null,o=null;return(t.hasClass(Q)||t.hasClass(M))&&(o=this.lastColIndex),null===o&&(o=el(t),this.lastColIndex=o),t.closest(S).prevAll(qt).each((function(t){let i=a(this);return i.hasClass(y)?(l=!0,!1):(s=i,t<e-1)})),this.focusInHeader||l||s||(this.focusInHeader=!0,s=this.tableHeader$.children().last()),s&&(i=s.hasClass(X)?t.hasClass(Ot)?s.children().first():s.children().last():tl(s,o)),i},_getNextCellDown:function(t,e){var l,s,i=null,o=null;return(t.hasClass(Q)||t.hasClass(M))&&(o=this.lastColIndex),null===o&&(o=el(t),this.lastColIndex=o),s=0,t.closest(S).nextAll(qt).each((function(t){let i=a(this);return s+=1,!i.hasClass(y)&&(l=i,t<e-1)})),this.focusInHeader&&(!l||s<e)&&(this.focusInHeader=!1,l=this.tableData$.children().first()),l&&(i=l.hasClass(X)?t.hasClass(Ot)?l.children().first():l.children().last():tl(l,o)),i},_copy:function(e){const l=this.model,s=this.options,i=t.htmlBuilder(),o=s.dataTransferFormats,n=(t,e,l)=>{let s=l,i=!!t&&t.copyValueToClipboard;return"function"==typeof i?s=i(t,e,l):!0===i&&(s=e,s.d&&(s=s.d)),""+s};if(s.selectCells){let t=[],e=this.getSelectedRange();if(!e||!e.values.length)return;t=e.columns.map((function(t){return t?s.columns[0][t]:null})),o.forEach((s=>{s.writer.begin(l,e,t)}));for(let s=0;s<e.values.length;s++){let i,a,r=e.recordIds[s],h=null!==r?l.getRecord(r):null;o.forEach((t=>{t.writer.beginRow(s,h,r)})),i=e.values[s];for(let e=0;e<i.length;e++)a=h&&t[e]?l.getValue(h,t[e].property):"",o.forEach((l=>{l.writer.cell(e,t[e],a,n(t[e],a,i[e]))}));o.forEach((t=>{t.writer.endRow()}))}}else{const t=[Jt,Zt].includes(s.rowHeader);let e=this.getSelection(),r=this.getSelectedRecords();if(!r.length)return;{let h=[],d=0,c=e[d];t&&h.push(null),this.getColumns().forEach((function(t){t.hidden||h.push(t)})),o.forEach((t=>{t.writer.begin(l,e,h)}));for(let u=0;u<r.length;u++){let f,p,m,g,C=r[u],_=l.getRecordId(C),v=c?.attr(be);_&&v===_?m=c:v&&(g=l.getRecordMetadata(v),C===g?.record?m=c:g=null),m?(c=null,d+=1,d<e.length&&(c=e[d])):(g=!g&&_?l.getRecordMetadata(_):{sel:!0,record:C},this._renderRecord(i,C,1,_,g),m=a(i.toString()),i.clear()),o.forEach((function(t){t.writer.beginRow(u,C,_)})),f=m.children();for(let e=0;e<f.length;e++)(0!==e||t||s.rowHeader===Qt)&&(p=C&&h[e]?l.getValue(C,h[e].property):"",o.forEach((t=>{t.writer.cell(e,h[e],p,n(h[e],p,f.eq(e).text()))})));o.forEach((t=>{t.writer.endRow()}))}o.forEach((t=>{t.writer.end()}))}}o.forEach((t=>{t.writer.end(),e.setData(t.format,t.writer.toString())}))},_setSelectionMode:function(){const t=this.options,e=this.element.children(p).find(ft);this.element.toggleClass("a-GV--selectCells",t.selectCells),e.removeClass(ut).removeAttr(yt).filter(O).attr(Tt,ee),t.persistSelection&&this.model.clearSelection(),this.allSelected=!1,this.lastFocused&&e[0]&&this._select(a(this.lastFocused),null,!1)},_select:function(e,l,s,i,o){let n,r,h,d,c,u,f,m,g,C,_,v,I,x,H=!1,R=null,y=this.options,$=le;const D=(t,e)=>{const l=t=>{t.each(((t,l)=>{let s=a(l).attr(be);s&&this.model.setSelectionState(s,e,$)}))};y.persistSelection&&!H&&(l(t),$!==ie&&t.length>1&&l(g.first()))};function M(t){const e=t.children("td").length,l=t.children("[aria-selected='true']").length;return e===l?te:0===l?ee:"mixed"}if(l===se||y.allowSelectHidden||(e=e.filter(qt)),m=e.parent(S),_=this.lastRow$&&this.lastRow$.index(e.first())>=0,l&&(y.selectCells&&y.multipleCells||!y.selectCells&&y.multiple)&&("string"==typeof l?$=l:"click"===l.type?l.ctrlKey||l.metaKey?$=ie:l.shiftKey&&($=oe):["keydown","keyup"].includes(l.type)&&(l.which===Te.SPACE?$=l.ctrlKey?ie:l.shiftKey?oe:ne:l.ctrlKey?$=ae:l.shiftKey&&($=oe)),y.selectCells&&$!==oe&&($=le),l.target||(l=null)),y.persistSelection&&(x=this.model.getSelectionState().rangeAnchor),$===re?(H=!0,$=le):$!==oe||(this.selectAnchor||x)&&!this.focusInHeader||($=le),!this.focusInHeader)if($!==le&&$!==oe||(v=this.element.children(p).find(y.selectCells?"td.is-selected,th.is-selected":"tr.is-selected"),y.rowHeaderCheckbox&&v.find(N).removeClass(ut),v.removeClass(ut).removeAttr(yt).find(O).attr(Tt,ee),y.persistSelection&&this.model.clearSelection()),y.selectCells)if($===oe){let t,l,s=a(this.selectAnchor);r=Xe(s.parent()),h=Xe(e.last().parent()),r>h&&(u=h,h=r,r=u),d=Xe(s),c=Xe(e.last()),d>c&&(u=c,c=d,d=u),t=d,l=c+1,this.tableData$.children().each(((e,s)=>{var i=a(s);if(e>h)return!1;e>=r&&i.hasClass(w)&&!i.hasClass(Rt)&&(y.allowSelectHidden||i.is(qt))&&(i.children().slice(t,l).addClass(ut).attr(yt,te),i.find(O).attr(Tt,M(i)))}))}else{const t=e.parent();e.addClass(ut).attr(yt,te),t.find(O).attr(Tt,M(t)),this.selectAnchor=e[0]}else{if(y.persistSelection&&H&&this.model.setSelectionState(null,!0,re),n=m.hasClass(ut),g=m.filter(b).not("."+Rt),$!==se&&(g=g.not("."+Ct)),$===le||$===ne||$===ie&&!n)g.addClass(ut).attr(yt,te).find(O).attr(Tt,te),D(g,!0),H||(this.selectAnchor=g[0]),R=!0;else if($===oe){let t,e=a(this.selectAnchor),l=m.last();if(r=this._rowIndex(e),y.persistSelection){let l=this.model.getRecordMetadata(x);l&&l.serverOffset&&(t=l.serverOffset+1,t!==Ve(e.attr(Ie))&&(r=-1))}if(h=this._rowIndex(l),r<0){let s=t||Ve(e.attr(Ie)),i=Ve(l.attr(Ie));if(y.pagination.virtual){let t=this.tableData$.find(k).toArray();if(i>s)for(let l=0;l<t.length&&(e=a(t[l]).next(),!(Ve(e.attr(Ie))>s));l++);else for(let l=t.length-1;l>=0&&(e=a(t[l]).prev(),!(Ve(e.attr(Ie))<s));l--);r=this._rowIndex(e)}else!y.pagination.scroll&&y.persistSelection&&(e=this.tableDataChildren$[i>s?"first":"last"](),r=this._rowIndex(e))}y.persistSelection&&(l.hasClass(X)&&(l=l[r>h?"next":"prev"]()),D(l,!0)),r>h&&(u=h,h=r,r=u),h+=1,C=[],this.tableDataChildren$.slice(r,h).each((function(t,e){let l=a(e);!l.hasClass(w)||l.hasClass(Rt)||l.hasClass(Ct)||!y.allowSelectHidden&&!l.is(qt)||C.push(e)})),g=a(C),g.addClass(ut).attr(yt,te),R=!0}else($===ie&&n||$===se)&&(g.removeClass(ut).removeAttr(yt),D(g,!1),this.selectAnchor=g[0],R=!1);null!==R&&y.rowHeaderCheckbox&&g.find(O).toggleClass(ut,R).attr(Tt,R),y.multiple&&y.selectAll&&this._updateSelectAll()}e.length>0&&null!==s&&(f=this._getCellFocusable(e.first()),s?this._setFocus(f,l):this._setFocusable(f),_||this._setCurrentRow(e[0])),y.persistSelection&&(this.hasSelection=this.model.getSelectedCount()>0),this.focusInHeader||$!==ie&&$!==se&&($!==oe||!y.selectCells&&n)&&$!==ne&&($!==le||!y.selectCells&&t.arrayEqual(v,g))||(I=!(o||y.navigation&&l&&"click"===l.type),i?this._selNotifyLongDelay(I,l):this._selNotifyDelay(I,l))},_checkSelectionChange:function(t){this._selectedCount()!==t&&this._selNotifyDelay()},_selChangeNotify:function(t,e){if(this.element.hasClass(r)){const s=this.options;if(s.selectionStateItem){let t=i(s.selectionStateItem);if(t.node){let e,l=this.getSelectedRecords();e=l.length?l.map((t=>this.model.getRecordId(t))).join(":"):"",t.setValue(e)}else l.warn("Item not found ",s.selectionStateItem)}this._updateStatus(),t&&this._trigger("selectionChange",e)}},_getAllSelectableRows:function(){let t=this.tableData$.children(b).not("."+Rt+",."+Ct);return this.options.allowSelectHidden||(t=t.filter(qt)),t},_updateSelectAll:function(){let t,e=this.options;if(e.persistSelection){t=this.model.getSelectionState().selectAll}else{let e=this._getAllSelectableRows();t=e.length>0&&e.length===e.filter(ft).length}this.allSelected=t,e.rowHeaderCheckbox&&this.tableHeader$.find(O).first().toggleClass(ut,t).attr(Tt,t?te:ee).closest(K).toggleClass(ut,t)},_clearChildrenRowCache:function(){this.tableDataChildren$=null},_rowIndex:function(t){return t.parents(p).length?(this.tableDataChildren$||(this.tableDataChildren$=this.tableData$.children()),this.tableDataChildren$.index(t)):Xe(t)},_setCurrentRow:function(t){this.lastRow$=nl(a(t)).children()},_fireActivate:function(t,e){var l=nl(e);this._trigger("activateCell",t,{cell$:e,row$:l})},_nextCellWithWrap:function(t){let e,l=this.options.skipReadonlyCells;function s(t){let e,s=t.next();return s.length||(e=t.closest(S),e=e.next(),s=function(t){for(;l&&t.hasClass(Rt)||t.not(qt).length;)t=t.next();return t.children().first()}(e)),s}if(e=s(t),l)for(;e.hasClass(It);)e=s(e);return e},_prevCellWithWrap:function(t){let e,l=this.options.skipReadonlyCells;function s(t){let e,s=t.prev();return s.length||(e=t.closest(S),e=e.prev(),s=function(t){for(;l&&t.hasClass(Rt)||t.not(qt).length;)t=t.prev();return t.children().last()}(e)),s}if(e=s(t),l)for(;e.hasClass(It);)e=s(e);return e},_clearHoverStates:function(){this.element.find(gt).removeClass(mt),this.columnControls$.hide(),this.columnHandle$.hide()},_setRowHoverState:function(t){this.element.find(gt).removeClass(mt),(t=nl(t.children().eq(0))).addClass(mt)},_sortChange:function(t,e,l){var s,i="set",o=this._getColumnMetadata(e);o.canSort&&(s=l===o.sortDirection,this.options.columnSortMultiple&&t.shiftKey?(i="add",i=s?"remove":o.sortDirection?"change":"add"):s&&(i="clear"),this._trigger("sortChange",t,{header$:e,column:o,direction:l,action:i}))},_updateColumnControls:function(t){const e=Ke("SORT_ASCENDING"),l=Ke("SORT_DESCENDING");let s,i,o=!1,n=!1;"asc"===t.sortDirection?(s=Ke("SORT_OFF"),i=l,o=!0):"desc"===t.sortDirection?(s=e,i=Ke("SORT_OFF"),n=!0):(s=e,i=l),this.columnControls$.find(".js-asc").attr(fe,s).attr(Dt,e).attr(Wt,o).toggleClass(vt,o),this.columnControls$.find(".js-desc").attr(fe,i).attr(Dt,l).attr(Wt,n).toggleClass(vt,n)},_adjustSizeForScrollBars:function(e,l,s){var i=this.element.children().filter(u).children(g),o=function(t,e){let l=t.parent()[0],s={h:!1,v:!1};return t.outerHeight()+(e||Ve(t.css("margin-top")))>l.clientHeight&&(s.v=!0),t.outerWidth()>l.clientWidth&&(s.h=!0),s}(this.tableData$.parent(),s);o.h&&t.getScrollbarSize().height,o.v&&(l-=t.getScrollbarSize().width),i.width(l)},_headerScrollCheck:function(t,e,l){var s,i,o,n=0,r=this.hdrScrollParent;return r&&(o=a(this.hdrScrollParent).offset().left,this.element.hasClass(Nt)?(t-e-o<10?n=-10:o+r.offsetWidth-t<10&&o+r.offsetWidth-t>0&&(n=10),l&&n&&((s=r.scrollLeft+n)>0?(r.scrollLeft=0,n=0):s>r.scrollWidth-r.clientWidth?(r.scrollLeft=r.scrollWidth-r.clientWidth,n=0):r.scrollLeft=s)):(o+r.offsetWidth-(t+e)<10?n=10:t-o<10&&t-o>0&&(n=-10),l&&n&&((s=r.scrollLeft+n)<0?(r.scrollLeft=0,n=0):s>r.scrollWidth-r.clientWidth?(r.scrollLeft=r.scrollWidth-r.clientWidth,n=0):r.scrollLeft=s)),i=!!n),i},_headerScrollStart:function(t,e,l){var s=this,i=0,o=[151,134,119,106,95,86,79,74,71];this.scrollTimerId&&this._headerScrollStop(),function n(){s.scrollTimerId=setTimeout((function(){s._headerScrollCheck(t,e,!0)?(l(),n()):s._headerScrollStop()}),o[i]),i<o.length-1&&(i+=1)}()},_headerScrollStop:function(){clearTimeout(this.scrollTimerId),this.scrollTimerId=null},_expandCollapseControlBreak:function(t,e){let l,s,i,o=[],n=[],r=this.options,h=!r.allowSelectHidden;function d(t,l){let n=a(l);if(n.hasClass(w)&&!n.hasClass(Rt))!e&&h&&n.hasClass(ut)&&o.push(n.children(x)[0]),n[e?"show":"hide"]();else{if(n.hasClass(X))return s=!0,!1;if(n.hasClass(y)){if(i=Ve(n.attr("data-start")),!e||"collapse"!==n.css("visibility"))return!1;n.css("visibility","").removeClass("is-hidden")}}}Fe(t)||(t=[t]);for(let l=0;l<t.length;l++){let o,a,h=t[l];h.hasClass(X)&&(n.push(h),s=!1,h.nextAll().each(d),a=this._getControlBreak(Ve(h.attr(Ie)),!0),a&&(a.expanded=e),e?(o=Ke("BREAK_COLLAPSE"),h.addClass(_t).find(it).attr(Ft,te).attr(fe,o).attr(Dt,o).children(".a-Icon").removeClass("icon-right-arrow").addClass("icon-down-arrow")):(o=Ke("BREAK_EXPAND"),h.removeClass(_t).find(it).attr(Ft,ee).attr(fe,o).attr(Dt,o).children(".a-Icon").removeClass("icon-down-arrow").addClass("icon-right-arrow"),l===t.length-1&&r.pagination.scroll&&!r.pagination.loadMore&&(s?r.pagination.virtual?(this.lastScrollTop=null,this._scrollPage()):this.tableData$.height()<this.scrollParent$.height()&&this._addNextPage():r.pagination.virtual?i>=0&&(this.pageOffset=i,this._addPageOfRecords()):this._addNextPage())))}o.length&&(l=this.focusInHeader,this.focusInHeader=!1,this._select(a(o),se,a(document.activeElement).closest(this.element[0]).length>0,null),this.focusInHeader=l),this._trigger("expansionChange",null,{type:"break",expand:e,rows$:n})},debugCellEdit:function(t){this.debugDontDeactivateCell=!!t}},apex.widget.contextMenuMixin)),a.ui.dialog&&a.widget("ui.dialog",a.ui.dialog,{_allowInteraction:function(t){return a(t.target).closest(ot).length>0||this._super(t)}})}(apex.util,apex.model,apex.debug,apex.lang,apex.item,apex.clipboard,apex.widget.util,apex.jQuery);