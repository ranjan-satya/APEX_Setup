/*!
 widget.listManager.js
 Copyright (c) 2012, 2024, Oracle and/or its affiliates. All rights reserved.
 */
!function(e,t){"use strict";var i="disabled",n="aria-expanded",a=t.ui.keyCode;e.listManager=function(o,r){const p="click",l="change";var d,s,u,c=t.extend({dependingOnSelector:null,optimizeRefresh:!0,pageItemsToSubmit:null},r),g="",f=!1,v=t(o,apex.gPageContext$),h=t(o+"_ADD",apex.gPageContext$),m=t(o+"_ADD_lov_btn",apex.gPageContext$),x=h.closest("tr").find("[value='Add']"),C=h.closest("tr").find("[value='Remove']"),S={itemId:o.substring(1)+"_ADD",ajaxIdentifier:r.ajaxIdentifier,initialFetch:r.initialFetch||"empty",isPopup:!1,multiple:!1,display:"list",height:450,width:500,minSearchChars:0,columns:{DISPLAY:{seq:10,index:0},RETURN:{seq:20,index:1}},displayColumn:"DISPLAY",valueColumn:"RETURN"};function $(){var t,i=h.val();t=i!==g?i:null,g=i,h.attr(n,"true"),e.util.openPopupLov(f,t,!1,S,(function(e){e&&(g=e.d||e.v||e),h.attr(n,"false")})),f=!1}function b(){s.refresh()}S.initialSearch="",f=!0,(c.pageItemsToSubmit||c.dependingOnSelector)&&(u=c.pageItemsToSubmit||"",c.dependingOnSelector&&(u.length>0&&(u+=","),u+=c.dependingOnSelector),S.itemsToSubmit=u.replace(/#/g,"").split(/\s*,\s*/)),t(o,apex.gPageContext$).each((function(){var e=this;apex.item.create(this.id,{enable:function(){var n=$x(e.id+"_fieldset");t(":input",n).prop(i,!1).filter("[type!=button]").removeClass("apex_disabled"),m.prop(i,!1)},disable:function(){var n=$x(e.id+"_fieldset");t("option:selected",$x(e.id)).prop("selected",!1),t(":input",n).prop(i,!0).filter("[type!=button]").addClass("apex_disabled"),m.prop(i,!0)},hide:function(){t("#"+e.id+"_fieldset",apex.gPageContext$).hide()},show:function(){t("#"+e.id+"_fieldset",apex.gPageContext$).show()},setValue:function(e){var t="";void 0!==e&&(apex.util.toArray(e,this.getMultiValueStorage()).forEach((function(e){e=apex.util.escapeHTML(e),t+='<option value="'+e+'">'+e+"</option>"})),v.find("option").remove().end().append(t))},getValue:function(){var e=[];return t("option",v[0]).each((function(){e.push(this.value)})),e},isChanged:function(){return $v(v[0])!==d},addValue:function(e){var t,i,n=e.split(","),a=!1,o="";for(i=0;i<n.length;i++)""!==(t=n[i].trim())&&0===v.find('option[value="'+t.replace(/"/g,'\\"')+'"]').length&&(o='<option value="'+(t=apex.util.escapeHTML(t))+'">'+t+"</option>",v.append(o),a=!0);a&&v.trigger(l)},removeValue:function(e){var i,n;e?(v.children().each((function(){var n=t(this);n.attr("value")==e&&(n.remove(),i=!0)})),i&&v.trigger(l)):(n=v.find(":selected")).length>0&&(n.remove(),v.trigger(l))},refresh:function(){var e,i;v.trigger("apexbeforerefresh"),h.val(""),t("option",v).remove(),v.trigger(l),(e=h.data("popupLovModelName"))&&(i=apex.model.get(e))&&(i.setData([]),apex.model.release(e)),f=!0,v.trigger("apexafterrefresh")},getPopupSelector:function(){return".ui-dialog-popuplov"},getValidity:function(){const e=t(v).prop("required");return void 0!==e&&!1!==e&&0===v.has("option").length?{valid:!1,valueMissing:!0}:{valid:!0}},storageType:c.storageType,separator:c.separator}),s=apex.item(this.id)})),d=$v(v[0]),m.on(p,(function(){$()})).on("focus",(function(){h.trigger("focus")})),x.on(p,(function(){const e=x.data("preserveCase"),t=x.data("listManagerItemName"),i=x.data("listItemName");let n=e?$v(i):$v(i).toUpperCase();apex.item(t).addValue(n),$s(i,"")})),C.on(p,(function(){const e=C.data("listManagerItemName");apex.item(e).removeValue()})),h.keydown((function(e){var t=e.which;t===a.DOWN||t===a.UP?$():t===a.ENTER&&(x.trigger("click"),e.preventDefault())})),c.dependingOnSelector&&t(c.dependingOnSelector,apex.gPageContext$).on("change",b),v.on("apexrefresh",b),v.on(l,(function(e){void 0!==e.originalEvent&&e.stopImmediatePropagation()}))}}(apex.widget,apex.jQuery);