/*!
 Copyright (c) 2024, Oracle and/or its affiliates.
*/
!function(e,t,a,i,s,l){"use strict";const n="contains",h="separated",r="json-array",o="chips",u='<input type="text" class="apex-item-text">',c=".aCombobox",d="data-value",p="pDisplayValue parameter not supported when returnDisplay false",m="pValue and pDisplayValue parameters cannot both contain a value, please provide only one parameter",v="Invalid configuration, manualEntriesItem must have a value to support returnDisplay",f="ITEM_DELETED",g=Array.isArray,V=e=>void 0!==e?.data?.[0]?.opts,E=e=>{let t=[];return e.data.forEach((e=>{g(e.opts)&&e.opts.length&&(t.push({d:e.label,gOpenTag:!0}),t=[...t,...e.opts],t.push({gCloseTag:!0}))})),{fields:e.fields,data:t}},x=e=>Object.keys(e).map((t=>{let a=e[t];return{name:t,index:a.index,searchable:a.searchable||void 0===a.searchable,visible:a.visible||void 0===a.visible}})).sort(((e,t)=>e.index-t.index)),y={ajaxIdentifier:{type:l.dataTypes.string,reactive:!0},ajaxItems:{type:l.dataTypes.string,reactive:!0},choiceTemplate:{type:l.dataTypes.string,reactive:!0},cache:{type:l.dataTypes.boolean,defaultValue:!1,reactive:!0},caseSensitive:{type:l.dataTypes.boolean,defaultValue:!1,reactive:!0},displayValuesAs:{type:l.dataTypes.enum,defaultValue:o,enumValues:[h,o],reactive:!0},fetchOnSearch:{type:l.dataTypes.boolean,defaultValue:!1,reactive:!0},highlightChoices:{type:l.dataTypes.boolean,defaultValue:!0},noResultsHint:{type:l.dataTypes.string,reactive:!0},maxResults:{type:l.dataTypes.number,rangeMin:0,defaultValue:250,setterGetter:!0,reactive:!0},minCharactersSearch:{defaultValue:0,type:l.dataTypes.number,rangeMin:0,reactive:!0},multiValue:{type:l.dataTypes.boolean,defaultValue:!1,reactive:!0},multiSelect:{type:l.dataTypes.boolean,defaultValue:!1,reactive:!0},multiValueStorage:{type:l.dataTypes.enum,defaultValue:h,enumValues:[h,r],reactive:!0},manualEntries:{type:l.dataTypes.boolean,defaultValue:!1},manualEntriesItem:{type:l.dataTypes.string,reactive:!0},matchType:{type:l.dataTypes.enum,defaultValue:n,enumValues:[n,"starts-with"],reactive:!0},multiValueSeparator:{type:l.dataTypes.string,reactive:!0,defaultValue:":"},name:{sync:!1,setterGetter:!0},parentItems:{type:l.dataTypes.string,reactive:!0},parentsRequired:{type:l.dataTypes.boolean,defaultValue:!1},returnDisplay:{type:l.dataTypes.boolean,reactive:!0,defaultValue:!1}},b=["disabled","size","maxlength","autocomplete","placeholder","minlength","value","tabindex","aria-labelledby","aria-describedby","required"];apex.item.ItemComponent._addCommonAttributes(b,y),l._addHyphenCaseAttrNames(y);const C=l._configObservedAttributes(y,b);class S extends e.ItemComponent{choices;initialValueChoices;_wrappedElement$;#e;#t;#a=new Map;#i=!1;#s;#l;#n;#h;#r;#o;#u;#c=!0;#d;#p;#m;#v;#f;#g={maxResults:void 0,minCharactersSearch:void 0,ajaxIdentifier:void 0,ajaxItems:void 0,choiceTemplate:void 0,parentItems:void 0,parentsRequired:void 0,matchType:void 0,fetchOnSearch:void 0,cache:void 0,caseSensitive:void 0,noResultsHint:void 0,multiValue:void 0,manualEntriesItem:void 0,multiSelect:void 0,multiValueSeparator:void 0,returnDisplay:void 0,manualEntries:void 0,multiValueStorage:void 0,highlightChoices:void 0,displayValuesAs:void 0};constructor(e){super(),this._configPrivateState(this.#g),this.#f=e;for(const[e,t]of Object.entries(this.#f))Object.defineProperty(this,e,{enumerable:!0,configurable:!0,get:()=>t.value});this._wrappedElement$=s(u),this.setFocusTo=this._wrappedElement$}#V(){return this.#g.multiValue&&!this.#g.multiSelect?this.#g.maxResults+this.getValue().length+this.getManualEntries().length:this.#g.maxResults}#E(e,t,a){const i=this.#g;let l;return this.#g.multiValue&&this.#g.displayValuesAs===h&&(a||!a&&!this.#t.isShowingSelectedOnly())&&(l=this.#o={}),this.constructor.searchChoices(s.extend(!0,{},e),t,a,this.#g.highlightChoices,this.#V(),i.matchType,i.caseSensitive,i.returnDisplay,l)}#x(e,t=!1){const a=this.getValue(),i=this.#v,l=V(e);let n=s.extend(!0,{},e);if(n.fields&&!this.#t.options.choiceTemplate&&(this.#t.options.choiceTemplate="<span>"+n.fields.map((e=>{if(!1!==e.visible)return`&"${e.name}".`})).filter((e=>void 0!==e)).join(" - ")+"</span>"),l&&(n=E(n)),n.data=n.data.filter((e=>{const t=(this.#g.multiValue?a:[a]).includes(i?e.r:e.pristineDisplayValue);return e.gOpenTag||e.gCloseTag||i||(e.d=e.r,delete e.r),!this.#g.multiValue||this.#g.multiValue&&this.#g.multiSelect?((this.#g.multiValue&&this.#g.multiSelect||!this.#g.multiValue&&!this.#l)&&(e.s=t),!0):this.#g.multiValue?!t:void 0})),l&&!t){let e=0,t=s.extend(!0,{},n.data);n.data=n.data.filter(((a,i)=>!a.gOpenTag&&!a.gCloseTag&&e<this.#g.maxResults?(e+=1,!0):!!((a.gOpenTag&&!t[i+1].gCloseTag||a.gCloseTag&&!t[i-1].gOpenTag)&&e<this.#g.maxResults)||void 0)),n.data.length&&!n.data[n.data.length-1].gCloseTag&&(n.data[n.data.length]={gCloseTag:!0})}else t||(n.data=n.data.slice(0,this.#g.maxResults));return n}#y(e){return e+"|"+this.#V()}#b(e,t,a=!0){let i;return a?i=this.#E(e,t,!1):(i=e,i.fields&&(i.fields=x(i.fields))),this.#g.cache&&this.#a.set(this.#y(t),{results:i,pristineResults:e}),this.#x(i)}#C(e){return a.util.cascadingLov(this.element,this.ajaxIdentifier,{x01:e,x02:this.#V(),pageItems:s(this.#g.ajaxItems,apex.gPageContext$)},{optimizeRefresh:this.#g.parentsRequired,dependingOn:s(this.#g.parentItems,apex.gPageContext$),loadingIndicatorPosition:"Nothing",target:this._wrappedElement$})}#S(e,t,a){let l=[];if(a){const e=s.extend(!0,{},this.#u);this.#o=s.extend(!0,{},this.#u),e.fields&&(e.fields=x(e.fields)),t(this.#x(e,a))}else if(this.#g.fetchOnSearch){let a;if(this.#g.cache){const t=this.#a.get(this.#y(e));t&&(this.#o=t.pristineResults,a=t.results)}if(this.#g.ajaxIdentifier)if(a)t(this.#x(a));else{const a=this.#C(e);a?a.done((a=>{t(this.#b(a,e))})):t([])}else if(this.choices){if("function"!=typeof this.choices)throw new Error("Invalid data source provided, choices must be an function");a?t(this.#x(a)):this.choices(e,this.#g.matchType,this.caseSensitive,this.#g.maxResults).then((a=>{t(this.#b(a,e,!1))})).catch((e=>{throw new Error(e)}))}else i.warn("No data source provided")}else this.choices||(this.choices={data:[]}),l=this.#E(this.choices,e,!!e),t(this.#x(l))}#I(e){const t="change"+c,a=()=>{this.refresh()};e&&s(e,apex.gPageContext$).off(t,a),this.#g.parentItems&&s(this.#g.parentItems,apex.gPageContext$).on(t,a)}#D(){const e="apexrefresh"+c,a="input"+c,i="change"+c,l="comboSelectFocusOut"+c,n="focusin"+c,h="mousedown"+c;this.element.off(c),this.element.on(e,(()=>{this.refresh()})).on(l,(()=>{const e=s.Event("change");this.#c=!0,this.#g.multiValue?t.unorderedArrayEqual(this.#d||[],this.getValue())&&t.unorderedArrayEqual(this.#p||[],this.getManualEntries())||(e.apexData={oldValue:this.#d,value:this.getValue()},this.#m&&(e.apexData.oldValueManualEntries=this.#p),this.element.trigger(e,e.apexData)):this.getValue()===(this.#d||"")&&this.getManualEntries()===(this.#p||"")||(e.apexData={oldValue:this.#d,value:this.getValue()},this.#m&&(e.apexData.oldValueManualEntries=this.#p),this.#g.manualEntries||(e.apexData.action=f),this.element.trigger(e,e.apexData))})).on(n,(()=>{this.#c&&(this.#c=!1,this.#d=this.getValue(),this.#p=this.getManualEntries())})).on(h,".js-removeChip",(()=>{this.element.has(s(document.activeElement)).length||(this.#c=!1,this.#d=this.getValue(),this.#p=this.getManualEntries())})),this.element.find(".apex-item-comboselect").on(a,(e=>{if(e.stopImmediatePropagation(),e.apexData||!this.#g.multiValue&&this.#g.manualEntries){const t=s.Event("input");if(t.apexData=e.apexData,this.element.trigger(t,t.apexData),("ITEM_SELECTED"===e?.apexData?.action||e?.apexData?.action===f&&this.#g.multiValue)&&!this.#g.manualEntries){const t=s.Event("change");t.apexData=e.apexData,t.apexData.oldValue=this.#d,t.apexData.value=this.getValue(),this.#d=this.getValue(),this.element.trigger(t,t.apexData)}}})).on(i,(e=>{e.stopImmediatePropagation()}))}#M(){const e=this.#C("");e?e.done((e=>{this.choices=e})):this.choices.data=[]}#w(e,t){const a=this.#v,i=a?"d":"r",s=a?t:e,l=s?.toLowerCase(),n=V(this.choices);let h;if(!this.#g.fetchOnSearch){let t,a=0,r=n?this.choices.data.length:1;for(;a<r&&!t;){let h,r=0;for(h=n?this.choices.data[a].opts:this.choices.data;r<h.length&&!t;){let a=h[r];this.#g.returnDisplay&&e?a.r===e&&(t=a):(this.#g.caseSensitive&&a[i]===s||!this.#g.caseSensitive&&a[i].toLowerCase()===l)&&(t=a),r+=1}a+=1}t&&(h={text:t[i],value:t.r})}return h}#T(e,t,a=!1,i=!1){const s=this.#v;let l;if(i&&t?l={text:t,value:s?e:t}:i&&!t&&this.#g.fetchOnSearch&&!this.#g.manualEntries?(this._wrappedElement$.val(""),this.#O(e),l={value:e}):s&&(e||t)?(l=this.#w(i?e:void 0,t),this.#g.manualEntries||l||(l={text:e,value:e})):t&&(l=this.#w(t)),this.#m&&this.#R(""),l)this.#s=l.value,this.#g.manualEntries&&(l.value=l.text),l.text&&this._wrappedElement$.val(l.text),this.#l||this._wrappedElement$.attr(d,this.#s);else if(t)if(s){if(!this.#m)throw new Error(v);this.#s=void 0,this.#R(t),a&&this._wrappedElement$.val(t)}else this.#m?(this.#s=void 0,this.#R(t),this.#s=void 0):this.#s=t,a&&this._wrappedElement$.val(t);else this.#s=void 0,this._wrappedElement$.val("").removeAttr(d);return this.#t.setEmpty(),l}#A(e,t){const a=e.toLowerCase();return t.some((t=>this.#g.caseSensitive?e===t:a===t.toLowerCase()))}#N(){const e=this.getManualEntries();if(this.#g.multiValue){if(this.#g.multiValueStorage===r)return JSON.stringify(e);{const t=this.#g.multiValueSeparator;return e.join(t)}}return e}#$(){const e=this.#g.manualEntriesItem;let t;return e&&s(e).length&&(t=s(e).val()),t}#_(){const e=this.#v;let a,i,s;this.#g.multiValue&&(a=[],i=[]),this.#g.manualEntriesItem&&(a=this.#g.multiValue?t.toArray(this.#$(),this.getMultiValueStorage()):this.#$()),this.#n&&(i=this.#g.multiValue?t.toArray(this.#n,this.getMultiValueStorage()):this.#n,this.initialValueChoices&&(s=this.initialValueChoices)),e?this.#g.multiValue?this.setValue(i,this.#g.manualEntriesItem?a:s,!0):i?this.setValue(i,s||void 0,!0):a&&this.setValue(void 0,a):this.#g.multiValue?this.setValue([...a,...i],void 0,!0):i?this.setValue(i,void 0,!0):a&&this.setValue(a,void 0,!0),this.#n=this.#s,this.#h=this.#l}#j(e){const t=this.#g.manualEntriesItem;t&&s(t).length&&s(t).val(e).trigger("change")}#R(e){this.#g.multiValue?(this.#l=this.getManualEntries()).push(e):this.#l=e,this.#j(this.#N())}#L(e,t,a){let i;return i=this.#v?this.#P(a?e:void 0,t,a):this.#P(t,void 0,a),i}#P(e,t,a,i){const l=this.#v,n=g(t?.data);let r,o,u=this.getValue();if(a)if(r={},n){const e=V(t)?t.data[0].opts[0]:t.data[0];r.text=e.d,r.value=e.r}else r.text=l?t:e,r.value=e;else r=this.#w(e,t)||{},this.#g.manualEntries||r.text&&r.value||(r.text=e,r.value=e);if(r.skip=!0,r.text||r.value)l&&!u.includes(r.value)?(o=r.value,this.#g.manualEntries&&(r.value=r.text),r.skip=!1):l||u.includes(r.text)||(o=r.text,r.skip=!1);else if(l&&t){if(o=e,!this.#m)throw new Error(v);this.#A(t,this.getManualEntries())||(this.#R(t),r.text=t,r.value=t,r.skip=!1)}else l||(this.#m?this.#A(e,this.getManualEntries())||(this.#R(e),r.text=e,r.value=e,r.skip=!1):this.#g.multiValue?this.#A(e,u)||(o=e,r.text=e,r.value=e,r.skip=!1):(o=e,r.skip=!1));if(o){const e=apex.lang.getMessage("APEX.CS.OTHERS_GROUP");if(u.push(o),this.#s=u,this.#g.multiValue&&this.#g.displayValuesAs===h){let a,l,h;if(n)l=t;else if(i){if(t)l={data:[{d:t,r:o}]};else if(!t)if(this.#g.fetchOnSearch)l={data:[{d:o,r:o}]};else{const e=this.constructor.choiceRecord(o,this.choices);l={data:[]},e?(l.data.push(e),this.choices.fields&&(l.fields=s.extend(!0,{},this.choices.fields))):l.data.push({d:o,r:o})}}else l=this.#g.fetchOnSearch||this.#o?this.#o:this.choices;if(h=this.constructor.choiceRecord(o,l),this.#u||(this.#u={data:[]}),l?.fields&&(this.#u.fields=l.fields),V(l)){a=h.opts[0],this.#u.data.length&&!V(this.#u)&&(this.#u.data=[{label:e,opts:this.#u.data}]);let t=this.#u.data.find((e=>h.label===e.label));if(t){const e=h.opts[0];t.opts.push(e)}else this.#u.data.push(h)}else if(a=h,V(this.#u)){let t=this.#u.data.find((t=>e===t.label));t?t.opts.push(h):this.#u.data.push({label:e,opts:[h]})}else this.#u.data.push(a);a.s=!0,a.pristineDisplayValue=a.d}}return r}#k(e,t,a=!0,i=!1){if(this.#g.multiValue){const l=this.#v,n=this.getValue(),h=this.getManualEntries();if(this.#g.manualEntries){if(t&&!l)throw new Error(p);if(e&&t)throw new Error(m)}if(this.#g.manualEntries&&(e||t)||!this.#g.manualEntries&&e){const l=this.#H(e||t);let r;if(r=this.#g.manualEntries?t?this.#P(void 0,l):this.#P(l):this.#P(l,t,!!t,i),!r.skip&&(this.#t.addValueChip(r.value,r.text),!a)){const e=s.Event("change");e.apexData={oldValue:n,value:this.getValue()},this.#m&&(e.apexData.oldValueManualEntries=h),this.element.trigger(e,e.apexData)}}}}#q(e){const t=(V(this.choices)?E(this.choices):this.choices).data.filter((t=>t.d===e))[0];if(t)return t.r}#F(e){const t=(V(this.choices)?E(this.choices):this.choices).data.filter((t=>t.r===e))[0];if(t)return t.d}#H(e){let a=null==e?void 0:String(e);if(this.#g.multiValue&&this.#g.multiValueStorage===h){const e=new RegExp(t.escapeRegExp(this.#g.multiValueSeparator),"g");a=a?.replace(e,"")}return a}#O(e){const a=this.#g.multiValue?e:[e];let l;l=this.#g.multiValueStorage===r&&this.#g.multiValue?JSON.stringify(a):a.join(this.#g.multiValueSeparator),apex.server.plugin(this.#g.ajaxIdentifier,{p_widget_action:"get-display-values",x03:l,pageItems:s(this.#g.ajaxItems,apex.gPageContext$).add(this.#g.parentItems,apex.gPageContext$)},{loadingIndicator:`#${t.escapeCSS(this.id)} .apex-item-comboselect`}).done((e=>{const t=apex.lang.getMessage("APEX.CS.OTHERS_GROUP");this.#u={data:[]},e?.fields&&(this.#u.fields=e.fields),a.forEach((a=>{const i=this.constructor.choiceRecord(a,e),s=V(e);let l;if(l=i?s?i.opts[0].d:i.d:a,this.#g.displayValuesAs===h)if(s){const e=i?i.label:t,s=this.#u.data.find((t=>e===t.label)),l=i||{label:t,opts:[{r:a,d:a}]},n=l.opts[0];n.s=!0,n.pristineDisplayValue=n.d,s?s.opts.push(n):this.#u.data.push(l)}else{const e=i||{r:a,d:a};e.s=!0,e.pristineDisplayValue=e.d,this.#u.data.push(e)}this.#g.multiValue?this.#t.addValueChip(a,l):this._wrappedElement$.val(l)})),this.element.trigger("apexafterdvfetched")})).fail((e=>{i.error("There was an error when fetching the display value",e)}))}#z(e,t,a=!1){const i=this.getValue(),s=this.#v;let l,n,h,r,o,u;if(s?(l=i.indexOf(e||this.#q(t)),u=this.#g.manualEntries?e?this.#F(e):t:e):(l=i.indexOf(e),u=e),n=l>=0,h=this.getManualEntries(),r=h.indexOf(s?t:e),o=r>=0,n){if(i.splice(l,1),this.#s=i,this.#u){const t=this.#u.data,a=V(this.#u);let i,s=0,l=!1;for(i=a?t.length:1;s<i&&!l;){const i=a?t[s].opts:t;let n=0;for(;n<i.length&&!l;){i[n].r===e&&(l=!0,i.splice(n,1)),n+=1}a&&l&&0===i.length&&t.splice(s,1),s+=1}}}else o&&(h.splice(r,1),this.#l=h,this.#j(this.#N()));a&&(o||n)&&this.#t.removeValueChip(u)}#G(){const e={data:[]},t=this.#v,a=this.element.children("a-optgroup"),i=e=>{const a=[];return e.each(((e,i)=>{const l=[...i.childNodes].filter((e=>e.nodeType===Node.TEXT_NODE)).map((e=>e.nodeValue.trim())).join(""),n={d:l,i:i.getAttribute("icon"),r:i.getAttribute("value")};t||(n.r=l,delete n.d),s(i).children("a-option-column-value").each(((e,t)=>{n.cols=n.cols||[],n.cols.push(t.innerText)})),n.cols&&(this.#r=!0),a.push(n)})),a};if(this.element.children("a-column-metadata").each(((t,a)=>{const i=a.getAttribute("name").toUpperCase(),s=a.getAttribute("index"),l=!("false"===a.getAttribute("searchable")),n=!("false"===a.getAttribute("visible"));e.fields=e.fields||{},e.fields[i]={index:s,searchable:l,visible:n}})),a.length)a.each(((t,a)=>{let l=s(a).children("a-option");if(l.length){const t={label:a.getAttribute("label")};t.opts=i(l),e.data.push(t)}}));else{const t=this.element.children("a-option");e.data=i(t)}return this.element.find("a-optgroup, a-option, a-column-metadata").remove(),e}get defaultValue(){return this.#n}set defaultValue(e){let t;t=null==e?"":e,this.setAttribute("value",String(t)),this.#n=this.#s,this.#h=this.#l}get selectedChoices(){return this.#u}isChanged(){return this.#g.multiValue?!t.unorderedArrayEqual(this.#n||[],this.getValue())||!t.unorderedArrayEqual(this.#h||[],this.getManualEntries()):this.getValue()!==(this.#n||"")}removeValue(e,t){if(this.#g.multiValue){const a=this.#v;if(this.#g.manualEntries){if(t&&!a)throw new Error(p);if(e&&t)throw new Error(m)}else if(t)throw new Error("Property pDisplayValue not supported for this configuration");this.#z(e,t,!0)}}refresh(){this.setValue(""),this.#a.clear(),!this.#g.fetchOnSearch&&this.#g.ajaxIdentifier&&this.#M()}addValue(e,t){this.#k(e,t,!1,!0)}setValue(e,a,i){const l=this.getValue(),n=this.getManualEntries(),h=this.#v,r=g(a?.data),o=(e,t)=>{const a=new Map,i=[];for(const s of e){let e=String(s);!t&&this.#g.manualEntries&&(e=e.toLowerCase()),a.get(e)||(a.set(e,!0),i.push(s))}return i};if(this.#g.manualEntries){if(a&&!h)throw new Error(p);if(e&&a&&!this.#g.multiValue)throw new Error(m)}else if(a&&!e)throw new Error("pValue cannot be undefined, if pDisplayValue is provided");if(this.#i){if(this.#g.multiValue){for(const e of l){let t;t=this.#g.manualEntries&&h?this.#F(e):e,this.#t.removeValueChip(t,!0)}for(const e of n)this.#t.removeValueChip(e,!0);if(this.#s=void 0,this.#l=void 0,this.#u=void 0,this.#j(""),this.#g.manualEntries){if(e){const a=e,i=o(g(a)?a:t.toArray(a,this.getMultiValueStorage()));for(const e of i)this.#k(e)}if(a){const e=a,i=o(g(e)?e:t.toArray(e,this.getMultiValueStorage()));for(const e of i)this.#k(void 0,e)}}else{let i,s;if(e&&(i=o(g(e)?e:t.toArray(e,this.getMultiValueStorage()))),i?.length)if(a&&!r&&(s=o(g(a)?a:t.toArray(a,this.getMultiValueStorage()))),!this.#g.fetchOnSearch||this.#g.fetchOnSearch&&(s||r))for(let e=0;e<i.length;e++){let t,l=i[e];if(s)t=s[e]?s[e]:l;else if(r){let e=this.constructor.choiceRecord(l,a);e&&(t={data:[e]},a.fields&&(t.fields=a.fields)),t||(t=l)}this.#k(l,t,!0,!0)}else this.#s=i,this.#u=i.map((e=>({r:e,d:e}))),this.#O(i)}}else{const t=g(e||a);let i,s;if(h){if(e&&(s=this.#H(t?e[0]:e)),this.#g.manualEntries||!r)a&&(i=this.#H(t?a[0]:a));else if(r){let e=this.constructor.choiceRecord(s,a);if(e){i=(e.opts?e.opts[0]:e).d}else i=s}}else i=this.#H(t?e[0]:e);this.#T(s,i,!0,void 0!==s)}if(!i){const e=s.Event("change");e.apexData={oldValue:l,value:this.getValue()},this.#m&&(e.apexData.oldValueManualEntries=n),this.element.trigger(e,e.apexData)}}else this.#n=e}getValue(){let e=this.#s;return this.#g.multiValue?e=e?[...e]:[]:e||(e=""),e}getSeparator(){return this.#g.multiValue?this.#g.multiValueSeparator:null}getMultiValueStorage(){if(this.#g.multiValue){let e={type:this.#g.multiValueStorage};return this.#g.multiValueStorage===h&&(e.separator=this.#g.multiValueSeparator),e}return null}reinit(e){if(this.#a.clear(),this.setValue(e,null,!0),!this.#g.fetchOnSearch&&this.#g.ajaxIdentifier&&this.#g.parentItems)return()=>{this.#M()}}getManualEntries(){return this.#g.multiValue?[...this.#l||[]]:void 0===this.#l?"":this.#l}isEmpty(){let e=!0;return this.#g.multiValue&&(this.getValue().length||this.getManualEntries().length)?e=!1:this.#g.multiValue||!this.getValue()&&!this.getManualEntries()||(e=!1),e}getValidity(){const e=this.element.attr("required");return void 0!==e&&!1!==e&&this.isEmpty()?{valid:!1,valueMissing:!0}:{valid:!0}}parseChoices(){this.choices=this.#G()}_cleanup(){this.#t&&this.#t.destroy()}_render(e){if(this.#f){for(const[t,a]of Object.entries(this.#f))this.#g[t]=a.value,e&&(e=e.filter((e=>e.attributeName!==a.attrName)));e&&!e.length&&(e=void 0)}if(this.#m=this.#g.manualEntriesItem&&!this.#g.fetchOnSearch&&this.#g.manualEntries,this.#v=!this.#g.manualEntries||this.#g.manualEntries&&!this.#g.fetchOnSearch&&this.#g.returnDisplay,this.#i){if(e)for(const t of e){switch(t.attributeName){case y.minCharactersSearch.attrName:this.#t.options.minCharactersSearch=this.#g.minCharactersSearch;break;case y.fetchOnSearch.attrName:this.#t.options.asyncLoading=this.#g.fetchOnSearch;break;case y.multiSelect.attrName:this.#t.options.multiSelect=this.#g.multiSelect;break;case y.choiceTemplate.attrName:this.#t.options.choiceTemplate=this.#g.choiceTemplate;break;case y.multiValueSeparator.attrName:this.#t.options.multiValueSeparator=this.#g.multiValueSeparator,this.setValue();break;case y.noResultsHint.attrName:this.#t.options.noMatchesMessage=this.#g.noResultsHint;break;case y.manualEntriesItem.attrName:this.setValue(),this.#s=void 0,this.#l=void 0}[y.multiValue.attrName,y.returnDisplay.attrName,y.displayValuesAs.attrName].includes(t.attributeName)&&(this.#i=!1,this._wrappedElement$.remove(),this._wrappedElement$=s(u),this.#s=void 0,this.#l=void 0,this.#j(""),this._cleanup(),this._render()),[y.minCharactersSearch.attrName,y.ajaxIdentifier.attrName,y.ajaxItems.attrName,y.parentItems.attrName,y.returnDisplay.attrName,y.maxResults.attrName].includes(t.attributeName)||this.#a.clear(),t.attributeName===y.parentItems.attrName&&this.#I(t.oldValue)}}else{const e=this.element.find("a-optgroup, a-option, a-column-metadata").length>0;let i;this.#g.fetchOnSearch||!e&&this.choices?!this.#g.fetchOnSearch||!e&&this.initialValueChoices||(this.initialValueChoices=this.#G()):this.parseChoices(),this.#g.multiValue?(this.#e=s("<div><ul><li></li></ul></div>"),this.#e.find("li").append(this._wrappedElement$)):(this.#e=s("<div></div>"),this.#e.filter("div").append(this._wrappedElement$)),this.element.hasClass("apex-item-has-icon")&&(i=this.element.find(".apex-item-icon").detach()),this.element.empty(),this.element.append(this.#e),i&&i[0]&&this.element.append(i),this.#u=void 0,this.#o=void 0,this.#t=a.util.initComboSelect(this.#e,{baseId:this.id,searchIcon:!1,enterable:this.#g.manualEntries,multiValued:this.#g.multiValue,multiSelect:this.#g.multiSelect,expandIcon:!(this.#g.multiValue&&this.#g.manualEntries),useOverflow:!1,multiValueSeparator:this.#g.multiValueSeparator,escapeChoices:!1,maxHeight:480,hasIcons:!0,clearIcon:!0,minCharactersSearch:this.#g.minCharactersSearch,noMatchesMessage:this.#g.noResultsHint,popupClasses:"ui-dialog-combobox",choiceTemplate:this.#g.choiceTemplate,asyncLoading:this.#g.fetchOnSearch,closeOnEmpty:this.#g.manualEntries,displayValuesAs:this.#g.displayValuesAs,choices:(e,t,a=!1)=>{this.#S(e,t,a)},isDisabled:function(){return!1},removeValue:e=>this.#v&&this.#g.manualEntries?this.#z(void 0,e):this.#z(e),addValue:(e,t,a)=>this.#L(e,t,a),findChoice:(e,t)=>this.#g.manualEntries?void 0:{d:t,r:e},setValue:(e,t,a)=>this.#T(e,t,!1,a)}),this.#g.manualEntries&&(this.#t.options.autoTagCreation=e=>{const a=this.#g.multiValueSeparator,i=new RegExp(t.escapeRegExp(a));let s;return e.match(i)&&(s=e.split(i).filter(Boolean)),s}),this.#i=!0,this.#I(),this.#D(),this.#_()}this.#g.returnDisplay&&this.#g.fetchOnSearch&&this.#g.manualEntries&&i.error("Invalid configuration, fetchOnSearch must be false to support returnDisplay"),this.#g.returnDisplay&&!this.#g.manualEntriesItem&&this.#g.manualEntries&&i.error(v)}static choiceRecord(e,t){const a=t.data,i=V(t);let l,n,h=0;for(n=i?a.length:1;h<n&&!l;){const t=i?a[h].opts:a;let n=0;for(;n<t.length&&!l;){const r=t[n];if(r.r===e){const e=s.extend(!0,{},r);l=i?{label:a[h].label,opts:[e]}:e}n+=1}h+=1}return l}static searchChoices(e,i,s,l,n,h,r,o,u){const c=e.data,d=V(e),p=d?c.length:1,m=o?"d":"r";let v,f=[],E=0,y=0;for(e.fields&&(v=x(e.fields),u&&(u.fields=e.fields));E<p&&(!n||y<n);){const e=[],p=[];let V,x=0;for(V=d?c[E].opts:c;x<V.length&&(!n||y<n);){const n=V[x];let c,d,f;if(g(n.cols)){let e=0;for(f=[...n.cols];e<n.cols.length&&!d;){const t=n.cols[e];v[e].searchable&&t&&(d=a.util.highlightSearchTerm(t,i,h,r,"a-ComboSelect-itemHighlight"),d&&i&&l&&(n.cols[e]=d)),e+=1}}else c=a.util.highlightSearchTerm(n[m],i,h,r,"a-ComboSelect-itemHighlight");if(c||d||!s){const a={pristineDisplayValue:n[m],i:n.i,cols:n.cols};let i;if(i=l&&c?c:t.escapeHTML(a.pristineDisplayValue),o){if(!n.r)throw new Error("Invalid choice object, r property missing");a.r=n.r,a.d=i}else a.r=i;if(e.push(a),u){const e={i:n.i,r:n.r,d:n[m]};f&&(e.cols=f),p.push(e)}y+=1}x+=1}d&&e.length?f.push({label:c[E].label,opts:e}):f=[...f,...e],u&&p.length&&(u.data||(u.data=[]),d?u.data.push({label:c[E].label,opts:p}):u.data=[...u.data,...p]),E+=1}return{fields:v,data:f}}static get observedAttributes(){return C}static get delegatedAttributes(){return b}static get componentMetaData(){return y}}apex.widget.util.ComboSelect=S}(apex.item,apex.util,apex.widget,apex.debug,apex.jQuery,apex.WebComponent);