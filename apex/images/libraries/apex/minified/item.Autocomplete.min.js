/*!
 Copyright (c) 2024, Oracle and/or its affiliates.
*/
!function(e,t,a,i,s,n){"use strict";class r extends HTMLElement{constructor(){super()}get textLabel(){return this.innerText}set textLabel(e){this.innerText=e}get htmlLabel(){return this.innerHTML}set htmlLabel(e){this.innerHTML=e}get icon(){return this.getAttribute("icon")}set icon(e){this.setAttribute("icon",e)}}customElements.define("a-option",r);const h="contains",c=".aAutocomplete",o={maxResults:{type:n.dataTypes.number,rangeMin:0,setterGetter:!0,reactive:!0,defaultValue:1e3},minCharactersSearch:{defaultValue:1,type:n.dataTypes.number,rangeMin:0,reactive:!0},ajaxIdentifier:{type:n.dataTypes.string,reactive:!0},ajaxItems:{type:n.dataTypes.string,reactive:!0},parentItems:{reactive:!0},parentsRequired:{defaultValue:!1},matchType:{type:n.dataTypes.enum,defaultValue:h,enumValues:[h,"starts-with"],reactive:!0},fetchOnType:{type:n.dataTypes.boolean,defaultValue:!1,reactive:!0},cache:{type:n.dataTypes.boolean,defaultValue:!1,reactive:!0},caseSensitive:{type:n.dataTypes.boolean,defaultValue:!1,reactive:!0}},l=["required","disabled","size","maxlength","autocomplete","placeholder","minlength","value","tabindex","name","aria-labelledby","aria-describedby"];apex.item.ItemComponent._addCommonAttributes(l,o),n._addHyphenCaseAttrNames(o);const d=n._configObservedAttributes(o,l);class p extends e.ItemComponent{choices;_wrappedElement$;item_type="AUTOCOMPLETE";#e;#t=new Map;#a={maxResults:void 0,minCharactersSearch:void 0,ajaxIdentifier:void 0,ajaxItems:void 0,parentItems:void 0,parentsRequired:void 0,matchType:void 0,fetchOnType:void 0,cache:void 0,caseSensitive:void 0};constructor(){super(),this._configPrivateState(this.#a),this._wrappedElement$=s('<input type="text" class="apex-item-text apex-item-auto-complete">'),this.setFocusTo=this._wrappedElement$}#i(e,i,s){const n=[];let r=0;for(;r<e.length&&(!this.#a.maxResults||n.length<this.#a.maxResults);){let h=e[r];const c=a.util.highlightSearchTerm(h.d,i,this.#a.matchType,this.#a.caseSensitive,"a-ComboSelect-itemHighlight");!c&&s||n.push({d:c||t.escapeHTML(h.d),i:h.i}),r+=1}return n}#s(e,t,a=!0){let i;return i=a?this.#i(e,t,!1):e,this.#a.cache&&this.#t.set(t,i),i}#n(e){return a.util.cascadingLov(this.element,this.ajaxIdentifier,{x01:e,pageItems:s(this.#a.ajaxItems,apex.gPageContext$)},{optimizeRefresh:this.#a.parentsRequired,dependingOn:s(this.#a.parentItems,apex.gPageContext$),loadingIndicatorPosition:"Nothing",target:this._wrappedElement$})}#r(e,t){let a=[];if(this.#a.fetchOnType){let a;if(this.#a.cache&&(a=this.#t.get(e)),this.#a.ajaxIdentifier)if(a)t(a);else{const a=this.#n(e);a?a.done((a=>{t(this.#s(a,e))})):t([])}else if(this.choices){if("function"!=typeof this.choices)throw new Error("Invalid data source provided, choices must be an function");a?t(a):this.choices(e,this.#a.matchType,this.caseSensitive,this.#a.maxResults).then((a=>{t(this.#s(a,e,!1))})).catch((e=>{throw new Error(e)}))}else i.warn("No data source provided")}else if(this.choices){if(!Array.isArray(this.choices))throw new Error("Invalid data source provided, choices property must be an array");a=this.#i(this.choices,e,!!e),t(a)}}#h(e){const t="change"+c,a=()=>{this.element.trigger("apexrefresh")};e&&s(e,apex.gPageContext$).off(t,a),this.#a.parentItems&&s(this.#a.parentItems,apex.gPageContext$).on(t,a)}#c(){const e="apexrefresh"+c;this.element.on(e,(()=>{this.refresh()}))}#o(){const e=this.#n("");e?e.done((e=>{this.choices=e})):this.choices=[]}refresh(){this.setValue(""),this.#t.clear(),!this.#a.fetchOnType&&this.#a.ajaxIdentifier&&this.#o()}setValue(e,t,a){this._wrappedElement$.val(e),super.setValue(e,t,a)}reinit(e){if(this.#t.clear(),this.setValue(e,null,!0),!this.#a.fetchOnType&&this.#a.ajaxIdentifier)return()=>{this.#o()}}_cleanup(){this.#e&&this.#e.destroy()}_render(e){if(this.rendered){if(e)for(const t of e)t.attributeName===o.minCharactersSearch.attrName?this.#e.options.minCharactersSearch=this.#a.minCharactersSearch:t.attributeName===o.fetchOnType.attrName&&(this.#e.options.asyncLoading=this.#a.fetchOnType),[o.minCharactersSearch.attrName,o.ajaxIdentifier.attrName,o.ajaxItems.attrName,o.parentItems.attrName].includes(t.attributeName)||this.#t.clear(),t.attributeName===o.parentItems.attrName&&this.#h(t.oldValue)}else{let e,t;if(e=this.element.find("a-option"),e.length){this.choices=[];const t=this.choices;e.each((function(){t.push({d:this.innerText,i:this.getAttribute("icon")})}))}this.element.hasClass("apex-item-has-icon")&&(t=this.element.find(".apex-item-icon").detach()),this.id&&this._wrappedElement$.attr("id",this.id+"_input"),this.element.empty().append(this._wrappedElement$),t&&t[0]&&this.element.append(t),this.#e=a.util.initComboSelect(this.element,{baseId:this.id,searchIcon:!1,enterable:!0,escapeChoices:!1,maxHeight:480,hasIcons:!0,minCharactersSearch:this.#a.minCharactersSearch,popupClasses:"ui-dialog-autocomplete",containerClasses:null,asyncLoading:this.#a.fetchOnType,choices:(e,t)=>{this.#r(e,t)},isDisabled:function(){return!0}}),this.#h(),this.element.on("apexrefresh",(()=>{this.refresh()})),this.#c()}}static get observedAttributes(){return d}static get delegatedAttributes(){return l}static get componentMetaData(){return o}}customElements.define("a-autocomplete",p)}(apex.item,apex.util,apex.widget,apex.debug,apex.jQuery,apex.WebComponent);