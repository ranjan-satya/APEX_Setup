/*!
 Copyright (c) 2015, 2024, Oracle and/or its affiliates.
*/
!function(e,t,i,o,r,l,s){"use strict";const n="a-RV",d="a-RV-toolbar",a="a-RV-w-scroll",c="a-RV-body",u="a-RV--excludeHidden",h="a-RV--excludeNull",f="u-Form",p=f+"-groupHeading",m=f+"-fieldContainer",g="."+m,R=g+".is-active",v=f+"-labelContainer",b=f+"-label",E=f+"-inputContainer",_="."+E,C="a-RV-fieldValue",y="a-Form-error",x="."+y,I="a-Alert",O="."+I,w="a-RV-field--hidden",V="is-focused",M="is-disabled",T="is-active",P="."+T,A="is-required",k="is-readonly",D="is-error",S="is-warning",F="is-error is-warning is-readonly",N=":tabbable",L="data-itemhelp",$=":visible",H="aria-invalid",X="aria-errormessage",z="option",K="show",B="hide",W="record",U="table",G="tree",q="delete-record",j="duplicate-record",Q="next-record",Y="previous-record",J="exclude-null-values",Z="exclude-hidden",ee="insert-record",te="refresh-record",ie="revert-record",oe=Object.entries,re=s.extend,le=s.ui.keyCode;const se=[{align:"start",controls:[{type:"MENU",labelKey:"APEX.RV.SETTINGS_MENU",iconOnly:!0,icon:"icon-gear",menu:{items:[{type:"toggle",action:J},{type:"toggle",action:Z}]}}]},{align:"end",controls:[{type:"STATIC",id:"status",label:""},{type:"BUTTON",iconOnly:!0,action:Y},{type:"STATIC",id:"recordNumber",label:""},{type:"BUTTON",iconOnly:!0,action:Q}]}];function ne(e){var t=e.groupName||null;return t&&e.useGroupFor&&e.useGroupFor.indexOf("srv")<0&&(t=null),t}s.widget("apex.recordView",s.apex.tableModelViewBase,{widgetEventPrefix:"recordview",options:{idPrefix:null,actionsContext:null,recordOffset:0,recordParent:null,showNullAs:"-",fields:null,fieldGroups:null,alwaysEdit:!1,skipDeletedRecords:!1,toolbar:se,showExcludeNullValues:!0,showExcludeHiddenFields:!0,formCssClasses:null,labelAlignment:"end",tabbableFieldContent:"a,button,input",modeChange:null,recordChange:null,exitEditModeOnEscape:!0},_create:function(){var e=this,t=this.options,i=this.element;i.addClass(n),this._super(),delete this.firstPage,delete this.previousPage,delete this.nextPage,delete this.lastPage,delete this.loadMore,delete this.gotoPage,this.editMode=!1,this.fields=null,this.excludeNullValues=!1,this.excludeHiddenFields=!1,this.lastFocused=null,this.lastField=null,this.toolbar$=null,this.currentRecord=null,this.currentRecordId=null,t.actionsContext?this.actions=t.actionsContext:this.actions=l.createContext("recordView",i[0]),this.actions.remove([J,Z,Q,Y,ee,te,ie,q,j]),this.actions.add([{name:J,labelKey:"APEX.RV.EXCLUDE_NULL",get:function(){return e.excludeNullValues},set:function(o){t.showExcludeNullValues&&(e.excludeNullValues=o,i.toggleClass(h,o))}},{name:Z,labelKey:"APEX.RV.EXCLUDE_HIDDEN",get:function(){return e.excludeHiddenFields},set:function(o){t.showExcludeHiddenFields&&(e.excludeHiddenFields=o,i.toggleClass(u,o))}},{name:Q,labelKey:"APEX.RV.NEXT_RECORD",shortcut:"Alt+Page Down",icon:"icon-next",action:function(){var i,o;if(e.modelShape===G){if(!(o=e._nextTreeRecord()))return;t.recordParent=o.parent,t.recordOffset=o.offset}else{if(!((i=e.model.getTotalRecords())<0||t.recordOffset+1<i))return;t.recordOffset+=1}e.direction=1,e.refresh(!1)}},{name:Y,labelKey:"APEX.RV.PREV_RECORD",shortcut:"Alt+Page Up",icon:"icon-prev",action:function(){var i;if(e.modelShape===G){if(!(i=e._previousTreeRecord()))return;t.recordParent=i.parent,t.recordOffset=i.offset}else{if(!(t.recordOffset>0))return;t.recordOffset-=1}e.direction=-1,e.refresh(!1)}},{name:ee,labelKey:"APEX.RV.INSERT",action:function(){if(t.editable)return e.model.insertNewRecord(e.modelShape===G?t.recordParent:null,e.getRecord()),e.actions.invoke(Q),e.editMode||e.setEditMode(!0),e.focus(),!0}},{name:te,labelKey:"APEX.RV.REFRESH",action:function(){e.model.fetchRecords([e.getRecord()])}},{name:ie,labelKey:"APEX.RV.REVERT",action:function(){t.editable&&e.model.revertRecords([e.getRecord()])}},{name:q,labelKey:"APEX.RV.DELETE",action:function(){t.editable&&e.model.deleteRecords([e.getRecord()])}},{name:j,labelKey:"APEX.RV.DUPLICATE",action:function(){if(t.editable){var i=e.getRecord();return e.model.copyRecords([i],null,i),e.actions.invoke(Q),e.editMode||e.setEditMode(!0),e.focus(),!0}}}]),this._updateMenuActions(),this._initModel(t.modelName),this._on(this._eventHandlers),this.direction=1,this.refresh(),t.disabled&&this._setOption("disabled",t.disabled)},_eventHandlers:{resize:function(e){e.target===this.element[0]&&(this.resize(),e.stopPropagation())},dblclick:function(e){const t=this.options;s(e.target).closest(g).length&&!t.alwaysEdit&&t.editable&&!this.editMode&&(e.preventDefault(),this.setEditMode(!0))},keydown:function(e){var t,i,o=this.options,r=e.which;if(r===le.ENTER){if(s(e.target).closest("a,button").length>0)return;s(e.target).closest(g).length&&!o.alwaysEdit&&o.editable&&!this.editMode&&(e.preventDefault(),this.setEditMode(!0))}else if(113===r)s(e.target).closest(g).length&&!o.alwaysEdit&&o.editable&&!this.editMode&&(e.preventDefault(),this.setEditMode(!0));else if(r===le.ESCAPE)o.exitEditModeOnEscape&&!o.alwaysEdit&&o.editable&&this.editMode&&(this.setEditMode(!1),e.stopPropagation());else if(112===r&&e.altKey&&(t=s(e.target).closest(g).find(".js-itemHelp")).length&&(i=t.attr(L)))return apex.theme.popupFieldHelp(i,apex.env.APP_SESSION),!1},focusin:function(e){var t,i,o=this;function r(){o.deactivateDelayTimer&&(clearTimeout(o.deactivateDelayTimer),o.deactivateDelayTimer=null)}0!==(i=s(e.target).closest(g)).length?(i.addClass(V),this.lastFocused=i[0],i[0]!==this.lastField?(this.lastField=i[0],this.editMode&&(r(),(t=this.element.find(P)).length&&this._deactivateField(t),this._activateField(i))):r()):this.lastField=null},focusout:function(e){var t=this,i=s(e.target).closest(g);0!==i.length&&(i.removeClass(V),this.editMode&&(this.deactivateDelayTimer=setTimeout((function(){t.lastField=null,t._deactivateField(i),t.deactivateDelayTimer=null}),10)))}},_destroy:function(){this.element.removeClass(n+" "+M+" u-RTL "+u+" "+h).empty(),this._initModel(null)},_setOption:function(e,t){"editable"===e&&!t&&this.editMode&&this.setEditMode(!1),this._super(e,t),"disabled"===e?(this.element.toggleClass(M,t),t&&this.resize()):"showExcludeNullValues"===e||"showExcludeHiddenFields"===e?this._updateMenuActions():"recordOffset"===e||"recordParent"===e?this.refresh():"modelName"===e?(this.editMode&&this.setEditMode(!1),this._initModel(t),this.refresh()):"editable"!==e&&"alwaysEdit"!==e&&"toolbar"!==e&&"formCssClasses"!==e&&"labelAlignment"!==e||this._refreshView()},getActions:function(){return this.actions},getToolbar:function(){return this.toolbar$},refresh:function(e){var t,i=this,o=this.options,r=this.element;this._refreshCheckIfVisible()&&((t=r.find(R)).length&&this._deactivateField(t),this.fields||this._initView(),!this.editMode&&o.alwaysEdit&&this.setEditMode(!0),this._updateRecord(null,null,(function(){e&&i.focus()})))},focus:function(){this.lastField=null;let e=this.body$.find(N).first();e[0]||(e=this.element.find(N).first()),e.trigger("focus")},gotoField:function(e,t){var o,r,l,s,n,d=this.options,a=null;if(r=this.model.getRecord(e)){if(e!==this.currentRecordId&&(d.recordOffset=this.model.indexOf(r),this.refresh()),t)if(s=d.fields[0][t]){for(s.hidden&&s.canHide&&this.excludeHiddenFields&&this.actions.set(Z,!1),null!==(n=this.model.getValue(r,t))&&""!==n||!this.excludeNullValues||this.actions.set(J,!1),o=0;o<this.fields.length;o++)if(!((l=this.fields[o]).virtual||!l.canHide&&l.hidden)&&l.property===t){a=this.element.find("[data-idx='"+o+"']");break}o>=this.fields.length&&i.warn("Warning field is hidden "+t)}else i.warn("Warning field not found "+t);a?(this.lastField=null,a.find(N).first().trigger("focus")):this.focus()}else i.warn("Warning record not found "+e)},getFields:function(){return this.fields},refreshFields:function(){this.fields=null},fieldElement:function(e){return this.mapFieldToLabelId&&this.mapFieldToLabelId[e]?s("#"+this.mapFieldToLabelId[e]).closest(g):s()},inEditMode:function(){return this.editMode},setEditMode:function(e){var t,o,r=this.element,l=this,n="change.rvedit";this.scrollWrap$&&(this.options.editable?(e=!!e,o=this.editMode,e!==o&&((t=s(this.lastFocused)).length&&!e&&l._deactivateField(t),this._updateRecord(e,o,(function(){l.editMode=e,r.toggleClass("a-RV--editMode",e),e&&!t.length&&(l.focus(),t=s(l.lastFocused)),t.length&&(t.find(N).first().trigger("focus"),l.deactivateDelayTimer&&(clearTimeout(l.deactivateDelayTimer),l.deactivateDelayTimer=null),e&&l._activateField(t)),e?l.body$.on(n,(function(e){var t,i,o;if(l.activeRecord&&!s(e.target).closest(R).length)for(t=0;t<l.fields.length;t++)if((i=l.fields[t]).elementId===e.target.id){o=i.property,l.setActiveRecordValue(o);break}})):(l._forEachField(!0,(function(e,t){void 0!==l.columnItems[t.property]&&l._deactivateColumnItem(l.columnItems[t.property])})),l.body$.off(n),l.activeRecord=null,l.activeRecordId=null),l._trigger("modeChange",null,{editMode:e})})))):e&&i.warn("View is not editable."))},getRecord:function(){return this.currentRecord},resize:function(){const e=this.element,t=e.height();if(null!==e[0].offsetParent&&(this.scrollWrap$&&!this.pendingRefresh||(this.refresh(),this.fields))){if(this.options.hasSize){let e=t-(this.toolbar$?this.toolbar$.outerHeight():0);this.scrollWrap$.height(e)}e.find(".a-RV-readonly").each((function(){s(this).css("height","").innerHeight(this.scrollHeight)}))}},expandGroup:function(){},collapseGroup:function(){},_initModel:function(t){var i,o=this.options,r=this;this._super(t,(function(t,l){function s(e,s){for(let n=0;n<e.length;n++){let d=e[n];d===r.currentRecordId&&("delete"===t?i&&o.skipDeletedRecords?(r.currentRecord=null,r.currentRecordId=null,r.activeRecord=null,r.activeRecordId=null,r.actions.invoke(Q),null===r.currentRecord&&r.actions.invoke(Y)):r._updateRecord():"clearChanges"===t&&s?r.actions.invoke(Q):"refreshRecords"===t?(d=l.newIds[d]||d,r._updateRecord()):"revert"===t?r._updateRecord():r._updateRecordState())}}if(!r.pendingRefresh)if("refresh"===t){if(r.modelShape===G)r.recordOffset=-1,r.recordParent=null;else{let e,t;r.modelShape===U&&r.currentRecordId?(e=r.model.getRecord(r.currentRecordId),t=r.model.indexOf(e),o.recordOffset=t>-1?t:0):o.recordOffset=0}if(l.clearDataPending&&r._refreshCheckIfVisible()){o.recordOffset=0,r.model.fetch(o.recordOffset,(function(){r.refresh()}))||r.refresh(!0)}else r.refresh(!0)}else if("insert"===t||"copy"===t)r.noData&&r.refresh();else if("refreshRecords"===t)s(l.recordIds);else if("clearChanges"===t)s(l.deletedIds,!0),s(l.changedIds);else if(l.recordIds)s(l.recordIds);else if("set"===t){let t,i,o,s,n,d;null!==r.ignoreFieldChange&&r.ignoreFieldChange===l.field||(l.oldIdentity&&r._identityChanged(l.oldIdentity,r.model.getRecordId(l.record)),r.model.getRecordId(l.record)===r.currentRecordId&&(t=r.columnItems[l.field],r.editMode&&t?r.ignoreItemChange||r._setColumnItemValue(t.item,l.record,l.field):(s=r.fieldElement(l.field),s.length&&(o=r._getFieldMetadata(s),n=r.model.getRecordMetadata(r.currentRecordId),d=null,n.fields&&(d=n.fields[o.property]),i=e.htmlBuilder(),r._renderFieldDataValue(i,o,l.record,n,d),s.find("."+C).html(i.toString()))),r._updateRecordState()))}else"metaChange"===t&&(null!==r.ignoreFieldChange&&r.ignoreFieldChange===l.field||l.recordId!==r.currentRecordId||r._updateRecordState())})),t&&(i=this.model.getOption("onlyMarkForDelete"),this.modelShape=this.model.getOption("shape"),this.modelShape===W&&(this.actions.hide(Q),this.actions.hide(Y),this.actions.hide(ee),this.actions.hide(j),this.actions.hide(q)))},_updateMenuActions:function(){var e=this.options;this.actions[e.showExcludeNullValues?K:B](J),this.actions[e.showExcludeHiddenFields?K:B](Z)},_updateFields:function(){let e={},t=this.options.fields[0];this.fields=[];for(const[i,o]of oe(t)){o.property=i,this.fields.push(o);let t=ne(o);t&&(!e[t]||o.seq<e[t])&&(e[t]=o.seq)}this.fields.sort((function(t,i){return ne(t)===ne(i)?t.seq-i.seq:ne(t)?ne(i)?(e[ne(t)]||0)-(e[ne(i)]||0):-1:1}))},_initView:function(){var e=this.options,t=this.editMode;this._updateFields(),this.columnItems||this._initColumnItems(this.fields),this.toolbar$=null,t&&this.setEditMode(!1),this._renderView(),(t||e.alwaysEdit)&&this.setEditMode(!0),e.toolbar&&(this.toolbar$=this.element.children("."+d).toolbar({idPrefix:this._getIdPrefix()+"tb",actionsContext:this.actions,data:e.toolbar,label:o.formatMessage("APEX.RECORD_VIEW.TOOLBAR"),small:!0}),this.modelShape===W&&this.toolbar$.toolbar("hideControl","recordNumber")),this.resize()},_refreshView:function(){this.refreshFields(),this.refresh()},_forEachField:function(e,t){var i,o,r,l,s,n=this.fields;for(e&&(l=this.element.find("."+C)),r=0,i=0;i<n.length;i++)(o=n[i]).virtual||!o.canHide&&o.hidden||(s=null,e&&(s=l.eq(r)),t.call(this,i,o,s),r+=1)},_getIdPrefix:function(){return(this.options.idPrefix||this.element[0].id||"rv")+"_"},_renderView:function(){const t=this.options,i=this.element,r=e.htmlBuilder();let l,n,u;function h(){r.markup("<div").attr("class",f+(t.formCssClasses?" "+t.formCssClasses:"")).markup(">"),n=!0}t.toolbar&&r.markup("<div class='"+d+"'></div>"),this._renderAltDataMessages(r),r.markup("<div class='"+a+"'>").markup("<div class='"+c+"'>"),this.mapFieldToLabelId={},l=null,n=!1,this._forEachField(!1,(function(e,i){const s=this._getIdPrefix()+e,d=this.columnItems[i.property],a=i.elementId?i.elementId:this._getIdPrefix()+i.property;let c,f,g,R,_,y;if(this.mapFieldToLabelId[i.property]=s,u=ne(i),l!==u){if(u){if(f=t.fieldGroups[u],!f)throw new Error("Unknown field group name: "+u);g=f.label||f.heading}else g=o.getMessage("APEX.RV.NOT_GROUPED_LABEL");n&&r.markup("</div>"),r.markup("<h3 class='"+p+"'><button type='button'>").content(g).markup("</button></h3>"),h(),l=u}if(n||h(),c=m,i.hidden&&(c+=" "+w),i.fieldCssClasses&&(c+=" "+i.fieldCssClasses),i.isRequired&&(c+=" "+A),R=i.label||i.heading,_=null,i.fieldColSpan&&(_=parseInt(i.fieldColSpan,10),_>0&&_<13?r.markup("<div class='apex-col apex-col-"+_+"'>"):_=null),r.markup("<div").attr("id",a+"_CONTAINER").attr("data-idx",e).attr("class",c).markup("><div").attr("id",s).attr("class",v+" "+function(e,t){var i="";return"start"===e?i=" u-tS":"end"===e?i=" u-tE":"left"===e?i=" u-tL":"right"===e?i=" u-tR":"center"!==e||t||(i=" u-tC"),i}(t.labelAlignment)).markup(">"),!d||!d.item.setLabel){const e="HIDDEN"===d?.item?.item_type?"span":"label",t=a+"_LABEL";r.markup("<"+e).attr("id",t).optionalAttr("for","label"===e?a:null).attr("class",b).markup(">").content(R).markup("</"+e+">")}r.markup("</div><div class='"+E+"'><div class='"+C+"'></div>"),i.helpid&&(y=o.formatMessage("APEX.ITEM.HELP_TEXT",R),r.markup("<button class='a-Button a-Button--noUI a-Button--helpButton js-itemHelp' tabindex='-1' type='button'").attr(L,i.helpid).attr("aria-label",y).attr("title",y).markup("><span class='a-Icon icon-help' aria-hidden='true'></span></button>")),r.markup("</div></div>"),_&&r.markup("</div>")})),n&&r.markup("</div>"),r.markup("</div></div>"),i.html(r.toString()).find("."+p).each((function(){var e=s(this);e.collapsible({heading:"."+p,controllingElement:"button",universalTheme:!0,collapsed:!1,content:e.next()})})),this.scrollWrap$=i.find("."+a),this.body$=i.find("."+c),this.noData$=i.find(".a-GV-noDataMsg")},_updateRecord:function(e,t,i){var o,r=this,l=this.currentRecordId,s=this.options;function n(){var e,t,i,o,l,s;for(o=r.model.getRecordMetadata(r.currentRecordId),e=0;e<r.fields.length;e++)t=r.fields[e].property,(i=r.columnItems[t])&&(s=i.item.isDisabled(),i.element$.is($)&&!s?i.item.getValidity().valid||r.model.setValidity("error",r.currentRecordId,t,i.item.getValidationMessage()):r.model.setValidity("valid",r.currentRecordId,t),o&&((l=o.fields?o.fields[t]:null)&&l.disabled||s)&&(l||(o.fields||(o.fields={}),l={},o.fields[t]=l),l.disabled=s));r._triggerEndEditing(r.currentRecord,r.currentRecordId),r.activeRecord=null,r.activeRecordId=null}function d(o,d,a){var c,u,h,f=r.body$;if(o){if(c=r.model.getRecordMetadata(a)||{},r.scrollWrap$.show(),r.noData$.hide(),c.agg||c.deleted&&s.skipDeletedRecords)return r.modelShape===G?(u=r[r.direction>0?"_nextTreeRecord":"_previousTreeRecord"]())&&(s.recordParent=u.parent,s.recordOffset=u.offset):(s.recordOffset+=r.direction,h=r.model.getTotalRecords(),s.recordOffset<0?(s.recordOffset=0,r.direction=-r.direction):h>=0&&s.recordOffset>=h&&(s.recordOffset=h-1,r.direction=-r.direction)),r._updateRecord(e,t,i),void r._updateRecord();s.editable&&r.currentRecord&&(e&&!1!==t||!0===t)&&n(),s.recordOffset=d,r.currentRecordId=a,r.currentRecord=null,r.activeRecord=null,r._renderRecordFields(e,o,d,a,c),r.currentRecord=o,e&&(r.activeRecord=o,r.activeRecordId=a),f.children(O).remove(),f.find(x).remove(),r._updateRecordState(),r._updateRecordNumber(),s.editable&&e&&r._triggerBeginEditing(r.currentRecord,r.currentRecordId),null!==l&&l===r.currentRecordId||setTimeout((function(){r._trigger("recordChange",null,{recordOffset:s.recordOffset,recordId:r.currentRecordId})}),1)}else s.editable&&r.currentRecord&&(e&&!1!==t||!0===t)&&n(),r.currentRecordId=null,r.currentRecord=null,r._renderRecordFields(e,null,-1,null,{}),r.scrollWrap$.hide(),r.noData$.show(),r._updateActions(),r._updateRecordNumber()}if(null==e&&(e=this.editMode),this.activeLockCount>0)this.activeUnlockCallback=function(){r._updateRecord(e,t,i)};else{switch(this.modelShape){case W:if(!(o=this.model.getRecord())&&this.model.getOption("ajaxIdentifier")){let e=this.model.fetch();if(e)return void e.then((()=>{d(o=this.model.getRecord(),0,o?this.model.getRecordId(o):null)}))}d(o,0,o?this.model.getRecordId(o):null);break;case U:this.model.forEachInPage(s.recordOffset,1,(function(e,t,i){d(e,t,i)}),this);break;case G:null===s.recordParent?(o=this.model.root(),s.recordOffset=-1,d(o,s.recordOffset,o?this.model.getRecordId(o):null)):d(o=this.model.child(s.recordParent,s.recordOffset),s.recordOffset,o?this.model.getRecordId(o):null)}i&&i()}},_renderRecordFields:function(t,i,o,r,l){const n=this.options.tabbableFieldContent,d=e.htmlBuilder(),a=e.htmlBuilder(),c=this.columnItemsContainer$?this.columnItemsContainer$[0]:null;let u=!1;t&&i&&(u=this.model.allowEdit(i)),this._forEachField(!0,(function(e,t,o){let r,h,f,p,g,R,v=null,E=null,_=null,C=!1;if(r=m,i&&(h=this.model.getValue(i,t.property),null!==h&&""!==h||(r+=" a-RV-field--null"),t.hidden&&(r+=" "+w),t.fieldCssClasses&&(r+=" "+t.fieldCssClasses),t.isRequired&&(r+=" "+A),l.fields&&(v=l.fields[t.property]),v&&(v.disabled&&(r+=" is-disabled"),C=v.ck),(C||t.readonly)&&(r+=" "+k,C=!0)),f=this.columnItems[t.property],!f||!f.item.setLabel){const e=t.elementId?t.elementId:this._getIdPrefix()+t.property;E=e+"_LABEL",_=e+"_RO"}u&&f&&!C&&!t.volatile?f.element$.parent()[0]===c&&(o.empty().append(f.element$),E&&t.elementId&&s("label#"+E).attr("for",t.elementId),this._activateColumnItem(f,E),E||f.item.setLabel(t.label||t.heading)):(f&&f.element$.closest(this.element).length&&(this._deactivateColumnItem(f),E||f.item.setLabel(null)),i?(d.clear(),a.clear(),E||(v=re(!0,{},v),v.ck="X"),R=v&&v.url||t.linkTargetColumn,this._renderFieldDataValue(a,t,i,l,v),h=a.toString(),!1===t.escape||R||t.cellTemplate?E&&!R?(_&&s("label#"+E).attr("for",_),d.markup('<span role="group" tabindex="0"').optionalAttr("id",_).attr("aria-labelledby",E).markup(">").markup(h).markup("</span>")):d.markup(h):(_&&s("label#"+E).attr("for",_),d.markup('<textarea class="a-RV-readonly" cols="50" rows="1" readonly').optionalAttr("id",_).optionalAttr("aria-labelledby",_?null:E).markup(">").markup(h).markup("</textarea>")),E||d.markup(`<span class='${b}'`).optionalAttr("id",t.domId).attr("aria-hidden","true").markup(">").content(t.label||t.heading).markup("</span>"),o.html(d.toString()),g=o.find(".a-RV-readonly"),g[0]&&g.innerHeight(g[0].scrollHeight),p=o.find(n),p.length&&(p.filter("[tabindex]").attr("tabindex",0).first().attr("aria-labelledby",E),o.find('[role="group"]').removeAttr("tabindex"))):o.empty()),o.parent().parent().attr("class",r)})),u&&i&&(this._beginSetColumnItems(),this._forEachField(!0,(function(e,t,o){var r=this.columnItems[t.property];!r||o.hasClass(k)||t.volatile||this._setColumnItemValue(r.item,i,t.property,u?l:null)})),this._endSetColumnItems())},_updateRecordState:function(){let e,t,i="",r=this.body$;if(e=this.model.getRecordMetadata(this.currentRecordId)||{},r.removeClass("is-deleted is-inserted is-updated "+F),e.deleted?(r.addClass("is-deleted"),i=o.getMessage("APEX.GV.ROW_DELETED")):e.inserted?(r.addClass("is-inserted"),i=o.getMessage("APEX.GV.ROW_ADDED")):e.updated&&(r.addClass("is-updated"),i=o.getMessage("APEX.GV.ROW_CHANGED")),this.model.allowEdit(this.currentRecord)||r.addClass(k),e.error||e.warning?(t=r.children(O),t.length||(t=s(`<div class='${I}'></div>`),r.prepend(t)),t.text(e.message),r.addClass(e.error?D:S)):r.children(O).remove(),e.fields)for(const[i,o]of oe(e.fields)){const e=this.fieldElement(i),r=e.find("input"),l=r.attr("id")+"_error";e.removeClass("is-changed is-stale "+F),o.error||o.warning?(t=e.find(x),t.length||(t=s("<span class='"+y+"'></span>"),e.find(_).append(t)),t.text(o.message).attr("id",l).attr("role","alert"),e.addClass(o.error?D:S),r.attr(H,"true").attr(X,l)):(e.find(x).remove(),r.removeAttr(H).removeAttr(X),o.changed?e.addClass("is-changed"):o.stale&&e.addClass("is-stale")),o.ck&&e.addClass(k)}this._updateActions(),this.toolbar$&&this.toolbar$.toolbar("findElement","status").text(i)},_hasPrevious:function(){var e=this.options;switch(this.modelShape){case W:return!1;case U:return e.recordOffset>0;case G:return null!==this._previousTreeRecord()}},_hasNext:function(){var e,t=this.options;switch(this.modelShape){case W:return!1;case U:return(e=this.model.getTotalRecords())<0||t.recordOffset+1<e;case G:return null!==this._nextTreeRecord()}},_nextTreeRecord:function(){var e,t,i=this.options,o=i.recordOffset,r=i.recordParent;if(t=null===r?this.model.root():this.model.child(r,o),this.model.childCount(t)>0)return{parent:t,offset:0};for(;r;){if((e=this.model.childCount(r))>0&&o+1<e)return{parent:r,offset:o+1};o=this.model.indexOf(r),r=this.model.parent(r)}return null},_previousTreeRecord:function(){var e=this,t=this.options,i=t.recordOffset,o=t.recordParent;return null===o?null:o&&i>0?function t(i){var o=e.model.childCount(i);return o>0?t(e.model.child(i,o-1)):{parent:e.model.parent(i),offset:e.model.indexOf(i)}}(this.model.child(o,i-1)):{parent:this.model.parent(o),offset:this.model.indexOf(o)}},_updateActions:function(){var e=this.options,t=this.actions,i=this.currentRecord,o=e.editable,r=this.model,l=this.modelShape===G?e.recordParent:null,s=o&&r.allowAdd(l,"new"),n=o&&i&&r.allowAdd(l,"copy"),d=o&&i;function a(e,i){t[e?"enable":"disable"](i)}a(d&&r.canRevertRecord(i),ie),a(d&&r.allowDelete(i),q),a(s,ee),a(n,j),a(i&&this._hasNext(),Q),a(i&&this._hasPrevious(),Y)},_getFieldMetadata:function(e){var t=parseInt(e.attr("data-idx"),10);return isNaN(t)?null:this.fields[t]},_activateField:function(e){var t,i;e.length<=0||null===this.currentRecord||((t=this._getFieldMetadata(e))&&(i=this.columnItems[t.property]),i&&this.model.allowEdit(this.currentRecord)&&!e.hasClass(k)&&e.addClass(T))},_deactivateField:function(e){var t,i=null;e.length<=0||null===this.currentRecord||((t=this._getFieldMetadata(e))&&(i=this.columnItems[t.property]),i&&!e.hasClass(k)&&e.hasClass(T)&&(this._setModelValue(e,i.item,this.currentRecord,t.property),this._updateRecordState()))},_updateRecordNumber:function(){var e,t,i="",r=this.options;this.toolbar$&&(this.currentRecord&&(this.modelShape===G?(t=this.model.parent(this.currentRecord))&&(e=this.model.childCount(t)):e=this.model.getTotalRecords(),i=e>0?o.formatMessage("APEX.RV.REC_XY",r.recordOffset+1,e):o.formatMessage("APEX.RV.REC_X",r.recordOffset+1)),this.toolbar$.toolbar("findElement","recordNumber").text(i))},_identityChanged:function(e,t){e===this.currentRecordId&&(this.currentRecordId=t,this.activeRecordId&&(this.activeRecordId=t))}}),s.apex.recordView.copyDefaultToolbar=function(){var e,t=[];for(e=0;e<se.length;e++)t.push(re(!0,{},se[e]));return t},s.apex.recordView.createModelEditDialog=function(i,r){var n,d,a,c,u,h,f,p,m,g,R,v,b,E,_,C,y,x=s,I=[],O=x("#"+i),w=r.modelOptions.shape||U,V=r.okLabelKey?o.getMessage(r.okLabelKey):null,M=e.htmlBuilder(),T=r.classPrefix||"a-IG-dialog";function P(e){E&&(h&&E.expand(E.getSelection().first()),y&&clearTimeout(y),y=setTimeout((function(){E[h?"setSelectedNodes":"setSelectedRecords"]([e]),y=null}),1))}r.appendToTop&&(x=e.getTopApex().jQuery),v=x("body").context,O.length||(O=x("<div id='"+i+"'></div>"),x(r.appendTo||"body").append(O)),w===G?d=s.apex.treeView.makeModelNodeAdapter(r.modelName,r.modelOptions,null):(w===W&&(I=null),d=t.create(r.modelName,r.modelOptions,I,0,!1)),m=d.getOption("shape"),g=d.getOption("fields"),R=d.getOption("editable"),b=R&&d.getOption("sequenceField"),M.markup("<form novalidate><section class='"+T+"-region "+T+"-body'>"),m!==W&&M.markup("<aside class='"+T+"-side resize'><div class='nav resize'></div><div class='tb'></div></aside>"),M.markup("<main class='"+T+"-main resize'><div class='rv resize'></div></main></section></form>"),(n=re({closeText:o.getMessage("APEX.DIALOG.CLOSE"),noDataMessage:null},r,{autoOpen:!1,modal:!0,create:function(){var e,t,o,n,p=l.createContext("ModelEditDialog",O[0]);if(x(this).closest(".ui-dialog").css("position","fixed"),(u=s("#"+i,v).find(".rv")).recordView({modelName:r.modelName,noDataMessage:r.noDataMessage,idPrefix:r.idPrefix||r.modelName,fields:[g],actionsContext:p,toolbar:null,editable:!0,alwaysEdit:!0,hasSize:!0,skipDeletedRecords:!0,formCssClasses:r.formCssClasses,labelAlignment:r.labelAlignment,recordChange:function(){var t;"nav"!==e&&(t=u.recordView("getRecord"))&&(e="rv",P(t),e=null)}}),m!==W&&(f=s("#"+i,v).find(".tb"),p.add([{name:"move-up",labelKey:"APEX.RV.MOVE_UP",hide:!0,action:function(){var e,t=null,i=a.grid("getSelection"),o=a.grid("getSelectedRecords");i[0].prev().length&&((e=i[0].prev().prev()).length&&(t=a.grid("getRecords",[e])[0]),d.moveRecords(o,null,t),a.grid("setSelectedRecords",o))}},{name:"move-down",labelKey:"APEX.RV.MOVE_DOWN",hide:!0,action:function(){var e,t=null,i=a.grid("getSelection"),o=a.grid("getSelectedRecords");(e=i[i.length-1].next()).length&&(t=a.grid("getRecords",[e])[0],d.moveRecords(o,null,t),a.grid("setSelectedRecords",o))}}]),t=[{type:"BUTTON",iconOnly:!0,icon:"icon-plus",action:ee},{type:"BUTTON",iconOnly:!0,icon:"icon-copy",action:j},{type:"BUTTON",iconOnly:!0,icon:"icon-minus",action:q},{type:"BUTTON",iconOnly:!0,icon:"icon-up-chevron",action:"move-up"},{type:"BUTTON",iconOnly:!0,icon:"icon-down-chevron",action:"move-down"}],p[R?K:B](q),p[R?K:B](ee),p[R&&r.includeCopy?K:B](j),p[b?K:B]("move-up"),p[b?K:B]("move-down"),f.toolbar({actionsContext:p,data:[{align:"start",controls:t}]})),m===U)if(r.useList){if(c=s("#"+i,v).find(".nav"),!(n=r.recordTemplate)){if(!r.labelColumn)throw new Error("Option recordTemplate or labelColumn is required");n="<li data-id='&APEX$ROW_ID.' class='&APEX$ROW_STATE_CLASSES.'>",r.iconClassColumn&&(n+="<span class='a-IconList-icon'><span class='&"+r.iconClassColumn+".'></span></span>"),r.enabledCheckbox&&(n+="<span class='ro-checkbox &\"enabledClass\".'></span><span class='u-vh'>&\"enabledText\".</span>"),n+="<span class='a-IconList-label'>&"+r.labelColumn+".</span></li>"}c.tableModelView({modelName:r.modelName,columns:[g],hasSize:!0,footer:!1,pagination:{scroll:!0},useIconList:!0,recordTemplate:n,collectionClasses:r.collectionClasses||"a-RVDialog-list",selectionChange:function(){var t,i;"rv"!==e&&(i=c.tableModelView("getSelectedRecords")[0])&&(e="nav",t=d.indexOf(i),u.recordView(z,"recordOffset",t),e=null)}}),E=c.data("apex-tableModelView")}else(a=s("#"+i,v).find(".nav")).grid({modelName:r.modelName,noDataMessage:r.noDataMessage,columns:[g],editable:!1,hasSize:!0,footer:!1,pagination:{scroll:!0},reorderColumns:!1,columnSort:!1,hideDeletedRows:!0,selectionChange:function(){var t,i;"rv"!==e&&(i=a.grid("getSelectedRecords")[0])&&(e="nav",t=d.indexOf(i),u.recordView(z,"recordOffset",t),e=null)}}),E=a.data("apex-grid");else m===G&&(s("#"+i,v).find(".nav").addClass("a-RVDialog-scroll").html("<div class='a-RVDialog-tree'></div>"),o={showRoot:!0,collapsibleRoot:!0,expandRoot:!0,getNodeAdapter:function(){return d},selectionChange:function(){var t,i,o;"rv"!==e&&(i=h.treeView("getSelectedNodes")[0])&&(o=d.parent(i),e="nav",o!==u.recordView(z,"recordParent")&&u.recordView(z,"recordParent",o),t=d.indexOf(i),u.recordView(z,"recordOffset",t),e=null)}},(h=s("#"+i,v).find(".a-RVDialog-tree")).treeView(o),s.apex.treeView.treeModelListener(r.modelName,h),E=h.data("apex-treeView"));this.initDone=!1},open:function(){var e,t=null;f&&f.toolbar("refresh"),a&&a.grid("refreshColumns"),n.resize(),r.init&&!this.initDone&&r.init.call(this,d,a||c||h||null,u,f),this.initDone=!0,r.load&&(t=r.load.call(this,d)),m!==W&&(e=t?d.getRecord(t):u.recordView("getRecord"))&&setTimeout((function(){P(e)}),10),setTimeout((function(){u.recordView("focus")}),100)},close:function(){m===U?d.setData([],0):d.setData(null)},resize:function(){var t=O.width(),i=O.height();p?O.find("section").height(i).width(t).resize():(O.find("section,main,aside").height(i),t-=O.find("aside").outerWidth()||0,O.find("main").width(t),u.width(t),u.height(i).recordView("resize"),t=O.find("aside").width(),i-=O.find(".tb").outerHeight(),a?a.width(t).height(i).grid("resize"):h&&h.width(t).height(i),e.setOuterWidth(O.find(".tb"),t))}})).buttons=R?[{text:o.getMessage("APEX.DIALOG.CANCEL"),click:function(){u.recordView("setEditMode",!1),x(this).dialog("close")}},{text:V||o.getMessage("APEX.DIALOG.SAVE"),class:"ui-button--hot",click:function(){var e="",t=!0;u.recordView("setEditMode",!1),r.validate&&"string"==typeof(t=r.validate.call(this,d,(function(e,t){d.setValidity("valid",e,t)}),(function(e,t,i){d.setValidity("error",e,t,i)})))&&(e=t+"\n\n",t=!1),t&&!d.hasErrors()?(r.store&&r.store.call(this,d),x(this).dialog("close")):(u.recordView("refresh"),e+=apex.lang.getMessage("APEX.CORRECT_ERRORS"),apex.message.alert(e,(function(){let e,t,i=d.getErrors()[0];if(i){for([e,t]of oe(i.fields))if(t.error)break;setTimeout((function(){u.recordView("gotoField",d.getRecordId(i.record),e)}),1)}})))}}]:[{text:V||o.getMessage("APEX.DIALOG.OK"),class:"ui-button--hot",click:function(){x(this).dialog("close")}}],n.dialogHelp&&n.buttons.unshift({text:o.getMessage("APEX.DIALOG.HELP"),class:"ui-button-help",click:function(){var e=n.dialogHelp;o.loadMessagesIfNeeded([e.titleKey,e.helpTextKey],(function(){var t={title:e.title,helpText:e.helpText};e.titleKey&&(t.title=o.getMessage(e.titleKey)),e.helpTextKey&&(t.helpText=o.getMessage(e.helpTextKey)),apex.theme.popupFieldHelp(t)}))}}),n.titleKey&&(n.title=o.getMessage(n.titleKey),delete n.titleKey),O.html(M.toString()).dialog(n).on("dialogopen",(function(){apex.navigation.beginFreezeScroll()})).on("dialogresize",(function(){x(this).closest(".ui-dialog").css("position","fixed")})).on("dialogclose",(function(){apex.navigation.endFreezeScroll()})),O.on("keydown",(function(e){var t;e.which===le.ENTER&&"INPUT"===e.target.nodeName&&(r.defaultButton&&(t=O.parent().find(".ui-button--hot").eq(0).trigger("focus"),setTimeout((function(){t.trigger("click")}),50)),e.preventDefault())})),r.useSplitter&&m!==W&&s.apex.splitter&&(_=r.splitterPosition||200,r.persistSplitter&&(C=apex.storage.getScopedSessionStorage({prefix:"ORA_WWV_apex.MED_"+r.persistSplitter,useAppId:!0}),_=parseInt(C.getItem("splitterPosition")||_,10)),p=O.find("."+T+"-body").splitter({position:_,collapsed:!1,minSize:120,orientation:"horizontal",positionedFrom:"begin",noCollapse:!0,change:function(e,t){C&&C.setItem("splitterPosition",t.lastPosition-t.lastPosition%1+"")}}),O.on("resize",(function(t){var i,o,r,l,n=s(t.target);i=n.height(),o=n.width(),(r=n.children(".resize").filter($)).length>0&&(n.children(":not(.resize)").filter($).each((function(){"fixed"!==(l=s(this).css("position"))&&"absolute"!==l&&(i-=s(this).outerHeight(!0))})),i=Math.floor(i/r.length),r.each((function(){var t=s(this);e.setOuterHeight(t,i),e.setOuterWidth(t,o),t.filter($).trigger("resize")}))),t.stopPropagation()})));var A=O.data("ui-dialog"),k=A._destroy;return A._destroy=function(){k.call(A),t.destroy(r.modelName)},O}}(apex.util,apex.model,apex.debug,apex.lang,apex.item,apex.actions,apex.jQuery);