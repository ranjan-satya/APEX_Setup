/*!
 * Copyright (c) 2021, 2022, Oracle and/or its affiliates.
 */
!function(e,t,r,a,o,i){"use strict";const p="logo-editor-pe",n="APEX_BUILDER",d="#apexDevToolbarQuickEdit",l="#apexDevCustomize",s="is-disabled",u="danger",c="warning",g=/(\.jpg|\.jpeg|\.png|\.gif|\.svg)$/i,m=512e3,E="APEXDEV.PE.",y="OUTPUT MESSAGE",f="CUSTOM HTML LINK",T="CUSTOM TEXT",h="CUSTOM IMAGE NAME",O="DRAG AND DROP",v="UTR.LOGO_EDITOR",_="LOGO.EDITOR.APP.GROUP",P="LOGO.DEFAULT.IMAGE",I="LOGO.DEFAULT.TEXT",x="UTR.LOGO.TYPE",D="LOGO.LABEL.TEXT",L="LOGO.LABEL.IMAGE",k="LOGO.LABEL.DRAG_AND_DROP",A="LOGO.LABEL.CUSTOM",R="LOGO.LABEL.NONE",C="UTR.LOGO.TEXT",w="UTR.LOGO.IMAGE",G="UTR.LOGO.ALT_TEXT",b="UTR.LOGO.IMAGE_TEXT",N="UTR.LOGO.NONE",F="UTR.LOGO.CUSTOM",U="UTR.SAVE",M="APEX.DIALOG.CANCEL",S="HOME",X="logo-group",B="logo-type",V="logo-text",Y="logo-alt",q="logo-image",H="logo-drag-and-drop",W="logo-custom",z="logo-none",j="NONE",Q="TEXT",K="IMAGE",$="IMAGE_AND_TEXT",Z="CUSTOM",J='<div id="logoEditorDialog"></div>',ee='<div id="TEMPLATE_ID" class="a-DevTools-content"></div>';let te,re,ae,oe=new function(){var t=this,r=!1,a={type:"",text:"",altText:"",image:"",imageFileName:""};function o(){return e(".t-Header-logo-link")}function n(){return o().children("img").eq(0)}function d(t){var r,i=l().propertyEditor("getProperty",B).value,p=l().propertyEditor("getProperty",V).value,d=l().propertyEditor("getProperty",Y).value,s=o(),u=n(),c=o().children("span").eq(0);if(a.type=i,i===j||i===Z)return s.empty(),void g();if(void 0===a.image&&u.length>0&&(a.image=u.attr("src")),i===Q&&(u.remove(),u=e()),i!==Q&&i!==$||(a.text=p,c.length>0?c.detach():c=e(document.createElement("span")),c.text(p).addClass("apex-logo-text"),u.length>0?u.after(c):s.length>0&&s.append(c)),i===K&&(c.remove(),c=e()),i===K||i===$){if(u.length>0?u.detach():u=e(document.createElement("img")).addClass("apex-logo-img"),a.altText=d,t){var m=new window.FileReader;m.readAsDataURL(t),m.onloadend=function(){r=m.result,u.attr({src:r}),a.uploadedImage=r.substring(r.indexOf("base64,")+7),a.uploadedFileB64=r,a.imageFileExtension=t.name.split(".").pop(),a.fileName=t.name,l().propertyEditor("updatePropertyValue",q,a.fileName,!1),g()}}else u.attr({src:a.image&&a.image.length>0?a.image:a.uploadedFileB64,alt:a.altText});c.length>0?c.before(u):s.length>0&&s.prepend(u)}g()}function l(){return e("#"+p)}function s(){e.when(ne.getLogo((function(e){var t;(t=[]).push({displayGroupId:X,displayGroupTitle:se(_),properties:[{propertyName:B,value:Q,errors:[],warnings:[],metaData:{displayGroupId:1,type:"SELECT LIST",prompt:se(x),isCommon:!0,isRequired:!0,lovValues:[{r:j,d:se(N)},{r:Q,d:se(C)},{r:K,d:se(w)},{r:$,d:se(b)},{r:Z,d:se(F)}]}},{propertyName:V,value:se(I),errors:[],warnings:[],metaData:{displayGroupId:1,type:T,prompt:se(D),isCommon:!0,isRequired:!1}},{propertyName:q,value:se(P),errors:[],warnings:[],metaData:{displayGroupId:1,type:h,prompt:se(L),isCommon:!0,isRequired:!1,isReadOnly:!0}},{propertyName:Y,value:se(S),errors:[],warnings:[],metaData:{displayGroupId:1,type:T,prompt:se(G),isCommon:!0,isRequired:!1}},{propertyName:H,value:se(k),errors:[],warnings:[],metaData:{displayGroupId:1,type:O,prompt:"",isCommon:!0,isRequired:!1}},{propertyName:z,value:se(R),errors:[],warnings:[],metaData:{displayGroupId:1,type:y,prompt:"",isCommon:!0,isRequired:!1,isReadOnly:!0}},{propertyName:W,value:se(A),errors:[],warnings:[],metaData:{displayGroupId:1,type:f,prompt:"",isCommon:!0,isRequired:!1,isReadOnly:!0}}]}),l().propertyEditor("option","data",{propertySet:t,componentCount:[]});var r,o=e.type,i=e.text&&e.text.length>0?e.text:se(S),p=l();switch(o){case"T":r=Q,p.propertyEditor("updatePropertyValue",V,e.text,!1);break;case"I":r=K,p.propertyEditor("updatePropertyValue",q,e.imageUrl.replace("#APP_IMAGES#",""),!1),p.propertyEditor("updatePropertyValue",Y,i,!1);break;case"IT":r=$,p.propertyEditor("updatePropertyValue",q,e.imageUrl.replace("#APP_IMAGES#",""),!1),p.propertyEditor("updatePropertyValue",V,e.text,!1);break;case"C":r=Z;break;case"NO":r=j}a={type:r,text:e.text,altText:i,image:n().length>0?n().attr("src"):"",imageFileName:e.imageUrl?e.imageUrl.replace("#APP_IMAGES#",""):""},p.propertyEditor("updatePropertyValue",B,r,!1),m()}),(function(){ue(se("UTR.LOGO.ERROR_LOAD_FAILED"),u)}))).done((function(){g()}))}function g(){var t=l().propertyEditor("getProperty",B).value,r=e("#save_logo_button");t===Z?r.prop("disabled",!0):r.prop("disabled",!1)}function m(){var e=l(),t=l().propertyEditor("getProperty",B).value,r=e.find('input[data-property-id="'+V+'"]').parent().parent(),a=e.find('input[data-property-id="'+q+'"]').parent().parent(),o=e.find('input[data-property-id="'+Y+'"]').parent().parent(),i=e.find('div[data-property-id="'+H+'"]').parent(),p=e.find('div[data-property-id="'+W+'"]').parent(),n=e.find('div[data-property-id="'+z+'"]').parent();switch(t){case"T":case"TEXT":r.show(),a.hide(),o.hide(),i.hide(),p.hide(),n.hide(),re.dialog("option","height",280);break;case"I":case"IMAGE":r.hide(),a.show(),o.show(),i.show(),p.hide(),n.hide(),re.dialog("option","height",510);break;case"IT":case"IMAGE_AND_TEXT":r.show(),a.show(),o.hide(),i.show(),p.hide(),n.hide(),re.dialog("option","height",540);break;case"C":case"CUSTOM":r.hide(),a.hide(),o.hide(),i.hide(),p.show(),n.hide(),re.dialog("option","height",360);break;case"NO":case"NONE":r.hide(),a.hide(),o.hide(),i.hide(),p.hide(),n.show(),re.dialog("option","height",300)}}t.init=function(){ie.addOutputMessage(),ie.addCustomHTMLMessage(),ie.addCustomTextField(),ie.addCustomImageNameField(),ie.addDragAndDrop(),l().propertyEditor({searchable:!0,data:{propertySet:[],componentCount:[]},change:function(e,t){t.property.propertyName===B&&m(),r=!0,d(null)}}),r=!1,s()},t.previewLogo=function(e,t){d(e)},t.saveLogo=function(){!function(){var e,t,r,o,p="N",n=a.altText,d=a.text;switch(a.type){case K:e="I";break;case Q:e="T";break;case $:e="IT";break;case Z:e="C";break;case j:e="NO"}void 0!==a.uploadedImage&&a.uploadedImage.length>0&&(t="app-"+i.APP_ID+"-logo."+a.imageFileExtension,r=a.uploadedImage,p="Y"),"N"===p&&typeof a.imageFileName.length>0&&(o="#APP_IMAGES#"+a.imageFileName),("T"===e||"IT"===e)&&d.trim().length<=0?ue(se("LOGO.MSG.TEXT_REQUIRED"),c):"I"!==e&&"IT"!==e||"N"!==p||void 0!==o?ne.setLogo(e,d,p,n,t,r,o,"",(function(){g(),ue(se("UTR.LOGO.SET_LOGO_SUCCESS"),"success")}),(function(){ue(se("UTR.LOGO.SET_LOGO_ERROR"),u)})):ue(se("LOGO.MSG.IMAGE_REQUIRED"),c)}()},t.reloadPage=function(){r&&location.reload(),r=!1}},ie={addOutputMessage:function(){e.apex.propertyEditor.addPropertyType(y,{render:function(e,t,r){e.markup("<div").attr("id",t).attr("class","a-Property-fieldContainer a-Property-fieldContainer--displayOnly").attr("data-property-id",r.propertyName).markup(">"+r.value),this.renderDivClose(e)}},e.apex.propertyEditor.PROP_TYPE.TEXTAREA)},addCustomHTMLMessage:function(){e.apex.propertyEditor.addPropertyType(f,{render:function(e,t,r){e.markup("<div").attr("id",t).attr("class","a-Property-fieldContainer a-Property-fieldContainer--displayOnly").attr("data-property-id",r.propertyName).markup(">").markup("<span").attr("classs","a-Property-field a-Property-field--text").markup(">"+r.value+"</span>").markup("<button").attr("id",t+"_SC_URL").attr("class","a-Button").markup(">"+se("BU.USER_INTERFACES")+"</button>"),this.renderDivClose(e)},init:function(t){var r=t.attr("id");e("button#"+r+"_SC_URL").on("click",(function(){pe.goToUIAttributes()}))}},e.apex.propertyEditor.PROP_TYPE.TEXTAREA)},addCustomTextField:function(){e.apex.propertyEditor.addPropertyType(T,{render:function(e,t,r){e.markup("<div").attr("class","a-Property-fieldContainer").markup(">").markup("<input").attr("id",t).attr("data-property-id",r.propertyName).attr("class","a-Property-field a-Property-field--text").attr("style","color:white;").attr("type","text").attr("value",r.value).markup("/>"),this.renderDivClose(e)},init:function(t){t.on("keyup",(function(){e(this).trigger("change")}))}},e.apex.propertyEditor.PROP_TYPE.TEXT)},addCustomImageNameField:function(){e.apex.propertyEditor.addPropertyType(h,{render:function(e,t,r){e.markup("<div").attr("class","a-Property-fieldContainer").markup(">").markup("<input").attr("id",t).attr("data-property-id",r.propertyName).attr("class","a-Property-field a-Property-field--text").attr("style","color:white;").attr("type","text").attr("readonly","readonly").attr("value",r.value).markup("/>"),this.renderDivClose(e)}},e.apex.propertyEditor.PROP_TYPE.TEXT)},addDragAndDrop:function(){e.apex.propertyEditor.addPropertyType(O,{render:function(e,t,r){e.markup("<div").attr("id",t).attr("class","file a-FileDrop-wrapper").attr("data-property-id",r.propertyName).attr("role","group").markup(">").markup("<div").attr("class","a-FileDrop a-FileDrop--dropzone").attr("aria-hidden","true").markup(">").markup("<input").attr("id","logoFile").attr("class","apex-item-file").attr("type","file").attr("accept","image/*").attr("name","logoFile").markup(" />").markup("<div").attr("class","a-FileDrop-icon").markup(">").markup("<span").attr("class","a-Icon icon-file-browse").attr("aria-hidden","true").markup(">").markup("</span>").markup("</div>").markup("<div").attr("class","a-FileDrop-body").markup(">").markup("<span").attr("class","a-FileDrop-heading").markup(">"+se("APEX.ITEM.FILE.DROP_FILE")+"</span>").markup("<span").attr("class","a-FileDrop-description").markup(">"+se("APEX.ITEM.FILE.DROP_OR_CHOOSE_FILE")+"</span>").markup("<span").attr("class","a-FileDrop-filename").markup(">").markup("</span>").markup("</div>").markup("<div").attr("class","a-FileDrop-progress").markup(">").markup("</div>").markup("<div").attr("class","a-FileDrop-action").markup(">").markup("<span").attr("class","a-Button a-FileDrop-action-choose a-Button--hot").markup(">"+se("APEX.ITEM.FILE.CHOOSE_FILE")+"</span>").markup("</div>").markup("</div>"),this.renderDivClose(e)},init:function(t){var r=t.find(".a-FileDrop"),a=t.attr("id");r.on("click",(function(t){"INPUT"!==t.target.tagName&&(t.preventDefault(),e("#logoFile").trigger("click"))})),e("#"+a).on("dragenter",(function(e){e.preventDefault()})).on("dragover",(function(e){e.preventDefault()})).on("drop change",(function(e){var t,r;e.preventDefault(),(r=e.originalEvent.dataTransfer?e.originalEvent.dataTransfer.files:e.target.files)&&r[0]&&((t=r[0]).size>m?ue(se("UTR.LOGO.MAX_FILESIZE_IN_KB").replace("%0",512),c):g.exec(t.name)?oe.previewLogo(t,!1):ue(se("UTR.LOGO.ONLY_IMAGE_FILES"),c))}))}},e.apex.propertyEditor.PROP_TYPE.TEXTAREA)}},pe={isBuilderWindow:function(){return window.name&&window.name.match("^"+n)},goToUIAttributes:function(){this.builderWindowUrl("f?p=4000:197:"+ae+"::NO::FB_FLOW_ID:"+i.APP_ID)},builderWindowUrl:function(e){var t=ae;this.isBuilderWindow(window)?a.redirect(e):t?a.openInNewWindow(e,n,{altSuffix:t}):apex.message.confirm(se("DEVELOPER_TOOLBAR_NO_BUILDER"),(function(t){t&&(window.name="",a.redirect(e))}))},chunkImage:function(e){for(var t=[];e.length>4e3;)t.push(e.substr(0,4e3)),e=e.substr(4e3);return t.push(e),t}},ne={getLogo:function(e,t){r.process("theme_roller",{p_flow_id:4e3,p_flow_step_id:0,p_instance:ae,x01:"get_logo",x02:i.APP_ID},{success:function(t){e&&e(t)},error:function(e){o(e),t(e)}})},setLogo:function(e,t,a,p,n,d,l,s,u,c){var g={p_flow_id:4e3,p_flow_step_id:0,p_instance:ae,x01:"set_logo",x02:i.APP_ID,x04:e,x09:a};switch(e){case"T":g.x06=t;break;case"I":case"IT":n&&d?(g.x08=n,g.f01=pe.chunkImage(d)):g.x05=l,"I"===e&&(g.x06=p),"IT"===e&&(g.x06=t);break;case"C":g.x07=s}r.process("theme_roller",g,{success:function(e){u&&u(e)},error:function(e){o(e),c(e)}})}},de=new function(){var t=["apex_ui/css/DevTools.css"],r={propertyEditor:i.APEX_FILES+"apex_ui/js/widget.propertyEditor.js"};this.init=function(a){t.forEach((t=>{e(`link[href*='${t}']`).length||e(document.createElement("link")).attr({rel:"stylesheet",type:"text/css",href:i.APEX_FILES+t}).appendTo("head")})),e.apex.propertyEditor?a():apex.server.loadScript({path:r.propertyEditor},a)}};function le(t){var r=this,a=e(J);te=apex.widget.waitPopup(),a.find(".apex-rds-hover").hide(),t.element.append(a);var o=e(ee.replace("TEMPLATE_ID",p));a.append(o),re=a.dialog({autoOpen:!0,title:se(v),dialogClass:"a-DevTools a-DevTools-main",resizable:!0,draggable:!0,minWidth:320,minHeight:420,closeOnEscape:!0,open:function(){apex.navigation.beginFreezeScroll()},close:function(){apex.navigation.endFreezeScroll(),e(d+" ,"+l).removeClass(s),oe.reloadPage()},buttons:[{id:"pe_logo_close_button",text:se(M),title:se(M),class:"a-Button a-DevTools-toolbar-item a-DevTools-toolbar-button a-DevTools-toolbar-item--push",click:function(){e(this).dialog("close")}},{id:"save_logo_button",text:se(U),title:se(U),class:"a-Button a-Button--hot a-DevTools-toolbar-item a-DevTools-toolbar-button",click:function(){oe.saveLogo()}}]}),e.apex.propertyEditor.setMessagePrefix(E),oe.init(a),r.isOpen=function(){return a.dialog("isOpen")},r.open=function(){a.dialog("open")},r.close=function(){a.dialog("close")},te.remove()}function se(e){return t.getMessage(e)}function ue(t,r){apex.devToolbar.notification(e("#logo-editor-pe"),t,r)}e.widget("apex.logoEditor",{_create:function(){var e=this;ae=this.options.builderSessionId,de.init((function(){var t;(t=e)._logoEditorController=new le(t),t._logoEditorController.status="READY",t._trigger("ready",null,{})}))},isReady:function(){return"READY"===this._logoEditorController.status},toggle:function(){this._logoEditorController.isOpen()?this._logoEditorController.close():this._logoEditorController.open()}}),apex.logoEditor=oe}(apex.jQuery,apex.lang,apex.server,apex.navigation,apex.debug,apex.env);