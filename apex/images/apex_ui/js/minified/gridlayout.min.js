/*!
 * Copyright (c) 2013, 2024, Oracle and/or its affiliates.
 */
!function(t,e,n,o){"use strict";var i="a-GridLayout",s="a-GridLayout-page",r=".a-GridLayout-page",a="a-GridLayout-pageItem",l="a-GridLayout-region",h="a-GridLayout-button",p="a-GridLayout-regionContainer",d=".a-GridLayout-regionContainer",c="a-GridLayout-itemContainer",u=".a-GridLayout-itemContainer",f="a-GridLayout-buttonContainer",m=".a-GridLayout-buttonGroup,.a-GridLayout-regionContent",g=".a-GridLayout-buttonRow",_="a-GridLayout--conditional",v="a-GridLayout-items",y="a-GridLayout-regions",C="a-GridLayout-buttons",w="a-GridLayout-grid",b=".a-GridLayout-grid",k="a-GridLayout-stack",S="a-GridLayout-flow",P=".a-GridLayout-label",G=".a-GridLayout-dragAction",L=".a-GridLayout-pageItem, .a-GridLayout-region, .a-GridLayout-button",I=".a-GridLayout-page, .a-GridLayout-pageItem, .a-GridLayout-region, .a-GridLayout-button",x=".a-GridLayout-regionContainer, .a-GridLayout-itemContainer, .a-GridLayout-buttonContainer",R=".a-GridLayout-grid, .a-GridLayout-stack, .a-GridLayout-flow",T="a-GridLayout-templateGrid",O="is-focused",A=".is-selected",D="is-selected",E="is-active",N="aria-selected",F=-2,H=[p,y],M=[c,v],W=[f,C],B={region:l,item:a,button:h},q=[50,75,100,125,150,175,200];const $=e.hasOwnProperty;function K(t,e,n){return t>e&&t<e+n}function Y(t){return t.parent().children(":visible").index(t)}function z(t,e,n,o){var i,s;"string"!=typeof e&&(o=n,n=e,e="*"),(s=(i=t.children(e)).index(n))>=0&&s<o&&(o+=1),o>=i.length?t.append(n):i.eq(o).before(n)}function U(t){var e,n=t||"";if(!((e=n.indexOf("_"))<0))return n.substring(e+1)}function V(t,e){var n;for(n=0;n<t.length;n++)if(t[n]===e)return n;return-1}function X(t){var e=0;return t.parent().children().each((function(){if(this===t[0])return!1;e+=this.colSpan||1})),e}function j(t,e,n,o){var i=e[n];i!==o&&(t.propertyChanges.push({component:e,property:n,oldValue:i,newValue:o}),e[n]=o)}function Z(t,e,n,o){var i,s,r;if(n<0&&(n=0),o>0)for(0===(r=Math.floor(n/o))&&(r=1),i=e;i<t.length;i++)-1===(s=t[i]).span&&(s.span=r,(n-=r)>0&&n<r&&(s.span+=n))}function J(t,e){var n,o,i,s=e,r=0,a=0,l=0,h=1;for(n=0;n<t.columns.length;n++)(i=t.columns[n]).col>1&&(o=i.col-h,Z(t.columns,r,o-a,l),s-=o,r=n,a=0,l=0,h=i.col),i.span>0?a+=i.span:l+=1;Z(t.columns,r,s-a,l)}function Q(t,e,n){var o;for(o in n)$(n,o)&&e[o]&&(t+=" "+n[o]);return t}function tt(t,e){var n;for(n in e)if($(e,n)&&t[n])return e[n];return null}function et(t,e){let n="";return t.hasRegionSupport&&(""!==n&&(n+=" "),n+=" "+H[e]),t.hasItemSupport&&(""!==n&&(n+=" "),n+=" "+M[e]),t.hasButtonSupport&&(""!==n&&(n+=" "),n+=" "+W[e]),n}function nt(t){var e="";return t.hasClass(y)&&(e+=",."+l),t.hasClass(v)&&(e+=",."+a),t.hasClass(C)&&(e+=",."+h),e.substr(1)}function ot(t){var e="",n=t.closest(x);return n.hasClass(p)&&(e+=" "+y),n.hasClass(c)&&(e+=" "+v),n.hasClass(f)&&(e+=" "+C),e.slice(1)}function it(t,e,n){return n?function(t){var e=[o.getMessage(t)].concat(Array.prototype.slice.call(arguments,1));return o.formatNoEscape.apply(this,e)}(t,e):e}t.widget("apex.gridlayout",t.ui.mouse,{widgetEventPrefix:"gridlayout",dragging:!1,animating:!1,nodeMap:{},nextId:1,dragComponent:null,helper:null,fromOutside:!1,isOver:!1,lastZoom:"",pageRoot:null,options:{getPageRoot:null,getIconForComponent:function(t){var e="",n=t.type;return"region"===n?e="region":"item"===n?e="page-item":"button"===n?e="button":"page"===n&&(e="page"),e},makeComponent:null,updateComponentCopy:null,deleteKeyAction:null,contextMenuAction:null,stateClassMap:{},stateIconMap:{},displayFrom:null,hideLegacySlots:!1,hideEmptySlots:!1,hideButtons:!1,hideItems:!1,zoom:100,iconType:"a-GIcon",appendTo:"parent",containment:!1,cursor:"auto",cursorAt:!1,gridTolerance:10,idPrefix:null,multiple:!0,opacity:!1,animate:!0,scroll:!0,scrollSensitivity:20,scrollSpeed:20,tolerance:"intersect",zIndex:1e3,activate:null,deactivate:null,out:null,over:null,start:null,beforeStop:null,stop:null,selectionChange:null,added:null,removed:null,moved:null,copied:null},_create:function(){var e=this.options,n=this;if(!e.makeComponent||!e.updateComponentCopy||!e.getPageRoot)throw new Error("Missing required options.");this.pageRoot=e.getPageRoot(),this.containerCache={},this.element.addClass(i),this.baseId=(e.idPrefix||this.element[0].id||"glv")+"_",this.refresh(!1),this._setZoom(),this.offset=this.element.offset(),this._mouseInit(),this.element.on("keydown.glv",(function(o){var i=t.ui.keyCode,s=o.which;o.altKey||(s===i.HOME?(n._select(t(r+":first"),o,!0,!0),o.preventDefault()):s===i.END?(n._select(n.element.find(I).last(),o,!0,!0),o.preventDefault()):s===i.DOWN?(n._traverseDown(o),o.preventDefault()):s===i.UP?(n._traverseUp(o),o.preventDefault(),o.stopPropagation()):s===i.LEFT?(n._traverseLeft(o),o.preventDefault()):s===i.RIGHT?(n._traverseRight(o),o.preventDefault()):s===i.SPACE?(n.lastFocused&&n._select(t(n.lastFocused),o,!0,!0),o.preventDefault()):e.deleteKeyAction&&s===i.DELETE?(n.lastFocused&&e.deleteKeyAction(o),o.preventDefault()):e.contextMenuAction&&o.shiftKey&&121===s&&(n.lastFocused&&!t(n.lastFocused).is(A)&&n._select(t(n.lastFocused),{},!1,!0),e.contextMenuAction(o),o.preventDefault()))})).on("focusin",(function(e){var o=t(e.target).closest(I);0!==o.length&&(o.addClass(O),n._setFocusable(o[0]))})).on("focusout",(function(e){t(e.target).closest(I).removeClass(O)})).on("contextmenu",(function(o){var i;e.contextMenuAction&&((i=t(o.target).closest(I).not(A)).length&&n._select(i,{},!1,!1),e.contextMenuAction(o),o.preventDefault())}))},_destroy:function(){return this.element.removeClass(i).empty(),this._mouseDestroy(),this},_setOption:function(e,n){"disabled"===e?(this.options[e]=n,this.widget().toggleClass("is-disabled",!!n)):t.Widget.prototype._setOption.apply(this,arguments),"displayFrom"===e?this.refresh(!1):["hideLegacySlots","hideButtons","hideItems","hideEmptySlots"].includes(e)?this._showOrHideSlots():"zoom"===e&&this._setZoom()},pageDataChanged:function(){var t=this.options;this.pageRoot=this.options.getPageRoot(),t.displayFrom&&(this._find(t.displayFrom,!0)||(t.displayFrom=null)),this.refresh(!1)},getPageData:function(){return this.pageRoot},refresh:function(t){var o,i,s,r,a,l,h,p=this.options,d=e.htmlBuilder();if(n.info("Gridlayout refresh"),!t)for(a=[],r=this.getSelectedComponents(),o=0;o<r.length;o++)a.push(r[o].id);if(this._layoutPage(),this.nodeMap={},p.displayFrom){if(!(i=this._find(p.displayFrom,!0)))throw new Error("No such region in displayFrom option: "+p.displayFrom);for(l=!0,h=i._parent;h;){if(h.components&&!h.isGrid){l=!1;break}h=h._parent}this._renderRegion(d,i,l,!0)}else this._renderPage(d,this.pageRoot);return this.element.html(d.toString()),this._showOrHideSlots(),s=this.element.children().eq(0),t?(this._select(s,t),this._trigger("selectionChange")):(this._setFocusable(s[0]),a.length>0&&this.element.is(":visible")&&(this.setSelectedComponents(a,!1),this.getSelection().length>0&&a.length!==this.getSelection().length&&this._trigger("selectionChange"))),this},dump:function(){n.log("Page: \r\n"+JSON.stringify(this.pageRoot,(function(t,e){return"_parent"===t?"-> "+(this._parent.id||this._parent.title):"_modelComponent"===t?"[id="+e.id+"]":"_parentGrid"===t?"-> "+V(this._parentGrid._parent._grids,this._parentGrid):"_parentRow"===t?"-> "+V(this._parentRow._parentGrid.rows,this._parentRow):"_parentColumn"===t?"-> "+V(this._parentColumn._parentRow.columns,this._parentColumn):e}),2))},findById:function(e){var n=this._find(e);return n?this._getElement(n):t()},findComponentById:function(t){return this._find(t)},getContainer:function(t){return t.closest(x)},findContainer:function(t,e){var n,o=this.pageRoot;if(n=o.id===t?o:this._find(t,!0))for(const t of n.slots)if(t.placeholder===e)return t;return null},getComponents:function(t){var e=this,n=[];return t.each((function(){n.push(e._getNode(this))})),n},getSelection:function(){return this.element.find(A)},getSelectedComponents:function(){return this.getComponents(this.getSelection())},setSelection:function(t,e){e=!!e,this._select(t,null,e,!1,!0)},setSelectedComponents:function(e,n){var o,i,s,r=[];for(n=!!n,o=0;o<e.length;o++)(i=this._find(e[o]))&&(s=this._getElement(i)).length>0&&r.push(s[0]);this._select(t(r),null,n,!1,!0)},focus:function(){this.lastFocused&&this.lastFocused.focus()},makeHelper:function(n,o,i,s,r,a){var l,h,p=this.options.getIconForComponent,d=new e.htmlBuilder;return n||(n=(l=this._getNode(this.dragComponent[0])).type,o=p(l),i=l.title),h=B[n]+" a-GridLayout-helper",d.markup("<div").attr("class",h),"region"===n?d.optionalAttr("data-region-type",r):"item"===n&&d.optionalAttr("data-item-type",a),d.optionalAttr("data-type-id",s).markup(">"),this._renderHeader(d,o,i,!0),d.markup("<div").attr("class","a-GridLayout-dragAction").markup("></div></div>"),t(d.toString())},getDropTargets:function(e,n){var i,s,r,p,d,c,u,f,m=[];function _(n){r=n,t(this).children().eq(0).children(d).each((function(n){u&&this===e[0]?c=!0:i.items.push({element:t(this),row:s,col:r,index:n,name:t(this).children("h3").text()})}))}function b(e){s=e,t(this).children("td").each(_)}if(u="move"===(n=n||"move"),"add"===n&&"string"==typeof e&&(f=e),"item"===f||!f&&e.hasClass(a))p=v;else if("region"===f||!f&&e.hasClass(l))p=y;else{if("button"!==f&&(f||!e.hasClass(h)))throw new Error("Invalid component or component type");p=C}return d="."+d,t(p="."+p,this.element).filter(":visible").each((function(){var n,s,r,a,l,h=t(this),p=null;d=nt(h),h.hasClass(w)?s="grid":h.hasClass(k)?s="stack":h.hasClass(S)&&(s="flow"),"stack"===s&&"TD"===h.parent()[0].nodeName||u&&0!==h.parents().filter(e[0]).length||(l="",""!==(a=h.parent().closest(".a-GridLayout-region").find(".a-GridLayout-label").eq(0).text())&&(l=a+" > "),"flow"===s&&"TD"===h.parent()[0].nodeName?(r=h.closest(g).prev().text(),h.parent().next().length>0?(r=o.formatMessageNoEscape("GL.BTN_POS_L",r),p="left"):(r=o.formatMessageNoEscape("GL.BTN_POS_R",r),p="right")):r=h.prev().text(),l+=r,i={element:h.closest(x),type:s,region:a,name:r,label:l},c=!1,"grid"===s?(i.items=[],h.children("tbody").children("tr").each(b)):(i.items=[],p&&(i.alignment=p),h.children(d).each((function(o){u&&this===e[0]?c=!0:(n={element:t(this),index:o,name:t(this).children("h3").text()},p&&(n.alignment=p),i.items.push(n))}))),c&&0===i.items.length||m.push(i))})),m},update:function(o,i,s){var r,a,l,h,p,d,c=this.options,u=!1;if("string"==typeof o&&(o=this._find(o)),!o)throw new Error("Nothing to update");if(n.getLevel()>=n.LOG_LEVEL.INFO&&n.info("Gridlayout update component: "+o.title+", layoutChange: "+i+", childrenOnly: "+s),i&&(s&&!o._parent||(o=o._parent._parent),u="page"===o.type||Array.isArray(o._parent._grids),this._layoutSlots(o.slots,o,u,12)),(l=this._getElement(o)).length)if(i)p=this.getSelectedComponents(),a=e.htmlBuilder(),"page"===o.type?this._renderPage(a,o):this._renderComponent(a,o,u),h=t(a.toString()),l.hasClass(D)&&h.addClass(D),h[0].tabIndex=l[0].tabIndex,l.replaceWith(h),this._showOrHideSlots(h),this.setSelectedComponents(p);else{for(r in l.find(P).first().html(e.escapeHTML(o.title)),"region"===o.type?l.data("region-type",o.regionType):"item"===o.type&&l.data("item-type",o.itemType),l.toggleClass(_,!!o.isConditional),c.stateClassMap)$(c.stateClassMap,r)&&l.toggleClass(c.stateClassMap[r],!!o[r]);l.find("."+c.iconType)[0].className=c.iconType+" "+c.getIconForComponent(o),(d=tt(o,c.stateIconMap))&&l.find(P).first().prepend("<span class='a-Icon "+d+"'></span>")}},add:function(t,e,o,i,s,r,a,l,h){var p,d,c;if("string"!=typeof e&&"number"!=typeof e||(d=e,e=this.options.makeComponent(d)),!(o=this._getContainerElement(o))||!o.is(x))throw new Error("Invalid add destination");return n.getLevel()>=n.LOG_LEVEL.INFO&&n.info("Gridlayout add component: "+e.title+" to: "+o[0].id+", g/r/c/i: "+i+"/"+s+"/"+r+"/"+a),c=(p=this._add(e,o,i,s,r,a,l,h)).newComponent$,p.lastChange=!0,this._trigger("added",t,p),this._select(c,t,!0),this},remove:function(e,o){var i,s,a,l,h,p=[],d=t(this.lastFocused).hasClass(O),c=this;if(n.getLevel()>=n.LOG_LEVEL.INFO&&n.info("Gridlayout remove "+(o?o.length+" component(s).":"selection")),o=o||this.getSelection(),Array.isArray(o)){for(l=[],i=0;i<o.length;i++)(h=this.findById(o[i])).length>0&&l.push(h[0]);o=t(l)}if(!o||0===o.filter(L).length)throw new Error("Nothing to remove");for(a=o.filter(A).eq(0);a&&a.length&&a.hasClass(D)&&!a.is(r);)(a=t(this._traverseUp(e,!0)))&&(this.lastFocused=a[0]);for(o.filter(L).each((function(){var e;(e=c._getNode(this))&&(n.info("Gridlayout remove component: "+e.title),s=c._remove(t(this)),p.push(s))})),i=0;i<p.length;i++)p[i].lastChange=i>=p.length-1,c._trigger("removed",e,p[i]);return a&&a.length&&this._select(a,e,d),this},move:function(e,o,i,s,r,a,l,h){var p,d;if(o=o||t(this.lastFocused),!(o=this._getComponentElement(o))||!o.is(L))throw new Error("Nothing to move");if(!(i=this._getContainerElement(i))||!i.is(x))throw new Error("Invalid move destination");return n.getLevel()>=n.LOG_LEVEL.INFO&&n.info("Gridlayout move component: "+this._getNode(o[0]).title+" to: "+i[0].id+", g/r/c/i: "+s+"/"+r+"/"+a+"/"+l),d=(p=this._moveOrCopy(o,i,s,r,a,l,h,!1)).newComponent$,p.lastChange=!0,this._trigger("moved",e,p),this._select(d,e,!0),this},copy:function(e,o,i,s,r,a,l,h){var p,d;if(o=o||t(this.lastFocused),!(o=this._getComponentElement(o))||!o.is(L))throw new Error("Nothing to copy");if(!(i=this._getContainerElement(i))||!i.is(x))throw new Error("Invalid copy destination");return n.getLevel()>=n.LOG_LEVEL.INFO&&n.info("Gridlayout copy component: "+this._getNode(o[0]).title+" to: "+i[0].id+", g/r/c/i: "+s+"/"+r+"/"+a+"/"+l),d=(p=this._moveOrCopy(o,i,s,r,a,l,h,!0)).newComponent$,p.lastChange=!0,this._trigger("copied",e,p),this._select(d,e,!0),this},_layoutGrid:function(t,e,n,o){var i,s,r,a,l,h,p,d,c,u,f=this.pageRoot,m=null,g={},_=0,v=null,y=null,C=null,w=0;if(n)for(m=[],a=0;a<t.length;a++)if(l=t[a],(!v||n&&"fixed"!==f.gridType&&l.newGrid)&&(v={_parent:e,rows:[]},y=null,m.push(v)),(!y||n&&l.newRow)&&(y={_parentGrid:v,columns:[]},C=null,v.rows.push(y),g={}),n&&l.col>0)if($(g,l.col))y.columns[g[l.col]].components.push(l),l._parentColumn=y.columns[g[l.col]];else if(C={_parentRow:y,col:l.col,span:f.hasColumnSpan?l.span||-1:1,rowSpan:l.rowSpan,components:[l]},l._parentColumn=C,y.columns.push(C),w=y.columns.length-1,l.col<_){for(p=w,h=l.col+1;h<=_;h++)$(g,h)&&(g[h]<p&&(p=g[h]),g[h]+=1);p!==w&&(d=w,c=p,u=void 0,u=y.columns.splice(d,1),y.columns.splice(c,0,u[0])),g[l.col]=p}else _=l.col,g[l.col]=w;else(!C||n&&l.newCol)&&(C={_parentRow:y,col:-1,span:f.hasColumnSpan?l.span||-1:1,rowSpan:l.rowSpan,components:[]},y.columns.push(C)),C.components.push(l),l._parentColumn=C;if(n&&"fixed"===f.gridType&&f.hasColumnSpan)for(i=0;i<m.length;i++)for(v=m[i],s=0;s<v.rows.length;s++)J(y=v.rows[s],o);if(m)for(i=0;i<m.length;i++)for(v=m[i],s=0;s<v.rows.length;s++)for(y=v.rows[s],r=0;r<y.columns.length;r++)C=y.columns[r];for(a=0;a<t.length;a++)(l=t[a])._parent=e,l.slots&&this._layoutSlots(l.slots,l,n,o);return m},_layoutSlots:function(t,e,n,o){var i=this.pageRoot,s=0;for(const r of t){if(r._parent=e,$(r,"span")||$(r,"newColumn")){if(r.newGrid&&(delete r.newRow,delete r.newColumn),r.newRow&&delete r.newColumn,(r.newRow||r.newGrid)&&(s=0),r.span=r.span||1,!1!==r.newColumn&&(s+=r.span),"fixed"===i.gridType&&s>o)throw new Error("Fixed layout template grid exceeded max columns. Slot: "+r.title);if(n&&r.isGrid&&!r.maxColumns&&("fixed"!==i.gridType||i.alwaysUseMaxColumns?r.maxColumns=o:r.maxColumns=r.span),r.isGrid&&"fixed"===i.gridType&&!i.alwaysUseMaxColumns&&r.span!==r.maxColumns)throw new Error("Fixed layout span and maxColumns must be the same. Slot: "+r.title)}else s=0,n&&r.isGrid&&!r.maxColumns&&(r.maxColumns=o);if(r.hasRowSpan&&!i.hasRowSpan)throw new Error("Row span not allowed for slot when page doesn't support row span. Slot: "+r.title);r._grids=this._layoutGrid(r.components,r,n&&r.isGrid||r.hasSubRegionTemplate,r.maxColumns||o)}},_layoutPage:function(){var t=this.pageRoot;this._layoutSlots(t.slots,t,!0,t.maxColumns)},_showOrHideSlots:function(e){var n,o=this.options,i=this;(e=e||this.element).find(d).each((function(){var e=i._getNode(this);n=!o.hideEmptySlots&&t(this).is(".a-GridLayout--legacy")?!o.hideLegacySlots||0!==e.components.length:!o.hideEmptySlots||0!==e.components.length,e.isDeprecated&&0===e.components.length&&(n=!1),t(this).toggle(n)})),e.find(".a-GridLayout-buttonContainer").each((function(){var e=i._getNode(this);(n=!(o.hideButtons||o.hideEmptySlots&&0===e.components.length))&&e.isLegacy&&(n=!o.hideLegacySlots||0!==e.components.length),e.isDeprecated&&0===e.components.length&&(n=!1),t(this).toggle(n)})),e.find(u).each((function(){var e=i._getNode(this);(n=!(o.hideItems||o.hideEmptySlots&&0===e.components.length))&&e.isLegacy&&(n=!o.hideLegacySlots||0!==e.components.length),e.isDeprecated&&0===e.components.length&&(n=!1),t(this).toggle(n)})),o.hideEmptySlots},_find:function(t,e){const n=this.pageRoot;return!e&&n===t||n.id===t?n:function n(o){let i=null;for(const s of o)if(!e||s.hasRegionSupport)for(let e=0;e<s.components.length;e++){let o=s.components[e];if(o===t||o.id===t)return o;if(o.slots&&(i=n(o.slots),i))return i}return i}(n.slots)},_getComponentElement:function(t){return"string"==typeof t?this.findById(t):t._elementId?this._getElement(t):t},_getContainerElement:function(t){var e;return Array.isArray(t)?(e=this.findContainer(t[0],t[1]))?this._getElement(e):null:t._elementId?this._getElement(t):t},_addNode:function(t){var e=this.nextId;return this.nodeMap[this.nextId]=t,t._elementId=this.nextId,this.nextId+=1,this.baseId+e},_setNode:function(t){if(!t._elementId)throw new Error("Failed to add node to nodeMap - no id");this.nodeMap[t._elementId]=t},_getNode:function(t){var e=U(t.id);return this.nodeMap[e]},_getElement:function(e){var n=this.baseId+e._elementId;return t("#"+n)},_renderHeader:function(t,e,n,o,i){t.markup("<h3").optionalAttr("class",null!==o?"is-draggable":null).optionalAttr("aria-grabbed",null!==o?""+o:null).markup("><span").attr("class",this.options.iconType+" "+e).markup("></span><span").attr("class","a-GridLayout-label").markup(">"),i&&t.markup("<span class='a-Icon ").attr(i).markup("'></span>"),t.content(n).markup("</span></h3>")},_renderRegion:function(t,e,n,o){var i,s=l;e.isConditional&&(s+=" "+_),s=Q(s,e,this.options.stateClassMap),i=tt(e,this.options.stateIconMap),t.markup("<div").attr("class",s).attr("id",this._addNode(e)).attr("data-region-type",e.regionType).markup(" tabindex='-1'>"),this._renderHeader(t,this.options.getIconForComponent(e),e.title,!(!o&&!e.isReadOnly)&&null,i),this._renderSlots(t,e.slots,n,e.itemsAboveContent),t.markup("</div>")},_renderItem:function(t,e){var n,o=a;e.isConditional&&(o+=" "+_),o=Q(o,e,this.options.stateClassMap),n=tt(e,this.options.stateIconMap),t.markup("<div").attr("class",o).attr("id",this._addNode(e)).attr("data-item-type",e.itemType).markup(" tabindex='-1'>"),this._renderHeader(t,this.options.getIconForComponent(e),e.title,!!e.isReadOnly&&null,n),t.markup("</div>")},_renderButton:function(t,e){var n,o=h;e.isConditional&&(o+=" "+_),o=Q(o,e,this.options.stateClassMap),n=tt(e,this.options.stateIconMap),t.markup("<div").attr("class",o).attr("id",this._addNode(e)).markup(" tabindex='-1'>"),this._renderHeader(t,this.options.getIconForComponent(e),e.title,!!e.isReadOnly&&null,n),t.markup("</div>")},_renderComponentsInGrid:function(t,e,n,o){var i,s,r,a,l,h,p,d,c,u,f=this.pageRoot.gridType;function m(){for(t.markup("<thead><tr>"),i=0;i<e.maxColumns;i++)t.markup("<td></td>");t.markup("</tr></thead>")}if(o.length>0)for(s=0;s<o.length;s++){for(d=o[s],t.markup("<table role='presentation'").attr("class",w+" "+n+(0===s?" first":"")).markup(">"),"fixed"===f&&m(),t.markup("<tbody>"),r=0;r<d.rows.length;r++){for(c=d.rows[r],t.markup("<tr>"),p=1,a=0;a<c.columns.length;a++){for((u=c.columns[a]).col>p&&(t.markup("<td").attr("colspan",u.col-p).markup("><div").attr("class",k+" "+n).markup("></div></td>"),p=u.col),p+=u.span>0?u.span:1,t.markup("<td").optionalAttr("colspan",u.span).optionalAttr("rowspan",u.rowSpan).markup("><div").attr("class",k+" "+n).markup(">"),l=0;l<u.components.length;l++)h=u.components[l],this._renderComponent(t,h,!0);t.markup("</div></td>")}t.markup("</tr>")}t.markup("</tbody></table>")}else t.markup("<table role='presentation'").attr("class",w+" first "+n).markup(">"),"fixed"===f&&m(),t.markup("<tbody><tr><td><div").attr("class",k+" "+n).markup("></div></td></tr></tbody></table>")},_renderComponent:function(t,e,n){if("region"===e.type)this._renderRegion(t,e,n);else if("item"===e.type)this._renderItem(t,e);else{if("button"!==e.type)throw new Error("Unknown component type");this._renderButton(t,e)}},_renderComponents:function(t,e,n,o,i=!1){var s,r;if(t.markup("<div").attr("class",e).markup(">"),n&&n.length>0)for(s=0;s<n.length;s++)r=n[s],o&&r.alignment!==o||this._renderComponent(t,r,i);t.markup("</div>")},_renderSlots:function(t,e,n,i){var s,r,a,l=this,h=null,p=!1,d=!1,c=!1;function u(){a=o.getMessage("GL.REGION_CONTENT"),t.markup("<div").attr("class","a-GridLayout-regionContent").markup("><h3>").content(a).markup("</h3>"),h&&(t.markup("<div").attr("class",W[0]).attr("id",l._addNode(h)).markup(">"),t.markup("<h3>").content(h.title).markup("</h3>"),l._renderComponents(t,S+" "+W[1],h.components),t.markup("</div>")),t.markup("</div>")}for(const o of e){if($(o,"span")||$(o,"newColumn")?(c&&!1!==o.newColumn&&(t.markup("</td>"),c=!1),d?o.newGrid&&t.markup("</tr></tbody></table><table role='presentation'").attr("class",T).markup("><tbody><tr>"):(t.markup("<table role='presentation'").attr("class",T).markup("><tbody><tr>"),d=!0,o.newColumn=!0),o.newRow&&t.markup("</tr><tr>"),!1!==o.newColumn&&(t.markup("<td colspan='"+o.span+"'>"),c=!0)):d&&(t.markup("</tr></tbody></table>"),d=!1),[o.hasRegionSupport,o.hasItemSupport,o.hasButtonSupport].filter(Boolean).length>1||o.hasRegionSupport||o.hasItemSupport)p&&(t.markup("</div>"),p=!1);else if(o.hasButtonSupport){if("RIGHT_OF_IR_SEARCH_BAR"===o.placeholder){h=o;continue}p?o.hasAlignment&&(t.markup("</div>"),p=!1):o.hasAlignment||(t.markup("<div").attr("class","a-GridLayout-buttonGroup").markup(">"),p=!0)}if("region"===o.type&&o.hasItemSupport&&"BODY"===o.placeholder&&!i&&u(),s=et(o,0),o.isLegacy&&(s+=" a-GridLayout--legacy"),o.isDeprecated&&(s+=" a-GridLayout--deprecated"),r=et(o,1),t.markup("<div").attr("class",s).attr("id",this._addNode(o)).attr("data-position-type",o.type).attr("data-position",o.placeholder).optionalAttr("data-supported-region-types",o.supportedRegionTypes?.join(",")).optionalAttr("data-supported-item-types",o.supportedItemTypes?.join(",")).markup(">"),t.markup("<h3>").content(it("MODEL.POSTFIX.LEGACY",o.title,o.isLegacy)).markup("</h3>"),[o.hasRegionSupport,o.hasItemSupport,o.hasButtonSupport].filter(Boolean).length>1||o.hasRegionSupport||o.hasItemSupport)o.isGrid&&n?this._renderComponentsInGrid(t,o,r,o._grids):this._renderComponents(t,k+" "+r,o.components,null,o.hasSubRegionTemplate);else{if(!o.hasButtonSupport)throw new Error("Unknown slot type: "+o.placeholder);o.hasAlignment?(t.markup("<table role='presentation'").attr("class","a-GridLayout-buttonRow").markup("><tbody><tr><td>"),this._renderComponents(t,S+" "+r,o.components,"left"),t.markup("</td><td>"),this._renderComponents(t,S+" "+r,o.components,"right"),t.markup("</td></tr></tbody></table>")):this._renderComponents(t,S+" "+r,o.components)}t.markup("</div>"),"region"===o.type&&o.hasItemSupport&&"BODY"===o.placeholder&&i&&u()}p&&t.markup("</div>"),d&&t.markup("</tr></tbody></table>")},_renderPage:function(t,e){var n,o=s;e.isConditional&&(o+=" "+_),o=Q(o,e,this.options.stateClassMap),n=tt(e,this.options.stateIconMap),t.markup("<div").attr("class",o).attr("id",this._addNode(e)).markup(" tabindex='-1'>"),this._renderHeader(t,this.options.getIconForComponent(e),e.title,null,n),this._renderSlots(t,e.slots,!0),t.markup("</div>")},_setFocusable:function(t){this.lastFocused&&this.lastFocused!==t&&(this.lastFocused.tabIndex=-1),t.tabIndex=0,this.lastFocused=t},_select:function(e,n,o,i,s){var r,a,l,h,p,d,c="set",u=this;e=e.filter(":visible"),n&&this.options.multiple&&("mousedown"===n.type?n.ctrlKey||n.metaKey?c="toggle":n.shiftKey&&(c="add"):"keydown"===n.type&&(n.keyCode===t.ui.keyCode.SPACE?c="toggle":n.ctrlKey?c="none":n.shiftKey&&(c="add"))),r=this.element.find(A),"set"===c&&r.removeClass(D).removeAttr(N),a=e.hasClass(D),"set"===c||"add"===c||"toggle"===c&&!a?e.addClass(D).attr(N,!0):"toggle"===c&&a&&e.removeClass(D).removeAttr(N),e.length>0&&(o?(e[0].tabIndex=0,e[0].focus()):this._setFocusable(e[0]),(p=(h=this.element.scrollParent())[0]===document?{left:0,top:0}:h.offset())&&(d=this.element.offset(),((l=e.first().offset()).top<p.top||l.top>p.top+h[0].offsetHeight)&&(h[0].scrollTop=l.top-d.top),(l.left+e[0].offsetWidth<p.left||l.left>p.left+h[0].offsetWidth)&&(h[0].scrollLeft=l.left-d.left))),s||("toggle"===c||"add"===c&&!a||"set"===c&&(r[0]!==e[0]||r.length!==e.length))&&(u.triggerTimerId&&(clearTimeout(u.triggerTimerId),u.triggerTimerId=null),u.triggerTimerId=setTimeout((function(){u.triggerTimerId=null,u._trigger("selectionChange",n)}),i?350:1))},_traverseRight:function(e){var n,o,i=null;if(this.lastFocused)if((n=t(this.lastFocused)).parent().hasClass(S))this._traverseDown(e);else{for(o=n.closest("td");o.length;){if((n=o.next().find(L).first()).length){i=n;break}o=o.parent().closest("td")}i&&i.length>0&&this._select(i.eq(0),e,!0,!0)}},_traverseLeft:function(e){var n,o,i=null;if(this.lastFocused)if((n=t(this.lastFocused)).parent().hasClass(S))this._traverseUp(e);else{for(o=n.closest("td");o.length;){if((n=o.prev().find(L).first()).length){i=n;break}o=o.parent().closest("td")}i&&i.length>0&&this._select(i.eq(0),e,!0,!0)}},_traverseDown:function(e){var n,o,i,s,r,a,l;if(this.lastFocused){if(i=t(this.lastFocused),e.which!==t.ui.keyCode.RIGHT&&(l=i.closest(m)).length>0&&(i=l.find(L).last()),(s=i.find(L).filter(":visible").first()).length>0)i=s;else if((s=i.nextAll(":visible").first()).length>0)i=s;else if(i.closest(g).length>0&&(s=i.closest("td").next().find(L).filter(":visible").first()),s.length>0)i=s;else for(;i.length>0;){if((s=i.nextAll(L).filter(":visible").first()).length>0){i=s;break}if((s=i.nextAll(":visible").find(L).filter(":visible").first()).length>0){i=s;break}if((r=i.parent().parent().parent("tr").first().next().first()).length>0&&(a=r.prev()[0],n=X(i.parents("td").filter((function(){return this.parentNode===a}))),o=0,r.children().each((function(){if((o+=this.colSpan||1)>n)return s=t(this).find(L).first(),!1})),0===s.length&&(s=r.children().last().find(L).first())),s.length>0){i=s;break}i=i.parent().closest("."+T+","+L+","+x+","+m)}i&&i.length>0&&this._select(i,e,!0,!0)}},_traverseUp:function(e,n){var o,i,r,a,l,h,p;if(this.lastFocused&&(r=t(this.lastFocused),e.which!==t.ui.keyCode.LEFT&&(p=r.closest(m)).length>0&&(r=p.find(L).first()),(a=r.prevAll(":visible").first()).length>0?0===(r=a.find(L).filter(":visible").last()).length&&(r=a):((l=r.closest("tr").prev()).length>0&&(o=X(r.closest("td")),i=0,l.children().each((function(){if((i+=this.colSpan||1)>o)return a=t(this).find(L).filter(":visible").last(),!1})),0===a.length&&(a=l.children().last().find(L).filter(":visible").last())),a.length>0?r=a:(r.closest(g).length>0&&(a=r.closest("td").prev().find(L).filter(":visible").last()),0===a.length&&(h=p&&p.length>0?p:r.parent().closest(x),0===(a=h.prevAll(":visible").find(L).filter(":visible").last()).length&&h.parent().is(m)&&(h=h.parent(),a=h.prevAll(":visible").find(L).filter(":visible").last())),0===a.length?(r=r.parent().closest(I)).is("."+s)&&(h=h.parent().closest("."+T),0!==(a=h.prevAll(":visible").find(L).filter(":visible").last()).length&&(r=a)):r=a)),r&&r.length>0)){if(n)return r[0];this._select(r,e,!0,!0)}},_setZoom:function(){var t,e,n=1*this.options.zoom;for(t=0;t<q.length;t++)if(n<=q[t]){n=q[t];break}t>=q.length&&(n=q[q.length-1]),e=i+"--z"+n,this.element.removeClass(this.lastZoom).addClass(e),this.lastZoom=e},_mouseCapture:function(e,n){var o,s=null;return!this.animating&&!this.options.disabled&&("H3"===e.target.nodeName?o=t(e.target):"H3"===e.target.parentNode.nodeName&&(o=t(e.target.parentNode)),o&&o.length&&(s=o.parent(I)),s&&s.length&&!n&&this._select(s,e,!0,!1),o&&o.length&&(s=o.parent(L)),!(!(o&&o.is(".is-draggable")&&s&&1===s.length)||s.parent().hasClass(i))&&(this.dragComponent=s,this._initDragTargets(this.dragComponent),!0))},_mouseStart:function(e,n,o){var i,s,r,a=this.options,l=this;return o||(t("body").on("keydown.glv",(function(e){e.keyCode!==t.ui.keyCode.ESCAPE?l._dragCopyOrMove(e.ctrlKey):l._cancel(e)})),t("body").on("keyup.glv",(function(t){l._dragCopyOrMove(t.ctrlKey)}))),this.helper||(this.helper=this._createHelper()),this.margins={left:parseInt(this.dragComponent.css("marginLeft"),10)||0,top:parseInt(this.dragComponent.css("marginTop"),10)||0},this.scrollParent=this.helper.scrollParent(),this.offset=this.dragComponent.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},t.extend(this.offset,{click:{left:n.pageX-this.offset.left,top:n.pageY-this.offset.top},parent:this._getParentOffset()}),this.helper.css("position","absolute"),this._cacheHelperProportions(),this.originalPosition=this._generatePosition(n),a.cursorAt&&this._adjustOffsetFromHelper(a.cursorAt),this.dragging=!0,s=this.dragComponent.children("h3").outerHeight(),this.dragComponent.hide(),this._createPlaceholder(s),r=this.placeholder.offset().top,this._initTargetContainers(),(r=this.placeholder.offset().top-r)>0&&(this.scrollParent[0].scrollTop=this.scrollParent[0].scrollTop+r),this._refreshPositions(),a.containment&&this._setContainment(),o||a.cursor&&"auto"!==a.cursor&&(i=t("body"),this.storedCursor=i.css("cursor"),i.css("cursor",a.cursor),this.storedStylesheet=t("<style>*{ cursor: "+a.cursor+" !important; }</style>").appendTo(i)),a.opacity&&this.helper.css("opacity",a.opacity),a.zIndex&&this.helper.css("zIndex",a.zIndex),this.scrollParent[0]!==document&&"HTML"!==this.scrollParent[0].tagName&&(this.overflowOffset=this.scrollParent.offset()),this._trigger("start",n,this._uiHashDnD()),this._mouseDrag(n),!0},_mouseDrag:function(e){var n,o,i,s,r,a,l,h,p,d,c,u,f=0,m=0,g=this.options,_=!1;for(this.position=this._generatePosition(e),this.positionAbs=this._adjustPositionForScroll(),this.lastPositionAbs||(this.lastPositionAbs=this.positionAbs),this.options.scroll&&(this.scrollParent[0]!==document&&"HTML"!==this.scrollParent[0].tagName?(this.overflowOffset.top+this.scrollParent[0].offsetHeight-e.pageY<g.scrollSensitivity?this.scrollParent[0].scrollTop=this.scrollParent[0].scrollTop+g.scrollSpeed:e.pageY-this.overflowOffset.top<g.scrollSensitivity&&(this.scrollParent[0].scrollTop=this.scrollParent[0].scrollTop-g.scrollSpeed),m=this.scrollParent[0].scrollTop-this.dropPositionsOrigin.y,this.overflowOffset.left+this.scrollParent[0].offsetWidth-e.pageX<g.scrollSensitivity?this.scrollParent[0].scrollLeft=this.scrollParent[0].scrollLeft+g.scrollSpeed:e.pageX-this.overflowOffset.left<g.scrollSensitivity&&(this.scrollParent[0].scrollLeft=this.scrollParent[0].scrollLeft-g.scrollSpeed),f=this.scrollParent[0].scrollLeft-this.dropPositionsOrigin.x):(e.pageY-t(document).scrollTop()<g.scrollSensitivity?t(document).scrollTop(t(document).scrollTop()-g.scrollSpeed):t(window).height()-(e.pageY-t(document).scrollTop())<g.scrollSensitivity&&t(document).scrollTop(t(document).scrollTop()+g.scrollSpeed),m=t(document).scrollTop()-this.dropPositionsOrigin.y,e.pageX-t(document).scrollLeft()<g.scrollSensitivity?t(document).scrollLeft(t(document).scrollLeft()-g.scrollSpeed):t(window).width()-(e.pageX-t(document).scrollLeft())<g.scrollSensitivity&&t(document).scrollLeft(t(document).scrollLeft()+g.scrollSpeed),f=t(document).scrollLeft()-this.dropPositionsOrigin.x)),this.positionAbs=this._adjustPositionForScroll(),this.helper[0].style.left=this.position.left+"px",this.helper[0].style.top=this.position.top+"px",this._dragCopyOrMove(e.ctrlKey),n=0;n<this.containers.length;n++)if(i=this.containers[n],a=this._intersectsWithPointer(i,null,f,m)){if("grid"===(u=i.type))for(c=this.positionAbs.top+this.offset.click.top+m,d=this.positionAbs.left+this.offset.click.left+f,l=0;l<i.rows.length;l++){if(K(c,(h=i.rows[l]).y-g.gridTolerance,2*g.gridTolerance)){_=this._movePlaceholder(i,null,"row",l);break}if(l<i.rows.length-1&&K(c,h.y,i.rows[l+1].y-h.y))for(p=0;p<h.columns.length;p++)if(K(d,h.columns[p]-g.gridTolerance,2*g.gridTolerance)){_=this._movePlaceholder(i,null,"column",l,p);break}}if(_)break;if(i.items)for(o=0;o<i.items.length;o++)if(s=i.items[o],a=this._intersectsWithPointer(s,u,f,m)){(r=s.element[0])!==this.dragComponent[0]&&this.placeholder[1===a?"next":"prev"]()[0]!==r&&("pointer"===this.options.tolerance||this._intersectsWithSides(s,u))&&(_=this._movePlaceholder(i,s,1===a?"before":"after"));break}if(_)break;if("grid"!==i.type&&(_=this._movePlaceholder(i)),_)break;i!==this.curContainer&&(this.curContainer=i);break}return this.lastPositionAbs=this.positionAbs,!1},_mouseStop:function(e,n){if(n||t("body").off(".glv"),this._deactivate(),this.storedCursor&&(t("body").css("cursor",this.storedCursor),this.storedStylesheet.remove()),!e.target)return this.fromOutside=!1,void(this.dragging=!1);if(this.options.animate){var o=this,i=this.placeholder.offset(),s={};s.left=i.left-this.offset.parent.left-this.margins.left+(this.offsetParent[0]===document.body?0:this.offsetParent[0].scrollLeft),s.top=i.top-this.offset.parent.top-this.margins.top+(this.offsetParent[0]===document.body?0:this.offsetParent[0].scrollTop),this.animating=!0,t(this.helper).animate(s,parseInt(this.options.animate,10)||500,(function(){o._finishDrag(e)}))}else this._finishDrag(e);return!1},_initDragTargets:function(t){this.itemType=void 0,this.regionType=void 0,t.hasClass(a)?(this.targetClass=v,this.itemClass=a,this.itemType=t.data("item-type")):t.hasClass(l)?(this.targetClass=y,this.itemClass=l,this.regionType=t.data("region-type")):t.hasClass(h)&&(this.targetClass=C,this.itemClass=h)},_dragCopyOrMove:function(t){this.isOver||this.prevCopy===t||(t?(this.dragComponent.show(),this.helper.find(G).text(o.getMessage("GL.DRAG_COPY"))):(this.dragComponent.hide(),this.helper.find(G).text("")),this.prevCopy=t)},_cancel:function(e){this.dragging&&(this._mouseUp(t.Event("mouseup",{target:null})),this.dragComponent.show(),this._select(this.dragComponent,null,!0)),this.placeholder&&(this.placeholder[0].parentNode&&this.placeholder[0].parentNode.removeChild(this.placeholder[0]),this.helper&&this.helper[0].parentNode&&this.helper.remove(),this.helper=null,this.dragging=!1,this.animating=!1),this._trigger("stop",e,this._uiHashDnD())},_intersectsWith:function(t){var e=this.positionAbs.left,n=this.positionAbs.top,o=t.left,i=o+t.width,s=t.top,r=s+t.height,a=this.offset.click.top,l=this.offset.click.left,h="x"===this.options.axis||n+a>s&&n+a<r,p="y"===this.options.axis||e+l>o&&e+l<i;return h&&p},_intersectsWithPointer:function(t,e,n,o){var i=K(this.positionAbs.top+this.offset.click.top+o,t.top,t.height),s=K(this.positionAbs.left+this.offset.click.left+n,t.left,t.width),r=i&&s,a=this._getDragVerticalDirection(),l=this._getDragHorizontalDirection();return!!r&&("flow"===e&&l?"right"===l||"down"===a?2:1:a&&"down"===a?2:1)},_intersectsWithSides:function(t,e){var n=K(this.positionAbs.top+this.offset.click.top,t.top+t.height/2,t.height),o=K(this.positionAbs.left+this.offset.click.left,t.left+t.width/2,t.width),i=this._getDragVerticalDirection(),s=this._getDragHorizontalDirection();return"flow"===e&&s?"right"===s&&o||"left"===s&&!o:i&&("down"===i&&n||"up"===i&&!n)},_getDragVerticalDirection:function(){var t=this.positionAbs.top-this.lastPositionAbs.top;return 0!==t&&(t>0?"down":"up")},_getDragHorizontalDirection:function(){var t=this.positionAbs.left-this.lastPositionAbs.left;return 0!==t&&(t>0?"right":"left")},_initTargetContainers:function(){var e,n=this,o="."+this.targetClass,i=t(o,this.element),s=null,r=this.regionType,a=this.itemType;this.helper&&(i=i.not(this.helper.find(o)),r=r||this.helper.data("region-type"),a=a||this.helper.data("item-type")),this.dragComponent&&(i=i.not(this.dragComponent.find(o)),s=this.dragComponent.closest(o)[0]),a&&(i=i.filter((function(){const e=t(this).closest(u).data("supported-item-types");return!e||e.includes(a)}))),r&&(i=i.filter((function(){const e=t(this).closest(d).data("supported-region-types");return!e||e.includes(r)}))),i.addClass(E),this.containers=[],this.curContainer=null,i.each((function(){var o,i,r;(i=t(this)).hasClass(w)?o="grid":i.hasClass(k)?o="stack":i.hasClass(S)&&(o="flow"),e={element:i,type:o,name:t(this).prev().text(),width:0,height:0,left:0,top:0},n.containers.unshift(e),this===s&&(n.curContainer=e),"grid"===o?e.rows=[]:(e.items=[],r=nt(i),i.children(r).each((function(){e.items.push({element:t(this),name:t(this).children("h3").text(),width:0,height:0,left:0,top:0})})))}))},_deactivate:function(){t("."+this.targetClass).removeClass(E)},_refreshPositions:function(){var e,n,o,i,s,r,a,l,h,p;function d(){h=t(this),s=h.offset(),a.columns.push(s.left)}function c(){l=t(this),s=l.offset(),a={y:s.top,columns:[]},o.rows.push(a),l.children("td").each(d),a.columns.push(s.left+h.outerWidth())}for(l=t(),e=0;e<this.containers.length;e++)if(i=(o=this.containers[e]).element,o.width=i.outerWidth(),o.height=i.outerHeight(),s=i.offset(),o.left=s.left,o.top=s.top,"grid"===o.type)o.rows=[],i.children("tbody").children("tr").each(c),o.rows.push({y:s.top+l.outerHeight()});else for(n=0;n<o.items.length;n++)i=(r=o.items[n]).element,r.width=i.outerWidth(),r.height=i.outerHeight(),s=i.offset(),r.left=s.left,r.top=s.top;this.dropPositionsOrigin={x:0,y:0},(p=this.element.scrollParent())[0]===document?p=this.element:this.dropPositionsOrigin={x:p[0].scrollLeft,y:p[0].scrollTop},s=p.offset(),this.containerCache.left=s.left,this.containerCache.top=s.top,this.containerCache.width=p.outerWidth(),this.containerCache.height=p.outerHeight()},_createPlaceholder:function(e){this.placeholder=t("<div class='a-GridLayout-placeholder'>&nbsp;</div>"),this.dragComponent.after(this.placeholder),e&&this.placeholder.height(e)},_createHelper:function(){var e=this.options,n=this.makeHelper();return n.parents("body").length||t("parent"!==e.appendTo?e.appendTo:this.element[0].parentNode)[0].appendChild(n[0]),n[0].style.width,n[0].style.height,n},_adjustOffsetFromHelper:function(t){"left"in t&&(this.offset.click.left=t.left+this.margins.left),"right"in t&&(this.offset.click.left=this.helperProportions.width-t.right+this.margins.left),"top"in t&&(this.offset.click.top=t.top+this.margins.top),"bottom"in t&&(this.offset.click.top=this.helperProportions.height-t.bottom+this.margins.top)},_getParentOffset:function(){var e;return this.offsetParent=this.helper.offsetParent(),e=this.offsetParent[0]===document||this.offsetParent[0]===document.firstElementChild?{left:0,top:0}:this.offsetParent.offset(),this.scrollParent[0]!==document&&t.contains(this.scrollParent[0],this.offsetParent[0])&&(e.left+=this.scrollParent.scrollLeft(),e.top+=this.scrollParent.scrollTop()),(this.offsetParent[0]===document.body||this.offsetParent[0].tagName&&"html"===this.offsetParent[0].tagName.toLowerCase()&&t.ui.ie)&&(e={top:0,left:0}),{top:e.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:e.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var e,n,o,i=this.options;"parent"===i.containment&&(i.containment=this.helper[0].parentNode),"document"!==i.containment&&"window"!==i.containment||(this.containment=[0-this.offset.parent.left,0-this.offset.parent.top,t("document"===i.containment?document:window).width()-this.helperProportions.width-this.margins.left,(t("document"===i.containment?document:window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]),/^(document|window|parent)$/.test(i.containment)||(e=t(i.containment)[0],n=t(i.containment).offset(),o="hidden"!==t(e).css("overflow"),this.containment=[n.left+(parseInt(t(e).css("borderLeftWidth"),10)||0)+(parseInt(t(e).css("paddingLeft"),10)||0)-this.margins.left,n.top+(parseInt(t(e).css("borderTopWidth"),10)||0)+(parseInt(t(e).css("paddingTop"),10)||0)-this.margins.top,n.left+(o?Math.max(e.scrollWidth,e.offsetWidth):e.offsetWidth)-(parseInt(t(e).css("borderLeftWidth"),10)||0)-(parseInt(t(e).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left,n.top+(o?Math.max(e.scrollHeight,e.offsetHeight):e.offsetHeight)-(parseInt(t(e).css("borderTopWidth"),10)||0)-(parseInt(t(e).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top])},_generatePosition:function(e){var n=e.pageX,o=e.pageY,i=this.scrollParent[0]!==document&&t.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,s=/(html|body)/i.test(i[0].tagName);return this.originalPosition&&this.containment&&(e.pageX-this.offset.click.left<this.containment[0]&&(n=this.containment[0]+this.offset.click.left),e.pageY-this.offset.click.top<this.containment[1]&&(o=this.containment[1]+this.offset.click.top),e.pageX-this.offset.click.left>this.containment[2]&&(n=this.containment[2]+this.offset.click.left),e.pageY-this.offset.click.top>this.containment[3]&&(o=this.containment[3]+this.offset.click.top)),{top:o-this.offset.click.top-this.offset.parent.top-(s?0:i.scrollTop()),left:n-this.offset.click.left-this.offset.parent.left-(s?0:i.scrollLeft())}},_adjustPositionForScroll:function(){var e=this.position,n=this.scrollParent[0]!==document&&t.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,o=/(html|body)/i.test(n[0].tagName);return{top:e.top+this.offset.parent.top-(o?0:n.scrollTop()),left:e.left+this.offset.parent.left-(o?0:n.scrollLeft())}},_makeTempDragComponent:function(){var n,o,i=e.htmlBuilder();return i.markup("<div").attr("class",this.itemClass).markup("><h3 class='is-draggable'><span>&nbsp;</span></h3></div>"),n=t(i.toString()),!!(o=this.element.find("."+this.targetClass).not(b).filter(":visible").first()).length&&(o.append(n),this.dragComponent=n,!0)},_movePlaceholder:function(e,n,o,i,s){var r,a,l,h,p,d,c=null,u=null,f=!1;if(n)(r=n.element[0]).parentNode.insertBefore(this.placeholder[0],"before"===o?r:r.nextSibling),f=!0;else if(p=nt(e.element),d=ot(e.element),"grid"===e.type){if(a=e.element.children("tbody").children("tr"),"row"===o){if(i>=a.length?h=a.last().find(p).filter(":visible").length:(h=a.eq(i).find(p).filter(":visible").length)>0&&i>0&&(h=a.eq(i-1).find(p).filter(":visible").length),0===h)return!1;c=t("<tr><td><div class='"+k+" "+d+"'></div></td></tr>"),i>=a.length?a.last().after(c):a.eq(i).before(c),c.find("div").append(this.placeholder[0]),this.containers.unshift({element:c.find("div"),type:"stack",name:"temp",items:[],width:0,height:0,left:0,top:0}),f=!0}else if("column"===o){if(s>=(l=a.eq(i).children("td")).length?h=l.last().find(p).filter(":visible").length:(h=l.eq(s).find(p).filter(":visible").length)>0&&s>0&&(h=l.eq(s-1).find(p).filter(":visible").length),0===h)return!1;u=t("<td><div class='"+k+" "+d+"'></div></td>"),s>=l.length?l.last().after(u):l.eq(s).before(u),u.find("div").append(this.placeholder[0]),this.containers.unshift({element:u.find("div"),type:"stack",name:"temp",items:[],width:0,height:0,left:0,top:0}),f=!0}}else(!e.items||0===e.items.length||1===e.items.length&&e.items[0].element[0]===this.dragComponent[0])&&(e.element.append(this.placeholder[0]),f=!0);return e!==this.curContainer&&(this.curContainer=e),f&&(this.tempGridRow&&0===this.placeholder.closest(this.tempGridRow).length&&(this.tempGridRow.remove(),this.tempGridRow=null),c&&(this.tempGridRow=c),this.tempGridColumn&&0===this.placeholder.closest(this.tempGridColumn).length&&(this.tempGridColumn.remove(),this.tempGridColumn=null),u&&(this.tempGridColumn=u)),f&&this._refreshPositions(),f},_copyComponent:function(t,e){var n,o,i,s,r={};for(i in t)if(Object.prototype.hasOwnProperty.call(t,i))if(s=t[i],"slots"===i){o=r.slots=[];for(const e of t.slots)o.push(this._copyComponent(e,r))}else if("components"===i)for(o=r.components=[],n=0;n<t.components.length;n++)o.push(this._copyComponent(t.components[n],r));else"_parent"===i?r._parent=e:"_"!==i.substring(0,1)&&(r[i]=s);return this.options.updateComponentCopy(r,t),r},_insert:function(t,e,n,o,i,s,r){var a,l,h,p,d,c,u=this.pageRoot,f=t.component,m=t.newParentContainer;if("button"===f.type&&(j(t,f,"alignment",r),r&&(t.newAlignment=r)),e&&!m.hasSubRegionTemplate){for(-1===s||0===m._grids.length?(a={_parent:m,rows:[]},m._grids.splice(n,0,a),j(t,f,"newGrid",!0),t.newGridInserted=!0,s=F):(j(t,f,"newGrid",!1),a=m._grids[n]),s===F||o>=a.rows.length?(l={_parentGrid:a,columns:[]},a.rows.splice(o,0,l),t.newRowInserted=!0,s=-3,j(t,f,"newRow",!0)):(j(t,f,"newRow",!1),l=a.rows[o]),-3===s?(h={_parentRow:l,span:-1,col:-1,components:[]},l.columns.splice(i,0,h),t.newColumnInserted=!0,s=0,j(t,f,"newCol",!0),0!==i||t.newRowInserted||j(t,f,"newRow",!0)):(d=(h=l.columns[i]).components[s],0===s?(j(t,f,"newCol",!0),d&&(j(t,f,"newRow",d.newRow),j(t,f,"newGrid",d.newGrid),j(t,f,"col",d.col),j(t,f,"span",d.span),void 0!==d.rowSpan&&j(t,f,"rowSpan",d.rowSpan),j(t,d,"newCol",!1),j(t,d,"newRow",!1),j(t,d,"newGrid",!1),j(t,d,"col",-1),j(t,d,"span",-1),void 0!==d.rowSpan&&j(t,d,"rowSpan",-1))):j(t,f,"newCol",!1)),(void 0===f.col||f.col>=0&&(0!==s||!d)&&!f.forceColumn)&&j(t,f,"col",-1),delete f.forceColumn,void 0===f.span&&j(t,f,"span",-1),f._parentColumn=h,t.newGrid=n,t.newRow=o,t.newColumn=i,t.newIndex=s,!d&&i+1<l.columns.length&&(d=l.columns[i+1].components[0],t.newColumnInserted&&0===i&&j(t,d,"newRow",!1)),!d&&o+1<a.rows.length&&(d=a.rows[o+1].columns[0].components[0]),!d&&n+1<m._grids.length&&(d=m._grids[n+1].rows[0].columns[0].components[0]),c=d?V(m.components,d):m.components.length,t.newComponentIndex=c,h.components.splice(s,0,f),m.components.splice(c,0,f),d&&d._parentColumn!==f._parentColumn&&0===i&&f.newCol&&j(t,d,"newCol",!0),p=0;p<l.columns.length;p++)(h=l.columns[p]).col=h.components[0].col,h.span=h.components[0].span||-1;"fixed"===u.gridType&&u.hasColumnSpan&&J(l,m.maxColumns)}else t.newIndex=s,m.components.splice(s,0,f);return f._parent=m,s},_getTableColumnFromColumn:function(t,e,n,o){var i,s,r=1,a=0,l=t._grids[e].rows[n].columns;for(i=0;i<=o&&i<l.length;i++)(s=l[i]).col>r&&(a+=1,r=s.col),r+=s.span>0?s.span:1,a+=1;return a-1},_insertInDom:function(e,n,o,i,s,r,a,l,p){var d,c,u,f,m,_,v,y,C,w,S,P=this.pageRoot;f=e.hasClass(h)&&n.children(g).length?n.find(g).find("td").eq("left"===p?0:1).children(R):n.children(R),this.placeholder?this.placeholder.before(e):f.is(b)?(C=ot(n),(w=a)<0&&(w=0),-1===a&&o._grids.length>1?(m=t("<table role='presentation'><tbody></tbody></table>"),z(f.parent(),"table",m,i),a=F,w=0):m=f.parent().children("table").eq(i),a===F&&0===i&&o._grids[i].rows.length>1?(c="<td><div class='"+k+" "+C+"'></div></td>",o._grids[i].rows[s].columns[0].col>=0&&(c+=c),_=t("<tr>"+c+"</tr>"),z(m.children("tbody"),_,s),w=0):_=m.children("tbody").children("tr").eq(s),S=this._getTableColumnFromColumn(o,i,s,r),-3===a?(o._grids[i].rows[s].columns[r].col>=0&&z(_,v=t("<td><div class='"+k+" "+C+"'></div></td>"),S-1),z(_,v=t("<td><div class='"+k+" "+C+"'></div></td>"),S),w=0):v=_.children().eq(S),z(v.children().eq(0),e,w)):z(f,e,a),"fixed"===P.gridType&&P.hasColumnSpan&&f.is(b)&&(_=(m=f.parent().children("table").eq(i)).children("tbody").children("tr").eq(s),y=o._grids[i].rows[s].columns,d=0,u=1,_.children("td").each((function(){y[d].col>u&&(this.colSpan=y[d].col-u,u=y[d].col),u+=y[d].span>0?y[d].span:1,t(this).find(L).length>0&&(this.colSpan=y[d].span,d+=1)}))),l&&this._showOrHideSlots(e)},_add:function(n,o,i,s,r,a,l,h){var p,d,c=!1,u=e.htmlBuilder(),f={container$:o,propertyChanges:[]};return f.newParentContainer=p=this._getNode(o[0]),d=Array.isArray(p._grids),n.slots&&this._layoutSlots(n.slots,n,d,12),h?(this._setNode(n),h[0].id=this.baseId+n._elementId):(this._renderComponent(u,n,d),h=t(u.toString()),c=!0),f.newComponent$=h,f.component=n,this._insert(f,d,i,s,r,a,l),this._insertInDom(f.newComponent$,o,p,i,s,r,a,c,l),f},_remove:function(e,n,o){var i,s,r,a,l,h,p,d,c,u,f,m,g,_,v,y,C=this.pageRoot,w=this,k=!!o;if(n=n||{propertyChanges:[]},r=this._getNode(e[0]),o=o||e.parent(),k?e.hide():(n.component$=e,n.component=r,n.prevContainer$=e.closest(x),delete this.nodeMap[U(e[0].id)],e.find(L).each((function(){delete w.nodeMap[U(this.id)]})),e.remove()),y="TD"===o[0].parentNode.nodeName&&o.closest("table").is(b),n.prevParentContainer=u=r._parent,n.prevComponentIndex=m=V(u.components,r),n.prevIndex=n.prevComponentIndex,"button"===r.type&&r.alignment&&(n.prevAlignment=r.alignment),y&&0===o.children(":visible").length&&((s=o.parent().parent()).parent().children("tr").length>1&&0===s.find(L).filter(":visible").length?s.remove():s.children("td").length>1&&(c=o.parent().prev().eq(0),o.parent().remove(),0===c.find(L).filter(":visible").length&&c.remove())),y){if(f=V((a=r._parentColumn).components,r),g=V(a._parentRow._parentGrid._parent._grids,a._parentRow._parentGrid),_=V(a._parentRow._parentGrid.rows,a._parentRow),v=V(a._parentRow.columns,a),n.prevGrid=g,n.prevRow=_,n.prevColumn=v,n.prevIndex=f,0===f&&a.components.length>1&&(j(n,p=a.components[1],"newGrid",r.newGrid),j(n,p,"newRow",r.newRow),j(n,p,"newCol",r.newCol),j(n,p,"col",r.col),j(n,p,"span",r.span),r.rowSpan&&j(n,p,"rowSpan",r.rowSpan)),(a=(l=(h=u._grids[g]).rows[_]).columns[v]).components.splice(f,1),0===a.components.length&&(l.columns.splice(v,1),0===v&&l.columns.length>0&&j(n,p=l.columns[v].components[0],"newRow",!0),n.prevColumnRemoved=!0,l.columns.length>0)){if("fixed"===C.gridType&&C.hasColumnSpan){for(i=0;i<l.columns.length;i++)(a=l.columns[i]).col=a.components[0].col,a.span=a.components[0].span||-1;J(l,u.maxColumns)}d=l.columns,i=0,s.children("td").each((function(){t(this).find(L).length>0&&(d[i].span>0&&(this.colSpan=d[i].span),i+=1)}))}0===l.columns.length&&(h.rows.splice(_,1),n.prevRowRemoved=!0),0===h.rows.length&&(u._grids.splice(g,1),n.prevGridRemoved=!0)}return k&&e.show(),u.components.splice(m,1),delete r._parent,n},_moveOrCopy:function(n,o,i,s,r,a,l,h){var p,d,c,u,f,m=!1,g=!1,_=e.htmlBuilder(),v={container$:o,propertyChanges:[]};return p=this._getNode(n[0]),v.newParentContainer=u=this._getNode(o[0]),c=Array.isArray(u._grids),v.prevContainer$=n.closest(x),h?(v.originalComponent=p,f=12,(p=this._copyComponent(p)).slots&&this._layoutSlots(p.slots,p,c,f),this._renderComponent(_,p,c),v.newComponent$=t(_.toString()),m=!0):(g="TD"===(d=n.parent())[0].parentNode.nodeName,v.newComponent$=n,p.slots&&c!==g&&(f=12,this._layoutSlots(p.slots,p,c,f),this._renderComponent(_,p,c),v.newComponent$=t(_.toString()),m=!0,n.remove(),delete this.nodeMap[U(n[0].id)])),v.component=p,h||(this._remove(v.newComponent$,v,d),g&&v.prevParentContainer===v.newParentContainer&&(v.prevColumnRemoved&&v.prevColumn<r&&s===v.prevRow&&(r-=1),v.prevRowRemoved&&v.prevRow<s&&i===v.prevGrid&&(s-=1),v.prevGridRemoved&&v.prevGrid<i&&(i-=1))),this._insert(v,c,i,s,r,a,l),this._insertInDom(v.newComponent$,o,u,i,s,r,a,m,l),v},_finishDrag:function(e){var n,o,i,s,r,a,l,h,p,d,c,u,f,m=e.ctrlKey,g=[];for(this.animating=!1,(this.dragComponent.next()[0]!==this.placeholder[0]||m||this.fromOutside)&&(h=this.placeholder.closest(x),d=Y(this.placeholder),r=null,a=null,l=null,h.children("table.a-GridLayout-grid").length>0?(o=this.placeholder.closest("td"),l=0,o.parent().children("td").each((function(){if(this===o[0])return!1;t(this).children("."+k).children().length>0&&(l+=1)})),a=Y(i=o.parent()),r=h.children("table").index(i.parent().parent()),0===d&&1===this.placeholder.parent().children(":visible").length&&(d=1===i.parent().children().length&&1===i.children().length?-1:1===i.children().length?F:-3)):h.children("table.a-GridLayout-buttonRow").length>0&&(f=0===Y(o=this.placeholder.closest("td"))?"left":"right"),this.fromOutside?(u=this.helper.attr("data-type-id"),s=this.options.makeComponent(u),this.dragComponent.remove(),c=this._add(s,h,r,a,l,d,f),g.push((function(t){this._trigger("added",t,c)}))):(c=this._moveOrCopy(this.dragComponent,h,r,a,l,d,f,m),g.push((function(t){this._trigger(m?"copied":"moved",t,c)})))),c&&(p=c.newComponent$),this.fromOutside&&g.push((function(t){this._trigger("deactivate",t,this._uiHashDnD(this))})),this.dragComponent.show(),this.dragging=!1,this.tempGridRow=null,this.tempGridColumn=null,this._trigger("beforeStop",e,this._uiHashDnD()),this.placeholder[0].parentNode.removeChild(this.placeholder[0]),this.placeholder=null,this.helper.remove(),this.helper=null,n=0;n<g.length;n++)g[n].call(this,e);return this._trigger("stop",e,this._uiHashDnD()),c&&this._select(p,e,!0),this.fromOutside=!1,!0},_trigger:function(){!1===t.Widget.prototype._trigger.apply(this,arguments)&&this.cancel()},_uiHashDnD:function(e){var n=e||this;return{helper:n.helper,placeholder:n.placeholder||t([]),position:n.position,originalPosition:n.originalPosition,offset:n.positionAbs,item:n.dragComponent,sender:e?e.element:null}}}),t.apex.gridlayout.INDEX={NEW_GRID:-1,NEW_ROW:F,NEW_COLUMN:-3},t.ui.plugin.add("draggable","connectToGridlayout",{start:function(e,n){var o=t(this).data("ui-draggable"),i=o.options,s=t.extend({},n,{item:o.element});t("body").on("keydown.glvplug",(function(e){e.keyCode===t.ui.keyCode.ESCAPE&&(o.dropped=!1,o.cancel())})),o.grids=[],t(i.connectToGridlayout).each((function(){var i=t.data(this,"apex-gridlayout");i&&!i.options.disabled&&(o.grids.push({instance:i}),i._initDragTargets(n.helper),i._initTargetContainers(),i._refreshPositions(),i._trigger("activate",e,s))}))},stop:function(e,n){var o,i=t(this).data("ui-draggable");t("body").off(".glvplug"),i.grids.forEach((function(s){s.instance.isOver&&!s.invalid?(s.instance.isOver=!1,i.cancelHelperRemoval=!0,e.target?s.instance._mouseStop(e,!0):(s.instance._mouseStop(e,!0),s.instance.dragComponent.remove(),s.instance._cancel(e))):(s.instance._deactivate(),o=t.extend({},n,{item:i.element}),s.instance._trigger("deactivate",e,o))}))},drag:function(e,n){var o=t(this).data("ui-draggable");for(let t of o.grids){var i=!1;if(!t.invalid)if(t.instance.positionAbs=o.positionAbs,t.instance.helperProportions=o.helperProportions,t.instance.offset.click=o.offset.click,t.instance._intersectsWith(t.instance.containerCache)&&(i=!0),i){if(!t.instance.isOver){if(t.instance.isOver=!0,!t.instance._makeTempDragComponent()){t.instance.isOver=!1,t.invalid=!0;continue}if(t.instance.helper=n.helper,t.instance.helper.css("position","relative"),e.target=t.instance.dragComponent.children("h3")[0],!t.instance._mouseCapture(e,!0)){t.instance.isOver=!1,t.invalid=!0;continue}t.instance._trigger("over",e,t.instance._uiHashDnD(t.instance)),t.instance._mouseStart(e,e,!0),t.instance.offset.click.top=o.offset.click.top,t.instance.offset.click.left=o.offset.click.left,t.instance.offset.parent.left-=o.offset.parent.left-t.instance.offset.parent.left,t.instance.offset.parent.top-=o.offset.parent.top-t.instance.offset.parent.top,o.dropped=t.instance.element,o.currentItem=o.element,t.instance.fromOutside=o}t.instance.dragComponent&&t.instance._mouseDrag(e)}else t.instance.isOver&&(t.instance.isOver=!1,t.instance._trigger("out",e,t.instance._uiHashDnD(t.instance)),e.target=null,t.instance._mouseStop(e,!0),t.instance.dragComponent.remove(),t.instance.placeholder&&t.instance.placeholder.remove(),o.dropped=!1)}}})}(apex.jQuery,apex.util,apex.debug,apex.lang);