/*!
 * Copyright (c) 2021, 2024, Oracle and/or its affiliates.
 */
!function(e,o,t,i,a,n,r,s,l){"use strict";const c="#apexDevToolbarQuickEdit",d="#apexDevCustomize",p="is-disabled",u="warning",g=/(\.jpg|\.jpeg|\.png|\.gif|\.svg)$/i,v="ICON.EDITOR.DIALOG.TITLE",h="ICON.EDITOR.UPLOAD.ICON",E="APEX.ITEM.FILE.DROP_OR_CHOOSE_FILE",I="DATA.LOAD.CHOOSE_FILE",m="UTR.LOGO.ONLY_IMAGE_FILES",f="UTR.SAVE",D="UTR.BUTTONS.CLOSE",w="UTR.COMMON.CANCEL",b="UTR.HELP",C="UTR.RESET",_="ICON.EDITOR.CROP.HELP",T="ICON.EDITOR.CROPPER.HELPTEXT",x="ICON.EDITOR.LEGACY_DATA",O="ICON.EDITOR.CROPPER.ZOOM_SLIDER_LABEL",R=656,y=390,P=260,L=220,A=e("[data-app-icon]");let F,$,N,S,U,B=new function(){let o=this,i=!1;o.init=function(){i=!1},o.saveIcon=async function(){const e=async(e,o)=>{try{await t.process("theme_roller",{p_flow_id:4e3,p_flow_step_id:0,p_instance:F,x01:"set_icon",x02:r.APP_ID,x04:o?`${e}-rounded`:e,p_clob_01:l.getDataURL({width:e,height:e,rounded:o}).split(";base64,")[1]})}catch(e){n(e),z(X("ICON.EDITOR.ERROR.SAVING"),"danger")}};U=apex.widget.waitPopup(),await e(32),await e(144,!0),await e(192),await e(256,!0),await e(512),i=!0,U.remove(),N.dialog("close")},o.reloadPage=function(){i&&location.reload(),i=!1},o.initCropper=function({imageItemName:e}){const o={crop(){A.length>0&&(A.is("span")&&A.css("background-image",`url(data:${l.getDataURL()})`),A.is("img")&&A.attr("src",`data:${l.getDataURL()}`))}};l.init({imageItemName:e,cropperOptions:o})},o.saveCustomIcon=async function(){const e=async(e,o)=>t.process("save_icon",{x01:o?`${e}-rounded`:e,p_clob_01:l.getDataURL({width:e,height:e,rounded:o}).split(";base64,")[1]});await e(32),await e(144,!0),await e(192),await e(256,!0),await e(512)},o.saveStockIcon=async function({iconClass:o,iconColor:i}){const n=async(n,r)=>{let s=await(await fetch(`${apex.env.APEX_FILES}apex_ui/img/icons/builder/app-icon-${encodeURIComponent(o)}.svg`)).text();const c=e(s);c.attr("width",n),c.attr("height",n);const d=e(`<rect xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" fill="${a.escapeHTMLAttr(i)}"/>`);c.prepend(d);const p="data:image/svg+xml;base64,"+btoa(c.get(0).outerHTML);let u=document.createElement("canvas");u.width=n,u.height=n;let g=document.createElement("img");g.src=p,await g.decode();let v=u.getContext("2d");if(r){const e=l.applyRoundedCanvas(g,n);await t.process("save_icon",{x01:`${n}-rounded`,p_clob_01:e.toDataURL().split(";base64,")[1]})}else v.drawImage(g,0,0,n,n),await t.process("save_icon",{x01:n,p_clob_01:u.toDataURL().split(";base64,")[1]})};await n(32),await n(144,!0),await n(192),await n(256,!0),await n(512)},o.resetCropper=l.reset},H=R,k=a.hasOwnProperty;function M(o){var a,s=this,h=`<div id="IconCropperHelpDialog" class="padding-sm" style="display:none;">\n                                            <div class="a-Property-label">${X(T)}</div>\n                                        </div>`,E=`<div>\n                                        <img id="CurrentApplicationIcon" width="400" height="400" style="max-width: 100%; display: block;" src="${r.APP_FILES+"icons/app-icon-512.png"}" />\n                                    </div>\n                                    <div class="u-textCenter margin-top-md margin-bottom-md">\n                                        <input id="APEXCropperZoom" type="range" min="0" max="100" value="0" step="1" style="width:auto;">\n                                        <label class="u-vh" for="APEXCropperZoom">${X(O)}</label>\n                                    </div>`,I=!0;U=apex.widget.waitPopup(),fetch(r.APP_FILES+"icons/app-icon-512.png").then((function(e){if(!e.ok)throw Error("No icon found")})).then((function(){a=j(E)})).catch((async function(){try{const e=await t.process("theme_roller",{p_flow_id:4e3,p_flow_step_id:0,p_instance:F,x01:"get_icon_data",x02:r.APP_ID});k(e,"favicons")?($=`<div class="a-Property-label">\n                                            ${X(x)}\n                                            <textarea class="a-Property-field a-Property-field--textarea" rows="8" readonly>${e.favicons}</textarea>\n                                            </div>`,H=y):k(e,"appBuilderIconName")?($=`<div class="a-Property-label">\n                                            ${X(x)}\n                                            </div>`,H=P):($="<div></div>",H=L),I=!1,a=j($)}catch(e){n.error(e)}})).finally((function(){N=e(a),S=e(h),N.find(".apex-rds-hover").hide(),S.find(".apex-rds-hover").hide(),l.initZoom(N.find("#APEXCropperZoom")),o.element.append(N,S),N.dialog({autoOpen:!0,title:X(v),dialogClass:"a-DevTools a-DevTools-main",resizable:!0,draggable:!0,width:400,height:H,closeOnEscape:!0,open:function(){i.beginFreezeScroll(),l.destroy(),I&&B.initCropper({imageItemName:"CurrentApplicationIcon"})},close:function(){i.endFreezeScroll(),S.hasClass("ui-dialog-content")&&S.dialog("close"),e(c).add(d).removeClass(p),B.reloadPage()},create:function(){N.find(".a-FileDrop").on("click",(function(e){"INPUT"!==e.target.tagName&&N.find("input#IconEditorFile").trigger("click")})),N.find("#DragAndDropContainer").on("dragenter dragover",(function(e){e.preventDefault()})).on("drop change",(function(o){let t,i,a;if(o.preventDefault(),t=o.originalEvent.dataTransfer?o.originalEvent.dataTransfer.files:o.target.files,t&&t[0])if(i=t[0],g.exec(i.name)){l.destroy();var n=new FileReader;n.readAsDataURL(i),n.onloadstart=function(){U=apex.widget.waitPopup()},n.onloadend=function(o){if(U.remove(),!I){document.getElementById("PreviousIconContainer").innerHTML=E,N.dialog("option","height",R),e("#IconEditorReset").show(),e("#IconEditorHelp").show(),e("#IconEditorSave").show()}a=document.getElementById("CurrentApplicationIcon"),a.src=o.target.result,B.initCropper({imageItemName:a.id})}}else z(X(m),u)}))},buttons:[{id:"IconEditorHelp",text:X(b),title:X(b),class:"a-Button a-DevTools-toolbar-item a-DevTools-toolbar-button",click:function(){S.dialog({title:X(_),dialogClass:"a-DevTools",resizable:!1,draggable:!0,width:360,height:425,closeOnEscape:!0,buttons:[{id:"DiagIconEditorCloseHelpDialogButton",text:X(D),title:X(D),class:"a-Button a-Button--hot a-DevTools-toolbar-item a-DevTools-toolbar-button a-DevTools-toolbar-item--push",click:function(){e(this).dialog("close")}}]})}},{id:"IconEditorReset",text:X(C),title:X(C),class:"a-Button a-DevTools-toolbar-item a-DevTools-toolbar-item--left a-DevTools-toolbar-button",click:l.reset},{id:"IconEditorCancel",text:X(w),title:X(w),class:"a-Button a-DevTools-toolbar-item a-DevTools-toolbar-button a-DevTools-toolbar-item--push",click:function(){if(l.destroy(),!I){document.getElementById("PreviousIconContainer").innerHTML=$,N.dialog("option","height",H),e("#IconEditorReset").hide(),e("#IconEditorHelp").hide(),e("#IconEditorSave").hide(),e("#IconEditorFile").val("")}e(this).dialog("close")}},{id:"IconEditorSave",text:X(f),title:X(f),class:"a-Button a-Button--hot a-DevTools-toolbar-item a-DevTools-toolbar-button",click:function(){B.saveIcon()}}]}),B.init(N),e("#IconEditorHelp").html('<span class="a-Icon icon-help" aria-hidden="true"></span>'),I||(e("#IconEditorReset").hide(),e("#IconEditorHelp").hide(),e("#IconEditorSave").hide()),s.isOpen=function(){return N.dialog("isOpen")},s.open=function(){N.dialog("open")},s.close=function(){N.dialog("close")},U.remove()}))}function j(e){return`<div id="IconEditorDialog" class="padding-sm">\n                    <div id="IconContainer" class="margin-bottom-sm">\n                        <div id="NewIconContainer">\n                            <div id="DragAndDropContainer" class="file  a-FileDrop-wrapper" role="group">\n                                <div class="a-FileDrop a-FileDrop--inlineDropzone" aria-hidden="true">\n                                    <input type="file" id="IconEditorFile" name="IconEditorFile" class="apex-item-file" accept="image/*" />\n                                    <div class="a-FileDrop-icon">\n                                        <span class="a-Icon icon-file-browse" aria-hidden="true"></span>\n                                    </div>\n                                    <div class="a-FileDrop-body">\n                                        <span class="a-FileDrop-heading">${X(h)}</span>\n                                        <span class="a-FileDrop-description">${X(E)}</span>\n                                        <span class="a-FileDrop-filename"></span>\n                                    </div>\n                                    <div class="a-FileDrop-progress">\n                                        <div class="a-FileDrop-progressbar"></div>\n                                    </div>\n                                    <div class="a-FileDrop-action">\n                                        <span class="a-Button a-FileDrop-action-choose a-Button--hot" aria-label="${X(I)}" aria-hidden="true">${X(I)}</span>\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                    <div id="PreviousIconContainer">${e}</div>\n                </div>`}function X(e){return o.getMessage(e)}function z(o,t){apex.devToolbar.notification(e("#IconEditorDialog"),o,t)}e.widget("apex.iconEditor",{_create:function(){var i=this;F=this.options.builderSessionId,(async()=>{await o.loadMessages(["ICON.EDITOR.%"]),await t.loadRequirejs(),(o=>{const i=["apex_ui/css/DevTools.css",`libraries/cropperjs/${s.cropperJs}/cropper.min.css`];for(const o of i)0===e(`link[href*='${o}']`).length&&e(document.createElement("link")).attr({rel:"stylesheet",type:"text/css",href:r.APEX_FILES+o}).appendTo("head");e("head").append('<style type="text/css">.cropper-face { border: 2px solid white !important; opacity: 1; background-color: transparent; }</style>');const a=`libraries/cropperjs/${s.cropperJs}/cropper.min.js`;0===e(`script[src*='${a}']`).length?t.loadScript({path:r.APEX_FILES+a,requirejs:!0,global:"Cropper"},o):o()})((()=>{var e;(e=i)._iconEditorController=new M(e),e._iconEditorController.status="READY",e._trigger("ready",null,{})}))})()},isReady:function(){return"READY"===this._iconEditorController.status},toggle:function(){this._iconEditorController.isOpen()?this._iconEditorController.close():this._iconEditorController.open()}}),apex.iconEditor=B}(apex.jQuery,apex.lang,apex.server,apex.navigation,apex.util,apex.debug,apex.env,apex.libVersions,apex.cropperEditor);