/*!
 * Copyright (c) 2013, 2024, Oracle and/or its affiliates.
 */
!function(e,t,n,o,a,i){"use strict";const r=a.CSS.IS_ERROR,l=a.CSS.IS_WARNING,s=".a-GridLayout-pageItem, .a-GridLayout-region, .a-GridLayout-button",p=".a-GridLayout-page, .a-GridLayout-pageItem, .a-GridLayout-region, .a-GridLayout-button",d="#glv",u="page",c="region",P="item",g="button",m="GLV_HIDE_LEGACY",O="GLV_HIDE_GLOBAL",R="GLV_HIDE_EMPTY",h="GLV_HIDE_BTNS",y="GLV_HIDE_ITEMS",E="glv",_="option",C=t.apex.gridlayout.INDEX,I={newGrid:e.PROP.GRID_NEW_GRID,newRow:e.PROP.GRID_NEW_ROW,col:e.PROP.GRID_COLUMN,newCol:e.PROP.GRID_NEW_COLUMN,span:e.PROP.GRID_COLUMN_SPAN,rowSpan:e.PROP.GRID_ROW_SPAN,alignment:e.PROP.ALIGNMENT},f=i.hasOwnProperty;function N(e){var t,n,o,a,i;for(t=0;t<e.length;t++)o=e[t],n=I[o.property],(i=o.component._modelComponent.getProperty(n))&&(!0===o.newValue?a=i.getMetaData().yesValue:!1===o.newValue?a=i.getMetaData().noValue:"alignment"===o.property&&o.newValue?a=o.newValue.toUpperCase():"col"!==o.property&&"span"!==o.property&&"rowSpan"!==o.property||-1!==o.newValue?void 0!==o.newValue&&null!==o.newValue&&(a=""+o.newValue):a="",void 0!==a&&i.setValue(a))}function v(e){var t,n=null;return void 0===(t=e.newComponentIndex)&&(t=e.newIndex),t>0&&(n=e.newParentContainer.components[t-1]._modelComponent),n}function T(e){e.newParentContainer===e.prevParentContainer?e.newParentContainer=e.prevParentContainer=[e.newParentContainer._parent.id,e.newParentContainer.placeholder]:(e.newParentContainer&&(e.newParentContainer=[e.newParentContainer._parent.id,e.newParentContainer.placeholder]),e.prevParentContainer&&(e.prevParentContainer=[e.prevParentContainer._parent.id,e.prevParentContainer.placeholder])),delete e.component$,delete e.newComponent$,delete e.container$,delete e.prevContainer$}function L(){var e=U.gridlayout(_);return{hideLegacySlots:e.hideLegacySlots,hideEmptySlots:e.hideEmptySlots,hideButtons:e.hideButtons,hideItems:e.hideItems,displayFrom:e.displayFrom,hideGlobalComponents:w}}function G(e){var t=U.gridlayout(_);t.displayFrom!==e.displayFrom&&U.gridlayout(_,"displayFrom",e.displayFrom),["displayFrom","hideLegacySlots","hideEmptySlots","hideButtons","hideItems"].forEach((function(n){e[n]||t[n]===e[n]||U.gridlayout(_,n,e[n])})),e.hideGlobalComponents!==w&&(w=e.hideGlobalComponents,U.gridlayout("pageDataChanged"))}var D=!1,w=!0,M=null,S=!1,A=!1,b=!1,x=t.extend(apex.commandHistory.baseCommand(),{execute:function(){this.changes?this.updateDataLayer():(M=this,this.gl$.gridlayout("move",{},this.component$,this.container$,this.grid,this.row,this.column,this.index,this.alignment)),this.state=L()},updateDataLayer:function(t){var n,a,i,r,l=[];function s(e,t){l.push({id:e,value:t})}t&&(this.changes=t),t=this.changes,this._label=o.formatMessageNoEscape("PD.GLV.CMD.MOVE",this.changes.component.title),b=!0,this.transaction=e.transaction.start(E),i=t.component._modelComponent,t.newParentContainer!==t.prevParentContainer&&(a=(n=t.newParentContainer)._parent,t.component.type===c?a.type===u?(s(e.PROP.PARENT_REGION,""),s(e.PROP.SLOT_PLACEHOLDER,n.placeholder)):(s(e.PROP.PARENT_REGION,a.id),s(e.PROP.SLOT_PLACEHOLDER,n.placeholder)):(t.component.type===P||t.component.type===g)&&(a.type===u?(s(e.PROP.REGION,""),s(e.PROP.SLOT_PLACEHOLDER,n.placeholder)):(s(e.PROP.REGION,a.id),s(e.PROP.SLOT_PLACEHOLDER,n.placeholder)))),r=v(t),i.move({previousComponent:r,values:l}),N(t.propertyChanges),this.transaction.execute(),T(t)},undo:function(){var t,n=this.changes,o=n.prevGrid,a=n.prevRow,i=n.prevColumn,r=n.prevIndex;G(this.state),S=!0,n.prevGridRemoved?r=C.NEW_GRID:n.prevRowRemoved?r=C.NEW_ROW:n.prevColumnRemoved&&(r=C.NEW_COLUMN),n.newParentContainer===n.prevParentContainer&&(r>=0&&n.prevIndex>n.newIndex&&(r+=1),n.newGridInserted?n.newGrid<=n.prevGrid&&(o+=1):n.newRowInserted?n.newRow<=n.prevRow&&(a+=1):n.newColumnInserted&&n.newColumn<=n.prevColumn&&(i+=1)),b=!0,this.transaction.undo(),(t=U.gridlayout("findComponentById",n.component.id)).col=1*Z(t._modelComponent,e.PROP.GRID_COLUMN,-1),t.col>=0&&(t.forceColumn=!0),this.gl$.gridlayout("move",{},n.component.id,n.prevParentContainer,o,a,i,r,n.prevAlignment)},redo:function(){var e=this.changes,t=e.newIndex;G(this.state),S=!0,e.newGridInserted?t=C.NEW_GRID:e.newRowInserted?t=C.NEW_ROW:e.newColumnInserted?t=C.NEW_COLUMN:e.newParentContainer===e.prevParentContainer&&e.newIndex>e.prevIndex&&(t+=1),b=!0,this.transaction.redo(),this.gl$.gridlayout("move",{},e.component.id,e.newParentContainer,e.newGrid,e.newRow,e.newColumn,t,e.newAlignment)},label:function(){return this._label}});function W(e,t,n,o,a,i,r,l,s){var p=Object.create(x);return p.changes=t,p.gl$=e,p.component$=n,p.container$=o,p.grid=a,p.row=i,p.column=r,p.index=l,p.alignment=s,p._label="move",p}var V=t.extend(apex.commandHistory.baseCommand(),{execute:function(){this.changes?this.updateDataLayer():(M=this,this.gl$.gridlayout("copy",{},this.component$,this.container$,this.grid,this.row,this.column,this.index,this.alignment)),this.state=L()},updateDataLayer:function(t){var n,a,i,r,l=[];function s(e,t){l.push({id:e,value:t})}t&&(this.changes=t),t=this.changes,this._label=o.formatMessageNoEscape("PD.GLV.CMD.COPY",this.changes.originalComponent.title),b=!0,A=!0,this.transaction=e.transaction.start(E),i=t.component._modelComponent,i=t.component._modelComponent=i.duplicate(),t.component.id=i.id,t.component.title=i.getDisplayTitle(),U.gridlayout("update",t.component,!1),t.newParentContainer!==t.originalComponent._parent&&(a=(n=t.newParentContainer)._parent,t.component.type===c?a.type===u?(s(e.PROP.PARENT_REGION,""),s(e.PROP.SLOT_PLACEHOLDER,n.placeholder)):(s(e.PROP.PARENT_REGION,a.id),s(e.PROP.SLOT_PLACEHOLDER,n.placeholder)):(t.component.type===P||t.component.type===g)&&(a.type===u?(s(e.PROP.REGION,""),s(e.PROP.SLOT_PLACEHOLDER,n.placeholder)):(s(e.PROP.REGION,a.id),s(e.PROP.SLOT_PLACEHOLDER,n.placeholder)))),r=v(t),i.move({previousComponent:r,values:l}),N(t.propertyChanges),this.transaction.execute(),T(t)},undo:function(){var e=this.changes;G(this.state),S=!0,this.gl$.gridlayout("remove",{},[e.component.id]),this.transaction.undo()},redo:function(){var e=this.changes,t=e.newIndex;G(this.state),S=!0,e.newGridInserted?t=C.NEW_GRID:e.newRowInserted?t=C.NEW_ROW:e.newColumnInserted?t=C.NEW_COLUMN:e.newParentContainer===e.prevParentContainer&&e.newIndex>e.prevIndex&&(t+=1),b=!0,A=!0,this.gl$.gridlayout("add",{},e.component,e.newParentContainer,e.newGrid,e.newRow,e.newColumn,t,e.newAlignment,e.newComponent$),this.transaction.redo()},label:function(){return this._label}});function H(e,t,n,o,a,i,r,l,s){var p=Object.create(V);return p.changes=t,p.gl$=e,p.component$=n,p.container$=o,p.grid=a,p.row=i,p.column=r,p.index=l,p.alignment=s,p._label="copy",p}var Y=t.extend(apex.commandHistory.baseCommand(),{execute:function(){this.changes?this.updateDataLayer():(M=this,this.gl$.gridlayout("add",{},this.componentTypeId,this.container$,this.grid,this.row,this.column,this.index,this.alignment)),this.state=L()},updateDataLayer:function(t){var n,a,i,r,l,s,p,d,m=!1,O=[];function R(e,t){O.push({id:e,value:t})}for(t&&(this.changes=t),p=(t=this.changes).component._galleryComponent,this._label=o.formatMessageNoEscape("PD.GLV.CMD.CREATE",p.title),this.transaction=e.transaction.start(E),i=(a=t.newParentContainer)._parent,t.component.type===c?(s=e.COMP_TYPE.REGION,i.type===u?(R(e.PROP.PARENT_REGION,""),R(e.PROP.SLOT_PLACEHOLDER,a.placeholder)):(R(e.PROP.PARENT_REGION,i.id),R(e.PROP.SLOT_PLACEHOLDER,a.placeholder))):t.component.type===P?(s=e.COMP_TYPE.PAGE_ITEM,i.type===u?(R(e.PROP.REGION,""),R(e.PROP.SLOT_PLACEHOLDER,a.placeholder)):(R(e.PROP.REGION,i.id),R(e.PROP.SLOT_PLACEHOLDER,a.placeholder))):t.component.type===g&&(s=e.COMP_TYPE.BUTTON,i.type===u?(R(e.PROP.REGION,""),R(e.PROP.SLOT_PLACEHOLDER,a.placeholder)):(R(e.PROP.REGION,i.id),R(e.PROP.SLOT_PLACEHOLDER,a.placeholder))),d=v(t),n=0;n<p.values.length;n++)r=p.values[n],O.push(r),r.id===e.PROP.ITEM_TYPE&&"NATIVE_HIDDEN"===r.value&&(m=!0);b=!0,A=!0,l=new e.Component({previousComponent:d,typeId:s,values:O}),t.component._modelComponent=l,delete t.component._galleryComponent,m?(S=!0,U.gridlayout("remove",{},t.newComponent$),this.changes=null):(N(t.propertyChanges),t.component.id=l.id,t.component.title=l.getDisplayTitle(),U.gridlayout("update",t.component,!1)),this.transaction.execute(),T(t)},undo:function(){var e=this.changes;G(this.state),e&&(S=!0,this.gl$.gridlayout("remove",{},[e.component.id])),this.transaction.undo()},redo:function(){var e,t=this.changes;G(this.state),t&&(e=t.newIndex,S=!0,b=!0,A=!0,t.newGridInserted?e=C.NEW_GRID:t.newRowInserted?e=C.NEW_ROW:t.newColumnInserted?e=C.NEW_COLUMN:t.newParentContainer===t.prevParentContainer&&t.newIndex>t.prevIndex&&(e+=1),this.gl$.gridlayout("add",{},t.component,t.newParentContainer,t.newGrid,t.newRow,t.newColumn,e,t.newAlignment,t.newComponent$)),this.transaction.redo()},label:function(){return this._label}});function B(e,t,n,o,a,i,r,l,s){var p=Object.create(Y);return p.changes=t,p.gl$=e,p.componentTypeId=n,p.container$=o,p.grid=a,p.row=i,p.column=r,p.index=l,p.alignment=s,p._label="create",p}var U,$=t.extend(apex.commandHistory.baseCommand(),{execute:function(){M=this,this.gl$.gridlayout("remove",{}),this.state=L()},updateDataLayer:function(t){this.changes.push(t),this.transaction||(this.transaction=e.transaction.start(E)),t.component._modelComponent.remove(),T(t),t.lastChange&&this.transaction.execute()},undo:function(){var e,t,n,o=this.changes;for(G(this.state),e=o.length-1;e>=0;e--)t=o[e],S=!0,n=t.prevIndex,t.prevGridRemoved?n=C.NEW_GRID:t.prevRowRemoved?n=C.NEW_ROW:t.prevColumnRemoved&&(n=C.NEW_COLUMN),this.gl$.gridlayout("add",{},t.component,t.prevParentContainer,t.prevGrid,t.prevRow,t.prevColumn,n,t.prevAlignment,t.component$);this.transaction.undo()},redo:function(){var e,t=[],n=this.changes;for(G(this.state),S=!0,e=0;e<n.length;e++)t.push(n[e].component.id);this.gl$.gridlayout("remove",{},t),this.transaction.redo()},label:function(){return this._label}});function F(e,t){e.id="t0001",e._modelComponent=t._modelComponent}function K(e){return e.iconClass}function q(t){const n=window.componentGallery.getComponentData(t),o=n.type;let a={type:o,_galleryComponent:n,id:"t0002",title:n.title,iconClass:n.iconClass};if(o===c){let t,o,i;for(let r=0;r<n.values.length;r++){const l=n.values[r];if(l.id===e.PROP.REGION_TEMPLATE)i=l.value;else if(l.id===e.PROP.REGION_TYPE&&(t=l.value,a.regionType=t,t.startsWith("TMPL"))){const n=e.getRegionPlugin(t).templateTypes;o=n.includes("REPORT")?"REPORT":n.includes("PARTIAL")?"PARTIAL":"REGION_ONLY"}}a.slots=[];Q(e.getSlots({regionType:t,templateComponentType:o,regionTemplateId:i}),a.slots,null,t);for(const e of a.slots)e.components=[]}if(o===P)for(let t=0;t<n.values.length;t++){const o=n.values[t];o.id===e.PROP.ITEM_TYPE&&(a.itemType=o.value)}return a}function k(e,t,n){var o,a=n,i=e.getProperty(t);return i&&(o=i.getMetaData().yesValue,a=i.getValue()===o),a}function Z(e,t,n){var o=n,a=e.getProperty(t);return a&&(null!==(o=a.getValue())&&""!==o||!n||(o=n)),o}function j(t){var n=t.parentId||t.pageId;return t.typeId===e.COMP_TYPE.REGION&&(n=Z(t,e.PROP.PARENT_REGION,n)),n}function Q(t,n,o,a){let i,r=0;for(const l of t){const t=l.name;"RIGHT_OF_IR_SEARCH_BAR"===l.placeholder&&(a&&"NATIVE_IR"!==a||o&&"NATIVE_IR"!==e.getComponents(e.COMP_TYPE.REGION,{id:o})[0].getProperty(e.PROP.REGION_TYPE).getValue()||!o&&!a)||(i={placeholder:l.placeholder,hasRegionSupport:l.hasRegionSupport,hasItemSupport:l.hasItemSupport,hasButtonSupport:l.hasButtonSupport,supportedRegionTypes:l.supportedRegionTypes,supportedItemTypes:l.supportedItemTypes,title:t,isGrid:l.hasGridSupport,hasSubRegionTemplate:l.hasSubRegionTemplate,isLegacy:l.isLegacy,isDeprecated:l.isDeprecated,type:o?"region":"page"},o||a||(f(l,"glvSpan")||!1===l.glvNewRow?(i.span=l.glvSpan,i.newColumn=!l.glvNewRow,!i.newColumn&&i.span>r&&(i.newRow=!0),r=i.span):i.newRow=!0),i.hasButtonSupport&&l.hasAlignment&&(i.hasAlignment=!0),n.push(i))}}function z(t,n){const{regionType:o,templateComponentType:a}=n,i=e.getSlots({regionType:o,templateComponentType:a,regionTemplateId:t});return n.slots=[],Q(i,n.slots,n.id),n}function X(t,n){let o={};if(w&&(o.excludeGlobalPage=!0),t.components=[],t.hasRegionSupport){o.properties=[{id:e.PROP.SLOT_PLACEHOLDER,value:t.placeholder},{id:e.PROP.PARENT_REGION,value:n||""}];const i=e.getComponents(e.COMP_TYPE.REGION,o);for(let n=0;n<i.length;n++){const o=i[n];if(!a.isDisplayed(o))continue;let r={};const l=Z(o,e.PROP.REGION_TEMPLATE),s=Z(o,e.PROP.REGION_TYPE),p=e.getTemplateComponentType(o);r=z(l,{type:c,regionType:s,templateComponentType:p,id:o.id,seq:o.seq,title:o.getDisplayTitle(),iconClass:a.getComponentIconClass(c,s,p),newGrid:k(o,e.PROP.GRID_NEW_GRID,!1),newRow:k(o,e.PROP.GRID_NEW_ROW,!1),col:1*Z(o,e.PROP.GRID_COLUMN,-1),newCol:k(o,e.PROP.GRID_NEW_COLUMN,!0),span:1*Z(o,e.PROP.GRID_COLUMN_SPAN,-1),hasErrors:o.hasErrors(),hasWarnings:o.hasWarnings(),isReadOnly:o.isReadOnly(),itemsAboveContent:"ABOVE"===Z(o,e.PROP.ITEM_DISPLAY_POSITION,"ABOVE"),_modelComponent:o}),a.isConditional(o)&&(r.isConditional=!0);for(const e of r.slots)e.components=X(e,r.id);t.components.push(r)}}if(t.hasItemSupport){o.properties=[{id:e.PROP.SLOT_PLACEHOLDER,value:t.placeholder},{id:e.PROP.REGION,value:n||""}];const i=e.getComponents(e.COMP_TYPE.PAGE_ITEM,o);for(let n=0;n<i.length;n++){const o=i[n];let r=Z(o,e.PROP.ITEM_TYPE);if("NATIVE_HIDDEN"===r)continue;let l={type:P,id:o.id,seq:o.seq,title:o.getDisplayTitle(),itemType:r,iconClass:a.getComponentIconClass(P,Z(o,e.PROP.ITEM_TYPE)),newGrid:k(o,e.PROP.GRID_NEW_GRID,!1),newRow:k(o,e.PROP.GRID_NEW_ROW,!1),col:1*Z(o,e.PROP.GRID_COLUMN,-1),newCol:k(o,e.PROP.GRID_NEW_COLUMN,!0),span:1*Z(o,e.PROP.GRID_COLUMN_SPAN,-1),hasErrors:o.hasErrors(),hasWarnings:o.hasWarnings(),isReadOnly:o.isReadOnly(),_modelComponent:o},s=1*Z(o,e.PROP.GRID_ROW_SPAN,-1);s>0&&(l.rowSpan=s),a.isConditional(o)&&(l.isConditional=!0),t.components.push(l)}}if(t.hasButtonSupport){o.properties=[{id:e.PROP.SLOT_PLACEHOLDER,value:t.placeholder},{id:e.PROP.REGION,value:n||""}];const i=e.getComponents(e.COMP_TYPE.BUTTON,o);for(let n=0;n<i.length;n++){const o=i[n];let r=Z(o,e.PROP.ALIGNMENT,null),l=k(o,e.PROP.BUTTON_IS_HOT,!1),s={type:g,id:o.id,seq:o.seq,title:o.getDisplayTitle(),iconClass:a.getComponentIconClass(g,l?"hot":"normal"),newGrid:k(o,e.PROP.GRID_NEW_GRID,!1),newRow:k(o,e.PROP.GRID_NEW_ROW,!1),col:1*Z(o,e.PROP.GRID_COLUMN,-1),newCol:k(o,e.PROP.GRID_NEW_COLUMN,!0),span:1*Z(o,e.PROP.GRID_COLUMN_SPAN,-1),hasErrors:o.hasErrors(),hasWarnings:o.hasWarnings(),isReadOnly:o.isReadOnly(),_modelComponent:o};r&&(s.alignment=r.toLowerCase());let p=1*Z(o,e.PROP.GRID_ROW_SPAN,-1);p>0&&(s.rowSpan=p),a.isConditional(o)&&(s.isConditional=!0),t.components.push(s)}}return t.components.sort((function(e,t){return e.seq===t.seq?String(e.id).padStart(36,"0")>String(t.id).padStart(36,"0")?1:-1:e.seq-t.seq})),t.components}function J(){return{type:u,iconClass:"icon-warning",gridType:"fixed",maxColumns:12,hasColumnSpan:!0,hasRowSpan:!1,alwaysUseMax:!1,title:o.getMessage("PD.GLV.EMPTY_GRID"),slots:[]}}function ee(){if(!D)return J();const t=e.getComponents(e.COMP_TYPE.PAGE);if(1!==t.length)return J();const n=t[0];let o=e.getPageTemplate();if(!o)return J();let a=(i=o,r={type:u,id:n.id,iconClass:"icon-page",title:n.getDisplayTitle(),hasErrors:n.hasErrors(),hasWarnings:n.hasWarnings(),isReadOnly:e.isPageReadOnly(),_modelComponent:n},l=i.grid,r.gridType=l.type.toLowerCase(),r.maxColumns=l.maxColumns,r.hasColumnSpan=l.hasColumnSpan,void 0!==l.hasRowSpan&&(r.hasRowSpan=l.hasRowSpan),r.alwaysUseMaxColumns=l.alwaysUseMaxColumns,r.slots=[],Q(i.slots,r.slots),r);var i,r,l;for(const e of a.slots)e.components=X(e);return a}function te(e){for(const t of e.slots)t.components=X(t,e.id)}t((function(){var i=[e.COMP_TYPE.PAGE,e.COMP_TYPE.REGION,e.COMP_TYPE.PAGE_ITEM,e.COMP_TYPE.BUTTON],I=t("#glvMenu"),N=null;function v(e){var t,n=!0;for(t=0;t<e.length;t++)if(e[t].isReadOnly){n=!1;break}return n}function T(){var e,t=U.gridlayout("getSelection").filter(s),n=U.gridlayout("getSelectedComponents"),a=v(n);0!==t.length&&a&&U.gridlayout(_,"displayFrom")!==n[0].id&&(e=function(e,t){var n=Object.create($);return n.changes=[],n.gl$=e,n.transaction=null,t.length>1?n._label=o.formatMessageNoEscape("PD.GLV.CMD.DEL_N",t.length):n._label=o.formatMessageNoEscape("PD.GLV.CMD.DEL",U.gridlayout("getComponents",t)[0].title),n}(U,t),apex.commandHistory.execute(e))}function L(){var e,t=null,n=null,o=null,a=U.gridlayout("getSelection");1===a.length&&(this.col>=0&&(t=0,n=this.row,o=this.col),e=this.copy?H(U,null,a,this.container,t,n,o,this.index,this.alignment):W(U,null,a,this.container,t,n,o,this.index,this.alignment),apex.commandHistory.execute(e))}U=t(d);var G=[{l:"Before",i:null,a:0},{l:"After",i:null,a:1},{l:"Row before",i:C.NEW_ROW,a:0},{l:"Row after",i:C.NEW_ROW,a:1},{l:"Column before",i:C.NEW_COLUMN,a:0},{l:"Column after",i:C.NEW_COLUMN,a:1}],x=[{l:"Before",i:null,a:0},{l:"After",i:null,a:1}];function V(e,t,n){var o,a,i,r,l,s,p,d,u=null,c=[];function P(e){var o,a,i,r,s=[];for(i="grid"===d?G:x,o=0;o<i.length;o++)r={label:(a=i[o]).l,type:"action",action:t,container:l.element,index:a.i?a.i:e.index+a.a},"grid"===d?(a.i===C.NEW_ROW?r.row=e.row+a.a:r.row=e.row,a.i===C.NEW_COLUMN?r.col=e.col+a.a:r.col=e.col):e.alignment&&(r.alignment=e.alignment),n&&(r.copy=!0),s.push(r);return s}for(e.length>0&&e[0].element.hasClass("a-GridLayout-buttonContainer")&&(u={}),o=0;o<e.length;o++){if(l=e[o],u&&u.label!==l.region&&(u.label&&c.push(u),u={label:l.region,type:"subMenu",menu:{items:[]}}),i={label:u?l.name:l.label},d=l.type,0===l.items.length)i.type="action",i.action=t,i.container=l.element,i.index=0,"grid"===d?(i.row=0,i.col=0):l.alignment&&(i.alignment=l.alignment),n&&(i.copy=!0);else for(i.type="subMenu",i.menu={items:[]},s=i.menu.items,a=0;a<l.items.length;a++)p={label:(r=l.items[a]).name,type:"subMenu",menu:{items:P(r)}},s.push(p);u?u.menu.items.push(i):c.push(i)}return u&&c.push(u),c}function Y(e){e=e||U.gridlayout("getSelectedComponents"),apex.actions.lookup("glv-disp-from-region").disabled=!(e.length>=1&&e[0].type===c&&e[0].id!==U.gridlayout(_,"displayFrom")),apex.actions.update("glv-disp-from-region"),apex.actions.lookup("glv-disp-from-page").disabled=null===U.gridlayout(_,"displayFrom"),apex.actions.update("glv-disp-from-page")}a.glvMakeTargetMenu=V,a.glvMenuAddAction=function(e){var t,n=null,o=null,a=null;this.col>=0&&(n=0,o=this.row,a=this.col),t=B(U,null,e,this.container,n,o,a,this.index,this.alignment),apex.commandHistory.execute(t)},apex.actions.add([{name:"glv-disp-from-page",label:o.getMessage("PD.GLV.MI.DISP_PAGE"),shortcut:"Ctrl+Alt+T",disabled:!0,action:function(){U.gridlayout(_,"displayFrom",null),Y()}},{name:"glv-disp-from-region",label:o.getMessage("PD.GLV.MI.DISP_REGION"),shortcut:"Ctrl+Alt+D",disabled:!0,action:function(){var e=U.gridlayout("getSelectedComponents");e.length>=1&&e[0].type===c&&U.gridlayout(_,"displayFrom",e[0].id),this.disabled=!0,apex.actions.update(this.name),apex.actions.lookup("glv-disp-from-page").disabled=!1,apex.actions.update("glv-disp-from-page")}},{name:"glv-hide-empty",label:o.getMessage("PD.GLV.MI.HIDE_EMPTY"),shortcut:"Ctrl+Alt+E",get:function(){return U.gridlayout(_,"hideEmptySlots")},set:function(e){U.gridlayout(_,"hideEmptySlots",e),a.saveBoolPref(R,e)}}]);var Q={menubar:!1,items:[{id:"dispRoot",type:"action",action:"glv-disp-from-page"},{id:"dispHere",type:"action",action:"glv-disp-from-region"},{type:"toggle",action:"pd-expand-restore"},{type:"separator"},{id:"newgrid",type:"action",labelKey:"PD.GLV.MI.NEW_GRID",hide:!0},{id:"delete",type:"action",labelKey:"PD.DEL",accelerator:"Del",disabled:function(){var e=U.gridlayout("getSelectedComponents"),t=v(e);return e.length<1||1===e.length&&e[0].type===u||!t||U.gridlayout(_,"displayFrom")===e[0].id},action:function(){T()}},{id:"moveTo",type:"subMenu",disabled:!0,labelKey:"PD.MI.MOVE2",menu:{items:[]}},{id:"copyTo",type:"subMenu",disabled:!0,labelKey:"PD.MI.COPY2",menu:{items:[]}},{type:"separator"},{id:"hideConditional",type:"subMenu",disabled:!0,labelKey:"PD.GLV.MI.HIDE_COND_COMP",hide:!0,menu:{items:[]}},{type:"toggle",labelKey:"PD.GLV.MI.HIDE_LEGACY",get:function(){return U.gridlayout(_,"hideLegacySlots")},set:function(e){U.gridlayout(_,"hideLegacySlots",e),a.saveBoolPref(m,e)}},{type:"toggle",action:"glv-hide-empty"},{type:"toggle",labelKey:"PD.GLV.MI.HIDE_GLOBAL",disabled:function(){var t=U.gridlayout(_,"displayFrom"),n=!!t&&U.gridlayout("findComponentById",t)._modelComponent.isOnGlobalPage();return!D||e.isGlobalPage()||n},get:function(){return w},set:function(e){w=e,U.gridlayout("pageDataChanged"),a.saveBoolPref(O,e)}},{type:"toggle",labelKey:"PD.GLV.MI.HIDE_BTNS",get:function(){return U.gridlayout(_,"hideButtons")},set:function(e){U.gridlayout(_,"hideButtons",e),a.saveBoolPref(h,e)}},{type:"toggle",labelKey:"PD.GLV.MI.HIDE_ITEMS",get:function(){return U.gridlayout(_,"hideItems")},set:function(e){U.gridlayout(_,"hideItems",e),a.saveBoolPref(y,e)}},{type:"subMenu",hide:!0,labelKey:"PD.GLV.MI.ZOOM",menu:{items:[{type:"radioGroup",set:function(e){U.gridlayout(_,"zoom",e)},get:function(){return U.gridlayout(_,"zoom")+""},choices:[{labelKey:o.formatMessage("PD.GLV.MI.ZOOM_N","50"),value:"50"},{labelKey:o.formatMessage("PD.GLV.MI.ZOOM_N","75"),value:"75"},{labelKey:o.formatMessage("PD.GLV.MI.ZOOM_N","100"),value:"100"},{labelKey:o.formatMessage("PD.GLV.MI.ZOOM_N","120"),value:"125"},{labelKey:o.formatMessage("PD.GLV.MI.ZOOM_N","150"),value:"150"},{labelKey:o.formatMessage("PD.GLV.MI.ZOOM_N","170"),value:"175"},{labelKey:o.formatMessage("PD.GLV.MI.ZOOM_N","200"),value:"200"}]}]}}],beforeOpen:function(){var e,t=I.menu("find","moveTo"),n=I.menu("find","copyTo"),o=U.gridlayout("getSelection").filter(s);t.menu.items=[],n.menu.items=[],1===o.length&&(e=o.eq(0),U.gridlayout("getComponents",e)[0].isReadOnly||(t.menu.items=V(U.gridlayout("getDropTargets",e),L),n.menu.items=V(U.gridlayout("getDropTargets",e,"copy"),L,!0))),t.disabled=0===t.menu.items.length,n.disabled=0===n.menu.items.length},afterClose:function(e,t){t.actionTookFocus||U.gridlayout("focus")}};function z(e){var n,o,a,i,r,l="";for(t.isArray(e)||(e=[e]),n=0;n<e.length;n++){for(a in l+="["+(r=e[n]).component.id+": ",r.properties)if(Object.prototype.hasOwnProperty.call(r.properties,a)){for(l+=a+":",i=r.properties[a],o=0;o<i.length;o++)l+=i[o]+",";l=l.substring(0,l.length-1)+";"}l+="] "}return l}I.menu(Q),w=a.getBoolPref(O,!0),U.gridlayout({getPageRoot:ee,hideLegacySlots:a.getBoolPref(m,!0),hideEmptySlots:a.getBoolPref(R,!1),hideButtons:a.getBoolPref(h,!1),hideItems:a.getBoolPref(y,!1),getIconForComponent:K,makeComponent:q,updateComponentCopy:F,deleteKeyAction:function(e){T()},contextMenuAction:function(e){var n,o;"contextmenu"===e.type?I.menu("toggle",e.pageX,e.pageY):(n=(o=t(e.target)).offset(),I.menu("toggle",n.left,n.top+o.find("h3").height()))},stateClassMap:{hasErrors:r,hasWarnings:l},stateIconMap:{hasErrors:"icon-error",hasWarnings:"icon-warning"},appendTo:"parent",cursor:"default",cursorAt:{left:2,top:2},containment:"document",multiple:!0,animate:!1,delay:10,distance:5,opacity:.9,scroll:!0,scrollSensitivity:30,iconType:"a-Icon",selectionChange:function(){var e,o,a,i=[];for(o=t(this).gridlayout("getSelectedComponents"),e=0;e<o.length;e++)(a=o[e]._modelComponent)?i.push(a):n.log("No component found for selection "+o[e].id);Y(o),t(document).trigger("selectionChanged",[E,i])},added:function(e,t){var n;S?S=!1:M?(M.updateDataLayer(t),M=null):(n=B(U,t),apex.commandHistory.execute(n))},removed:function(e,t){S?S=!1:M&&(M.updateDataLayer(t),t.lastChange&&(M=null))},moved:function(e,t){var n;S?S=!1:M?(M.updateDataLayer(t),M=null):(n=W(U,t),apex.commandHistory.execute(n))},copied:function(e,t){var n;S?S=!1:M?(M.updateDataLayer(t),M=null):(n=H(U,t),apex.commandHistory.execute(n))},start:function(){apex.tooltipManager.disableTooltips()},stop:function(){apex.tooltipManager.enableTooltips()}}).tooltip({items:".a-GridLayout-page > h3, .a-GridLayout-pageItem > h3, .a-GridLayout-region > h3, .a-GridLayout-button > h3",show:apex.tooltipManager.defaultShowOption(),content:function(){var e=U.gridlayout("getComponents",t(this).parent())[0];return e.note?e.note:e._modelComponent?a.tooltipContentForComponent(e._modelComponent):void 0}}).on("focusin",(function(e){var n,o=t(e.target).closest(p);0!==o.length&&(U.tooltip(_,"disabled")||((n=t.Event(e)).target=n.currentTarget=o.children("h3")[0],U.tooltip("open",n)))})).on("focusout",(function(e){var n,o=t(e.target).closest(p);0!==o.length&&(U.tooltip(_,"disabled")||((n=t.Event(e)).target=n.currentTarget=o.children("h3")[0],U.tooltip("close",n)))})).on("keyup",(function(e){var n,o;if(e.keyCode===t.ui.keyCode.ESCAPE){if(0===(o=t(e.target).closest(p)).length)return;U.tooltip(_,"disabled")||((n=t.Event(e)).currentTarget=o.children("h3")[0],U.tooltip("close",n))}})),t(document).on("selectionChanged",(function(t,n,o){var a,i,r=[];if(n!==E){for(a=0;a<o.length;a++)(i=o[a]).typeId!==e.COMP_TYPE.PAGE&&i.typeId!==e.COMP_TYPE.REGION&&i.typeId!==e.COMP_TYPE.PAGE_ITEM&&i.typeId!==e.COMP_TYPE.BUTTON||r.push(i.id);U.is(":visible")?(U.gridlayout("setSelectedComponents",r),Y()):N=r}})),t("#editor_tabs").on("tabsactivate",(function(e,t){"grid_layout"===t.newPanel[0].id&&N&&(U.gridlayout("setSelectedComponents",N),Y(),N=null)})),e.observer(E,{component:{typeIds:i},events:[e.EVENT.DISPLAY_TITLE]},(function(e){var t=U.gridlayout("findComponentById",e.component.id);n.getLevel()>=n.LOG_LEVEL.APP_TRACE&&n.trace("GLV Handle display title change: "+z(e)),t&&(t.title=e.component.getDisplayTitle(),U.gridlayout("update",t,!1))})),e.observer(E,{component:{typeIds:i},events:[e.EVENT.CHANGE],properties:[e.PROP.CONDITION_TYPE,e.PROP.AUTHORIZATION_SCHEME,e.PROP.BUILD_OPTION,e.PROP.GRID_NEW_GRID,e.PROP.GRID_NEW_ROW,e.PROP.GRID_NEW_COLUMN,e.PROP.GRID_COLUMN,e.PROP.GRID_COLUMN_SPAN,e.PROP.GRID_ROW_SPAN,e.PROP.ALIGNMENT,e.PROP.ITEM_DISPLAY_POSITION,e.PROP.ITEM_TYPE,e.PROP.REGION_TYPE,e.PROP.BUTTON_IS_HOT,e.PROP.DISPLAY_SEQUENCE,e.PROP.REGION,e.PROP.PARENT_REGION,e.PROP.SLOT_PLACEHOLDER]},(function(o){var i,r,l,s,p,d,u,m={},O={},R={};function h(e){var n=p.properties[e];return n&&t.inArray("change",n)>=0}function y(e){return p.component.getProperty(e).getValue()}function E(e){var t=p.component.getProperty(e),n=t.getMetaData().yesValue;return t.getValue()===n}function _(e,t){for(var n=t._parent?t._parent._parent:null;n;){if(e[n.id])return!0;n=n._parent?n._parent._parent:null}return!1}if(b)b=!1;else{for(n.getLevel()>=n.LOG_LEVEL.APP_TRACE&&n.trace("GLV Handle property changes: "+z(o)),i=0;i<o.length;i++)r=(p=o[i]).component.id,l=j(p.component),d=U.gridlayout("findComponentById",r),u=U.gridlayout("findComponentById",l),!d&&u&&(R[l]=u),d&&(h(e.PROP.ITEM_TYPE)&&d.type===P&&("NATIVE_HIDDEN"===(s=y(e.PROP.ITEM_TYPE))?R[l]=u:(d.iconClass=a.getComponentIconClass(P,Z(p.component,e.PROP.ITEM_TYPE)),d.itemType=s,m[r]=d)),(h(e.PROP.CONDITION_TYPE)||h(e.PROP.AUTHORIZATION_SCHEME)||h(e.PROP.BUILD_OPTION))&&(a.isConditional(p.component)?d.isConditional=!0:delete d.isConditional,m[r]=d),h(e.PROP.REGION_TYPE)&&d.type===c&&(d.iconClass=a.getComponentIconClass(c,Z(p.component,e.PROP.REGION_TYPE)),d.regionType=y(e.PROP.REGION_TYPE),m[r]=d),h(e.PROP.BUTTON_IS_HOT)&&d.type===g&&(d.iconClass=a.getComponentIconClass(g,k(p.component,e.PROP.BUTTON_IS_HOT,!1)?"hot":"normal"),m[r]=d),h(e.PROP.GRID_NEW_GRID)&&(d.newGrid=E(e.PROP.GRID_NEW_GRID),O[l]=d),h(e.PROP.GRID_NEW_ROW)&&(d.newRow=E(e.PROP.GRID_NEW_ROW),O[l]=d),h(e.PROP.GRID_NEW_COLUMN)&&(d.newCol=E(e.PROP.GRID_NEW_COLUMN),O[l]=d),h(e.PROP.GRID_COLUMN)&&(d.col=1*y(e.PROP.GRID_COLUMN),O[l]=d),h(e.PROP.GRID_COLUMN_SPAN)&&(d.span=1*y(e.PROP.GRID_COLUMN_SPAN),O[l]=d),h(e.PROP.GRID_ROW_SPAN)&&(d.rowSpan=1*y(e.PROP.GRID_ROW_SPAN),O[l]=d),h(e.PROP.ITEM_DISPLAY_POSITION)&&(d.itemsAboveContent="ABOVE"===y(e.PROP.ITEM_DISPLAY_POSITION),O[l]=d),(h(e.PROP.ALIGNMENT)||h(e.PROP.REGION)||h(e.PROP.PARENT_REGION)||h(e.PROP.SLOT_PLACEHOLDER)||h(e.PROP.DISPLAY_SEQUENCE))&&(d&&d._parent&&d._parent._parent&&d._parent._parent.id!==l&&(R[d._parent._parent.id]=d._parent._parent),R[l]=u));for(r in m)f(m,r)&&(O[(d=m[r]).id]||R[d.id]||_(O,d)||_(R,d)||U.gridlayout("update",d,!1));for(r in O)f(O,r)&&(R[(d=O[r]).id]||_(R,d)||U.gridlayout("update",d,!0));for(r in R)f(R,r)&&(u=R[r])&&!_(R,u)&&("page"===u.type?U.gridlayout("pageDataChanged"):(te(u),U.gridlayout("update",u,!0,!0)))}}),!0),e.observer(E,{events:[e.EVENT.GRID]},(function(e){var t,o;if(n.getLevel()>=n.LOG_LEVEL.APP_TRACE&&n.trace("GLV Handle grid changes - refresh whole page: "+z(e)),!U.is(":visible"))for(N=[],o=U.gridlayout("getSelectedComponents"),t=0;t<o.length;t++)N.push(o[t].id);U.gridlayout("pageDataChanged")}),!0),e.observer(E,{component:{typeIds:i},events:[e.EVENT.CREATE]},(function(e){var t;A?A=!1:(n.getLevel()>=n.LOG_LEVEL.APP_TRACE&&n.trace("GLV Handle create: "+z(e)),(t=U.gridlayout("findComponentById",j(e.component)))&&("page"===t.type?U.gridlayout("pageDataChanged"):(te(t),U.gridlayout("update",t,!0,!0))))})),e.observer(E,{component:{typeIds:i},events:[e.EVENT.DELETE]},(function(e){var t,o=e.component.id;M||(n.getLevel()>=n.LOG_LEVEL.APP_TRACE&&n.trace("GLV Handle delete: "+z(e)),(t=U.gridlayout("findById",o)).length&&(S=!0,U.gridlayout("remove",{},t)))})),e.observer(E,{component:{typeIds:i},events:[e.EVENT.ERRORS,e.EVENT.NO_ERRORS,e.EVENT.WARNINGS,e.EVENT.NO_WARNINGS]},(function(e){var t=U.gridlayout("findComponentById",e.component.id);n.getLevel()>=n.LOG_LEVEL.APP_TRACE&&n.trace("GLV Handle error or warning status change: "+z(e)),t&&(t.hasErrors=e.component.hasErrors(),t.hasWarnings=e.component.hasWarnings(),U.gridlayout("update",t,!1))}))})),t(document).on("modelReady",(function(){if(D=!0,t(d).length)try{U.gridlayout("pageDataChanged")}catch(e){n.error("Failed to load grid layout",e),D=!1,U.gridlayout("pageDataChanged")}})),t(document).on("modelCleared",(function(){D=!1,t(d).length&&U.gridlayout("pageDataChanged")}))}(window.pe,apex.jQuery,apex.debug,apex.lang,window.pageDesigner,apex.util);