/*!
 * Copyright (c) 2023, Oracle and/or its affiliates.
 */
!function(e,t,r,a,n,o,i,s,l){"use strict";r.clientSideTemplator=function(c){const u="ClientSideTemplator",p="SERVER",f="CLIENT",d="POST",g="SCROLL",h="apexclientsidetemplatorresponse",m="apexclientsidetemplatorajaxerror";let I,S,y={regionId:"",regionStaticId:"",source:{type:f,ajaxIdentifier:"",itemsToSubmit:[],restEndpointURLs:[""],httpMethod:"GET",requestData:{},requestHeaders:{},arraySelector:""},beforeTemplate:"",recordTemplate:"",afterTemplate:"",pagination:g,rowsPerPage:20,noDataMessage:a.getMessage("APEX.IG.NO_DATA_FOUND"),enableCache:!1,searchItem:"",showErrors:!0},T=l.extend(y,c),E=l("#"+e.escapeCSS(T.regionStaticId),apex.gPageContext$),R=u+"_"+T.regionId,x=u.toUpperCase()+"_"+T.regionId.toUpperCase(),D={},O="",w=T.source;function j(e){return e instanceof Function}function C(e){return e instanceof Object}function P(){let t,r,a=l.Deferred(),o=w.httpMethod===d?w.requestData:null,i=w.httpMethod===d?w.requestHeaders:{},s=w.restEndpointURLs||[],c={},u=T.regionStaticId+"_fetch_data";function g(e,t){return C(e)&&C(t)?(Object.keys(t).forEach((r=>{const a=e[r],n=t[r];Array.isArray(a)&&Array.isArray(n)?e[r]=a.concat(n):C(a)&&C(n)?e[r]=g(Object.assign({},a),n):e[r]=n})),e):t}return w.type===p?n.plugin(w.ajaxIdentifier,{pageItems:w.itemsToSubmit},{refreshObject:E,loadingIndicator:E}).done((function(e){a.resolve(e)})).fail((function(e,t,r){a.reject({type:p,jqxhr:e,textStatus:t,errorThrown:r})})):w.type===f&&async function(){async function a(e){const r=await Promise.all([await fetch(e,{method:w.httpMethod,mode:"cors",credentials:"omit",cache:"no-store",redirect:"follow",referrerPolicy:"no-referrer",body:o,headers:i}).then((r=>{if(r.ok)return r.json();t={type:f,url:e,jqxhr:null,textStatus:r.status,errorThrown:r.statusText}})).catch((()=>{t={type:f,url:e,jqxhr:null,textStatus:"failed",errorThrown:"Connection refused"}}))]);return t?Promise.reject(t):Promise.resolve(r)}if(T.enableCache){let e=S;if(e)return Promise.resolve(e)}e.delayLinger.start(u,(function(){r=e.showSpinner(E)}));for(let e=0;e<s.length;e++){let[t]=await a(s[e])||{};g(c,t)}var n;return e.delayLinger.finish(u,(function(){r.remove()})),T.enableCache&&(n=c,S=JSON.parse(JSON.stringify(n))),Promise.resolve(c)}().then((e=>a.resolve(e))).catch((e=>a.reject(e))),a.promise()}function _(){let e=l.Deferred();return P().done((function(t){let r=A(t),a=[];s.info(u+" request success",r),E.trigger(h,r),a=L(r),e.resolve(function(e){let t=e||{},r={regions:[{id:T.regionId,ajaxIdentifier:T.ajaxIdentifier,fetchedData:t}]};return r}(a))})).fail((function(t){s.error(u+" request failed",t),b(t),e.reject(t)})),e.promise()}function b(e){let t=e||{},r="";E.trigger(m,e),t.type===f&&(r=t.errorThrown||t.textStatus,r&&"error"!==r||(r=a.hasMessage("REGION.CLIENTSIDETEMPLATOR.ERROR")?a.getMessage("REGION.CLIENTSIDETEMPLATOR.ERROR"):"Web Service Request failed."),T.showErrors&&(i.clearErrors(),i.showErrors({message:r,location:"page"})))}function q(e){let t,r={},a=Object.keys(e||{});if(e&&a.length>0)for(let e=0;e<a.length;e++)t=a[e].toUpperCase(),r[t]={},r[t].index=e;else r.APEX_MODEL_ROW_ID={index:0};return r}function A(e){let t=[];if(e){if(t=w.type===f&&w.arraySelector&&e[w.arraySelector]?e[w.arraySelector]:e,!Array.isArray(t))return[];for(let e=0;e<t.length;e++)T.prepareRowData&&j(T.prepareRowData)&&(t[e]=T.prepareRowData(t[e])),t[e]=Object.assign({apex_model_row_id:"id"+e},t[e]);T.filterData&&j(T.filterData)&&(t=T.filterData(t)),T.sortData&&j(T.sortData)&&(t=t.sort(T.sortData))}return t}function L(e){let t=[],r={values:[],firstRow:1,moreData:!1,totalRows:0};if(e&&Array.isArray(e)){for(let r=0;r<e.length;r++){let a=[];Object.values(e[r]).forEach((e=>{a.push((e||"").toString())})),t.push(a)}w.type===f&&T.searchItem&&O.length>0&&(t=T.searchItemFilter&&j(T.searchItemFilter)?T.searchItemFilter(t,q(e[0]),O):t.filter((function(e){return e[1].toLowerCase().includes(O.toLowerCase())||e[2].toLowerCase().includes(O.toLowerCase())}))),r.values=t,r.totalRows=t.length}return r}function M(e,t){let r,a,n="";if(e){r=Object.keys(e),n="{with/}\n",n+="REGION_ID:="+T.regionId+"\n",n+="REGION_STATIC_ID:="+T.regionStaticId+"\n";for(let e=0;e<r.length;e++)a=r[e].toUpperCase(),n+=a+":=&"+a+".\n"}return n+="{apply "+t+"/}",n}function v(t){let r=[];t&&Array.isArray(t)&&(r=function(e){let t,r,a=[];if(e){t=Object.keys(e);for(let e=0;e<t.length;e++)r=t[e].toUpperCase(),a.push({name:r,required:!1,default:"",escape:"HTML"})}return a}(t[0])),e.defineTemplates([{name:x+"_BEFORE",template:T.beforeTemplate,args:r},{name:x+"_RECORD",template:T.recordTemplate,args:r},{name:x+"_AFTER",template:T.afterTemplate,args:r}])}w.httpMethod===d&&(w.requestData&&!C(w.requestData)&&(w.requestData=JSON.parse(w.requestData)),w.requestHeaders&&!C(w.requestHeaders)&&(w.requestHeaders=JSON.parse(w.requestHeaders))),T.searchItem&&(O=o(T.searchItem).getValue()),s.info(u+" options: ",T),P().done((function(e){let t=A(e),a=L(t);s.info(u+" request success",t),E.trigger(h,t),v(t),D={regionType:u,regionId:T.regionId,regionStaticId:T.regionStaticId,ajaxIdentifier:T.ajaxIdentifier,itemsToSubmit:T.itemsToSubmit,lazyLoading:!1,beforeTemplate:M(t[0],x+"_BEFORE"),afterTemplate:M(t[0],x+"_AFTER"),recordTemplate:M(t[0],x+"_RECORD"),modelName:R,columns:[q(t[0])],modelOptions:{hasTotalRecords:!0,paginationType:"none",pageSize:1e3,identityField:"APEX_MODEL_ROW_ID",callServer:function(){return _()}},pagination:{},rowsPerPage:T.rowsPerPage,noDataMessage:T.noDataMessage},T.pagination===g&&(D.pagination.scroll=!0,D.pagination.virtual=!0,D.footer=!1),"PAGE"===T.pagination&&(D.pagination.hideSinglePage=!0,t.length<=T.rowsPerPage&&(D.footer=!1)),r.templateReportRegionInit(D,a)})).fail((function(e){s.error(u+" request failed",e),b(e)})),T.searchItem&&(I=l("#"+e.escapeCSS(T.searchItem),apex.gPageContext$),I.on("input",e.debounce((function(){O=o(T.searchItem).getValue(),t(T.regionStaticId).refresh()}),100)))}}(apex.util,apex.region,apex.widget,apex.lang,apex.server,apex.item,apex.message,apex.debug,apex.jQuery);