/*!
 * Copyright (c) 2024, Oracle and/or its affiliates.
 */
!function(){"use strict";const{item:e,lang:s,page:t,debug:a}=apex,A=s.getMessage("AI.PROMPT.CANNOT_PROCESS"),i=s.getMessage("AI.DISCLAIMER"),n=/^```.*?({.*}).*```/s,E={blank:"AI.PAGE_TYPE.BLANK",interactiveReport:"AI.PAGE_TYPE.IR",facetedSearch:"AI.PAGE_TYPE.FACETED_SEARCH",smartFilters:"AI.PAGE_TYPE.SMART_FILTERS",dashboard:"AI.PAGE_TYPE.DASHBOARD",classicReport:"AI.PAGE_TYPE.CR",interactiveGrid:"AI.PAGE_TYPE.IG",calendar:"AI.PAGE_TYPE.CALENDAR",chart:"AI.PAGE_TYPE.CHART",cards:"AI.PAGE_TYPE.CARDS",timeline:"AI.PAGE_TYPE.TIMELINE",form:"AI.PAGE_TYPE.FORM",masterDetailFor:"AI.PAGE_TYPE.MD",wizard:"AI.PAGE_TYPE.WIZARD",map:"AI.PAGE_TYPE.MAP"},r={progressiveWebApp:"AI.FEATURE.PWA",pushNotifications:"AI.FEATURE.PUSH_NOTIFICATIONS",accessControl:"AI.FEATURE.ACCESS_CONTROL",activityReporting:"AI.FEATURE.ACTIVITY_REPORTING",configurationOptions:"AI.FEATURE.CONFIG_OPTIONS",feedback:"AI.FEATURE.FEEDBACK",helpPages:"AI.FEATURE.ABOUT_PAGE",themeSelection:"AI.FEATURE.THEME_STYLE"};function o(e){return"object"==typeof e&&!!e&&!Array.isArray(e)}function g(...e){a.info("Create App APEX Assistant:",...e)}window.aiChatWidgetInit=function(a){return a.viewOptions.quickActions=JSON.parse(e("P2000_AI_SAMPLES").getValue()),a.viewOptions.disclaimer=i,a.chatOptions.processMessage=(a,i)=>{const{content:P,user:p}=i;if(p!==a.getAiUser()||!a.getModel().getMessages().length)return;const I={};let l,T,c=!1;try{const e=P.trim().replace(n,"$1"),s=JSON.parse(e);({message:l,blueprint:T}=s),g("Parsed the response JSON:\n",s),c=!0}catch(e){g("Unable to parse the response:\n",P)}if(o(T)){const a=o(T.application)?T.application:{},{name:i,features:n={}}=a;if(i){let{pages:A=[]}=a;const o=Object.entries(n).filter((([,e])=>e)).map((([e])=>e)).reduce(((e,t)=>{const a=s.getMessage(r[t]);return e?`${e}, ${a}`:a}),""),P=A.length;A=A.filter((e=>e.pageType in E));const p=A.length;P!==p&&(a.pages=A);let l=s.formatMessage(p?"AI.REPLY_APP_NAME":"AI.REPLY_BLANK_APP",`**${i}**`);l+="\n",p&&(A.forEach((e=>{const{pageName:t,pageType:a,table:A}=e,i=s.getMessage(E[a]),n=A?s.formatMessage("AI.PAGE_NAME.TYPE.ON_TABLE",t,i,`\`${A}\``):s.formatMessage("AI.PAGE_NAME.TYPE",t,i);l+=`* ${n}\n`})),l+="\n"),o&&(l+=s.formatMessage("AI.REPLY_ENABLED_FEATURES",`**${o}**`),l+=" "),l+=s.getMessage("AI.REPLY_CREATE_OR_CHANGE"),I.message=l,g("Valid application name found in the response JSON so displaying the built message."),I.quickActions=[{label:s.getMessage("AI.CREATE_APPLICATION"),action:()=>{e("P2000_AI_ACTION").setValue(JSON.stringify(T)),t.submit("CREATE_APP")}}]}else g("Missing application name in the blueprint."),"string"==typeof l&&l.trim().length?(I.message=l,g("Valid message found in the response JSON, displaying it.")):(I.message=A,g("Invalid or no message in the response JSON, displaying default message."))}else c?"string"==typeof l&&l.trim().length?(I.message=l,g("Invalid or no blueprint in the response JSON but valid message found, displaying it.")):(I.message=A,g("Invalid or no blueprint and invalid message in the response JSON, displaying default message.")):(I.message=A,g("Displaying default message"));return I},a}}();