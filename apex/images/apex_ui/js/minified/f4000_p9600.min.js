/*!
 * Copyright (c) 2023, 2024, Oracle and/or its affiliates.
 */
!function(e,t,n,a,i,o,l,r){"use strict";const s="is-processing",c="pd-go-to-workflow-tree",g="pd-go-to-diagram-builder",E="pd-go-to-wf-property-editor",p="pd-go-to-used-shared-tree",d="pd-show-shortcuts",_="pd-go-to-gallery-activities",O="ACTIVE",P="INACTIVE",u=t("#peMain");let R,A,T,y;function C(){e.getComponents(e.COMP_TYPE.WORKFLOW).length?(R.hide(),A.show()):(R.show(),A.hide())}function I(e,t,n){return t.p_arg_names=["FB_FLOW_ID"],t.p_arg_values=[$v("P9600_CURRENT_APP")],a.process(e,t,n)}function f(){let t=e.transaction.start("PAGE_CONTROLLER"),n=new e.Component({previousComponent:"last",typeId:e.COMP_TYPE.WORKFLOW}),a=e.getComponents(e.COMP_TYPE.WORKFLOW_VERSION,{parentId:n.id})[0];return apex.commandHistory.execute(t),a}o.validateVersionStateChange=function(t,n,a){if(n===O){let n=!!t.getChilds(e.COMP_TYPE.WORKFLOW_PARTICIP,{fitlers:[{id:e.PROP.WORKFLOW_PARTICIP_TYPE,value:"OWNER"}]}).length,i=t.getAllChildren().some((e=>e.hasErrors()));if(!n||i){let e=n?o.msg("WF.ERROR.FIX_VALIDATION_ERROR"):o.msg("WF.ERROR.MISSING_OWNER");r.alert(e,(()=>{}))}else{let n=o.getConnectedWorkflows(t.parentId,"child");if(n.length>0){for(let t=0;t<n.length;t++){if(e.getComponents(e.COMP_TYPE.WORKFLOW_VERSION,{parentId:n[t].childWorkflowId}).every((t=>t.getProperty(e.PROP.STATE).getValue()!==O)))return void r.alert(o.msg("WF.ERROR.NO_ACTIVE_CHILD"),(()=>{}))}a()}else r.confirm(o.msg("WF.QUESTION_ACTIVATE"),(e=>{e&&a()}))}}else if(n===P){let e=o.getConnectedWorkflows(t.parentId);e.length>0&&e.some((e=>!e.isInactive))&&t.getSiblings().every((e=>o.isInactive(e)))?r.alert(o.msg("WF.ERROR.PARENT_IS_ACTIVE"),(()=>{})):r.confirm(o.msg("WF.QUESTION_DEACTIVATE"),(e=>{e&&a()}))}},o.getWorkflowActivities=function(){let e=pe.getComponentType(pe.COMP_TYPE.WORKFLOW_ACTIVITY).pluginType.plugins;const t=pe.getAll().sharedComponents.isCloud;return Object.keys(e).reduce(((n,a)=>(!e[a].componentTypes.includes(pe.COMP_TYPE.WORKFLOW_ACTIVITY)||!t&&e[a].cloudOnly||(n[a]=e[a]),n)),{})},o.getWorkflowActivitiesConfig=function(){let e=o.getWorkflowActivities();return Object.keys(e).reduce(((t,n)=>{let a={},i={title:e[n].title};if(y[n]){switch(e[n].title){case"NATIVE_WORKFLOW_START":a={stencilTooltip:{text:"Start",position:"top"},allowLinkIn:!1};break;case"NATIVE_WORKFLOW_END":a={stencilTooltip:"End",allowLinkOut:!1}}t[n]={...i,...y[n],...a}}else t[n]={...i,...y.$PLUGIN$,typeId:n};return t}),{})},o.getDiagramKeyboardShortcuts=function(){return[{label:o.msg("WF.DIAGRAM.DESELECT"),key:"esc",displayKey:"Esc",event:"deselect"},{label:o.msg("WF.DIAGRAM.SELECT_NEXT"),key:"shift+up shift+right",displayKey:"Shift+Up Shift+Right",event:"cycleUp"},{label:o.msg("WF.DIAGRAM.SELECT_PREV"),key:"shift+down shift+left",displayKey:"Shift+Down Shift+Left",event:"cycleDown"},{label:o.msg("WF.DIAGRAM.SHOW_MENU"),key:"shift+F10",displayKey:"Shift+F10",event:"menuShow"},{label:o.msg("WF.DIAGRAM.MOVE_CELL_UP"),key:"up",displayKey:"Up",event:"selMoveUp"},{label:o.msg("WF.DIAGRAM.MOVE_CELL_DOWN"),key:"down",displayKey:"Down",event:"selMoveDown"},{label:o.msg("WF.DIAGRAM.MOVE_CELL_LEFT"),key:"left",displayKey:"Left",event:"selMoveLeft"},{label:o.msg("WF.DIAGRAM.MOVE_CELL_RIGHT"),key:"right",displayKey:"Right",event:"selMoveRight"},{label:o.msg("WF.DIAGRAM.SCROLL_AREA_UP"),key:"w",displayKey:"W",event:"paperPanUp"},{label:o.msg("WF.DIAGRAM.SCROLL_AREA_DOWN"),key:"s",displayKey:"S",event:"paperPanDown"},{label:o.msg("WF.DIAGRAM.SCROLL_AREA_LEFT"),key:"a",displayKey:"A",event:"paperPanLeft"},{label:o.msg("WF.DIAGRAM.SCROLL_AREA_RIGHT"),key:"d",displayKey:"D",event:"paperPanRight"},{label:o.msg("WF.DIAGRAM.OPEN_MENU_TOP"),key:"i",displayKey:"I",event:"elConnectUpTrigger"},{label:o.msg("WF.DIAGRAM.OPEN_MENU_BOTTOM"),key:"k",displayKey:"K",event:"elConnectDownTrigger"},{label:o.msg("WF.DIAGRAM.OPEN_MENU_LEFT"),key:"j",displayKey:"J",event:"elConnectLeftTrigger"},{label:o.msg("WF.DIAGRAM.OPEN_MENU_RIGHT"),key:"l",displayKey:"L",event:"elConnectRightTrigger"},{label:o.msg("WF.DIAGRAM.REMOVE_CELL"),key:"delete backspace",displayKey:"Delete",event:"cellRemove"},{label:o.msg("WF.DIAGRAM.CHANGE_SELECTION_MODE"),key:"shift+c",displayKey:"Shift+C",event:"cyclingModeChange"},{label:o.msg("WF.DIAGRAM.ZOOM_IN"),key:"ctrl+plus",displayKey:"Ctrl+Plus",event:"zoomIn"},{label:o.msg("WF.DIAGRAM.ZOOM_OUT"),key:"ctrl+minus",displayKey:"Ctrl+Minus",event:"zoomOut"},{label:o.msg("WF.DIAGRAM.ZOOM_RESET"),key:"ctrl+0",displayKey:"Ctrl+0",event:"zoomReset"},{label:o.msg("WF.DIAGRAM.OPEN_MENU_TARGET"),key:"l",displayKey:"L",event:"linkPlaceholderTargetTrigger"},{label:o.msg("WF.DIAGRAM.OPEN_MENU_ADD_TO_LINK"),key:"i k",displayKey:"I K",event:"linkAddElementButtonTrigger"}]},o.isInactive=function(t,n=P){if(t){let a=t;if(a.typeId!==e.COMP_TYPE.WORKFLOW_VERSION)for(;a&&a.typeId!==e.COMP_TYPE.WORKFLOW_VERSION;)a=a.getParent();if(a){let t=a.getProperty(e.PROP.STATE);return t&&t.getValue()===n}}return!1},o.getConnectedWorkflows=function(t,n="parent"){let a=[];const i="workflowId",l="childWorkflowId",r="parent"===n?l:i,s="parent"!==n?l:i,c=t,g=e.getPluginProperty(e.COMP_TYPE.PAGE_PROCESS,"NATIVE_INVOKE_WF",1).id,E=e.getComponents(e.COMP_TYPE.WORKFLOW_ACTIVITY,{properties:[{id:e.PROP.PAGE_PROCESS_TYPE,value:"NATIVE_INVOKE_WF"}]}).reduce(((t,n)=>{let a={activityId:n.id,isInactive:o.isInactive(n),name:n.getParent(e.COMP_TYPE.WORKFLOW)?.getProperty(e.PROP.NAME).getValue(),[l]:n.getProperty(g).getValue(),[i]:n.getParent(e.COMP_TYPE.WORKFLOW).id};return a[i]!==a[l]&&t.filter((e=>e[i]===n[i]&&e[l]===n[l])).length<1&&t.push(a),t}),[]);return function e(t){if(t){E.filter((e=>e[r]===t)).forEach((t=>{a.push(t),t[s]!==c&&e(t[s])}))}}(t),a},t((function(){!function(){let n=t("#search-container").peSearch({componentType:e.COMP_TYPE.WORKFLOW});t("#P9600_LOCAL_SEARCH,#P9600_MATCH_CASE,#P9600_IS_REGEXP").on("change",(function(){let e=$v("P9600_LOCAL_SEARCH"),t=("Y"===$v("P9600_MATCH_CASE")?"":"i")+"g",a="Y"===$v("P9600_IS_REGEXP");""!==e?(e=a?new RegExp(e,t):new RegExp(l.escapeRegExp(e),t),n.peSearch("search",e)):n.peSearch("clear")})),t("#CLEAR_PAGE_SEARCH").on("click",(function(){$s("P9600_LOCAL_SEARCH","","",!0),$s("P9600_MATCH_CASE","","",!0),$s("P9600_IS_REGEXP","","",!0),n.peSearch("clear")})),t(document).on("pageSearch",(function(e,t){o.activateTab("search"),$s("P9600_MATCH_CASE","","",!0),$s("P9600_IS_REGEXP","","",!0),$s("P9600_LOCAL_SEARCH",t)}))}(),e.init({isInternal:gIsInternal,isReadOnly:gIsReadOnly}),setTimeout((function(){let a=function(){let n,a,o,r,c,g,E=t("#a_PageDesigner"),p=t.Deferred();return l.delayLinger.start("main",(function(){n=l.showSpinner(E),E.addClass(s)})),a=t.ajax({dataType:"json",type:"GET",url:i.APEX_FILES+"apex_ui/js/staticData/pd_static_data_"+gLanguage+".json?v="+gApexVersion}),g=I("getWorkflowDiagramConfig",{},{type:"GET"}),o=I("getWorkflowData",{},{type:"GET"}),r=I("getSharedData",{},{type:"GET"}),c=I("getWorkspaceData",{},{type:"GET"}),t.when(a,c,r,o,g).done(((n,a,o,l,r)=>{e.initModelConfig(n[0],a[0],o[0]),l[0][e.COMP_TYPE.PAGE]=[{id:i.APP_PAGE_ID,parentId:$v("P9600_CURRENT_APP"),pageId:i.APP_PAGE_ID,properties:{[e.PROP.NAME]:"Workflow Designer",[e.PROP.PAGE_MODE]:"NORMAL",[e.PROP.IS_GLOBAL_PAGE]:"N"}}],e.setComponentData(l[0]),e.setCurrentAppId($v("P9600_CURRENT_APP")),e.setCurrentPageId(i.APP_PAGE_ID),y=r[0].config.reduce(((e,t)=>(e[t.typeId]=t,e)),{}),t(document).trigger("modelReady"),p.resolve()})).fail((function(){p.reject()})).always((function(){l.delayLinger.finish("main",(function(){n.remove(),E.removeClass(s)}))})),p.promise()}(),r=new URL(window.location.href);r.searchParams.has("request")&&(T="newWorkflow"===r.searchParams.get("request")),t.when(a).done((function(){let n=o.parseSelectionHash(window.location.hash);if(n)o.goToComponent(n.typeId,n.componentId);else if(T)t(document).trigger("selectionChanged",["controller",[f()]]),r.searchParams.delete("request"),window.history.replaceState(null,null,r);else{let n=e.getComponents(e.COMP_TYPE.WORKFLOW_VERSION),a=n.find((t=>t.getProperty(e.PROP.STATE).getValue()===O)),i=n.find((t=>"DEVELOPMENT"===t.getProperty(e.PROP.STATE).getValue())),o=n.find((t=>t.getProperty(e.PROP.STATE).getValue()===P)),l=a||i||o||e.getComponents(e.COMP_TYPE.WORKFLOW)[0];l&&t(document).trigger("selectionChanged",["controller",[l]])}})),n.add([{name:c,label:o.msg("WF.GO_TO_WORKFLOW_TREE"),action:function(){return o.activateTab("workflowTree_container"),t("#workflowTree").designerTree("focus"),!0}},{name:g,label:o.msg("WF.GO_TO_DIAGRAM"),action:function(){return o.activateTab("grid_diagram"),t("#app")[0].diagramBuilder?.focus(),!0}},{name:E,label:o.msg("WF.GO_TO_PROPERTY_EDITOR"),action:function(){return o.activateTab("peComponentProperties"),u.propertyEditor("focus"),!0}},{name:p,label:o.msg("WF.GO_TO_USED_SHARED_COMPONENTS"),action:function(){return o.activateTab("sharedComp_container"),t("#PDsharedCompTree").designerTree("focus"),!0}},{name:_,label:o.msg("WF.GO_TO_GALLERY"),action:function(){return o.activateTab("grid_diagram"),t("#gallery-tabs").tabs("option","active",0),t("#gallery-tabs .a-Gallery.a-IconList").iconList("focus"),!0}},{name:d,label:o.msg("KBD_SHORTCUTS"),action:function(){let e=[],t={},a=n.listShortcuts(!0);for(let n=0;n<a.length;n++){let i=a[n],o=t[i.actionName];o||(e.push(i.actionName),o={actionLabel:i.actionLabel,shortcuts:[]},t[i.actionName]=o),o.shortcuts.push(i.shortcutDisplay)}t={...t,...o.getDiagramKeyboardShortcuts().reduce(((e,t)=>{let a=t.label.replace(/\s+/g,"-").toLowerCase(),i=t.displayKey||t.key;return e[a]={actionLabel:t.label,shortcuts:i.split(" ").map((e=>n.shortcutDisplay(e,!0)))},e}),{})},e=Object.keys(t),e.sort((function(e,n){return t[e].actionLabel>t[n].actionLabel?1:t[e].actionLabel<t[n].actionLabel?-1:0})),o.getShortcutsMenuListMarkup(e,t)}}]);let R=[...n.listShortcuts().reduce(((e,t)=>(e.push(o.addBinding(t.actionName,t.shortcut)),e)),[]),o.addBinding(d,"Alt+Shift+F1"),o.addBinding(p,"Ctrl+/,S"),o.addBinding(c,"Ctrl+/,W"),o.addBinding(E,"Ctrl+/,E"),o.addBinding(g,"Ctrl+/,D"),o.addBinding(_,"Ctrl+/,G,A")];n.setShortcutKeyBindings(R)}),1),R=t("#startRegion"),A=t("#trees"),t(document).on("modelReady",(function(){T||C()})),t("#helpMenu_menu").on("menucreate",(function(){let e=t("#helpMenu_menu").menu("find","keyboardShortcuts");e&&(e.hide=!1,e.action=d)})),t("#createWorkflow").on("click",(function(e){e.preventDefault();let n=f();C(),t(document).trigger("selectionChanged",["controller",[n]])})),e.observer("PAGE_CONTROLLER",{component:{typeIds:[e.COMP_TYPE.WORKFLOW]},events:[e.EVENT.CREATE,e.EVENT.DELETE]},(function(){C()})),t("#peMain").pdPropertyEditor({mode:"main"})}))}(pe,apex.jQuery,apex.actions,apex.server,apex.env,window.pageDesigner,apex.util,apex.message);