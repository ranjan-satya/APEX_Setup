/*!
 * Copyright (c) 2014, 2024, Oracle and/or its affiliates.
 */
!function(t,e,r,a){"use strict";var i="a-PopupLOV",s=i+"-search",l=i+"-filters",n=i+"-filterGroup",o=n+"--lineFilter",u=i+"-filterLabel",p=i+"-filterItem",h=p+"-label",m=p+"-select",d=p+"-text",f=i+"-results",c=i+"-resultsSet",v=i+"-resultsGrid",k=v+"-wrap",g=c+"-link",b=i+"-iconGrid-item",_="a-SearchBox",E=_+"-field",F=_+"-icon",S=_+"-input",I="a-Icon",L="a-Button",y=L+"--noLabel",D=L+"--withIcon",x=L+"--slim",C=L+"--pillEnd",w=L+"--primary",O="a-Form-label",V="a-Form-field",A="visuallyhidden",T="u-textLeft",B="u-textCenter",H="table";function R(t){return a.getMessage("LOV_DIALOG."+t)}const q=e.hasOwnProperty;t.widget("apex.lovDialog",t.ui.dialog,{widgetEventPrefix:"lovdialog",baseId:null,filterHasSubFilter:[],filterIsSearch:[],filterFiltersOnChange:[],currentFilters:{},deferredFilterLov:t.Deferred(),options:{filterLov:null,idPrefix:null,multiValue:!1,filters:[],columnDefinitions:[],resultsDisplay:H},_create:function(){var e,r=this.options;if("function"!=typeof r.filterLov)throw new Error("Missing required 'filterLov' option.");if(0===r.columnDefinitions.length)throw new Error("Missing required 'columnDefinitions' option.");this.baseId=(r.idPrefix||this.element[0].id||"lovDialog")+"_",this.element.addClass(i);for(var s=0;s<this.options.columnDefinitions.length;s++)this.options.columnDefinitions[s]=t.extend({alignment:"left",escape:!0},this.options.columnDefinitions[s]);return this.filterHasSubFilter=[],this.filterIsSearch=[],this.filterFiltersOnChange=[],this.currentFilters={},this.resultsDisplayTableMode=this.options.resultsDisplay===H,this.options.closeText=a.getMessage("APEX.DIALOG.CLOSE"),e=this._super(),this.element.closest(".ui-dialog").attr("aria-modal",this.options.modal),this._renderLovDialog(),e},_renderLovDialog:function(){var r,a,s,l,n,o,u=this,p=e.htmlBuilder();if(p.markup("<div").attr("class",i).markup(">"),this._renderFilters(p,this.options.filters),p.markup("<div").attr("class",f).markup(">"),this.resultsDisplayTableMode){for(p.markup("<table").attr("class",c).attr("id",u.baseId+"lovEntries").markup(">").markup("<caption").attr("class",A).markup(">").content(R("LOV_ENTRIES")).markup("</caption>"),p.markup("<tr>"),this.options.multiValue&&p.markup("<th>").content(R("SELECT")).markup("</th>"),r=0;r<this.options.columnDefinitions.length;r++)o=this.options.columnDefinitions[r].title,n="left"===this.options.columnDefinitions[r].alignment?T:B,p.markup("<th").attr("class",n).optionalAttr("width",this.options.columnDefinitions[r].width).markup(">"),this.options.columnDefinitions[r].escape?p.content(o):p.markup(o),p.markup("</th>");p.markup("</tr>"),p.markup("</table>")}else p.markup("<div").attr("class",k).markup("><ul").attr("class",v).markup("></ul></div>");for(p.markup("</div>"),this.element.empty().append(p.toString()),this._lovEntries$=t("#"+this.baseId+"lovEntries"),this._filterLov(this.options.filters),this._on({click:this._resultsLinkClick}),a=0;a<this.filterIsSearch.length;a++)this._on("#"+this.filterIsSearch[a]+"_button",{click:this._doSearch}),this._on("#"+this.filterIsSearch[a],{keypress:function(t){13===t.which&&(u._doSearch(t),t.preventDefault())}});for(l=0;l<this.filterFiltersOnChange.length;l++)this._on("#"+this.filterFiltersOnChange[l],{change:this._doSearch});for(s=0;s<this.filterHasSubFilter.length;s++)this._on("#"+this.filterHasSubFilter[s],{change:this._filterHasSubFilterChange})},_resultsLinkClick:function(e){var r,a,i,s,l=t(e.target),n=!1;if(l.hasClass(g)){for(var o in r=this.lovEntries[l.data("lov-entry-idx")],this.currentFilters)if(q(this.currentFilters,o)){for(a=0;a<this.options.filters.length;a++)if(this.options.filters[a].name===o){if(n=!0,this.options.filters[a].lov)for(i=0;i<this.options.filters[a].lov.length;i++)if(this.options.filters[a].lov[i].value===this.currentFilters[o]){this.options.filters[a].lov[i].valueFormatting&&(s=this.options.filters[a].lov[i].valueFormatting);break}break}if(n)break}s&&t.extend(r,{valueFormatting:s}),this._trigger("valueSelected",{},r),!1===this.options.multiValue&&this.close()}},_doSearch:function(){this._filterLov(this.options.filters)},_filterHasSubFilterChange:function(r){for(var a=e.htmlBuilder(),i=this.options.filters,s=t(r.target),l=s.data("filter-name"),o=0;o<i.length;o++)if(i[o].name===l)for(var u=0;u<i[o].lov.length;u++)if(i[o].lov[u].filters)if(s.val()===i[o].lov[u].value)this._renderFilters(a,i[o].lov[u].filters,!0),s.closest("div."+n).after(a.toString());else for(var p=0;p<i[o].lov[u].filters.length;p++)this.element.find("[data-filter-name="+i[o].lov[u].filters[p].name+"]").closest("div."+n).remove()},_filterLovEntries:function(t){var e,r,a,i=[];if(""!==t){for(a=t instanceof RegExp?t:new RegExp(t,"i"),e=0;e<this.lovEntries.length;e++)for(r=0;r<this.options.columnDefinitions.length;r++)if((this.lovEntries[e][this.options.columnDefinitions[r].name]+"").match(a)){i.push(this.lovEntries[e]);break}this.lovEntries=i}},_renderLovEntries:function(t,r){const a=this.options;let i,s,l,n,o=e.htmlBuilder();if(this.lovEntries=t.slice(),r&&this._filterLovEntries(r.trim()),this.resultsDisplayTableMode){for(let t=0;t<this.lovEntries.length;t++){o.markup("<tr>"),a.multiValue&&o.markup("<td>").markup("<input").attr("type","checkbox").attr("title",R("SELECT")).attr("data-lov-row",t).markup(" />").markup("</td>");for(let e=0;e<a.columnDefinitions.length;e++){const r=a.columnDefinitions[e];l=r.cellFormatting?function(t){o.markup(r.cellFormatting(t))}:r.escape?function(t){o.content(t)}:function(t){o.markup(t)},s=this.lovEntries[t][r.name],s=0!==s?s||"":s,"left"===r.alignment?i=T:"right"===r.alignment?i="u-textRight":"center"===r.alignment&&(i=B),o.markup("<td").attr("class",i).optionalAttr("role",r.isRowHeader?"rowheader":null).markup(">"),0===e?(o.markup("<a").attr("class",g).attr("href","#").attr("data-lov-entry-idx",t).markup(">"),l(s),o.markup("</a>")):l(s),o.markup("</td>")}o.markup("</tr>")}this._lovEntries$.find("tr").after(o.toString())}else{for(let t=0;t<this.lovEntries.length;t++)o.markup("<li").attr("class",b).markup(">"),s=this.lovEntries[t].r,n=this.lovEntries[t].d,s=0!==s?s||"":s,o.markup("<a").attr("class",g).attr("href","#").attr("data-lov-entry-idx",t).markup(">"),o.markup("<span").attr("class","fa "+s).attr("aria-hidden","true").markup("></span>"),o.content(n),o.markup("</a>"),o.markup("</li>");this.element.find("."+v).append(o.toString())}},_updateCurrentFilters:function(e){var r,a,i,s;for(r=0;r<e.length;r++)if(a=e[r].name,t("#"+this.baseId+a).length>0&&(i=t("#"+this.baseId+e[r].name),t.inArray(e[r].type,["text","select","search"])>-1?s=i.val():"buttonset"===e[r].type&&(s=i.find("input:checked").val()),this.currentFilters[a]=s,e[r].lov))for(var l=0;l<e[r].lov.length;l++)e[r].lov[l].value===s&&e[r].lov[l].filters&&this._updateCurrentFilters(e[r].lov[l].filters)},_filterLov:function(r){var a,i=this;i.deferredFilterLov.reject({status:0},"superseded",null),i.deferredFilterLov=t.Deferred().always((function(){e.delayLinger.finish("lovDialog",(function(){a.remove()}))})).done((function(t,e){i._renderLovEntries(t,e)})),this.resultsDisplayTableMode?this._lovEntries$.find("tr").not(":first").remove():this.element.find("."+v).empty(),this._updateCurrentFilters(r),e.delayLinger.start("lovDialog",(function(){a=e.showSpinner(t(".a-PopupLOV-results"))})),this.options.filterLov(this.currentFilters,(function(t,e){i.deferredFilterLov.resolve(t,e)}))},_renderSearch:function(t,e){t.markup("<div").attr("class",s).markup(">"),t.markup("<div").attr("class",_).markup(">"),t.markup("<div").attr("class",E).markup(">"),t.markup("<span").attr("class",F).attr("role","img").attr("aria-label",a.getMessage("PE.SEARCH")).markup(">"),t.markup("<span").attr("class",I+" icon-search").markup(">").markup("</span>"),t.markup("</span>"),t.markup("<input").attr("id",this.baseId+e.name).attr("data-filter-name",e.name).attr("type","text").attr("class",S).attr("title",e.title).attr("placeholder",e.title).attr("aria-controls",this.baseId+"lovEntries").attr("value",e.defaultValue?e.defaultValue:"").optionalBoolAttr("aria-required",e.isRequired).markup(" />"),t.markup("</div>"),t.markup("<button").attr("class",L+" "+y+" "+D+" "+x+" "+C+" "+w).attr("value",R("GO")).attr("type","button").attr("id",this.baseId+e.name+"_button").attr("title",R("GO")).attr("aria-controls",this.baseId+"lovEntries").markup(">"),t.markup("<span").attr("class",I+" icon-right-chevron").markup(">").markup("</span>"),t.markup("<span").attr("class",A).markup(">").content("Go").markup("</span>"),t.markup("</button>"),t.markup("</div>"),t.markup("</div>"),this.filterIsSearch.push(this.baseId+e.name)},_renderText:function(t,e){t.markup("<div").attr("class",n+" "+o).markup(">"),t.markup("<span").attr("class",u).markup(">"),t.markup("<label").attr("for",this.baseId+e.name).attr("class",O+" "+h).markup(">").content(e.title).markup("</label>"),t.markup("</span>"),t.markup("<span").attr("class",p).markup(">"),t.markup("<input").attr("id",this.baseId+e.name).attr("data-filter-name",e.name).attr("type","text").attr("class",V+" "+d).attr("value",e.defaultValue?e.defaultValue:"").optionalBoolAttr("aria-required",e.isRequired).markup(" />"),t.markup("</span>"),t.markup("</div>")},_renderSelect:function(t,e){var r,a=[];function i(r){var i=e.defaultValue===r.value;t.markup("<option").attr("value",r.value).optionalAttr("selected",i).markup(">").content(r.display).markup("</option>"),r.filters&&(this.filterHasSubFilter.push(this.baseId+e.name),i&&(a=r.filters))}for(this.filterFiltersOnChange.push(this.baseId+e.name),t.markup("<div").attr("class",n+" "+o).markup(">"),t.markup("<span").attr("class",u).markup(">"),t.markup("<label").attr("for",this.baseId+e.name).attr("class",O+" "+h).markup(">").content(e.title).markup("</label>"),t.markup("</span>"),t.markup("<span").attr("class",p).markup(">"),t.markup("<select").attr("id",this.baseId+e.name).attr("data-filter-name",e.name).attr("size","1").attr("class",V+" a-Form-select "+m).attr("aria-controls",this.baseId+"lovEntries").optionalBoolAttr("aria-required",e.isRequired).markup(">"),e.isRequired||i({display:R("SELECT_VALUE"),value:""}),r=0;r<e.lov.length;r++)i(e.lov[r]);return t.markup("</select>"),t.markup("</span>"),t.markup("</div>"),a},_renderButtonSet:function(t,e){var r,a,i=[];for(this.filterFiltersOnChange.push(this.baseId+e.name),t.markup("<div").attr("class",n+" "+o).markup(">"),t.markup("<span").attr("class",p+" apex-button-group").attr("id",this.baseId+e.name).attr("role","group").attr("aria-label",e.title).attr("aria-controls",this.baseId+"lovEntries").markup(">"),t.markup("<div").attr("class","apex-item-grid-row").markup(">"),r=0;r<e.lov.length;r++)a=e.defaultValue===e.lov[r].value,t.markup("<div").attr("class","apex-item-option").markup(">"),t.markup("<input").attr("id",this.baseId+e.name+"_"+e.lov[r].value).attr("type","radio").optionalAttr("checked",a).attr("value",e.lov[r].value).attr("name",this.baseId+e.name).attr("data-filter-name",e.name).markup(" />"),t.markup("<label").attr("for",this.baseId+e.name+"_"+e.lov[r].value).markup(">").content(e.lov[r].display).markup("</label>"),t.markup("</div>"),e.lov[r].filters&&(this.filterHasSubFilter.push(this.baseId+e.name),a&&(i=e.lov[r].filters));return t.markup("</div>"),t.markup("</span>"),t.markup("</div>"),i},_renderFilters:function(t,e,r){var a,i=[];for(e.length>0&&!r&&t.markup("<div").attr("class",l).markup(">"),a=0;a<e.length;a++){switch(i=[],e[a].type){case"search":this._renderSearch(t,e[a]);break;case"text":this._renderText(t,e[a]);break;case"select":i=this._renderSelect(t,e[a]);break;case"buttonset":i=this._renderButtonSet(t,e[a])}i.length>0&&this._renderFilters(t,i,!0)}e.length>0&&!r&&t.markup("</div>")},close:function(){return this.element.removeClass(i).empty(),this._super()}})}(apex.jQuery,apex.util,apex.debug,apex.lang);