/*!
 * Copyright (c) 2021, 2024, Oracle and/or its affiliates.
 */
const objectBrowser=function(e,t,i,n,o,a,r,s,l,d,c,u){"use strict";const g="aria-label",f="aria-labelledby",h="action",p={type:"separator"},m="BUTTON",b="MENU",w="option",I="refresh",y="focus",v="hide",V="show",D=".ob-view-",_=".ob-vtype-grid",C=".a-GV",E=".ob-vtype-nvp",T=".ob-vtype-editor",S="DATA",O="ENV_IMPORTS",x="openTabs",A="viewState",R="lastSchema",N="treeExpansionState",j="treeSelection",P="objectFilter",M="objectsTree",k=r.getScopedSessionStorage({prefix:"ORA_WWV_apex.objectBrowser",useAppId:!1}),$=new Map,B=new Map,L={},z=[],H=new Map,U=new Map,F=new Map,q="CODE_EDITOR_SETTINGS",G="INVALID",J="_DIR",K=e.ui.keyCode,W=Object.entries,X=Array.isArray,Y=e=>parseInt(e,10);let Z,Q,ee,te,ie,ne,oe=null,ae=null,re=null,se=null;const le=d("P2000_OB_SCHEMA");e.widget("ui.tabs",e.ui.tabs,{_isLocal:function(){return!0}});const de=function(){let t=null,n=null,a=null,r=null,l=null,d=null,c=null;function u(e){const t=e.hasErrors||!1;c.toggleClass("is-error",t),a.attr(f,"obObjectDocLabel"+(t?" obObjectDocStatus":"")),c.toggleClass("is-changed",e.getIsChanged())}function h(e){c.find(".b-OB-docHeader-icon").html(function(e,t){const n=i.htmlBuilder();return n.markup("<span").attr("class","a-Icon "+e),t&&n.markup(' role="img"').attr(g,t),n.markup("></span>"),n.toString()}(e.icon,e.iconLabel)),c.find(".b-OB-docHeader-label").text(e.name)}return{init:function(i,o){l=a=e("#"+i),c=e("#obObjectDocTitle"),r=e("#obObjectDocToolbar"),d=e("#obObjectDocBody"),n=a.next();e("#obObjectDocTabs").html('<ul><li><a href="#ob_temp_tab">L</a></li></ul>'),d.append('<div id="ob_temp_tab"></div>'),l.tabs({heightStyle:"content",activate:function(e,t){let i=t.newPanel.prop("id");i&&(i=i.replace("ob_view_",""),s.set("change-view",i))}}),o.initToolbar(r),l.on("resize",(function(i){if(i.target!==this)return;let n=e(i.target).width(),o=e(i.target).height();o-=d.position().top,d.add(d.children()).width(n).height(o),t.resize(),i.stopPropagation()}))},syncViewTabs:function(e){const t=l.tabs("option","active"),i=l.find(".ui-tabs-nav").first().children(),n=i.index(i.filter(`[aria-controls="ob_view_${e}"]`));t!==n&&l.tabs("option","active",n)},openDocument:function(e){const i=e.renderUI();function o(){n.hide(),a.show(),h(e),u(e),t=e,a.parent().trigger("resize"),d.html(i),e.initUI(d),e.activate(s,r,l)}t?this.checkAndCloseDoc().then((e=>{e&&o()})):o()},closeDocument:function(){t&&t.destroyUI(d),a.hide(),n.show(),n.trigger("resize"),t=null},checkAndCloseDoc:function(){return new Promise((e=>{let i=t&&t.checkRemove();i?o.confirm(i,(i=>{i&&(t.clear(),this.closeDocument()),e(i)})):(this.closeDocument(),e(!0))}))},renameDocument:function(e){t=e,h(e),u(e)},getDocDescriptor:function(){return t},updateDocState:function(){u(t)}}}();function ce(){return le.displayValueFor(le.getValue())}function ue(){return le.getValue()}function ge(t){let i=null;return le.element.children(w).each((function(){const n=e(this);if(n.text().trim()===t)return i=n.attr("value"),!1})),i}function fe(e){return n.getMessage("OB.ACTION_"+e)}function he(e){return n.getMessage("OB."+e)}function pe(e){return B.get(e)}function me(e){return e.toLowerCase().split("_").map((e=>e.substring(0,1).toUpperCase()+e.substring(1))).join(" ")}function be(e,t,i,o,a,r,s=!1){const l=pe(e);return{id:o,path:a+".",name:i,title:a+"."+i,type:e,icon:l.icon,iconLabel:me(e),hasErrors:s,getIsChanged:function(){for(const[,e]of this.data)if(e.isChanged)return!0;return!1},renderUI:function(){return l.renderUI(this)},initUI:function(e){l.initUI(this,e)},destroyUI:function(e){l.destroyUI(this,e)},activate:function(e,t,i){oe&&ae&&(se=oe.type+"_"+ae.currentViewId),oe=l,ae=this,t.attr(g,n.formatMessage("OB.TB_LABEL",this.iconLabel)),l.activate(this,e,t,i)},loadViewData:function(e,t,i){l.loadViewData(this,e,t,i,!0)},resize:function(){l.resize(this)},checkRemove:function(){return l.checkRemove(this)},clear:function(){return l.clear(this)},save:function(){return l.save(this)},getViewReadOnly:function(e){return l.getViewReadOnly(this,e)},setViewReadOnly:function(e,t){l.setViewReadOnly(this,e,t)},getViewIsChanged:function(e){return l.getViewIsChanged(this,e)},clearViewChanges:function(e){return l.clearViewChanges(this,e)},currentViewId:null,getCurrentView:function(){return this.tabPanel$.children(D+this.currentViewId)},owner:t,schema:a,schemaId:r,initializedViews:new Set,staleViews:new Set,staleObjects:new Set,models:new Map,columns:new Map,data:new Map}}function we(){return e("#objectsTree")}function Ie(e){return e.treeView("getNodeAdapter")}function ye(e){const t=we(),i=Ie(t),n=i.getRecord(e);if(n){const e=i.parent(n);e&&e.type&&e.type.endsWith(J)&&t.treeView("expand",t.treeView("getTreeNode",e)),t.treeView("setSelectedNodes",[n])}}function ve(e,t,i,n,o,a=!1){de.openDocument(be(e,i,t,n,o,ge(o),a)),ye(n)}function Ve(e,t,i,n){if(t.hasErrors=!e,de.updateDocState(),n===ce()){const t=Ie(we()),n=t.getRecord(i);e!==(n.status!==G)&&(e?(delete n.classes,t.setValue(n,"status","VALID")):(n.classes="is-error",t.setValue(n,"status",G)))}}function De(t,i){let n=null,o=e(t).closest(".a-GV-row");return o.length>0&&(n=i.grid("getRecords",[o])[0]),n}let _e,Ce;function Ee(e){const t=de.getDocDescriptor(),i=e.id,n=ce(),o=pe(e.type),a=e.status===G;i&&o&&(t&&t.id===i||de.openDocument(be(e.type,n,e.label,i,n,ue(),a)))}function Te(t,o){const a=we();let r,l,d,c=!1,u=null,g=e("#obMainSplitter").height()-e("#obLeftHeader").height();a.parent().height(g),r=k.getItem(N),r&&(r=r.split(":")),d=k.getItem(j),l=k.getItem(R);const f=function(){const e=new URLSearchParams(window.location.search),t={};for(const[i,n]of e)t[i.toUpperCase()]=n;return t}();if(f.P2000_OB_INIT_SCHEMA){l=ge(f.P2000_OB_INIT_SCHEMA),f.P2000_OB_INIT_ID?(d=f.P2000_OB_INIT_ID,c=!0):d=null;let e=new URL(window.location.href),t=new URLSearchParams(e.search);t.delete("p2000_ob_init_schema"),t.delete("p2000_ob_init_id"),t.delete("clear"),e.search=t.toString(),window.history.replaceState({},"",decodeURIComponent(e.toString()))}if(l){let e=ue();le.setValue(l),ue()!==l&&(le.setValue(e),d=null,r=[])}let h=null,p={matchString:""},m=e.apex.treeView.makeModelNodeAdapter(M,{fields:{label:{},type:{},id:{},classes:{},status:{},children:{}},regionId:t,ajaxIdentifier:o,regionData:{dataShape:"tree",parsingSchema:ce()},requestOptions:{refreshObject:a[0]},editable:!0,trackChanges:!1,types:L,typeField:"type",identityField:"id",childrenField:"children",classesField:"classes",hasIdentity:!0,initialExpandedNodeIds:r,visibilityFilter:(e,t,i)=>t.label.toUpperCase().includes(i.matchString),visibilityFilterContext:null});const b=e("#objectsTreeMenu_menu");b.data("apexMenu",{});let I={showRoot:!1,collapsibleRoot:!1,getNodeAdapter:function(){return m},contextMenuId:"objectsTreeMenu_menu",iconType:"a-Icon",multiple:!1,doubleClick:"toggle",autoCollapse:!1,useLinks:!1,navigation:!0,activateNode:function(e,t){t.nodes.length>0&&(t.nodes[0].type.endsWith(J)?de.checkAndCloseDoc():Ee(t.nodes[0]))},selectionChange:function(){const t=a.treeView("getSelectedNodes"),i=s.lookup("create-current-object-type");let o,r;if(!u){const t=e("#objectsCreateMenu_menu");let o;u=i.label,o=t.menu(w).items,o.forEach((e=>{if(e.id&&e.id.startsWith("create-")){let t=s.lookup(e.id);t.contextLabel=n.format(u,t.label)}}))}t.length&&"INVALID_DIR"!==t[0].type&&(o="create-"+t[0].type.replace(J,"").replace("_","-").toLowerCase()),i.hide=!0,o&&(r=s.lookup(o),r&&(i.label=n.format(u,r.label),i.createActionName=o,i.hide=!1)),s.update("create-current-object-type")}};a.treeView(I),a.on("apexafterrefresh",(()=>{const e=ce(),t=de.getDocDescriptor();if(h=null,t&&t.schema===e){let e=a.treeView("find",{match:e=>e.id===t.id,depth:-1});if(0===e.length)de.closeDocument();else{const i=a.treeView("getNodes",e)[0].status===G;t.hasErrors!==i&&(t.hasErrors=i,de.updateDocState())}}D(),d&&setTimeout((()=>{if(c){const e=Ie(a).getRecord(d);e&&ve(e.type,e.label,ce(),d,ce(),e.status===G)}else ye(d);d=null}),0)})),b.removeData("apexMenu");const y=e("#P2000_OB_OBJECTS_FILTER"),D=()=>{let e=y.val();e!==h&&(e.length>0&&(""===h||null===h)&&setTimeout((()=>{a.treeView("expandAll")}),200),y.next().toggleClass("is-empty",""===e),_(e),h=e)},_=i.debounce((e=>{p.matchString=e.toUpperCase(),m.updateVisibility(p)}),200);return _e=function(){y.val(""),h=null},Ce=function(){return y.val()},y.after('<span class="a-input-clear is-empty js-clearInput" tabindex="-1"><span class="a-Icon icon-multi-remove"></span></span>').on("input",(function(){D()})).on("keydown",(function(e){let t=e.which;t===K.ENTER?e.preventDefault():t===K.ESCAPE&&(_e(),D())})),y.next().on("click",(()=>{_e(),D()})),y.val(k.getItem(P)||""),s.add([{name:"objects-expand-all",label:null,action:function(){a.treeView("expandAll")}},{name:"objects-collapse-all",label:null,action:function(){a.treeView("collapseAll")}},{name:"objects-refresh",label:null,action:function(){m.clearData()}},{name:"objects-open",label:null,action:function(){const e=a.treeView("getSelectedNodes");e.length&&Ee(e[0])}}]),e((()=>{e("#objectsTreeMenu_menu").menu(w,"beforeOpen",(function(){const e=a.treeView("getSelectedNodes"),t=!e[0]||e[0].type.endsWith(J)?v:V;s[t]("objects-open")}))})),a}function Se(e){let t=[],i=[],n=[];z.forEach((e=>{let o=e.actions;for(let e=0;e<o.length;e++){let a=o[e];if(a.name)!1!==a.preferButton?a.uiDefaultsGroup?n.push({type:m,action:a.name,icon:a.icon||null,iconBeforeLabel:!0,hot:a.hot||!1}):i.find((e=>e.action===a.name))||i.push({type:m,action:a.name,icon:a.icon||null,iconBeforeLabel:!0,hot:a.hot||!1}):(a.separatorBefore&&t.push(p),t.push({type:h,action:a.name}));else if("string"==typeof a){let e=s.lookup(a);e&&!i.find((e=>e.action===a))&&i.push({type:m,action:a,icon:e.icon||null,iconBeforeLabel:!0})}}})),e.toolbar({idPrefix:"obtb",small:!0,simple:!0,cursorKeyNavigation:!1,data:[{id:"actionsGroup",controls:i},{id:"uiDefaultsGroup",controls:n},{id:"refreshGroup",controls:[{type:m,icon:"icon-ob-refresh",iconBeforeLabel:!0,action:"refresh-view"}]},{id:"overflowGroup",controls:[{type:b,id:"actions_button",labelKey:"OB.TB_MORE",menu:{items:t}}]}]})}const Oe="grid",xe="grids",Ae="editor",Re="nvp_grid",Ne="nvp_editor";function je(e,t){$.set(e,t)}function Pe(e,t,n=!0){return n&&(t=i.escapeHTML(t)),`<li><span class="tt-label">${e}: </span><span class='tt-value'>${t}</span></li>`}function Me(e,t,i,n,o=null){e.markup('<div role="region"').attr(f,o).markup('><span class="b-OB-Section-label"').optionalAttr("id",o).markup(">").content(t).markup(`</span><div id="${i}" class="${n}"`).optionalAttr(f,o).markup("></div></div>")}function ke(t,i,n,o){const a=n.editable||!1,r=n.Id===S&&a,s={modelName:i,applyTemplateOptions:{extraSubstitutions:{baseId:t[0].id},iterationCallback:function(e,t,i,n,o,a){a.rowIndex=""+n}},columns:[o],editable:a,spreadsheetMode:!1,fixedRowHeight:void 0===n.fixedRowHeight||n.fixedRowHeight,hasSize:void 0===n.hasSize||n.hasSize,multiple:!0,multipleCells:!0,selectCells:!a,resizeColumns:!0,reorderColumns:!1,noDataMessage:n.noDataMessage||he("NO_DATA"),hideEmptyFooter:!0,rowHeader:"none",showNullAs:"",skipReadonlyCells:!0,pagination:{scroll:!0,virtual:r},persistSelection:r,columnSort:!1,pageChange:function(t,i){const n=e(this),o=n.grid("getModel");0===i.offset&&setTimeout((()=>{if(n.grid(w,"selectCells")){const e=n.grid("getSelectedRange"),t=n.find("tbody td.a-GV-cell").first();!e.recordIds.length&&t.length&&n.grid("setSelection",t)}else{const e=n.grid("getSelectedRecords"),t=o.recordAt(0);!e.length&&t&&n.grid("setSelectedRecords",[t])}}),0)},sortChange:function(e,i){let n=i.column.sortIndex,o=t.grid("getColumns"),a=t.grid("getModel"),r=[],s=a.getOption("fetchData"),l=1;for(let e=0;e<o.length;e++){let t=o[e];t.sortIndex&&("change"===i.action?t===i.column&&(l=t.sortIndex):"add"===i.action?t.sortIndex>=l&&(l=t.sortIndex+1):"remove"===i.action?t===i.column?(delete t.sortIndex,delete t.sortDirection):t.sortIndex>n&&(t.sortIndex-=1):"clear"!==i.action&&"set"!==i.action||(delete t.sortIndex,delete t.sortDirection))}"clear"!==i.action&&"remove"!==i.action&&(i.column.sortIndex=l,i.column.sortDirection=i.direction),t.grid("refreshColumns"),s.sorts=r;for(let e=0;e<o.length;e++){let t=o[e];t.sortDirection&&r.push({column:t.property,direction:t.sortDirection.toUpperCase(),index:t.sortIndex})}a.clearData()}};if(a&&(s.selectionChange=function(){let i=t.grid("getSelection");e(".js-selectionMenu",t).prop("disabled",0===i.length)}),n.sorts)for(let e=0;e<n.sorts.length;e++){let t=n.sorts[e],i=s.columns[0][t.column];i&&(i.sortIndex=t.index,i.sortDirection=t.direction.toLowerCase())}return n.id===S&&(s.tooltip={content:function(e,t,i,n,o){let a=null;return!i&&o&&(a="",o.serverDataType&&(a+=Pe(he("COL_DATA_TYPE"),o.serverDataType,!1)),o.nullable&&(a+=Pe(he("COL_NULLABLE"),o.nullable)),o.defaultValue&&(a+=Pe(he("COL_DEFAULT"),o.defaultValue)),o.comment&&(a+=Pe(he("COL_COMMENT"),o.comment)),a=a.length>0?`<ul class="tt-list">${a}</ul>`:null),a}}),s}function $e(e,t,i,n,o){const a={modelName:t,fields:[n],hasSize:!1,labelAlignment:"start",noDataMessage:he("NO_DATA"),showNullAs:"",toolbar:null};return o&&(a.applyTemplateOptions={extraSubstitutions:o}),a}function Be(e,t,i){e.codeEditor("setValue",t).codeEditor("resetUndoRedoStack");let n=F.get(i);!n||isNaN(n.l)||isNaN(n.c)||e.codeEditor("gotoPosition",n.l,n.c)}function Le(e){return $.get(e)}function ze(e,t,i){return`ob_${e}_${t}_${i}`}function He(e,i,n,o,a,r,s,l,d,c){const u=l.shape||"table",g={shape:u,recordIsArray:!0,fields:d,regionData:{dataShape:u,parsingSchema:i,owner:n,objectType:o,objectId:a,objectName:r,view:s},regionId:Q+(l.subId||""),ajaxIdentifier:ee,hasTotalRecords:s!==S,paginationType:s===S?"progressive":"none"};let f=null,h=null,p=null;if(l.subId&&(g.regionData.subView=l.subId),(l.editable||l.modelEditable)&&(g.editable=!0,l.editable||(g.trackChanges=!1)),l.identityField&&(g.identityField=l.identityField),d&&d._meta&&(g.metaField="_meta"),"table"===u&&(g.fetchData={filters:[],sorts:l.sorts||[]},g.editable&&d)){let e=[];for(const[t,i]of W(d))i.virtual||e.push({name:t,index:i.index,dataType:i.dataType,isRequired:i.isRequired,queryOnly:i.readonly||"CLOB"===i.dataType});e.sort(((e,t)=>e.index-t.index)),e.forEach((e=>{delete e.index})),g.saveData={columns:e}}return c&&(f=c.values,h=c.totalRows,p=c.moreData),t.create(e,g,f,h,p)}je(Oe,{render:function(e,t,i){const n=`ob_${t.type}_${i.id}_${t.id}_`,o=n+"label";e.markup('<div class="ob-vtype-grid-r" role="region"').attr(f,o).markup(`><span class="u-vh" id="${o}">`).content(i.label).markup(`</span><div id="${n}grid" class="ob-vtype-grid" aria-labelledby="${o}"></div>`),i.modelEditable&&i.id===S&&(e.markup('<div class="a-GV-columnItemContainer u-vh" aria-hidden="true">'),i.columns&&this.renderColumnItems(e,i.columns),e.markup("</div>")),e.markup("</div>")},renderColumnItems:function(e,t){for(const[,i]of W(t))i.elementId&&(e.markup('<div class="a-GV-columnItem">'),["VARCHAR2","NVARCHAR2","CHAR"].includes(i.dataType)&&i.dataLength&&i.dataLength>=60?e.markup(`<textarea id="${i.elementId}" class="textarea apex-item-textarea" rows="3" cols="30" data-resizable="true" style="resize: both;" ${i.isRequired?" required":""}></textarea>`):"CLOB"===i.dataType?e.markup(`<textarea id="${i.elementId}" class="textarea apex-item-textarea" readonly rows="3" cols="30" data-resizable="true" style="resize: both;"></textarea>`):e.markup(`<input id="${i.elementId}" type="text" class="text_field apex-item-text" size="30" ${i.isRequired?" required":""}>`),e.markup("</div>"))},initializeView:function(t,n,o){const a=n.modelId,r=t.find(_),s=r.next(".a-GV-columnItemContainer"),l=ke(r,a,o,[S,O].includes(o.id)?n.dataColumns:n.columns.get(o.id));if(n.dataColumns&&0===s.children().length){const t=i.htmlBuilder();this.renderColumnItems(t,n.dataColumns),e.apex.tableModelViewBase.clearColumnItemCache(s[0]),s.html(t.toString())}r.height(t.height()).width(t.width()).grid(l),l.selectionChange&&e(".js-selectionMenu",r).prop("disabled",0===r.grid("getSelection").length)},destroyView:function(t){const i=t.find(_),n=i.next(".a-GV-columnItemContainer");i.grid("destroy"),e.apex.tableModelViewBase.clearColumnItemCache(n[0]),n.empty()},focus:function(e){e.find(_).grid(y)},resize:function(e){e.find(_).height(e.height()).width(e.width()).grid("resize")},getState:function(e){e.find(_).grid("getSelection");return null},save:function(e,t){const i=t.models.get(t.currentViewId),a=e.find(_);if(i.hasErrors())return o.alert(n.getMessage("APEX.CORRECT_ERRORS"),(function(){setTimeout((()=>{a.find(".is-error").first().focus()}),0)})),!0;a.grid("finishEditing").then((()=>{let e=i.save();e&&(e.done((function(e,t){let i,a="";if(t.errors)o.clearErrors(),o.showErrors(t.errors);else if(t.regions){for(let e=0;e<t.regions.length;e++)i=t.regions[e],i.fetchedData&&i.fetchedData.successMessage&&(a&&(a+="<br>"),a+=i.fetchedData.successMessage);a||(a=n.getMessage("APEX.IG.CHANGES_SAVED")),o.showPageSuccess(a)}})).always((function(){s.enable("save")})),s.disable("save"))}))}}),je("nvp",{render:function(e,t,i){const n=`ob_${t.type}_${i.id}_${t.id}_`;e.markup('<div class="ob-vtype-nvp-r" role="region"').attr(g,i.label).markup(`><div id="${n}nvp" class="ob-vtype-nvp"></div></div>`)},initializeView:function(e,t,i){const n=t.modelId,o=e.find(E),a=$e(0,n,0,t.columns.get(i.id),{owner:t.owner});o.height(e.height()).width(e.width()).recordView(a)},focus:function(e){e.find(E).recordView(y)},resize:function(e){e.find(E).height(e.height()).width(e.width()).recordView("resize")},getState:function(){return null},checkDepends:function(e,t){let i=!1,n=e.staleObjects;if(t.columns.OBJECT_ID){let o=e.models.get(t.id);if(o){let e=o.getValue("OBJECT_ID");n.has(e)&&(n.delete(e),i=!0)}}return i}}),je(Re,{render:function(e,t,i){const n=`ob_${t.type}_${i.id}_${t.id}_`,o=i.subViews;e.markup('<div class="ob-vtype-nvpgrid" role="region"').attr(g,i.label).markup(">"),o[0].hidden?e.markup(`<span class="u-vh" id="${n}label">`).content(i.label).markup(`</span><div id="${n}grid" class="ob-vtype-grid" aria-labelledby="${n}label"></div>`):(Me(e,o[0].heading,n+"nvp","ob-vtype-nvp",n+"nvp_label"),Me(e,o[1].heading,n+"grid","ob-vtype-grid",n+"grid_label")),e.markup("</div>")},initializeView:function(e,i,n){const o=i.modelIds,a=n.subViews[0];function r(){const t=n.subViews[1],r=e.find(_),s=i.columns.get(n.id+"_"+t.subId),l=ke(r,o[1],t,s);if(!a.hidden){const t=e.find(E),r=i.columns.get(n.id+"_"+a.subId),s=$e(0,o[0],0,r,{owner:i.owner});t.recordView(s)}r.grid(l)}a.hidden?e.find(".ob-vtype-nvpgrid, .ob-vtype-grid").height(e.height()).width(e.width()):e.css("overflow","auto").find(".ob-vtype-nvpgrid").height(e.height()).width(e.width());let s=t.multipleFetch(null,{loadingIndicator:e,loadingIndicatorPosition:"centered"},o);s?s.done((()=>{r()})):r()},focus:function(e){const t=e.find(E),i=e.find(_);t[0]?t.recordView(y):i.grid(y)},resize:function(e){const t=e.find(_),n=e.find(E),o=e.children().first();let a=e.width(),r=e.height();o.height()>e.height()&&(a-=i.getScrollbarSize().width),o.width(a),n.width(a).recordView("resize"),n[0]||o.add(t).height(r),t.width(a).grid("resize")},refresh:function(e){const t=e.find(_),i=e.find(E);t.grid(I),i.recordView(I)},getState:function(){return null},checkDepends:function(e,t){let i,n=!1,o=e.staleObjects;if(i=t.subViews[0],i.columns.OBJECT_ID){let a=e.models.get(t.id+"_"+i.subId);if(a){let e=a.getValue("OBJECT_ID");o.has(e)&&(o.delete(e),n=!0)}}if(n)return n;if(i=t.subViews[1],i.columns.OBJECT_ID){let a=e.models.get(t.id+"_"+i.subId);if(a){let e=a.getFieldKey("OBJECT_ID");a.forEach((t=>{let i=t[e];o.has(i)&&(o.delete(i),n=!0)}))}}return n}}),je(xe,{render:function(e,t,i){const n=`ob_${t.type}_${i.id}_${t.id}_`,o=i.subViews;e.markup('<div class="ob-vtype-grids" role="region"').attr(g,i.label).markup(">");for(let t=0;t<o.length;t++)Me(e,o[t].heading,n+"grid_"+t,"ob-vtype-grid",n+"grid_label_"+t);e.markup("</div>")},initializeView:function(e,i,n){const o=i.modelIds;e.css("overflow","auto").find(".ob-vt-nvpgrid").height(e.height()).width(e.width()),t.multipleFetch(null,{loadingIndicator:e,loadingIndicatorPosition:"centered"},o).done((()=>{const t=e.find(_);for(let e=0;e<n.subViews.length;e++){let a=n.subViews[e],r=t.eq(e),s=i.columns.get(n.id+"_"+a.subId),l=ke(r,o[e],a,s);r.grid(l)}}))},focus:function(e){e.find(_).eq(0).grid(y)},resize:function(e){const t=e.find(_),n=e.children().first();let o=e.width();n.height()>e.height()&&(o-=i.getScrollbarSize().width),n.width(o),t.width(o).grid("resize")},refresh:function(e){e.find(_).grid(I)},getState:function(){return null},checkDepends:function(e,t){let i=!1,n=e.staleObjects;return t.subViews.forEach((o=>{if(o.columns.OBJECT_ID){let a=e.models.get(t.id+"_"+o.subId);if(a){let e=a.getFieldKey("OBJECT_ID");a.forEach((t=>{let o=t[e];n.has(o)&&(n.delete(o),i=!0)}))}}})),i}}),je(Ae,{render:function(e,t,i){const n=`ob_${t.type}_${i.id}_${t.id}_`;e.markup('<div class="ob-vtype-editor-r" role="region"').attr("aria-label",i.label).markup(`><div id="${n}editor" class="ob-vtype-editor"></div></div>`)},initializeView:function(t,n,o){const r=this,s=t.find(T),l=de.getDocDescriptor(),d=o.readOnly,c=r.getViewData(n,o.id),u=apex.aiHook?.aiEnabled?{ajax:{ajaxId:apex.aiHook.ajaxId.codeEditor}}:null;let g;c.readOnly=d,c.initialValue="",c.isChanged=!1,["sql","plsql"].includes(o.language)&&(g=function(e,t){a.process("getHints",{x01:n.schema,x02:e.search,x03:e.parent,x04:e.grantParent},{success:t})}),r.editorReady=new Promise((i=>{s.codeEditor(e.extend({language:o.language,autofocus:!1,readOnly:d,codeComplete:g,value:"",ai:u,onInitialized:e=>{i(e)},heightFn:function(){return t.height()}},e.apex.codeEditor.preferencesObjectFromString(Z)))})),r.refreshData(n,o),r.editorReady.then((e=>{const t=e.getModel();t.onDidChangeContent(i.debounce((()=>{const e=t.getValue(),i=c.initialValue!==e;c.isChanged=i,l.getIsChanged()!==i&&de.updateDocState()}),200,!0))}))},refreshData:function(e,t){const i=t.id,n=e.tabPanel$.find(`${D}${i} .ob-vtype-editor`),o=this,r=o.getViewData(e,t.id),s=de.getDocDescriptor();a.plugin({regions:[{id:te,ajaxIdentifier:ie,op:"fetch",dataShape:"text",objectType:e.type,objectId:e.id,objectName:e.name,view:i,owner:e.owner,parsingSchema:e.schema}]},{loadingIndicator:n,loadingIndicatorPosition:"centered"}).then((i=>{let a=(i.regions[0].text||"").replace(/\r?\n/g,"\n");o.editorReady.then((()=>{r.initialValue=a,r.isChanged=!1,!1!==s.getIsChanged()&&de.updateDocState(),Be(n,a,e.id+"_"+t.id)}))}))},focus:function(e){e.find(T).codeEditor(y)},resize:function(e){e.find(T).codeEditor("resize")},getState:function(e){let t=null,i=e.find(T).codeEditor("getEditor").getPosition();return i&&(t={l:i.lineNumber,c:i.column}),t},save:function(e,t){const i=e.find(T),n=t.schema,r=t.id,s=i.codeEditor("getValue"),l=de.getDocDescriptor(),d=this.getViewData(t,t.currentViewId);a.plugin({regions:[{id:te,ajaxIdentifier:ie,op:"save",dataShape:"text",objectType:t.type,objectId:r,objectName:t.name,view:t.currentViewId,owner:t.owner,parsingSchema:n,text:s}]},{loadingIndicator:i,loadingIndicatorPosition:"centered"}).then((e=>{let a=e.regions[0],c=a.errors||[],u=!1;if(i.codeEditor(w,"errors",c),0===c.length?(u=!0,d.initialValue=s,d.isChanged=!1,!1!==l.getIsChanged()&&de.updateDocState(),i.codeEditor("resetUndoRedoStack"),a.success&&o.showPageSuccess(a.success)):o.hidePageSuccess(),t.models){const e=t.models.get("ERRORS");e&&e.clearData()}Ve(u,t,r,n)}))},getViewReadOnly:function(e,t){return this.getViewData(e,t).readOnly},setViewReadOnly:function(e,t,i,n){this.getViewData(t,i).readOnly=n,e&&e.find(T).codeEditor("option","readOnly",n)},getViewIsChanged:function(e,t){return this.getViewData(e,t).isChanged},clearViewChanges:function(e,t,i){const n=this.getViewData(t,i);e&&e.find(T).codeEditor("setValue",n.initialValue),n.isChanged=!1},getViewData:function(e,t){const i=e.data;return i.has(t)||i.set(t,{initialValue:"",isChanged:!1,readOnly:!0}),i.get(t)}}),je(Ne,{render:function(e,t,i){const n=`ob_${t.type}_${i.id}_${t.id}_`,o=i.subViews;e.markup('<div class="ob-vtype-nvpeditor" role="region"').attr(g,i.label).markup(">"),Me(e,o[0].heading,n+"nvp","ob-vtype-nvp",n+"nvp_label"),Me(e,o[1].heading,n+"editor","ob-vtype-editor",n+"editor_label"),e.markup("</div>")},initializeView:function(i,n,o){const a=n.modelIds[0],r=i.find(E),s=o.subViews[0],l=$e(0,a,0,n.columns.get(o.id+"_"+s.subId),{owner:n.owner}),d=i.find(T),c=o.subViews[1],u=apex.aiHook?.aiEnabled?{ajax:{ajaxId:apex.aiHook.ajaxId.codeEditor}}:null;i.find(".ob-vtype-nvpgrid").height(i.height()).width(i.width()),d.css("height","600px").codeEditor(e.extend({language:c.language,autofocus:!1,readOnly:c.readOnly,value:"",ai:u},e.apex.codeEditor.preferencesObjectFromString(Z))),t.multipleFetch({regions:[{id:te,ajaxIdentifier:ie,op:"fetch",dataShape:"text",objectType:n.type,objectId:n.id,objectName:n.name,view:o.id,subView:c.subId,owner:n.owner,parsingSchema:n.schema}]},{loadingIndicator:i,loadingIndicatorPosition:"centered"},[a]).done((e=>{let t=e.regions[0].text;r.recordView(l),d.codeEditor("setValue",t)}))},refreshData:function(e,i){const n=i.id,o=e.tabPanel$.find(D+n),a=o.find(E),r=o.find(T),s=i.subViews[0],l=i.subViews[1],d=e.models.get(n+"_"+s.subId),c=d.modelId();d.clearData(!1),t.multipleFetch({regions:[{id:te,ajaxIdentifier:ie,op:"fetch",dataShape:"text",objectType:e.type,objectId:e.id,objectName:e.name,view:i.id,subView:l.subId,owner:e.owner,parsingSchema:e.schema}]},{loadingIndicator:o,loadingIndicatorPosition:"centered"},[c]).done((t=>{let n=t.regions[0].text||"";a.recordView(I),Be(r,n,e.id+"_"+i.id)}))},focus:function(e){e.find(T).codeEditor(y)},resize:function(){},getState:function(){return null}}),e(document.body).on("codeeditorpreferenceschanged",(function(t){const i=e(t.target).codeEditor("getPreferencesString"),n=e.apex.codeEditor.preferencesObjectFromString(i);e(".a-MonacoEditor").each((function(){this!==t.target&&e(this).codeEditor("option",n)})),Z=i,a.process("setPreference",{x01:q,x02:Z},{dataType:""})}));function Ue(e){return e.match(/^(N?VARCHAR2?|N?CHAR|)$/)?"VARCHAR2":e.match(/^(NUMBER|FLOAT|BINARY_DOUBLE|BINARY_FLOAT)$/)?"NUMBER":"DATE"===e?"DATE":e.match(/^TIMESTAMP.*\)$/)?"TIMESTAMP":e.match(/^TIMESTAMP.*WITH TIME ZONE$/)?"TIMESTAMP_TZ":e.match(/^TIMESTAMP.*WITH LOCAL TIME ZONE$/)?"TIMESTAMP_LTZ":e}function Fe(e,t){return`<button type='button' class='a-Button a-Button--noLabel a-Button--iconTextButton a-Button--edit' title='${e}' ${g}='${e}' data-action='${t}'><span aria-hidden='true' class='a-Icon icon-ob-edit'></span></button>`}const qe={renderUI:function(e){const t=i.htmlBuilder();return this.views.forEach((i=>{t.markup(`<div id="ob_view_${i.id}" class="ob-view-${i.id}">`),Le(i.type).render(t,e,i),t.markup("</div>")})),t.toString()},initUI:function(e,t){e.tabPanel$=t},destroyUI:function(e,i){for(const[,i]of e.models)t.release(i.modelId());this.saveState(e,i)},getViewDef:function(e){return this.views.find((t=>t.id===e))},saveState:function(e,t){for(let i of e.initializedViews){let n=e.id+"_"+i,o=this.getViewDef(i),a=t.children().filter(D+i),r=Le(o.type).getState(a);r&&F.set(n,r)}},activate:function(t,i,n,o){let a,r=i.lookup("change-view");if(t.currentViewId=null,this.type!==re){let e=this.views.map((e=>({label:e.label,value:e.id})));re=this.type,r.choices=e,o.find("[role=tablist]").html(this.views.map((e=>`<li><a aria-hidden="true" href="#ob_view_${e.id}">${e.label}</a></li>`)).join(""))}o.tabs("instance").active=e(),o.tabs("refresh"),a=U.get(t.type)||r.choices[0].value,r.set(a)},getActiveView:function(e){return e.currentViewId},refreshData:function(e){const i=e.currentViewId,n=this.getViewDef(i),o=Le(n.type);let a;if(o.refreshData)return this.saveState(e,e.tabPanel$),void o.refreshData(e,n);if(n.subViews){let r=[],s=e.tabPanel$.children(D+i);n.subViews.forEach((t=>{a=e.models.get(i+"_"+t.subId),a&&(r.push(a.modelId()),a.clearData(!1))})),t.multipleFetch(null,{loadingIndicator:s,loadingIndicatorPosition:"centered"},r).done((()=>{o.refresh(s)}))}else a=e.models.get(i),a&&a.clearData()},download:function(t,i){const r=t.currentViewId;if(r){let s,l,d=null,u=this.getViewDef(r);if(u.type===Re)d=u.subViews[1],s=r+"_"+d.subId,d=d.subId;else if(u.type===Ne)d=u.subViews[1].subId,i="TEXT";else if(u.type===Oe)s=r;else{if(u.type!==Ae)return;i="TEXT"}if(l={format:i},s){let i=t.models.get(s);if(i){e.extend(l,i.getOption("fetchData"));const t=i.getOption("fields"),n=[];for(const[e,i]of W(t))i.virtual||i.hidden||n.push({name:e,seq:i.seq});n.sort(((e,t)=>e.seq-t.seq)),l.columns=n.map((e=>e.name))}}!function(e,t,i,r){const s="TEXT"===r.format,l=s?te:Q;a.plugin({regions:[{dataShape:s?"text":"table",parsingSchema:e.schema,owner:e.owner,objectType:e.type,objectId:e.id,objectName:e.name,view:t,subView:i,id:l,ajaxIdentifier:s?ie:ee,download:r}]},{loadingIndicator:e.tabPanel$,loadingIndicatorPosition:"centered"}).done((e=>{const t=e.regions&&e.regions[0];if(t&&t.download&&t.download.id){o.showPageSuccess(n.getMessage("APEX.IG.FILE_PREPARED"));let e=a.ajaxUrl({regions:[{id:l,ajaxIdentifier:ee,downloadFileId:t.download.id}],salt:$v("pSalt")});c.download(e)}}))}(t,r,d,l)}},resize:function(e){const t=e.currentViewId;if(t&&e.initializedViews.has(t)){let i=this.getViewDef(t),n=e.tabPanel$,o=n.children().filter(D+t);o.height(n.height()).width(n.width()),Le(i.type).resize(o)}},activateView:function(i,n){const o=this.type+"_"+n,a=i.tabPanel$,r=this.getViewDef(n),l=i.tabPanel$.children(),d=e("#obObjectDocToolbar");let c,u;i.currentViewId=n,se&&(u=H.get(se),u&&u.forEach((e=>{s.hide(e)})),se=null),u=H.get(o),u&&u.forEach((e=>{s.show(e)})),d.toolbar("findElement","actions_button").toggle("TABLE"===i.type&&"MAIN"===n),c=l.hide().filter(D+n).show(),c.height(a.height()).width(a.width());let g=Le(r.type);i.staleViews.has(n)&&i.initializedViews.has(n)&&i.dataColumns&&n===S&&g.destroyView&&(g.destroyView(c),t.release(i.models.get(n).modelId()),i.dataColumns=null,i.initializedViews.delete(n)),i.initializedViews.has(n)?(g.resize(c),i.staleObjects.size>0&&g.checkDepends&&g.checkDepends(i,r)&&i.staleViews.add(n),i.staleViews.has(n)&&this.refreshData(i)):this.initializeView(c,i,r),i.staleViews.delete(n),U.set(i.type,n)},loadViewData:function(n,o,r,s,l,d=this.getViewDef(o)){const c=n.schema,u=n.owner,g=n.type,f=n.id,h=n.name,p=ze(g,f,o);let m;function b(e,t){t.updateActions&&e.subscribe({onChange:function(e){"addData"!==e&&"refresh"!==e||t.updateActions(n)}})}if(null===d.columns&&o===S){let e,b="COLUMNS",w=this.getViewDef(b);if(w||(e="COLS",b="MAIN",w=this.views.find((e=>e.id===b)).subViews.find((t=>t.subId===e))),m=t.get(p),m)n.dataColumns=m.getOption("fields"),n.modelId=p,n.models.set(o,m);else{l=!0,a.plugin({regions:[{dataShape:"table",parsingSchema:c,owner:u,objectType:g,objectId:f,objectName:h,view:b,subView:e,id:Q+"COLUMNS",ajaxIdentifier:ee,fetchData:{version:1,firstRow:1,maxRows:null}},{dataShape:"table",parsingSchema:c,owner:u,objectType:g,objectId:f,objectName:h,view:S,id:Q+S,ajaxIdentifier:ee,fetchData:{version:1,firstRow:1,maxRows:100}}]},{loadingIndicator:r,loadingIndicatorPosition:"centered"}).done((e=>{if(e.regions&&2===e.regions.length){let t=e.regions[0].fetchedData.values;t=function(e,t,n,o){let a=0,r=0,s={};if(n){const e=he("EDIT_DATA");s.ROWID={index:0,hidden:!0,canHide:!1},r=1,s.ROW_ACTIONS={hidden:!1,readonly:!1,escape:!0,label:e,heading:`<span class='u-vh'>${e}</span>`,headingAlignment:"center",alignment:"center",seq:1,noStretch:!0,canSort:!1,isRequired:!1,canHide:!1,noCopy:!1,defaultValue:"",cellTemplate:Fe(e,"row-edit"),columnCssClasses:"has-button",virtual:!0,noHeaderActivate:!0,width:42}}a=r;for(let n=0;n<t.length;n++){let r=t[n];if("Y"===r[13])continue;let l=Ue(r[2]),d={DATA_TYPE:r[2],LENGTH:r[3],PRECISION:r[5],SCALE:r[6]},c=r[11],u=r[12],g={index:a,seq:a+1,heading:i.escapeHTML(r[1]),headingAlignment:"start",alignment:"start",isRequired:r[7].startsWith("N"),readonly:!0,width:120,noStretch:!1,canSort:!1,dataType:l,dataLength:r[3],noCopy:parseInt(r[9],10)>0,serverDataType:i.applyTemplate(o,{extraSubstitutions:d}),comment:r[10],nullable:r[7]};a>30&&(g.hidden=!0),"ALWAYS"===c||"Y"===u||"SDO_GEOMETRY"===l?(g.isRequired=!1,g.noCopy=!0):["VARCHAR2","NUMBER","DATE","TIMESTAMP","TIMESTAMP_TZ","TIMESTAMP_LTZ","CLOB"].includes(l)?(g.elementId=`O_${e}_COL_${n+1}`,g.readonly=!1,g.canSort=!0):g.cellTemplate="["+i.escapeHTML(l)+"]","NUMBER"===l&&(g.headingAlignment="end",g.alignment="end"),s[r[1]]=g,a+=1}return n&&(s._meta={index:a,hidden:!0,canHide:!1}),s}(f,t,d.modelEditable,w.columns.DATA_TYPE.cellTemplate),n.dataColumns=t,m=He(p,c,u,g,f,h,o,d,t,e.regions[1].fetchedData),n.modelId=p,n.models.set(o,m),s()}}))}}else if(d.columns){let i;if(m=t.get(p),o===O){const e=he("EDIT_IMPORT");i={ROW_ACTIONS:{hidden:!1,readonly:!1,escape:!0,label:e,heading:`<span class='u-vh'>${e}</span>`,headingAlignment:"center",alignment:"center",seq:1,noStretch:!0,frozen:!0,canSort:!1,isRequired:!1,noCopy:!1,canHide:!1,defaultValue:"",cellTemplate:Fe(e,"import-edit"),columnCssClasses:"has-button",headingCssClasses:"has-button",virtual:!0,noHeaderActivate:!0,width:42},...d.columns};let t=0;for(const[e,n]of W(i))["ROW_ACTIONS","ORIGINAL_IMPORT_NAME"].includes(e)||(n.elementId=`O_${f}_COL_${t+1}`,n.readonly=!1,n.canSort=!0,t+=1);n.dataColumns=i}else i=e.extend(!0,{},d.columns);if(m)l=!1;else if(m=He(p,c,u,g,f,h,o,d,i),l){const e=m.fetch();e?e.then(s):s()}b(m,d),n.modelId=p,n.models.set(o,m),n.columns.set(o,i)}else if(d.subViews){let i=!1,a=[];for(let r=0;r<d.subViews.length;r++){let s=d.subViews[r];if(s.columns){let r=o+"_"+s.subId,l=ze(g,f,r),p=t.get(l),m=e.extend(!0,{},s.columns);a.push(l),p||(p=He(l,c,u,g,f,h,o,s,m),i=!0),n.models.set(r,p),n.columns.set(r,m),b(p,d)}}if(n.modelIds=a,l&&i){const e=t.multipleFetch(null,{loadingIndicator:r,loadingIndicatorPosition:"centered"},a);e?e.then(s):s()}}l||s()},initializeView:function(e,t,i){let n=Le(i.type);this.loadViewData(t,t.currentViewId,e,(function(){n.initializeView(e,t,i),t.initializedViews.add(i.id)}),!1,i)},checkRemove:function(e){let t=null;return e.getIsChanged()&&(t=he("CLOSE_WARNING")),t},clear:function(e){for(const[,t]of e.data)t.isChanged=!1},save:function(e){const t=e.currentViewId,i=Le(this.getViewDef(t).type),n=e.tabPanel$.children(D+t);if(i.save)return i.save(n,e)},getViewReadOnly:function(e,t){const i=Le(this.getViewDef(t).type);return!!i.getViewReadOnly&&i.getViewReadOnly(e,t)},setViewReadOnly:function(e,t,i){const n=Le(this.getViewDef(t).type),o=e.tabPanel$.children(D+t);n.setViewReadOnly&&n.setViewReadOnly(o,e,t,i)},getViewIsChanged:function(e,t){const i=Le(this.getViewDef(t).type);return!!i.getViewIsChanged&&i.getViewIsChanged(e,t)},clearViewChanges:function(e,t){const i=Le(this.getViewDef(t).type),n=e.tabPanel$.children(D+t);i.clearViewChanges&&i.clearViewChanges(n,e,t)}};const Ge=new Map;let Je=1;function Ke(e,t,i){if(e.hasSQL){i&&(t.find("#"+e.sqlPreviewId).text(e.ddl),Prism.highlightAll());let n=t.find("#"+e.sqlRegionId);n.find(".preview").toggle(i),n.find(".previewMessage").toggle(!i)}}function We(t,i){const o=e("#"+t,apex.gPageContext$),a=o.find("a-model-cursor")[0],r=o.find(".js-ok,.js-copy"),s=Ge.get(t),l=s.args;let d=null;a&&(a.recordId="");for(const[e,t]of W(l))$s(t,i[e]||"");if(i.dialogTitle?d=i.dialogTitle:i.dialogTitleArgs&&s.titleTemplate&&(d=n.format(s.titleTemplate,...i.dialogTitleArgs)),d&&o.dialog(w,"title",d),s.open&&s.open(o,i),s.validate){const e=s.validate(o,!0);Ke(s,o,e),r.prop("disabled",!e)}return u.openRegion(t),s.postOpen&&s.postOpen(o,i),!0}function Xe(e,t){const i=de.getDocDescriptor();t&&i&&i.id===e&&t.forEach((e=>{i.staleViews.add(e)}))}return{initialize:function(t){const i=t.preferences||{};ie=t.codeAjaxIdentifier,te=t.codeRegionId,ee=t.gridAjaxIdentifier,Q=t.gridRegionId,ne=t.links||{},Z=i[q]||"",s.add([{name:"refresh-view",label:fe("REFRESH"),icon:"icon-ob-refresh",action:function(){oe&&oe.refreshData(ae)}},{name:"change-view",label:fe("CHANGE_VIEW"),get:function(){return oe?oe.getActiveView(ae):"NONE"},set:function(e){oe&&e!==ae.currentViewId&&(ae.currentViewId&&(se=oe.type+"_"+ae.currentViewId),oe.activateView(ae,e),de.syncViewTabs(e))},choices:[]},{name:"open-object",labelKey:"OB.ACTION_OPEN_OBJECT",action:function(e,t,i){if(i&&i.id&&i.label&&i.type){let e=i.type.replace(" ","_"),t=i.owner,a=i.owner,r=ge(a);return r?("PACKAGE_BODY"===e&&(e="PACKAGE"),de.openDocument(be(e,t,i.label,i.id,a,r)),!0):void o.alert(n.formatMessage("OB.NO_SCHEMA",a))}}},{name:"goto-error",labelKey:"OB.ACTION_GOTO_ERROR",action:function(e,t,i){if(i&&i.view&&i.line&&i.column){let e=i.view,t=i.line,n=i.column;if(e&&t&&n){s.set("change-view",e),t=Y(t),n=Y(n);const i=ae.currentViewId,o=ae.getCurrentView().find(".a-MonacoEditor"),a=F.get(ae.id+"_"+i);a&&(a.l=t,a.c=n),o.codeEditor("gotoPosition",t,n,!0)}return!0}}},{name:"copy-query",label:fe("COPY"),action:function(){apex.clipboard.copy()}},{name:"run-query",label:fe("RUN"),action:function(e,t,i){i&&i.url&&c.redirect(i.url.replaceAll("%26","&"))}},{name:"choose-columns",label:fe("COLUMNS"),icon:"icon-ob-columns",hide:!0,action:function(){return We("dialogColumns",{grid$:ae.getCurrentView().find(C)})}},{name:"filter",label:fe("FILTER"),icon:"icon-ob-filter",hide:!0,action:function(){return We("dialogFilter",{grid$:ae.getCurrentView().find(C)})}},{name:"download-excel",label:fe("DL_EXCEL"),icon:"icon-ob-download",hide:!0,action:function(){oe&&oe.download(ae,"XLSX")}},{name:"download-text",label:fe("DL_TEXT"),icon:"icon-ob-download",hide:!0,action:function(){oe&&oe.download(ae,"TEXT")}},{name:"create-current-object-type",label:null,contextLabelKey:"OB.ACTION_CREATE_CURRENT",hide:!0,action:function(e,t,i){if(this.createActionName)return s.invoke(this.createActionName,e,t,i)}},{name:"mle-env-import-row-delete",labelKey:"OB.ACTION_DROP_IMPORT",icon:"icon-ig-delete",action:function(e,t){const i=ae.models.get(O),n=De(t,ae.getCurrentView().find(C));n&&i.deleteRecords([n])}},{name:"mle-env-import-row-revert",labelKey:"APEX.IG.REVERT_CHANGES",icon:"icon-ig-revert",action:function(e,t){const i=ae.models.get(O),n=ae.getCurrentView().find(C),o=De(t,n);o&&(n.grid(y),i.revertRecords([o]))}},{name:"mle-env-import-selection-delete",labelKey:"OB.ACTION_DROP_IMPORT",icon:"icon-ig-delete",action:function(){const e=ae.models.get(O),t=ae.getCurrentView().find(C);if(!e||!t[0])return;let i=t.grid("getSelectedRecords");for(let t=0;t<i.length;t++)e.allowDelete(i[t])||(i.splice(t,1),t-=1);i.length>0&&e.deleteRecords(i)}},{name:"mle-env-import-selection-revert",labelKey:"APEX.IG.REVERT_CHANGES",icon:"icon-ig-revert",action:function(){const e=ae.models.get(O),t=ae.getCurrentView().find(C);if(!e||!t[0])return;let i=t.grid("getSelectedRecords");for(let t=0;t<i.length;t++)e.canRevertRecord(i[t])||(i.splice(t,1),t-=1);i.length>0&&e.revertRecords(i)}},{name:"row-edit",labelKey:"OB.EDIT_DATA",action:function(e,t){const i=ae.getCurrentView().find(C);return We("dialogRowEdit",{model:ae.models.get(S),record:De(t,i),dialogTitle:he("EDIT_DATA"),pageMode:"E"})}},{name:"import-edit",labelKey:"OB.EDIT_IMPORT",action:function(e,t){const i=ae.getCurrentView().find(C);return We("dialogImportEdit",{model:ae.models.get(O),record:De(t,i),dialogTitle:he("EDIT_IMPORT"),pageMode:"E"})}}]),z.forEach((e=>{const t=e.actions,i=[];for(let e=0;e<t.length;e++){let n=t[e];"string"==typeof n?i.push(n):(n.hide=!0,s.add(n),i.push(n.name))}H.set(e.type+"_"+e.view,i)}));for(const[e,t]of W(ne))if(t.startsWith("javascript:apex")){let i=/\('([^']+)',\{([^}]+)}/.exec(t);if(i){let n="{"+i[2].replaceAll("'",'"').replace(/(\w+):/g,((e,t)=>'"'+t+'":'))+"}";try{ne[e]={url:i[1].replace(/\\u([0-9A-F]{4})/gi,((e,t)=>String.fromCharCode(parseInt(t,16)))),options:JSON.parse(n)}}catch(e){l.error("Invalid url",t)}}}setTimeout((()=>{s.list().forEach((e=>{if(e.name.startsWith("create-")){const t=s.lookup(e.name);if("a-dialog-open"===t?.actionBinding?.actionName){let e=s.lookup(t.actionBinding.actionName);const i=e.action;e.action=function(e,t,n){n.url=n.url.replaceAll("~PARSING_SCHEMA~",ce()),i(e,t,n)}}}}))}),0);const a=Te(t.treeRegionId,t.treeAjaxIdentifier);de.init("obObjectDoc",{initToolbar:Se}),le.element.on("change",(function(){de.checkAndCloseDoc().then((e=>{if(e){let e=Ie(a),t=e.getOption("regionData"),i=ce();t.parsingSchema=i,_e(),e.clearData()}else le.setValue(de.getDocDescriptor().schemaId,null,!0)}))})),apex.gPageContext$.on("apexreadyend",(function(){!function(e){let t=k.getItem(x);if(t){try{if(t=JSON.parse(t),!X(t))throw new Error("Invalid open tabs")}catch(e){return void l.warn("Failed to restore previous open tabs",e)}for(let i=0;i<t.length;i++){let n=!1,o=t[i];if(null!==o&&"object"==typeof o&&4===Object.keys(o).length){let t,i,{type:a,id:r,schemaId:s,view:l}=o,d=B.get(a);if(0===[a,r,s,l].filter((e=>"string"!=typeof e)).length&&d&&(t=le.displayValueFor(s),i=e[r],t!==s&&i&&d.getViewDef(l))){let e=be(a,t,i,r,t,s);U.set(e.type,l),de.openDocument(e),n=!0}}n||l.warn("Invalid previous tab data ignored")}}let i=k.getItem(A);if(i){try{if(i=JSON.parse(i),!X(i))throw new Error("Invalid view state")}catch(e){return void l.warn("Failed to restore previous view state",e)}for(let t=0;t<i.length;t++){let n=i[t],o=n.k,a=n.v;"string"==typeof o&&"object"==typeof a&&e[o.split("_")[0]]&&F.set(o,a)}}}(t.cachedIds)})),e(window).on("unload",(()=>{let e=a.treeView("getExpandedNodeIds").join(":"),t=a.treeView("getSelectedNodes")[0],i=[];k.setItem(N,e),k.setItem(j,t?t.id:""),k.setItem(P,Ce());let n=de.getDocDescriptor();pe(n.type).saveState(n,n.tabPanel$),i.push({schemaId:n.schemaId,type:n.type,id:n.id,view:n.currentViewId});let o=[];for(const[e,t]of F.entries())o.push({k:e,v:t});k.setItem(x,JSON.stringify(i)),k.setItem(A,JSON.stringify(o)),k.setItem(R,ue())})).on("beforeunload",(()=>{const e=de.getDocDescriptor();if(e){const t=e.checkRemove();if(t)return t}})),e(document).on("apexafterclosedialog",(function(e,t){const i=Ie(a);let n="P"+t.dialogPageId+"_",o=t[n+"OBJECT_TYPE"],r=t[n+"NAME"],s=t[n+"OBJECT_ID"],d=t[n+"INVALIDATE"],c=t[n+"OBJECT_STATUS"]===G,u=t[n+"PARSING_SCHEMA"]||ce();if(o&&r&&s){if(u===ce()){const e=i.root().children.find((e=>e.id===o));if(e){let t=-1,n={type:o,id:s};e.children.length>0&&(t=e.children.findIndex((e=>e.label>r)),t<0&&(t=e.children.length),t-=1),c&&(n.classes="is-error",n.status=G),i.addNode(e,t,r,n,(()=>{}))}else l.error("Node type not found in tree",o)}ve(o,r,u,s,u,c)}if(d){let e,t;try{e=JSON.parse(d),t=e.affectedObjects}catch(e){l.error("Invalid data to invalidate"),t=null}if(e&&(e.refreshTree&&i.clearData(),e.refreshView&&oe.refreshData(ae)),t)for(const e of t)e.objId&&X(e.views)?Xe(e.objId,e.views):l.error("Invalid object to invalidate")}})),u.initResponsiveDialogs(),e("html").removeClass("no-js")},registerObjectType:function(e,t){const i=Object.create(qe);Object.assign(i,t),i.type=e,B.set(e,i),L[e+J]={icon:t.icon},i.views.forEach((t=>{t.label||(t.label=n.getMessage("OB.VIEW_"+(t.labelKey||t.id)),delete t.labelKey),t.subViews&&t.subViews.forEach((e=>{e.heading||(e.heading=n.getMessage("OB.SV_"+e.headingKey),delete e.headingKey)})),t.actions&&z.push({type:e,view:t.id,actions:t.actions})}))},typeDisplayName:me,getCurrentInstance:function(){return ae},doLinkAction:function(t,i,n){let o,a=ne[i];if(a){"object"==typeof a&&(o=a.options,a=a.url);for(const[e,t]of W(n))a=a.replaceAll("~"+e+"~",t);if(o)return c.dialog(a,o,"a-Dialog--wizard",e(t)),!0;c.redirect(a)}else l.error("No such link with name ",i)},sendDDL:function(e,t,i,n){return new Promise((o=>{a.plugin({regions:[{id:te,ajaxIdentifier:ie,parsingSchema:e,owner:t,ddl:i}]},{loadingIndicator:n,loadingIndicatorPosition:"centered",success:function(e){let t=e.regions[0];o({success:"SUCCESS"===t.status,message:t.message})}}).fail(((e,t,i)=>{o({success:!1,message:i})}))}))},sendCommand:function(e,t,i,n={},o){return new Promise((r=>{a.plugin({regions:[{id:te,ajaxIdentifier:ie,parsingSchema:e,owner:t,command:i,in:n}]},{loadingIndicator:o,loadingIndicatorPosition:"centered",success:function(e){let t=e.regions[0];r({success:"SUCCESS"===t.status,message:t.message,result:t.out})}}).fail(((e,t,i)=>{r({success:!1,message:i})}))}))},invalidateViews:Xe,doc:de,initDialog:function(t,n,a){const r=e("#"+t,apex.gPageContext$),s=r.attr("data-bind-cursor"),c=r.find(".js-ok"),g=r.find(".js-create"),f=r.find(".js-save"),h=r.find(".js-delete");if(r[0]){if(n&&W(a.args).forEach((([e,t])=>{a.args[e]=n+t})),Ge.set(t,a),a.hasSQL){const t=e(e("#sqlPreviewRegion")[0].content).children().first().clone(),i="sqlRegion_"+Je,n="sqlPreview_"+Je,o="sqlCopy_"+Je;Je+=1,t.attr("id",i).find(".previewSQL").attr("id",n).parent("pre").attr("id",o),t.find(".js-copy").attr("data-clipboard-source","#"+o),r.find(".b-OB-sqlPreview").append(t),a.sqlPreviewId=n,a.sqlRegionId=i,t.show()}if(a.titleIsTemplate&&e((()=>{a.titleTemplate=r.dialog(w,"title")})),s&&r.append(`<a-model-cursor id="${s}" explicit-store="true"></a-model-cursor>`),a.initialize&&e(document).on("apexreadyend",(()=>{a.initialize(r)})),a.validate){const t=t=>{if(!r.dialog("isOpen"))return;const i="change"===t.type;let n=!0;if(i){const i=function(t){let i=t.target.id;return i||(i=e(t.target).closest(".a-Form-fieldContainer").attr("id").replace("_CONTAINER","")),d.isItem(i)?d(i):null}(t);i&&i.element.is(":visible")&&(n=i.getValidity().valid,n?o.clearErrors(i.id):o.showErrors({type:"error",location:"inline",pageItem:i.id,message:i.getValidationMessage()}))}n&&(n=a.validate(r,i,t)),Ke(a,r,n),c.prop("disabled",!n),r.find(".js-copy").prop("disabled",!n)};r.on("change",(e=>{t(e)})),r.on("input","input,textarea",i.debounce(t,200))}r.on("dialogclose",(function(){let e=r.find("a-model-cursor")[0];e&&(e.modelId="")})),r.find(".js-cancel").on("click",(()=>{u.closeRegion(t)})),c.on("click",(()=>{const e=Ge.get(t);e.onOk(r).then((({success:i,message:n})=>{if(i){if(u.closeRegion(t),e.updateActions){let e=pe(ae.type).getViewDef(ae.currentViewId);e.updateActions&&e.updateActions(ae)}}else n?o.alert(n):u.closeRegion(t)}))})),g.on("click",(()=>{a.onCreate(r)})),f.on("click",(()=>{a.onSave(r)})),h.on("click",(()=>{a.onDelete(r)}))}else l.error("No such dialog ",t)},openDialog:We,removeFromTree:function(e){const t=Ie(we()),i=t.getRecord(e);i&&t.deleteNode(i,(()=>{})),de.closeDocument(e)},updateInvalidState:Ve,viewTypes:{GRID:Oe,GRIDS:xe,NVP:"nvp",EDITOR:Ae,NVP_GRID:Re,NVP_EDITOR:Ne},getSchema:ce}}(apex.jQuery,apex.model,apex.util,apex.lang,apex.message,apex.server,apex.storage,apex.actions,apex.debug,apex.item,apex.navigation,apex.theme);