/*!
 * Copyright (c) 2019, 2022, Oracle and/or its affiliates.
 */
!function(e,t,o){"use strict";const s=apex.util.hasOwnProperty,a=apex.env.APEX_FILES,i=["apex_ui/css/DevTools.css"],n=["APEX.LTO.COMMON","APEX.LTO.ADVANCED","APEX.LTO.NO_OPTIONS_FOUND","APEX.LTO.NOT_APPLICABLE","APEX.LTO.LIVE_TEMPLATE_OPTIONS","APEX.LTO.CANCEL","APEX.LTO.SAVE"];let r=0,p=!1,l=[],d=!1;const c=function(e){for(var t in e)s(e,t)&&(this[t]=e[t])};c.prototype={getValues:function(){return apex.templateOptionsHelper.getValuesFromDialog(this.properties,this.propertyEditor.el$).join(":")},resetClasses:function(){void 0!==this.el$[0]&&(this.el$[0].className=this.originalClassName)},destroy:function(){this.hasOptions&&this.propertyEditor.el$.propertyEditor("destroy"),this.propertyEditor.el$.remove()}},e.widget("apex.liveTemplateOptions",{options:{componentId:"",data:{},onSave:function(e){e()}},_resetClassNames:function(){this.components.forEach((function(e){e.resetClasses()}))},_destroyComponents:function(){this.components.forEach((function(e){e.destroy()})),e("#apex_lto_rds").remove()},_buildComponents:function(){var o=this.options;this.components=[];for(const[n,r]of Object.entries(o.data)){var s=function(){var t=e(".lto"+o.componentId+"_"+n);return t.length<=0&&(t=e(".lto"+o.componentId+"_"+n,e("iframe").contents())),t}(this.element),a=apex.templateOptionsHelper.getProperties(r,(r.currentValues||"").split(":")),i=new c({title:r.title,defaultValues:r.defaultValues,properties:a,propertyEditor:{el:"",options:{propertySet:[{displayGroupId:"common",displayGroupTitle:t.getMessage("APEX.LTO.COMMON"),properties:a.common},{displayGroupId:"advanced",displayGroupTitle:t.getMessage("APEX.LTO.ADVANCED"),properties:a.advanced}]}},el$:s,originalClassName:s[0]?s[0].className:"",hasOptions:a.common[0].metaData.lovValues.length>0});this.components.push(i)}return!0},_render:function(){var s=this.element,a=this,i=e('<div class="apex-rds-container" id="apex_lto_rds"><ul class="apex-rds"></ul></div>'),n=e('<div class="a-DevTools--info"><span class="t-Icon fa fa-info-circle"></span><span class="a-DevTools--info-message"></span></div>');e("body").append(i);var p=i.find(".apex-rds");for(let o of this.components){var l=o.el$,c="liveTemplateOptionsTab"+r;r+=1,p.append("<li><a href='#"+c+"'>"+o.title+"</a></li>");var u=o.propertyEditor.el$=e("<div id='"+c+"'>");i.append(u),o.hasOptions?(u.propertyEditor({data:o.propertyEditor.options,change:function(e,t){var s,a=function(e){var t=!1,s=(e||"").split(":").filter((function(e){return"#DEFAULT#"!==e||(t=!0,!1)})).join(" ");return t&&(s+=" "+o.defaultValues.join(" ")),s},i=a(t.property.value),n=a(t.property.oldValue);s=t.property$,t.property.value===t.property.originalValue?s.removeClass("is-changed").removeClass("has-warning"):(s.addClass("is-changed"),t.property.requires_reload&&s.addClass("has-warning")),l.removeClass(n),l.addClass(i)}}),""!==o.originalClassName||u.html("<div class='a-DevTools--inner-message'>"+t.getMessage("APEX.LTO.NOT_APPLICABLE")+"</div>")):u.html("<div class='a-DevTools--inner-message'>"+t.getMessage("APEX.LTO.NO_OPTIONS_FOUND")+"</div>")}this.components.length>1?p.aTabs({classPrefix:"apex-rds",showAllScrollOffset:function(){return!1}}):p.hide();var f,v=!1,h=this.options;i.dialog({resizable:!0,draggable:!0,modal:!0,width:400,maxHeight:640,minWidth:280,height:640,dialogClass:"a-DevTools",title:t.getMessage("APEX.LTO.LIVE_TEMPLATE_OPTIONS"),position:d||{my:"left top",at:"right top",of:s,collision:"flipfit"},create:function(){e(this).closest(".ui-dialog").attr("aria-modal",!0)},close:function(){apex.navigation.endFreezeScroll(),s.css({"z-index":"",position:""}),s.parentsUntil("body").each((function(){var t=e(this);"fixed"===t.css("position")&&t.css("z-index","")})),v?e(window).trigger("apexwindowresized"):a._resetClassNames(),a.destroy(),e("#apexDevToolbar").css("z-index",""),a._destroyComponents(),f.remove()},beforeClose:function(){var t=f.offset();d=[t.left-e(window).scrollLeft(),t.top-e(window).scrollTop()]},open:function(){f||(f=i.parents(".ui-dialog")),apex.navigation.beginFreezeScroll();var t=parseInt(f.next(".ui-front").css("z-index"),10)+1;s.css({"z-index":t,position:"relative"}),s.parentsUntil("body").each((function(){var o=e(this);"fixed"===o.css("position")&&o.css("z-index",t)})),f.css("z-index",t+1),e("#apexDevToolbar").css("z-index",t-2)},buttons:[{text:t.getMessage("APEX.LTO.CANCEL"),class:"a-Button a-DevTools-toolbar-item a-DevTools-toolbar-item--push a-DevTools-toolbar-item--right a-DevTools-toolbar-button a-DevTools-container__button",click:function(){i.dialog("close")}},{text:t.getMessage("APEX.LTO.SAVE"),class:"a-Button a-Button--hot ui-button--hot a-DevTools-toolbar-item a-DevTools-toolbar-item--right a-DevTools-toolbar-button a-DevTools-container__button",click:function(){var e=[];a.components.forEach((function(t){t.hasOptions&&e.push(t.getValues())})),h.onSave(e,(function(){v=!0,i.dialog("close")}),(function(e,t,s){o.alert(JSON.parse(e.responseText).addInfo||JSON.parse(e.responseText).error||s),apex.debug(e)}))}}]}),i.parents(".ui-dialog").first().find(".ui-dialog-buttonpane").append(n)},_create:function(){var e=this,t=function(){e._buildComponents()?e._render():e.destroy()};p&&jQuery().propertyEditor&&jQuery().aTabs&&apex.templateOptionsHelper?t():(l.push(t),p||u())}});var u=e.apex.liveTemplateOptions.preload=function(){if(!p){p=!0;var o=e("head"),s=0===apex.debug.getLevel();i.forEach((function(e){o.append("<link rel='stylesheet' href='"+a+e+"' />")})),t.loadMessagesIfNeeded(n,(function(){e.when(apex.server.loadScript({path:a+"apex_ui/js/"+(s?"minified/widget.propertyEditor.min.js":"widget.propertyEditor.js")}),apex.server.loadScript({path:a+"libraries/apex/"+(s?"minified/widget.apexTabs.min.js":"widget.apexTabs.js")}),apex.server.loadScript({path:a+"apex_ui/js/"+(s?"minified/templateOptionsHelper.min.js":"templateOptionsHelper.js")})).done((function(){for(apex.templateOptionsHelper.addGeneralPropertyType();l.length>0;){var e=l.pop();e&&e()}}))}))}}}(apex.jQuery,apex.lang,apex.message);