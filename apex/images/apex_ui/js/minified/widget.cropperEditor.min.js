/*!
 * Copyright (c) 2022, 2024, Oracle and/or its affiliates.
 */
!function(e){"use strict";let t,a,i,o=!1,n={aspectRatio:1,viewMode:1,dragMode:"move",cropBoxMovable:!1,cropBoxResizable:!1,toggleDragModeOnDblclick:!1,zoom(e){const i=a.getContainerData(),o=a.getCanvasData(),n=i.height/o.naturalHeight,r=parseInt((e.detail.ratio-.8*n)/n*100,10);t.data("active")||t.val(r)},ready(){const n=a.getContainerData(),r=a.getCanvasData(),h=n.height/r.naturalHeight;a.zoomTo(0),t.val(0),t.on("input",(()=>{t.data("active",!0);const e=Number(t.val())/100;a.zoomTo(.8*h+h*e),t.data("active",!1)})),e(i).siblings(".cropper-container").attr("tabindex",0).attr("role","application").trigger("focus").keydown((function(e){switch(e.key){case"ArrowLeft":e.preventDefault(),e.shiftKey?a.move(-10,0):a.move(-1,0);break;case"ArrowUp":e.preventDefault(),e.shiftKey?a.move(0,-10):a.move(0,-1);break;case"ArrowRight":e.preventDefault(),e.shiftKey?a.move(10,0):a.move(1,0);break;case"ArrowDown":e.preventDefault(),e.shiftKey?a.move(0,10):a.move(0,1);break;case"i":a.zoom(.1);break;case"o":a.zoom(-.1);break;case"l":a.rotate(-90);break;case"r":a.rotate(90)}}));const d=a.getImageData();o=d.aspectRatio!==a.options.aspectRatio,i.addEventListener("crop",(e=>{o=d.naturalWidth!==e.detail.width||d.naturalHeight!==e.detail.height||d.rotate!==e.detail.rotate}))}},r={applyRoundedCanvas:(e,t)=>{const a=.1*t,i=a,o=2*a,n=.8*t,r=n,h=document.createElement("canvas");h.width=t,h.height=t;let d=h.getContext("2d");return d.beginPath(),d.moveTo(a+o,i),d.lineTo(a+n-o,i),d.quadraticCurveTo(a+n,i,a+n,i+o),d.lineTo(a+n,i+r-o),d.quadraticCurveTo(a+n,i+r,a+n-o,i+r),d.lineTo(a+o,i+r),d.quadraticCurveTo(a,i+r,a,i+r-o),d.lineTo(a,i+o),d.quadraticCurveTo(a,i,a+o,i),d.closePath(),d.clip(),d.drawImage(e,a,i,n,r),h},getCanvas:({width:e,height:t,minWidth:i,minHeight:o,maxWidth:n,maxHeight:h,rounded:d}={})=>{const g=a.getData();void 0===e&&(e=g.width),void 0===t&&(t=g.height);const m=a.getCroppedCanvas({width:e,height:t,minWidth:i||e,minHeight:o||t,maxWidth:n||e,maxHeight:h||t,imageSmoothingEnabled:!0,imageSmoothingQuality:"high"});return d?r.applyRoundedCanvas(m,e):m},getDataURL:({width:e,height:t,minWidth:a,minHeight:i,maxWidth:o,maxHeight:n,fileType:h,rounded:d}={})=>r.getCanvas({width:e,height:t,minWidth:a,minHeight:i,maxWidth:o,maxHeight:n,rounded:d}).toDataURL(h),getBlob:async({width:e,height:t,minWidth:a,minHeight:i,maxWidth:o,maxHeight:n,fileType:h,rounded:d}={})=>(e=>new Promise((t=>{e.toBlob(t,h)})))(r.getCanvas({width:e,height:t,minWidth:a,minHeight:i,maxWidth:o,maxHeight:n,rounded:d})),init:function({imageItemName:o,cropperOptions:r}){i=document.getElementById(o),t=e("#APEXCropperZoom");const h={...n,...r};a=new Cropper(i,h)},initZoom:function(e){t=e},isChanged:function(){return o},reset:function(){a.reset(),a.zoomTo(0),t.val(0),o=!1},destroy:function(){a&&a.destroy(),o=!1}};apex.cropperEditor=r}(apex.jQuery);