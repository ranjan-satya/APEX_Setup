/*!
 * Copyright (c) 2021, 2023, Oracle and/or its affiliates.
 */
!function(e,t,n,i,s,o,a,l,r,d,c){"use strict";const h=t.initDialog,u=t.getCurrentInstance,m=t.typeDisplayName,g=t.sendDDL,p=t.sendCommand,E=t.invalidateViews,f=t.removeFromTree,O="SELECTED",$="RECORD_VIEW_MODEL",T="OWNER",_="OBJ_NAME",v="TYPE";function A(e,t){t?e.show():e.hide()}function C(e,t){return(t.includes(" ")||t.includes('"'))&&(t=t.replaceAll(" ","_").replaceAll('"',""),$s(e,t,null,!0)),t}function D(t,n,s,o){e("#"+n).html(i.applyTemplate('{loop LIST/}<option value="&APEX$ITEM%return.">&APEX$ITEM%display.</option>{endloop/}',{extraSubstitutions:{LIST:s}})),o&&t.setValue(o)}function M(e){let t=o(e);return t.displayValueFor(t.getValue())}function N(){r.invoke("objects-refresh")}function R(e,t){let n=e.getRecord(t);e.deleteRecords([n])}h("dialogColumns","P2000_SHOW_",{args:{columns:"COLUMNS"},_resize:function(){},initialize:function(e){e.on("dialogresizestop dialogopen",(()=>{this._resize(e)}))},open:function(t,n){const s=[],o=[],a=this.args,l=e("#"+a.columns),r=n.grid$,d=r.grid("getColumns");for(const e of d)if(void 0===e.canHide||e.canHide){let t=e.label||e.heading;s.push(t),e.hidden||o.push(t)}l.html(i.applyTemplate('{loop CHECKBOXES/}<div class="apex-item-option">  <input type="checkbox" id="P2000_SHOW_COLUMNS_&APEX$I." name="P1_CBGROUP" data-display="&APEX$ITEM." value="&APEX$ITEM.">  <label class="u-checkbox" for="P2000_SHOW_COLUMNS_&APEX$I.">&APEX$ITEM.</label></div>{endloop/}',{extraSubstitutions:{CHECKBOXES:s}})),$s(a.columns,o),this._grid$=r},validate:function(){let e=this.args;return $v(e.columns).length>0},onOk:function(){let e=this.args;return new Promise((t=>{let n=this._grid$,i=o(e.columns).getValue(),s=n.grid("getColumns");this._grid$=null;for(const e of s)if(void 0===e.canHide||e.canHide){let t=e.label||e.heading;e.hidden=!i.includes(t)}n.grid("refreshColumns").grid("refresh"),t({})}))}});const I="FilterModel";let L=null,b=null;function P(e,t,n,i,s,o){let a=e;switch(e){case"VARCHAR2":case"CHAR":case"NCHAR":case"NVARCHAR2":case"RAW":if(t){let i="";"RAW"!==e&&"N"!==e[0]&&n&&(i=" "+n),a+=`(${t}${i})`}else a=null;break;case"NUMBER":i?a+=s?`(${i},${s})`:`(${i})`:s&&(a=null);break;case"FLOAT":case"TIMESTAMP":i&&(a+=`(${i})`);break;case"INTERVAL YEAR TO MONTH":o&&(a=a.split(" "),a.splice(2,0,`(${o})`),a=a.join(" "));break;case"INTERVAL DAY TO SECOND":(o||i)&&(a=a.split(" "),o&&a.splice(2,0,`(${o})`),i&&a.push(`(${i})`),a=a.join(" "));break;case"TIMESTAMP WITH TIME ZONE":case"TIMESTAMP WITH LOCAL TIME ZONE":i&&(a=a.split(" "),a.splice(1,0,`(${i})`),a=a.join(" "))}return a&&(a=a.replaceAll(" (","(")),a}h("dialogFilter","P2000_FILTER_",{args:{column:"COLUMN",op:"OP",value:"VALUE"},initialize:function(t){const i=t.find(".b-OB-addFilter").first(),s=i.html();this.formContainer$=i.parent(),this.filterModel=null,this.columnOptions$=null,L=o(this.args.column+"_XX").element.find("option").first().text(),this.rowTemplate=`<div class="b-OB-addFilter" data-bind-record="&APEX$ID." role="group" aria-label='&ROW_LABEL.'>${s.replaceAll("_XX","_&APEX$ID.")}</div>`,i.remove(),t.on("dialogclose",(()=>{n.release(I),this.filterModel=null,this.formContainer$.empty()})),t.find(".js-add").on("click",(()=>{let t=this.filterModel,n=t.getTotalRecords(!0)-1,i=t.recordAt(n),s=i.id+1;t.insertNewRecord(null,i,{id:s,column:"",op:"",value:""}),this.updateForm(),this.formContainer$.find(".b-OB-addFilter").last().find("select").first().focus(),function(t){let n=b;n&&n[0].isConnected||(n=e('<span aria-hidden="true" class="u-vh" role="alert"></span>'),e("body").append(n),b=n),n.text(""),setTimeout((()=>{n.attr("aria-hidden","false").text(t),setTimeout((()=>{n.attr("aria-hidden","true").text("")}),500)}),0)}(d.getMessage("OB.FILTER_ADDED"))})),t.on("click",".js-remove",(t=>{let n=this.filterModel,i=e(t.target).closest(".b-OB-addFilter"),s=i.parent().index(i),o=i.attr("data-bind-record");if(o){let e=n.getRecord(o);n.deleteRecords([e]),i.remove(),0===n.getTotalRecords(!0)&&n.insertNewRecord(null,null,{id:1,column:"",op:"",value:""}),this.updateForm(),this.formContainer$.find(".b-OB-addFilter").eq(s).find("select").first().focus()}})),t.on("change",".js-filter-op",(t=>{const n=e(t.target),i=n.val(),s=n.closest(".b-OB-addFilter").find("input").last();"N"===i||"NN"===i?(s.attr("disabled","disabled"),s.val("")):s.removeAttr("disabled")}))},updateForm:function(){const t={iterationCallback:function(e,t,n,i,s,o){o.ROW_LABEL=d.formatMessage("OB.FILTER_GROUP",""+(i+1))}};let n,s=`{loop FilterModel/}${this.rowTemplate}{endloop/}`;this.formContainer$.empty(),n=e(i.applyTemplate(s,t)),this.formContainer$.append(n),n.find("select.filterColumns").each(((t,n)=>{e(n).html(this.columnOptions$.clone())})),o.attach(n),n.find("select").each(((e,t)=>{o.create(t.id,{})})),l.applyBindings(this.formContainer$[0]),n.find("select").trigger("change")},open:function(t,s){const o=[],a=[],l=s.grid$,r=l.grid("getModel"),d=l.grid("getColumns");o.push({display:L,return:""});for(const e of d)if((e.canHide||!e.hidden)&&!e.virtual&&!1!==e.canFilter){let t=e.label||e.heading;o.push({display:t,return:e.property})}this.columnOptions$=e(i.applyTemplate('{loop LIST/}<option value="&APEX$ITEM%return.">&APEX$ITEM%display.</option>{endloop/}',{extraSubstitutions:{LIST:o}})),r.getOption("fetchData").filters.forEach(((e,t)=>{a.push({id:t+1,column:e.column,op:e.op,value:e.value})})),this.filterModel=n.create(I,{fields:{id:{},column:{},op:{defaultValue:"EQ"},value:{}},editable:!0,trackChanges:!1,identityField:"id",paginationType:"none"},a,a.length),this.grid$=l,this.model=r,0===a.length&&this.filterModel.insertNewRecord(null,null,{id:1,column:"",op:"",value:""}),this.updateForm()},validate:function(){let e=!0;return this.filterModel.getTotalRecords(!0)>1&&this.filterModel.forEach((t=>{const n=t.op;t.column&&n||(e=!1)})),e},onOk:function(){return new Promise((e=>{let t=[];this.filterModel.forEach((e=>{let n=["N","NN"].includes(e.op);e.column&&e.op&&(e.value||n)&&t.push({column:e.column,op:e.op,value:n?void 0:e.value})})),this.model.getOption("fetchData").filters=t,this.model.clearData(),e({})}))}}),h("dialogDropObject","P2000_DROP_DLG_",{args:{owner:T,type:"OBJ_TYPE",name:_,cascade:"CASCADE"},hasSQL:!0,open:function(e,t){let n=this.args,i=o(n.cascade);this.objId=t.id,this.schema=t.schema,A(i,"TABLE"===t.type)},validate:function(){let e=this.args,t=$v(e.owner),n=$v(e.type).toLowerCase(),i=$v(e.name),s="table"===n&&"Y"===$v(e.cascade),o=!0;return"mle environment"===n&&(n="mle env"),this.ddl=null,this.ddl="database link"===n?`drop ${n} "${i}";`:`drop ${n} "${t}"."${i}"${s?" cascade constraints":""};`,o},onOk:function(e){const t=g(this.schema,$v(this.args.owner),this.ddl,e);return t.then((({success:e})=>{if(e){if("PACKAGE BODY"===$v(this.args.type)){u().tabPanel$.find(".ob-view-BODY .ob-vtype-editor").codeEditor("setValue","")}N()}})),t}}),h("dialogAddModCol","P2000_ADDMODCOL_DLG_",{args:{owner:T,name:_,columnName:"COL",columns:"COLS",dataType:"DATA_TYPE",fmtDataType:"FMT_DT",length:"LENGTH",lengthSemantics:"CHAR_USED",ydPrecision:"YD_PREC",precision:"PRECISION",scale:"SCALE",nullable:"NULL",colDefault:"DEFAULT",identity:"IDENTITY",hasIdentity:"HAS_IDTY"},hasSQL:!0,initialize:function(e){const t=this.args,n=e.find("a-model-cursor")[0],i=o(t.dataType),s=o(t.fmtDataType),a=o(t.length),r=o(t.lengthSemantics),d=o(t.precision),c=o(t.ydPrecision),h=o(t.scale),u=o(t.identity),m=o(t.hasIdentity);this.add=!1,l.bindExpression({type:"item-value",element:s.node,itemName:t.fmtDataType,storeElement:n},"=DATA_TYPE"),s.element.on("change",(()=>{let e=null,t=null,n=s.getValue();n.startsWith("TIMESTAMP")?n=n.replace(/\((\d+)\)/,((t,n)=>(n&&(e=n),""))):n.startsWith("INTERVAL")&&(n=n.replace(/\((\d+)\)/g,((n,i)=>(i&&(null===t?t=i:e=i),"")))),i.setValue(n),setTimeout((()=>{null!==e&&d.setValue(e),t&&c.setValue(t)}),0)})),e.on("change",`#${t.dataType},#${t.precision},#${t.ydPrecision}`,(e=>{let t,n=i.getValue();n.startsWith("TIMESTAMP")||n.startsWith("INTERVAL")?t=P(n,null,null,d.getValue(),null,c.getValue()):e.target===i.node&&(t=n),null!=t&&s.setValue(t,null,!0)})),l.bind({type:"visible",element:a.node},[{type:"item",name:t.dataType}],(()=>["VARCHAR2","CHAR","NCHAR","NVARCHAR2","RAW"].includes(i.getValue()))),l.bind({type:"visible",element:r.node},[{type:"item",name:t.dataType}],(()=>["VARCHAR2","CHAR"].includes(i.getValue()))),l.bind({type:"visible",element:d.node},[{type:"item",name:t.dataType}],(()=>["NUMBER","FLOAT","INTERVAL DAY TO SECOND","TIMESTAMP","TIMESTAMP WITH TIME ZONE","TIMESTAMP WITH LOCAL TIME ZONE"].includes(i.getValue()))),l.bind({type:"visible",element:h.node},[{type:"item",name:t.dataType}],(()=>"NUMBER"===i.getValue())),l.bind({type:"visible",element:c.node},[{type:"item",name:t.dataType}],(()=>["INTERVAL YEAR TO MONTH","INTERVAL DAY TO SECOND"].includes(i.getValue()))),l.bind({type:"visible",element:u.node},[{type:"item",name:t.dataType},{type:"item",name:t.hasIdentity}],(()=>"NUMBER"===i.getValue()&&"Y"!==m.getValue())),e.on("dialogclose",(()=>{l.unbind({type:"attribute",element:n,attribute:"record-id"})}))},open:function(e,t){const n=this.args,i=e.find("a-model-cursor")[0],s=t.model,a=o(n.columns),r=o(n.columnName);this.objId=t.id,this.schema=t.schema,this.add=t.add,this.model=s,A(a,!t.add),A(r,t.add),i.modelId=s.modelId(),t.add?setTimeout((()=>{o(n.nullable).setValue("Y")}),0):(D(a,n.columns,t.columns,t.currentColumn),l.bind({type:"attribute",element:i,attribute:"record-id"},[{type:"item",name:n.columns}],((e,t)=>o(t[0].name).getValue())))},validate:function(e,t){const n=this.args,i=this.add?"add":"modify",s=e.find("a-model-cursor")[0];let o="",a="",l="",r=$v(n.dataType),d=$v(n.length),c=$v(n.lengthSemantics),h=$v(n.precision),u=$v(n.ydPrecision),m=$v(n.scale),g=$v(n.owner),p=$v(n.name),E=$v(this.add?n.columnName:n.columns),f="Y"===$v(n.nullable),O=$v(n.hasIdentity),$=$v(n.identity),T=$v(n.colDefault),_=P(r,d,c,h,m,u),v=!0;if(g&&p&&E&&_||(v=!1),this.add||(E=M(n.columns)),this.ddl=null,v){if(this.add)t&&(E=C(n.columnName,E)),f||(o=" not null");else if(s.getCurrentRecord()){f!==("Y"===this.model.getValue(s.getCurrentRecord(),"NULLABLE"))&&(o=f?" null":" not null")}"NUMBER"===r&&"Y"!==O&&this.add&&"Y"===$&&(a=" generated by default on null as identity"),T&&(l=` default ${T}`),this.ddl=`alter table "${g}"."${p}" ${i}\n("${E}" ${_}${l}${a}${o});`}return v},onOk:function(e){const t=this.args,n=$v(t.dataType),i=this.ddl.includes("as identity"),s=e.find("a-model-cursor")[0],a=g(this.schema,$v(t.owner),this.ddl,e);return a.then((({success:e})=>{if(e){if(this.add){let e,t,n=s.getModel(),i=-1;n.forEach(((e,t,n)=>{let s=parseFloat(n);s>i&&(i=s)})),e=n.recordAt(n.getTotalRecords(!0)-1),t=Array(12).fill("",0,12),t[0]=""+(i+1),n.insertNewRecord(null,e,t),s.recordId=t[0]}(n.startsWith("INTERVAL")||n.startsWith("TIMESTAMP"))&&o(t.precision).setValue("",null,!0),s.store(),E(this.objId,["DATA","INDEXES","CONSTRAINTS","STATS","DDL"],["INDEX","TRIGGERS"]),i&&(s.getModel().clearData(),N())}})),a}}),h("dialogDropRenameCol","P2000_RENDROPCOL_DLG_",{args:{owner:T,name:_,column:"COLS",columnNew:"COL_REN"},hasSQL:!0,initialize:function(e){let t=this.args,n=e.find("a-model-cursor")[0];this.rename,l.bind({type:"attribute",element:n,attribute:"record-id"},[{type:"item",name:t.column}],((e,t)=>o(t[0].name).getValue()))},open:function(e,t){let n=this.args,i=e.find("a-model-cursor")[0],s=o(n.column),a=o(n.columnNew);this.objId=t.id,this.schema=t.schema,this.rename=t.rename,this.model=t.model,i.modelId=this.model.modelId(),A(a,t.rename),D(s,n.column,t.columns,t.currentColumn)},validate:function(e,t){const n=this.args;let i=$v(n.owner),s=$v(n.name),o=M(n.column),a=this.rename?$v(n.columnNew):null,l=!0;return i&&s&&o&&(!this.rename||a)||(l=!1),this.ddl=null,l&&(this.ddl=`alter table "${i}"."${s}" `,this.rename?(t&&(a=C(n.columnNew,a)),this.ddl+=`rename column\n"${o}" to "${a}";`):this.ddl+=`drop column "${o}";`),l},onOk:function(e){const t=e.find("a-model-cursor")[0],n=g(this.schema,$v(this.args.owner),this.ddl,e);return n.then((({success:e})=>{e&&(this.rename?t.store():R(this.model,$v(this.args.column)),E(this.objId,["DATA","INDEXES","CONSTRAINTS","STATS","DEPS","DDL"],this.rename?["INDEX","TRIGGERS"]:null),N())})),n}}),h("dialogRenameTable","P2000_RENTABLE_DLG_",{args:{owner:T,name:_,nameNew:"TAB_REN"},hasSQL:!0,open:function(e,t){this.objId=t.id,this.schema=t.schema},validate:function(e,t){const n=this.args;let i=$v(n.owner),s=$v(n.name),o=$v(n.nameNew),a=!0;return i&&s&&o||(a=!1),this.ddl=null,a&&(t&&(o=C(n.nameNew,o)),this.ddl=`alter table "${i}"."${s}" rename\nto "${o}";`),a},onOk:function(e){let n=this.args;const i=g(this.schema,$v(n.owner),this.ddl,e);return i.then((({success:e})=>{if(e){const e=$v(n.nameNew),i=u();N(),i.name=e,i.title=i.path+e,t.doc.renameDocument(i),E(this.objId,null,["INDEX","TRIGGER","TABLE","VIEW","SYNONYM"])}})),i}}),h("dialogComment","P2000_COMMENT_DLG_",{args:{owner:T,name:_,tabOrCol:"OBJ_COL",columns:"COLS",comment:"COMMENT",type:v},hasSQL:!0,initialize:function(e){let t=this.args,n=e.find("a-model-cursor")[0],i=o(t.columns),s=o(t.tabOrCol);s.element.find("input[value='T']").next().attr("ab-text",`=${t.type}`),l.applyBindings(s.node),l.unbind({type:"visible",element:i.node}),l.bind({type:"visible",element:i.node},[{type:"item",name:t.tabOrCol}],(()=>"C"===s.getValue()?"V":"H")),l.bind({type:"attribute",element:n,attribute:"record-id"},[{type:"item",name:t.columns}],((e,t)=>o(t[0].name).getValue())),s.element.on("change",(()=>{let e,t,o=s.getValue();"C"===o?(t=this.model,e=i.getValue()):(t=this.objModel,e="0"),o&&t&&(n.modelId=t.modelId(),n.recordId=e)}))},open:function(e,t){let n=this.args,i=o(n.tabOrCol),s=o(n.column),a=o(n.type);this.objId=t.id,this.schema=t.schema,this.objectType=t.objectType,this.model=t.model,this.objModel=t.objModel,a.setValue(m(this.objectType)),i.setValue("T"),D(s,n.columns,t.columns,t.currentColumn)},validate:function(){const e=this.args;let t=$v(e.owner),n=$v(e.name),i="C"===$v(e.tabOrCol),s=M(e.columns),o=$v(e.comment).replaceAll("'","''"),a=!0;if(t&&n&&(!i||s)||(a=!1),this.ddl=null,a){let e="",a=this.objectType.toLowerCase().replace("_"," ");i?(a="column",e=`."${s}"`):"view"===a&&(a="table"),this.ddl=`comment on ${a} "${t}"."${n}"${e}\nis '${o}';`}return a},onOk:function(e){const t=this.args,n="C"===$v(t.tabOrCol),i=e.find("a-model-cursor")[0],s=g(this.schema,$v(this.args.owner),this.ddl,e);return s.then((({success:e})=>{e&&(i.store(),E(this.objId,n?["DATA","DDL"]:["DDL"]))})),s}}),h("dialogCopyTable","P2000_COPYTABLE_DLG_",{args:{owner:T,name:_,nameNew:"TAB_NEW",chooseCols:"CHOOSE_COL",columns:"COLUMNS",chooseRows:"ROWS",where:"WHERE"},hasSQL:!0,initialize:function(){let e=this.args,t=o(e.chooseCols),n=o(e.columns),i=o(e.chooseRows),s=o(e.where);l.bind({type:"visible",element:n.node},[{type:"item",name:e.chooseCols}],(()=>t.getValue()===O)),l.bind({type:"visible",element:s.node},[{type:"item",name:e.chooseRows}],(()=>i.getValue()===O))},open:function(t,n){let i=this.args,s=o(i.chooseCols),a=o(i.columns),l=o(i.chooseRows);this.objId=n.id,this.schema=n.schema,s.setValue("ALL"),l.setValue("NONE"),a.setValue([]),D(a,i.columns+"_LEFT",n.columns),e("#"+i.columns+"_RESET").hide()},validate:function(e,t){const n=this.args;let i=$v(n.owner),s=$v(n.name),a=$v(n.nameNew),l=$v(n.where),r=$v2(n.columns),d=$v(n.chooseCols),c=$v(n.chooseRows),h=!0;if(i&&s&&a&&(d!==O||0!==r.length)&&(c!==O||l)||(h=!1),this.ddl=null,h){let e="*",h="";"NONE"===c?h="\nwhere 1=2":c===O&&(h=`\nwhere ${l}`),d===O&&(e=r.map((e=>o(n.columns).displayValueFor(e))),e='"'+e.join('", "')+'"'),t&&(a=C(n.nameNew,a)),this.ddl=`create table "${i}"."${a}" as\nselect ${e}\nfrom "${i}"."${s}"${h};`}return h},onOk:function(e){const t=g(this.schema,$v(this.args.owner),this.ddl,e);return t.then((({success:e})=>{e&&N()})),t}}),h("dialogTruncateTable","P2000_TRUNCTABLE_DLG_",{args:{owner:T,name:_},hasSQL:!0,open:function(e,t){this.objId=t.id,this.schema=t.schema},validate:function(){const e=this.args;let t=$v(e.owner),n=$v(e.name),i=!0;return t&&n||(i=!1),this.ddl=null,i&&(this.ddl=`truncate table "${t}"."${n}";`),i},onOk:function(e){const t=g(this.schema,$v(this.args.owner),this.ddl,e);return t.then((({success:e})=>{e&&E(this.objId,["DATA"])})),t}}),h("dialogDropIndex","P2000_DROPIDX_DLG_",{args:{owner:T,name:_,index:"INDEX"},hasSQL:!0,open:function(e,t){const n=this.args,i=o(n.index);this.objId=t.id,this.schema=t.schema,this.model=t.model,D(i,n.index,t.indexes,t.currentIndex)},validate:function(){let e=M(this.args.index),t=!0;return e||(t=!1),this.ddl=null,t&&(this.ddl=`drop index "${e}";`),t},onOk:function(e){const t=this.args,n=$v(t.index),i=g(this.schema,$v(t.owner),this.ddl,e);return i.then((({success:e})=>{e&&(R(this.model,n),f(n))})),i}}),e((()=>{e("#P2000_ADDCON_DLG_CASCADE, #P2000_ADDCON_DLG_FK_COL, #P2000_ADDCON_DLG_FK_COLS2").attr("ab-visible","{case P2000_ADDCON_DLG_TYPE/}{when FOREIGN KEY/}V{otherwise/}H{endcase/}")})),h("dialogAddConstraint","P2000_ADDCON_DLG_",{args:{owner:T,name:_,constraint:"CONSTRAINT",type:v,conditionCol:"CON_COL",conditionExp:"CHECK_CON",cascade:"CASCADE",fkPopulate:"POP_FK",fkCol:"FK_COL",fkTab:"FK_TAB",fkTabCols:"FK_COLS2",pkCol1:"PK_COL1",pkCol2:"PK_COL2",pkCol3:"PK_COL3",ukCol1:"UK_COL1",ukCol2:"UK_COL2",ukCol3:"UK_COL3"},hasSQL:!0,updateActions:!0,initialize:function(){let e=this.args,t=o(e.type),n=o(e.fkPopulate);t.element.on("change",(()=>{"FOREIGN KEY"===t.getValue()&&"Y"!==n.getValue()&&n.setValue("Y")}))},open:function(e,t){const n=this.args,i=u(),s=o(n.constraint),a=o(n.conditionCol),l=o(n.pkCol1),r=o(n.pkCol2),d=o(n.pkCol3),c=o(n.ukCol1),h=o(n.ukCol2),m=o(n.ukCol3);let g=i.models.get("MAIN_COLS");function p(){const e=[];g=i.models.get("MAIN_COLS");let t=g.getFieldKey("COLUMN_NAME");e.push({display:L,return:""}),g.forEach((n=>{let i=n[t];e.push({display:i,return:i})})),D(a,n.conditionCol,e),D(null,"P2000_ADDCON_DLG_FK_COL_LEFT",e.slice(1)),D(l,n.pkCol1,e),D(r,n.pkCol2,e),D(d,n.pkCol3,e),D(c,n.ukCol1,e),D(h,n.ukCol2,e),D(m,n.ukCol3,e)}this.objId=t.id,this.schema=t.schema,this.model=t.model,s.setValue(t.name+"_CON"),g&&g.getTotalRecords(!0)>0?p():i.loadViewData("MAIN",e,p)},validate:function(){const e=this.args;let t,n=$v(e.owner),i=$v(e.name),s=M(e.constraint),o=$v(e.type),a=!0;if(n&&i&&s)if("CHECK"===o){let n=$v(e.conditionCol),i=$v(e.conditionExp);n&&i?t=`check ( "${n}" ${i} )`:a=!1}else if("FOREIGN KEY"===o){let n=$v(e.cascade).toLowerCase(),i=$v2(e.fkCol),s=$v(e.fkTab),o=$v2(e.fkTabCols);i.length>0&&s&&o.length>0?(n&&(n=" "+n),t=`foreign key ( "${i.join('", "')}" ) references "${s}" ( "${o.join('", "')}" )${n}`):a=!1}else if("PRIMARY KEY"===o){let n=[],i=$v(e.pkCol1),s=$v(e.pkCol2),o=$v(e.pkCol3);i?(n.push(`"${i}"`),s&&n.push(`"${s}"`),o&&n.push(`"${o}"`),t=`primary key ( ${n.join(", ")} )`):a=!1}else if("UNIQUE"===o){let n=[],i=$v(e.ukCol1),s=$v(e.ukCol2),o=$v(e.ukCol3);i?(n.push(`"${i}"`),s&&n.push(`"${s}"`),o&&n.push(`"${o}"`),t=`unique ( ${n.join(", ")} )`):a=!1}else a=!1;else a=!1;return this.ddl=null,a&&(this.ddl=`alter table "${n}"."${i}" add constraint\n"${s}" ${t};`),a},onOk:function(e){const t=g(this.schema,$v(this.args.owner),this.ddl,e);return t.then((({success:e})=>{e&&(this.model.clearData(),E(this.objId,["MAIN","INDEXES","DEPS","DDL"]))})),t}}),h("dialogDropConstraint","P2000_DROPCON_DLG_",{args:{owner:T,name:_,constraint:"CONSTRAINT"},hasSQL:!0,updateActions:!0,open:function(e,t){const n=this.args,i=o(n.constraint);this.objId=t.id,this.schema=t.schema,this.model=t.model,D(i,n.constraint,t.constraints,t.currentConstraint)},validate:function(){const e=this.args;let t=$v(e.owner),n=$v(e.name),i=M(e.constraint),s=!0;return t&&n&&i||(s=!1),this.ddl=null,s&&(this.ddl=`alter table "${t}"."${n}" drop constraint\n${i};`),s},onOk:function(e){const t=this.args,n=$v(t.constraint),i=g(this.schema,$v(this.args.owner),this.ddl,e);return i.then((({success:e})=>{e&&(R(this.model,n),E(this.objId,["MAIN","DATA","DEPS","DDL"]))})),i}}),h("dialogEnDisConstraint","P2000_ENDISCON_DLG_",{args:{owner:T,name:_,constraint:"CONSTRAINT"},hasSQL:!0,updateActions:!0,titleIsTemplate:!0,open:function(e,t){const n=this.args,i=o(n.constraint);this.objId=t.id,this.schema=t.schema,this.model=t.model,this.enable=t.enable,D(i,n.constraint,t.constraints,t.currentConstraint)},validate:function(){const e=this.args;let t=$v(e.owner),n=$v(e.name),i=M(e.constraint),s=this.enable?"enable":"disable",o=!0;return t&&n&&i||(o=!1),this.ddl=null,o&&(this.ddl=`alter table "${t}"."${n}" ${s} constraint\n${i};`),o},onOk:function(e){const t=this.args,n=g(this.schema,$v(t.owner),this.ddl,e);return n.then((({success:e})=>{if(e){let e=this.model,n=e.getRecord($v(t.constraint));e.setValue(n,"STATUS",this.enable?"ENABLED":"DISABLED"),E(this.objId,["MAIN","DATA","DEPS","DDL"])}})),n}});const S=["DEBUG","EXECUTE"],w={TABLE:["ALTER","DEBUG","DELETE","INDEX","INSERT","READ","REFERENCES","SELECT","UPDATE"],VIEW:["DEBUG","DELETE","INSERT","MERGE VIEW","READ","REFERENCES","SELECT","UNDER","UPDATE"],SEQUENCE:["ALTER","KEEP SEQUENCE","SELECT"],TYPE:["DEBUG","EXECUTE","UNDER"],PACKAGE:S,FUNCTION:S,PROCEDURE:S,MATERIALIZED_VIEW:["ON COMMIT REFRESH","QUERY REWRITE","READ","SELECT"],MLE_ENVIRONMENT:["EXECUTE"],MLE_MODULE:["EXECUTE"]};function y(e,t){let n=e.find(`#${t} .apex-item-grid-row`).html();return n=`<div class="apex-item-grid-row">{loop LIST/}${n.replaceAll("-R-","&APEX$ITEM%return.").replaceAll("-D-","&APEX$ITEM%display.").replaceAll(/_\d+"/g,'_&APEX$I."')}{if =APEX$ITEM%newrow/}</div><div class="apex-item-grid-row">{endif/}{endloop/}`,n}h("dialogGrant","P2000_GRANT_DLG_",{args:{owner:T,name:_,grantee:"GRANTEE",grant:"GRANT",option:"OPTION",type:v},hasSQL:!0,initialize:function(e){const t=this.args,n=o(t.grant);this.cbTemplate=y(e,t.grant),function(e,t){e.all=!1,t.element.on("change",(()=>{let n=t.getValue();n.includes("ALL")?e.all&&n.length>1?(n.shift(),e.all=!1,t.setValue(n,null,!0)):e.all||(e.all=!0,n.length>1&&(n=["ALL"],t.setValue(n,null,!0))):e.all=!1}))}(this,n)},open:function(t,n){const s=this.args,a=o(s.type);let l,r=n.objectType;this.objId=n.id,this.schema=n.schema,this.objectType=r,this.model=n.model,a.setValue(m(r)),l=w[r].map(((e,t)=>({return:e,display:e,newrow:t%2?"Y":"N"}))),l.unshift({return:"ALL",display:"ALL",newrow:"Y"}),this.all=!1,e("#"+s.grant+" .apex-item-grid").html(i.applyTemplate(this.cbTemplate,{extraSubstitutions:{LIST:l}}))},validate:function(){const e=this.args;let t=$v(e.owner),n=$v(e.name),i=$v(e.grantee),s=$v2(e.grant),o="Y"===$v(e.option)?" with grant option":"",a=!0;return t&&n&&i&&0!==s.length||(a=!1),this.ddl=null,a&&(this.ddl=`grant ${s.join(", ")} on "${t}"."${n}" to ${i}${o};`),a},onOk:function(e){const t=g(this.schema,$v(this.args.owner),this.ddl,e);return t.then((({success:e})=>{e&&this.model.clearData()})),t}}),h("dialogRevoke","P2000_REVOKE_DLG_",{args:{owner:T,name:_,grantee:"GRANTEE",grant:"GRANT",type:v},hasSQL:!0,gatherPrivsFor:function(t){const n=this.args,s=this.model;let o=[],a=0;s&&(s.forEach((e=>{if(s.getValue(e,"GRANTEE")===t){let t=s.getValue(e,"PRIVILEGE");o.push({return:t,display:t,newrow:a%2?"Y":"N"}),a+=1}})),o.unshift({return:"ALL",display:"ALL",newrow:"Y"}),e("#"+n.grant+" .apex-item-grid").html(i.applyTemplate(this.cbTemplate,{extraSubstitutions:{LIST:o}})))},initialize:function(e){const t=this.args,n=o(t.grantee);this.cbTemplate=y(e,t.grant),n.element.on("change",(()=>{this.gatherPrivsFor(n.getValue())}))},open:function(e,t){const n=this.args,i=o(n.grantee),s=o(n.grant),a=o(n.type),l=new Set;let r,d=[];this.objId=t.id,this.schema=t.schema,this.objectType=t.objectType,r=this.model=t.model,a.setValue(m(this.objectType)),s.setValue([]),r.forEach((e=>{let t=r.getValue(e,"GRANTEE");l.has(t)||(d.push({display:t,return:t}),l.add(t))})),D(i,n.grantee,d),this.gatherPrivsFor(i.getValue())},validate:function(){const e=this.args;let t=$v(e.owner),n=$v(e.name),i=$v(e.grantee),s=$v2(e.grant),o=!0;return t&&n&&i&&0!==s.length||(o=!1),this.ddl=null,o&&(this.ddl=`revoke ${s.join(", ")} on "${t}"."${n}" from ${i}`),o},onOk:function(e){const t=g(this.schema,$v(this.args.owner),this.ddl,e);return t.then((({success:e})=>{e&&this.model.clearData()})),t}}),h("dialogDropTrigger","P2000_DROPTRIG_DLG_",{args:{owner:T,name:_,trigger:"TRIGGER"},hasSQL:!0,updateActions:!0,open:function(e,t){const n=this.args,i=o(n.trigger);this.objId=t.id,this.schema=t.schema,this.model=t.model,D(i,n.trigger,t.triggers,t.currentTrigger)},validate:function(){let e=M(this.args.trigger),t=!0;return e||(t=!1),this.ddl=null,t&&(this.ddl=`drop trigger "${e}";`),t},onOk:function(e){const t=this.args,n=$v(t.trigger),i=g(this.schema,$v(t.owner),this.ddl,e);return i.then((({success:e})=>{e&&(R(this.model,n),f(n),E(this.objId,["DEPS"]))})),i}}),h("dialogEnDisTrigger","P2000_ENDIS_DLG_",{args:{owner:T,name:_,trigger:"TRIGGER"},titleIsTemplate:!0,updateActions:!0,open:function(e,t){const n=this.args,i=o(n.trigger);this.objId=t.id,this.schema=t.schema,this.model=t.model,this.enable=t.enable,D(i,n.trigger,t.triggers,t.currentTrigger)},validate:function(){const e=this.args;let t=$v(e.owner),n=$v(e.name),i=M(e.trigger),s=!0;return t&&n&&i||(s=!1),s},onOk:function(e){const t=this.args,n=this.enable?"enable":"disable",i=M(t.trigger),s=p(this.schema,$v(t.owner),n,{objectId:this.objId,objectName:i,objectType:"TRIGGER"},e);return s.then((({success:e})=>{e&&this.model.clearData()})),s}}),h("dialogDropSODA","P2000_DROPSODA_DLG_",{args:{owner:T,name:"COL_NAME"},open:function(e,t){this.objId=t.id,this.schema=t.schema},validate:function(){let e=this.args,t=$v(e.owner),n=$v(e.name),i=!0;return t&&n||(i=!1),i},onOk:function(e){const t=this.args,n=$v(t.name),i=p(this.schema,$v(t.owner),"drop_soda",{objectId:this.objId,objectName:n,objectType:"SODA_COLLECTION"},e);return i.then((({success:e})=>{e&&N()})),i}}),h("dialogSODAIndex","P2000_SODAIDX_DLG_",{args:{owner:T,name:"COL_NAME",indexName:"IDX_NAME"},open:function(e,t){let n=this.args,i=o(n.indexName);this.objId=t.id,this.schema=t.schema,this.model=t.model,i.setValue(t.name+"_SEARCH_IX")},validate:function(){let e=this.args,t=$v(e.owner),n=$v(e.name),i=$v(e.indexName),s=!0;return t&&n&&i||(s=!1),s},onOk:function(e){const t=this.args,n=$v(t.name),i=$v(t.indexName),s=p(this.schema,$v(t.owner),"create_soda_index",{objectId:this.objId,objectName:n,objectType:"SODA_COLLECTION",indexName:i},e);return s.then((({success:e})=>{e&&(r.invoke("refresh-view"),N())})),s}}),h("dialogSODAView","P2000_SODAVIEW_DLG_",{args:{owner:T,name:"COL_NAME",viewName:"VIEW_NAME",jsonPath:"JSON_SEL"},open:function(e,t){let n=this.args,i=o(n.viewName),s=o(n.jsonPath);this.objId=t.id,this.schema=t.schema,this.model=t.model,i.setValue(t.name+"_VIEW"),s.setValue("$")},validate:function(){let e=this.args,t=$v(e.owner),n=$v(e.name),i=$v(e.viewName),s=$v(e.jsonPath),o=!0;return t&&n&&i&&s||(o=!1),o},onOk:function(e){const t=this.args,n=$v(t.name),i=$v(t.viewName),s=$v(t.jsonPath),o=p(this.schema,$v(t.owner),"create_soda_view",{objectId:this.objId,objectName:n,objectType:"SODA_COLLECTION",viewName:i,jsonPath:s},e);return o.then((({success:e})=>{e&&(r.invoke("refresh-view"),N())})),o}}),h("dialogDBLinkTest","P2000_DBLTEST_DLG_",{args:{owner:T,name:"DB_LINK_NAME"},hasSQL:!0,open:function(e,t){this.objId=t.id,this.schema=t.schema},validate:function(){let e=this.args,t=$v(e.owner),n=$v(e.name),i=!0;return t&&n||(i=!1),this.ddl=null,i&&(this.ddl=`select 1 from dual@"${n}"`),i},onOk:function(e){const t=this.args,n=p(this.schema,$v(t.owner),"test_db_link",{ddl:this.ddl,objectName:$v(t.name)},e);return n.then((({success:e,message:t})=>{e&&s.alert(t,(()=>{}))})),n}}),h("dialogAlterSequence","P2000_ALTSEQ_DLG_",{args:{owner:T,name:"SEQ_NAME",currentVal:"CURRENT_VAL",minVal:"MIN_VAL",maxVal:"MAX_VAL",inc:"INCREMENT_BY",cycle:"CYCLE",numCache:"CACHE",order:"ORDER"},hasSQL:!0,open:function(e,t){const n=e.find("a-model-cursor")[0];this.objId=t.id,this.schema=t.schema,this.model=t.model,n.modelId=t.model.modelId()},validate:function(){let e=this.args,t=$v(e.owner),n=$v(e.name),i=$v(e.minVal),s=$v(e.maxVal),o=$v(e.inc),a="Y"===$v(e.cycle),l="Y"===$v(e.order),r=$v(e.numCache),d=!0;return t&&n&&i&&s&&o&&r||(d=!1),this.ddl=null,d&&(this.ddl=`alter sequence "${t}"."${n}"\nminvalue ${i}\nmaxvalue ${s}\nincrement by ${o}\n${a?"cycle":"nocycle"}\ncache ${r}\n${l?"order":"noorder"};`),d},onOk:function(e){const t=e.find("a-model-cursor")[0],n=g(this.schema,$v(this.args.owner),this.ddl,e);return n.then((({success:e})=>{e&&t.store()})),n}}),h("dialogRowEdit","P2000_ROW_EDIT_DLG_",{args:{pageMode:"MODE"},hasSQL:!1,initialize:function(t){t.on("dialogclose",(()=>{const t=e("#editDataForm");t.recordView("setEditMode",!1),t.recordView("destroy"),n.destroy($)}))},open:function(e,t){this.model=t.model,this.record=t.record,this.pageMode=t.pageMode,this.name="dialogRowEdit",this.tempRecord=structuredClone(t.record),this.fields=structuredClone(t.model.getOption("fields"));for(const e of Object.keys(this.fields)){let t=this.fields[e];["ROWID","ROW_ACTIONS","_meta"].includes(e)||(t.hidden=!1),!t.hidden&&t.heading&&(t.label=t.heading,delete t.heading)}n.create($,{shape:"table",recordIsArray:!0,fields:this.fields,regionId:this.model.getOption("regionId"),ajaxIdentifier:this.model.getOption("ajaxIdentifier"),regionData:this.model.getOption("regionData"),saveData:this.model.getOption("saveData"),identityField:this.model.getOption("identityField"),metaField:this.model.getOption("metaField"),editable:!0},"C"===this.pageMode?null:[this.tempRecord]),this.tempModel=n.get($),"C"===this.pageMode&&this.tempModel.insertNewRecord()},validate:function(){return!0},onCreate:function(){let e=this.tempModel.save();e&&(e.done((()=>{this.model.clearData(),s.showPageSuccess(d.getMessage("OB.ROW_INSERTED")),c.closeRegion(this.name)})),e.fail((function(e){s.alert(e[0].message)})))},onSave:function(){if(this.tempModel.isChanged())if(this.tempModel.hasErrors())s.alert(d.getMessage("OB.CORRECT_ERRORS"));else{let e=this.tempModel.save();e&&(e.done((()=>{let e=this.tempModel.getValue(this.tempModel.recordAt(0),"ROWID"),t=this.model.getRecordMetadata(e),n=this.tempModel.recordAt(0),i=n[n.length-1].rowVersion;for(const e in this.fields)["ROWID","ROW_ACTIONS","_meta"].includes(e)||this.tempModel.getFieldMetadata(e).readonly||this.model.setValue(this.record,e,this.tempModel.getValue(n,e));t.record[t.record.length-1].rowVersion=i,t.rowVersion=i,s.showPageSuccess(d.getMessage("APEX.IG.CHANGES_SAVED")),c.closeRegion(this.name)})),e.fail((function(e){s.alert(e[0].message)})))}else c.closeRegion(this.name)},onDelete:function(){const t=this.tempModel.recordAt(0),n=e("#editDataForm");s.confirm(d.getMessage("OB.ROW_DELETE_CONFIRM"),(e=>{if(e){n.hide(),this.tempModel.deleteRecords([this.tempModel.recordAt(0)]);let e=this.tempModel.save();e&&(e.done((()=>{this.model.deleteRecords([this.record]),s.showPageSuccess(d.getMessage("OB.ROW_DELETED")),c.closeRegion(this.name),n.show()})),e.fail((e=>{this.tempModel.revertRecords([t]),n.show(),s.alert(e[0].message)})))}}))},postOpen:function(){const t=e("#editDataForm");t.recordView({modelName:$,fields:[this.fields],editable:!0,toolbar:null,recordOffset:0,exitEditModeOnEscape:!1}),t.recordView("setEditMode",!0)}}),apex.env.DB_VERSION>=23&&h("dialogImportEdit","P2000_IMPORT_EDIT_DLG_",{args:{pageMode:"MODE"},hasSQL:!1,initialize:function(){a.P2000_MODULE_NAME.element.on("change",(()=>{"C"===this.pageMode&&""!==a.P2000_MODULE_NAME.value&&""===a.P2000_IMPORT_NAME.value&&(a.P2000_IMPORT_NAME.value=a.P2000_MODULE_NAME.value.toLowerCase().replaceAll("_","-"))})),a.P2000_OB_SCHEMA.element.on("change",(()=>{a.P2000_SCHEMA_HELPER.value=objectBrowser.getSchema()}))},open:function(e,t){if(this.model=t.model,this.record=t.record,this.pageMode=t.pageMode,this.name="dialogImportEdit",this.tempRecord=structuredClone(t.record),this.fields=structuredClone(t.model.getOption("fields")),n.create($,{shape:"table",recordIsArray:!0,fields:this.fields,regionId:this.model.getOption("regionId"),ajaxIdentifier:this.model.getOption("ajaxIdentifier"),regionData:this.model.getOption("regionData"),saveData:this.model.getOption("saveData"),identityField:this.model.getOption("identityField"),metaField:this.model.getOption("metaField"),editable:!0},"C"===this.pageMode?null:[this.tempRecord]),this.tempModel=n.get($),"C"===this.pageMode)a.P2000_ORIGINAL_IMPORT_NAME.value="",a.P2000_MODULE_OWNER.value="",a.P2000_MODULE_NAME.value="",a.P2000_IMPORT_NAME.value="";else if("E"===this.pageMode){a.P2000_ORIGINAL_IMPORT_NAME.value=this.tempModel.getValue(this.tempRecord,"ORIGINAL_IMPORT_NAME"),a.P2000_IMPORT_NAME.value=this.tempModel.getValue(this.tempRecord,"IMPORT_NAME");const e=this.tempModel.getValue(this.tempRecord,"MODULE_OWNER"),t=this.tempModel.getValue(this.tempRecord,"MODULE_NAME");a.P2000_MODULE_OWNER.value!==e?(a.P2000_MODULE_NAME.element.one("apexafterrefresh",(()=>{a.P2000_MODULE_NAME.value=t})),a.P2000_MODULE_OWNER.value=e):a.P2000_MODULE_NAME.value=t}},validate:function(){return!0},onCreate:function(){const e=this.tempModel.insertNewRecord();this.tempModel.setRecordValue(e,"MODULE_OWNER",a.P2000_MODULE_OWNER.value),this.tempModel.setRecordValue(e,"MODULE_NAME",a.P2000_MODULE_NAME.value),this.tempModel.setRecordValue(e,"IMPORT_NAME",a.P2000_IMPORT_NAME.value);let t=this.tempModel.save();t&&(t.always((()=>{this.tempModel.clearData(!1)})),t.done((()=>{this.model.clearData(),s.showPageSuccess(d.getMessage("OB.IMPORT_CREATED")),c.closeRegion(this.name)})),t.fail((function(e){s.alert(e[0].message)})))},onSave:function(){if(this.tempModel.setValue(this.tempRecord,"MODULE_OWNER",a.P2000_MODULE_OWNER.value),this.tempModel.setValue(this.tempRecord,"MODULE_NAME",a.P2000_MODULE_NAME.value),this.tempModel.setValue(this.tempRecord,"IMPORT_NAME",a.P2000_IMPORT_NAME.value),!this.tempModel.isChanged())return void c.closeRegion(this.name);let e=this.tempModel.save();e&&(e.done((()=>{this.model.clearData(),s.showPageSuccess(d.getMessage("APEX.IG.CHANGES_SAVED")),c.closeRegion(this.name)})),e.fail((function(e){s.alert(e[0].message)})))},onDelete:function(){s.confirm(d.getMessage("OB.IMPORT_DELETE_CONFIRM"),(e=>{if(e){this.tempModel.deleteRecords([this.tempModel.recordAt(0)]);let e=this.tempModel.save();e&&(e.done((()=>{this.model.deleteRecords([this.record]),s.showPageSuccess(d.getMessage("OB.IMPORT_DELETED")),c.closeRegion(this.name)})),e.fail((e=>{s.alert(e[0].message)})))}}))}})}(apex.jQuery,objectBrowser,apex.model,apex.util,apex.message,apex.item,apex.items,apex.binding,apex.actions,apex.lang,apex.theme);