/*!
 * Copyright (c) 2021, 2024, Oracle and/or its affiliates.
 */
apex.jQuery!==$&&jQuery.noConflict(!0),function(e,t,o,r,a,n,i,s){"use strict";const l="theme-roller-pe",u="custom-css-group",p="selected-themes",c="custom-css",d="is-not-rollable-msg",f="custom-css-enable-less-compilation",m="success",v="warning",g="danger",h="a-ThemeRoller-menu",y="a-ThemeRoller-Reset",E="theme-roller-css",C="theme-roller-custom-css",T="utr_undo_button",_="utr_redo_button",b="utr_save_theme",R="utr_save_theme_as",P="a-ThemeRoller-menu-button",x="OUTPUT MESSAGE",O="CUSTOM_CSS_TEXT_AREA",S="INPUT_RANGE",D="SINGLE_COLOR_PICKER",V="DOUBLE_COLOR_PICKER",k="THEME.SELECTOR.APP.GROUP",w="UTR.SELECT_THEME",I="UTR.CUSTOM_CSS",A="UTR.SAVE.SUCCESS",L="UTR.ENABLE_LESS_COMPILATION",N="UTR.ERROR.UNSUPPORTED_STYLE",U="APEX.DIALOG.CANCEL",F="UTR.UPLOAD_ERROR",j="UTR.ADDITIONAL_OPTIONS",G="UTR.SAVE_AS",M="UTR.SAVE",B="UTR.UNDO",$="UTR.REDO",Y="UTR.CONTRAST_DIALOG.TITLE",X="UTR.CURRENT",W='<div id="TEMPLATE_ID" class="apex-theme-editor-container te-theme-roller-tab a-DevTools-theme-editor-container"><div class="te-property-editor-container"></div></div>',z="variable",q="class";var H,J,K,Q,Z=!1,ee=!1,te=function(){e.apex.propertyEditor.addPropertyType(O,{render:function(e,t,o){e.markup("<div").attr("class","a-Property-buttonContainer").markup(">").markup("<button").attr("id",t+"_modalBtn").attr("class","a-Button a-Button--small a-Button--noLabel a-Button--withIcon a-Button--simple").attr("type","button").attr("title",me("UTR.INLINE_EDITOR_TITLE")).markup(">").markup("<span").attr("class","a-Icon icon-open-in-dialog").markup("></span>").markup("</button>").markup("</div>").markup("<div").attr("class","a-Property-fieldContainer").markup(">").markup("<div").attr("id",t+"_codeEditor").attr("class","a-DevTools-codearea a-DevTools-codearea--full-width").attr("style","height:180px; resize: vertical; overflow: auto;").markup(">").markup("<textarea").attr("id",t).attr("data-property-id",o.propertyName).attr("class","a-Property-field a-Property-field--textarea").attr("rows","3").attr("maxlength","32767").attr("value",o.value).markup("></textarea>").markup("</div>"),this.renderDivClose(e)},init:function(t,o){var a,n,i=this,s=e(t).attr("id"),l=e("#"+s+"_modalBtn"),u=r.htmlBuilder(),p=e("#"+s+"_codeEditor"),c=[];e(t).hide(),H=p.codeEditor({language:"less",theme:"vs-dark",toolbar:!1,minimap:!1,wordWrap:!0,automaticLayout:!0,value:o.value}),l.on("click",(function(){u.markup("<div").attr("id","editorDlg").attr("class","a-DevTools-content").attr("title",me("UTR.BUTTONS.CODE_EDITOR")).markup("><div").attr("id","div-codeEditor").attr("class","a-DevTools-codearea a-DevTools-codearea--standard").markup("></div></div>"),c.push({text:me(U),class:"a-Button a-DevTools-toolbar-item a-DevTools-toolbar-button a-DevTools-toolbar-item--push",click:function(){a.dialog("close")}}),c.push({text:me("APEX.DIALOG.OK"),class:"a-Button a-Button--hot a-DevTools-toolbar-item a-DevTools-toolbar-button",click:function(){i.setValue(t,o,n.codeEditor("getValue")),a.dialog("close"),H.codeEditor("focus").codeEditor("setCursorToEnd",!0)}}),a=e(u.toString()).dialog({dialogClass:"a-DevTools",modal:!0,closeText:me("APEX.DIALOG.CLOSE"),width:680,height:400,resize:r.debounce((function(){n.trigger("resize")}),100),create:function(){e(this).closest(".ui-dialog").attr("aria-modal",!0)},close:function(){u=r.htmlBuilder(),c=[],a.dialog("destroy").remove()},open:function(){var t=e("#div-codeEditor");n=t.codeEditor({language:"less",theme:"vs-dark",toolbar:!1,minimap:!1,wordWrap:!0,automaticLayout:!0,value:H.codeEditor("getValue"),onInitialized:function(){t.codeEditor("focus").codeEditor("setCursorToEnd",!0)}})},buttons:c})})),H.trigger("resize")},setValue:function(e,t,o){e.val(o,null,!0),e.parent().codeEditor("setValue",o),e.trigger("change")},getValue:function(t){return e("textarea",t).first().val()}},e.apex.propertyEditor.PROP_TYPE.TEXTAREA)},oe=function(){e.apex.propertyEditor.addPropertyType(S,{render:function(e,t,o){let r;r=o.value.includes("rem")?16*Number(o.value.replace("rem","")):o.value.replace(o.metaData.units,""),e.markup("<div").attr("class","a-Property-fieldContainer").markup(">").markup("<input").attr("type","range").attr("id",t).attr("min",o.metaData.min).attr("max",o.metaData.max).attr("step",o.metaData.increment).attr("value",r).attr("data-property-id",o.propertyName).attr("data-unit",o.metaData.units).markup(" />").markup("<output").attr("id",t+"_output").markup(">"+o.value+"</output>"),this.renderDivClose(e)},getValue:function(e){const t=e.find("[data-property-id]");return t.val()+t.data("unit")},setValue:function(t,o,r){t.val(r.replace(t.data("unit"),""));const a=e(t).attr("id");e("#"+a+"_output").html(t.val()+o.metaData.units)},init:function(t,o){const r=e(t).attr("id");e("#"+r+"_output").html(t.val()+o.metaData.units),t.on("change",(function(){var t=parseInt(e(this).val(),10),a=parseInt(o.metaData.min,10),n=parseInt(o.metaData.max,10);Number.isSafeInteger(t)&&(t>=a||t<=n)&&e("#"+r+"_output").html(t+o.metaData.units)})).on("input",(function(){t.trigger("change")}))}},e.apex.propertyEditor.PROP_TYPE.TEXT)},re=function(){e.apex.propertyEditor.addPropertyType(x,{render:function(e,t,o){e.markup("<div").attr("id",t).attr("class","a-Property-fieldContainer a-Property-fieldContainer--displayOnly").attr("data-property-id",o.propertyName).markup(">"+o.value),this.renderDivClose(e)},init:function(){}},e.apex.propertyEditor.PROP_TYPE.TEXTAREA)},ae=function(){e.apex.propertyEditor.addPropertyType(D,{render:function(e,t,o){e.markup("<div").attr("class","a-Property-fieldContainer a-Property-fieldContainer--colorPicker").attr("data-property-id",o.propertyName).attr("aria-label",o.label).attr("title",o.label).markup(">"),e.markup("<a-color-picker").attr("class","a-Property-field color_picker apex-item-color-picker").attr("value",o.value).attr("id",t).attr("display-mode","FULL").attr("display-as","COLOR_ONLY").attr("return-value-as","HEX").attr("popup-class","a-DevTools-ColorPicker").markup(">").markup("</a-color-picker>"),e.markup("</div>")},init:function(t){var o=t.closest(".a-Property"),a=e("a-color-picker",o);apex.item.attach(o),a.on("transientchange",r.debounce((function(){a.trigger("change")}),300))},setValue:function(e,t,o){apex.item(e.attr("id")).setValue(o,null,!0)},getValue:function(t){return e("input",t).val()}},e.apex.propertyEditor.PROP_TYPE.TEXT)},ne=function(){e.apex.propertyEditor.addPropertyType(V,{render:function(e,t,o){var r=o.value.split(","),a=o.label.split(",");function n(e,t,o,r){e.markup("<a-color-picker").attr("class","a-Property-field color_picker apex-item-color-picker").attr("value",o).attr("id",t).attr("display-mode","FULL").attr("display-as","COLOR_ONLY").attr("return-value-as","HEX").attr("popup-class","a-DevTools-ColorPicker").attr("aria-label",r).attr("title",r).markup(">").markup("</a-color-picker>")}e.markup("<div").attr("class","a-Property-fieldContainer a-Property-fieldContainer--doubleColorPicker").attr("data-property-id",o.propertyName).markup(">"),e.markup("<input").attr("type","hidden").attr("id",t).attr("value",o.value).markup("/>"),!1!==o.metaData.sourceCode.checkContrast&&e.markup("<div").attr("class","a-colorContrast").markup(">").markup("<span").attr("class","a-colorContrast-icon a-Icon").attr("aria-hidden","true").markup("></span>").markup("<span").attr("class","a-colorContrast-ratio").markup("></span>").markup("</div>"),n(e,t+"_colorA",r[0],a[0]),n(e,t+"_colorB",r[1],a[1]),e.markup("</div>")},refreshContrastInfo:function(t){var o=e("a-color-picker",t),r=o[0],a=o[1],n=e(".a-colorContrast",t),i=e("span.a-Icon",n),s=e("span.a-colorContrast-ratio",n);if(r&&a&&r.rendered&&a.rendered){var l,u=(l=r.contrastWith(a.getValue()).ratio,+(Math.round(l+"e+2")+"e-2")),p="",c="",d="";p=u>=4.5?"pass":u>=3?"warning":"fail",u>=7?c="AAA":u>=4.5?c="AA":u>=3&&(d=me("UTR.CONTRAST_VALIDATION.LARGE_TEXT_NOTICE")),n.removeClass("a-colorContrast--pass a-colorContrast--warning a-colorContrast--fail").addClass("a-colorContrast--"+p),i.removeClass("icon-tr-fail icon-tr-warning icon-tr-pass").addClass("icon-tr-"+p).attr("title",me(Y)),n.tooltip({show:{delay:250,duration:150},position:{my:"top",at:"center bottom+20"},content:function(){return`\n                                    <div class="a-DevTools--tooltip a-colorContrast--tooltip">\n                                        <div class="a-colorContrast-ratio">${me(Y)} ${u}</div>\n                                        <div class="a-colorContrast-status a-colorContrast--${p}">\n                                            <span aria-hidden="true" class="a-colorContrast-icon a-Icon icon-tr-${p}"></span>\n                                            <span class="a-colorContrast-text">${me(["pass","warning"].includes(p)?"UTR.CONTRAST_VALIDATION.PASSED":"UTR.CONTRAST_VALIDATION.FAILED")} ${c}</span>\n                                        </div>\n                                        <div class="a-colorContrast-extraInfo">${d}</div>\n                                    </div>\n                                `}}),s.text(u)}},init:function(t,o){var a=e("input",t).first(),n=e("a-color-picker",t),i=this;!1!==o.metaData.sourceCode.checkContrast&&i.refreshContrastInfo(t),n.each((function(e){var t=n.eq(e);t.on("transientchange",r.debounce((function(){t.trigger("change")}),300))})),n.on("change",(function(t){t.stopPropagation(),a.val(n.map((function(){return e(this).val()})).get().join(",")).trigger("change")})),!1!==o.metaData.sourceCode.checkContrast&&a.on("change",(()=>{i.refreshContrastInfo(t)}))},setValue:function(t,o){var r=t.closest(".a-Property"),a=o.value.split(",");t.val(o.value),e("a-color-picker",r).each((function(t){e(this)[0].setValue(a[t],null,!0)})),!1!==o.metaData.sourceCode.checkContrast&&this.refreshContrastInfo(r)},getValue:function(t){return e("input",t).first().val()}},e.apex.propertyEditor.PROP_TYPE.TEXT)},ie=function(){return{builderSessionId:Q.builderSessionId,themeId:Q.themeId}},se=function(e){for(var t=[];e.length>4e3;)t.push(e.substr(0,4e3)),e=e.substr(4e3);return t.push(e),t},le=function(e,t){o.process("theme_roller",{p_flow_id:4e3,p_flow_step_id:0,p_instance:ie().builderSessionId,p_debug:"NO",x01:"get_styles",x02:apex.env.APP_ID,x03:ie().themeId},{success:function(t){t=t.sort((function(e,t){return e.isReadOnly===t.isReadOnly?e.name<t.name?-1:1:e.isReadOnly?-1:1})),e(t)},error:function(e){a(e),t(e)}})},ue=function(e,t,r){var n=e.config,i={p_flow_id:4e3,p_flow_step_id:0,p_instance:ie().builderSessionId,p_debug:"NO",x01:"create_style",x02:apex.env.APP_ID,x03:ie().themeId,x04:e.id,x05:e.name,x06:JSON.stringify(n),x07:e.pageCssClasses};e.css.length>0&&(i.f01=se(e.css)),o.process("theme_roller",i,{success:function(e){a("new theme created",e),t(e)},error:function(e){a(e),r(e)}})},pe=function(e,t,r){o.process("theme_roller",{p_flow_id:4e3,p_flow_step_id:0,p_instance:ie().builderSessionId,x01:"set_current_style",x02:apex.env.APP_ID,x03:ie().themeId,x04:e},{success:function(e){a("pData",e),t(e)},error:function(e){a(e),r(e)}})},ce=function(e,t,r){var n=e.config,i={p_flow_id:4e3,p_flow_step_id:0,p_instance:ie().builderSessionId,p_debug:"NO",x01:"update_style",x02:apex.env.APP_ID,x03:ie().themeId,x04:e.id,x05:e.name,x06:JSON.stringify(n),x07:e.pageCssClasses};e.css.length>0&&(i.f01=se(e.css)),o.process("theme_roller",i,{success:function(e){a("theme updated",e),t(e)},error:function(e){a(e),r(e)}})},de=new function(){var t=["apex_ui/css/DevTools.css"],r={lessPath:n.APEX_FILES+`libraries/less-js/${i.lessJs}/less`,colorPicker:n.APEX_FILES+"libraries/apex/item.Colorpicker.js",propertyEditor:n.APEX_FILES+"apex_ui/js/widget.propertyEditor.js",codeEditor:n.APEX_FILES+"apex_ui/js/widget.codeEditor.js"};this.init=function(a){t.forEach((t=>{e(`link[href*='${t}']`).length||e(document.createElement("link")).attr({rel:"stylesheet",type:"text/css",href:n.APEX_FILES+t}).appendTo("head")})),o.loadRequirejs().then((()=>{const e={paths:{less:r.lessPath},shim:{less:{deps:[r.propertyEditor,r.codeEditor]}}};void 0===customElements.get("a-color-picker")&&e.shim.less.deps.push(r.colorPicker),require.config(e),require(["less"],(function(){a()}))}))}},fe=new function(){var t,o=this,n=null,i=new function(){var t,o=this;function r(e){var t="_less_variables",o=e&&"object"==typeof e.variables&&!Array.isArray(e.variables)?e.variables:void 0,r=e&&("object"==typeof e.seedVariableNames&&Array.isArray(e.seedVariableNames)||"function"==typeof e.seedVariableNames?e.seedVariableNames:[]);if(void 0!==o){var n=function(e){this._visitor=new less.visitors.Visitor(this),this._context=e};n.prototype={isReplacing:!1,isPreEvalVisitor:!0,isPreVisitor:!1,run:function(e){var o=Object.keys(e.variables());("function"==typeof r?r.apply():r).forEach((function(e){-1===o.indexOf(e)&&o.push(e)}));var n=o.map((function(e){return void 0===e?"":e.substr(1)+":"+e+";"})),i=t+"{"+n.join(" ")+"}";return this._context.parse(i,{},(function(t,o){t&&a(t),e.rules.push(o.rules[0])})),this._visitor.visit(e)}};var i=function(e){this._visitor=new less.visitors.Visitor(this),this._context=e};i.prototype={isReplacing:!0,isPreEvalVisitor:!1,isPreVisitor:!1,run:function(e){return this._visitor.visit(e)},_lFlattenValue:function(e,t){var o=this;return e instanceof less.tree.Node?void 0!==e.value&&Array.isArray(e.value)?1===e.value.length?o._lFlattenValue(e.value[0],t):e.value.map((function(e){return o._lFlattenValue(e,t)})):e.toCSS?o._lFlattenValue(e.toCSS(t),t):e.eval?this._lFlattenValue(e.eval(t),t):void 0:e},visitRuleset:function(e){var r=this;return e.selectors&&e.selectors[0]&&e.selectors[0].elements&&e.selectors[0].elements[0]&&e.selectors[0].elements[0].value===t?void e.rules.forEach((function(e){o["@"+e.name]=r._lFlattenValue(e.value,new less.contexts.Eval({}))})):e}};var s={_visitors:[n,i],install:function(e,t){t.addVisitor(new s._visitors[0](e)),t.addVisitor(new s._visitors[1](e))}};return s}throw new Error("ERROR: apex.utr.less.pluginFactories.getVariablesFactory: variables option is mandatory and must be an object")}function n(e){var t=e.comments,o=!!e.trim,r=!!e.parseJson,a="function"===e.commentsFilter?e.commentsFilter:function(){return!0},n=function(e){var t,a;if(a=e.isLineComment?e.value.replace(/^\/\//,""):e.value.replace(/(^\/\*)|(\*\/$)/g,""),o&&(a=a.trim()),r)try{t=JSON.parse(a)}catch(e){t=a}else t=a;return t},i=function(e){this._visitor=new less.visitors.Visitor(this),this._context=e};i.prototype={isReplacing:!1,isPreEvalVisitor:!0,isPreVisitor:!1,run:function(e){return this._visitor.visit(e)},visitComment:function(e){var i=n(e,{trim:o,parseJson:r});return a(i)&&t.push(i),e}};var s={_visitors:[i],install:function(e,t){t.addVisitor(new i(e))}};return s}var i=null;function s(e){var t=!!e,o=function(e){this._visitor=new less.visitors.Visitor(this),this._context=e};o.prototype={isReplacing:!0,isPreEvalVisitor:!1,isPreVisitor:!1,run:function(e){return this._visitor.visit(e)},visitComment:function(e){return!t&&e.value.length>=3&&"!"===e.value.substr(2,1)?e:void 0}};var r={_visitors:[o],install:function(e,t){t.addVisitor(new r._visitors[0](e))}};return r}function l(e,t,o,a){return{lessOptions:{globalVars:[],modifyVars:{},plugins:[n({comments:t,trim:!0,parseJson:!0,commentsFilter:function(e){return"object"==typeof e&&null!==e&&!Array.isArray(e)&&Object.prototype.hasOwnProperty.call(e,"groups")}}),n({comments:e,trim:!0,parseJson:!0,commentsFilter:function(e){return"object"==typeof e&&null!==e&&!Array.isArray(e)&&Object.prototype.hasOwnProperty.call(e,"var")}}),n({comments:o,trim:!0,parseJson:!0,commentsFilter:function(e){return"object"==typeof e&&null!==e&&!Array.isArray(e)&&Object.prototype.hasOwnProperty.call(e,"translate")}}),r({variables:a,seedVariableNames:function(){return e.map((function(e){return e.var}))}}),s(!1)]},lVarComments:e,lGroupsComments:t,lTranslateComments:o,lVariables:a}}o.compileTheme=function(r,n,s,u){t=r,i=l([],[],[],{}),o.compilerOptions=i,n.config=e.extend(!0,{vars:{},classes:[],customCSS:""},n.config),n.pageCssClasses=n.pageCssClasses||"",Object.keys(n.config.vars).forEach((function(e){var t=n.config.vars[e];i.lessOptions.modifyVars[e]=t})),a("compilerOptions.lessOptions",i.lessOptions),less.render(r,i.lessOptions,(function(t,o){if(t)return a(t),u(t);var r=[];i.lGroupsComments.forEach((function(t){t.groups&&t.groups.forEach((function(t){var o=e.extend(!0,{common:!0},t),a=r.indexOf(o.name);-1===a?(r.push(o.name),r.push(o)):r[a]=o}))}));var l={};i.lVarComments.forEach((function(t){t.target===q?l[t.name]=t:t.var&&(l[t.var]=e.extend(!0,{target:z},t));const o=t.group;-1===r.indexOf(o)&&(r.push(o),r.push({name:o}))})),Object.keys(i.lVarComments).forEach((function(e){Object.prototype.hasOwnProperty.call(i.lVariables,e)&&(l[e]||(l[e]={}),l[e].value=i.lVariables[e])})),s({lessOutput:o,groups:r,varsDescription:l,comments:i.lVarComments,vars:i.lVariables,classes:n.config.classes}),u(t)}))},o.recompile=function(e,o){i.lessOptions.modifyVars=e,less.render(t,i.lessOptions,(function(e,t){e?a(e):o(t)}))},o.getCurrentThemeContent=function(){return t}},y=new function(){var e=this,t={};e.reset=function(){t={}},e.resetWith=function(e){t=e},e.set=function(e,o){t[e]=o},e.get=function(e){return t[e]},e.values=function(){return t}},P=null,j=null,B=!1;K=new function(){var e=[],t=this,o=0;t.getValue=function(t){var o=e.find((function(e){return e.name===t}));return o?o.value:null},t.totalCount=function(){return e.length},t.push=function(t){e.length=o,e[o]=t,o+=1},t.redo=function(){if(o<e.length){var t=o;o+=1,e[t].redo()}},t.undo=function(){o>0&&e[o-=1].undo()},t.hasChanges=function(){return e.length>0},t.hasChangesToUndo=function(){return o>0},t.hasChangesToRedo=function(){return o<e.length},t.clear=function(){o=0,e.length=0}},0===e("#"+E).length&&e("head").append(e('<style id="'+E+'" type="text/css"></style>'));0===e("#"+C).length&&e("body").append(e('<style id="'+C+'" type="text/css"></style>'));function $(){return e("#"+l)}function Y(t,o){var r=apex.widget.waitPopup();W(t,(function(){var t=$().find("div.a-PropertyEditor-wrapper");t&&t.length>0&&t.removeAttr("style").removeClass("a-PropertyEditor-wrapper"),e("button.a-Button--stickyFilter").hide(),o&&o(),r&&(r.remove(),r=null)}),(function(){r&&(r.remove(),r=null)}))}function W(t,o,r){le((function(e){P=e,j||(j=e.find((function(e){return e.isCurrent}))),Te(t||j.id,o,r)}),(function(){ve(me("UTR.ERROR.LOAD_FAILED"),g),e("#"+b).hide(),e("#"+R).hide(),e("#"+T).hide(),e("#"+_).hide(),J&&(J.remove(),J=null)}))}function Q(t){var o;!function(t){var o=t.groups,r=t.varsDescription,i=[],s=[],l=[],m=[];Object.keys(r).forEach((function(e){var o=r[e];if(o.target===z)o.value=t.vars[e];else if(o.target===q)if(o.options&&o.options.length){var n=o.options.find((e=>t.classes.includes(e.r)));o.value=n?n.r:o.options[0].r}else a.warn("The class target can only be applied to select lists with at least 1 option"),o.value="";if(l.push(o),o.subgroup){var i=o.group+"."+o.subgroup;i in s?s[i].push(o):s[i]=[o]}}));for(var v=0;v<o.length;v++){var g=o[v],h=typeof g;"undefined"!==h&&"string"!==h&&(g.variables=l.filter((function(e){return e&&e.group===g.name})),i.push(g))}var y=P.map((function(e){return{d:e.name+(_e(e)?"":" *")+(e.isCurrent?" ("+me(X)+")":""),r:e.id}}));if(m.push({displayGroupId:p,displayGroupTitle:me(k),collapsed:!1,properties:[{propertyName:"currentTheme.id",value:j.id,errors:[],warnings:[],hasChanged:!1,metaData:{type:"SELECT LIST",prompt:me(w),subtype:"theme selector",isCommon:!0,isRequired:!0,lovValues:y}},{propertyName:d,value:me(N),errors:[],warnings:[],metaData:{displayGroupId:1,type:x,prompt:"",isCommon:!0,isRequired:!1,isReadOnly:!0}}]}),i.forEach((function(t){var o=[],r={displayGroupId:t.name,displayGroupTitle:me(t.name),collapsed:!0,properties:o},a=[];m.push(r),t.variables.forEach((function(r){var n=null,i=r.var,l=r.name,u=i||l;if(r.subgroup){var p=r.group+"."+r.subgroup;if(!a.includes(p)){var c=[];s[p].forEach((function(e){c.push({label:e.name,name:e.var,value:e.value})})),n={propertyName:c.map((function(e){return e.name})).join(","),value:c.map((function(e){return e.value})).join(","),label:c.map((function(e){return me(e.label)})).join(","),errors:[],warnings:[],metaData:{displayGroupId:t.name,type:V,prompt:me(r.subgroup),colors:c,isCommon:!0,isRequired:!0,isModVar:!0}},a.push(p)}}else switch(r.type){case"number":n={propertyName:u,value:r.value,errors:[],warnings:[],metaData:{displayGroupId:t.name,type:S,prompt:me(r.name),isCommon:!0,isRequired:!0,increment:r.range.increment,units:r.units,max:r.range.max,min:r.range.min,isModVar:!0}};break;case"color":n={propertyName:u,value:r.value,label:me(r.name),errors:[],warnings:[],metaData:{displayGroupId:t.name,type:D,prompt:me(r.name),isCommon:!0,isRequired:!0,color:r.var,isModVar:!0}};break;case"select":for(var d=[],f=0;f<r.options.length;f++)d.push({d:me(r.options[f].d),r:r.options[f].r});n={propertyName:u,value:r.value,errors:[],warnings:[],metaData:{displayGroupId:t.name,type:"SELECT LIST",prompt:me(r.name),isCommon:!0,isRequired:!0,lovValues:d,isModVar:!0}};break;default:n={propertyName:u,value:"",errors:[],warnings:[],metaData:{displayGroupId:t.name,type:e.apex.propertyEditor.PROP_TYPE.TEXT,prompt:me(r.name),isCommon:!0,isRequired:!0,isModVar:!0}}}null!==n&&(n.metaData.sourceCode=r,o.push(n))}))})),i.length>0){var E=j.config&&j.config.customCSS?j.config.customCSS:"",C=j.config&&j.config.useCustomLess?j.config.useCustomLess:"N";m.push({displayGroupId:u,displayGroupTitle:me(I),collapsed:!0,properties:[{propertyName:c,value:E,errors:[],warnings:[],metaData:{type:O,prompt:"",isCommon:!0,isRequired:!0,isModVar:!1}},{propertyName:f,value:C,errors:[],warnings:[],metaData:{type:e.apex.propertyEditor.PROP_TYPE.YES_NO,noValue:"N",yesValue:"Y",prompt:me(L),isCommon:!0,isRequired:!0,isModVar:!1}}]})}$().propertyEditor("option","data",{propertySet:m,componentCount:[]}),n._trigger("updateExpandedGroups")}({groups:t.groups,varsDescription:t.varsDescription,vars:t.vars,classes:t.classes}),$().parent().find('input.a-Property-field--filter[type="search"]').on("keyup focusout",(function(t){$().propertyEditor("search",e(t.target).val())})),o=$().find('div[data-property-id="'+d+'"]').parent(),_e(j)?o.hide():o.show(),se()}function ie(e){var t=e.config&&e.config.customCSS?e.config.customCSS:"";e.config&&e.config.useCustomLess&&"Y"===e.config.useCustomLess?less.render(t).then((function(e){xe(e.css)})):xe(t)}function se(){_e(j)?(e("#"+R).show(),e("#"+T).show(),e("#"+_).show()):(e("#"+R).hide(),e("#"+T).hide(),e("#"+_).hide()),e("#"+b).prop("disabled",j.isCurrent&&!K.hasChangesToUndo()),e("#"+T).prop("disabled",!K.hasChangesToUndo()),e("#"+_).prop("disabled",!K.hasChangesToRedo())}function de(t,o,r){!function(t,o){var r=[];0===t.length&&o(r);t.forEach((function(n,i){e.get(n,(function(e){if(r.push({i:i,response:e}),r.length===t.length){r.sort((function(e,t){return t.i-e.i}));var a=r.reduce((function(e,t){return e.push(t.response),e}),[]);o(a)}}),"text").fail((function(e){a(e),o([],e)}))}))}(t.inputFileUrls,(function(e,t){t?r(t):o(e.join(""))}))}function fe(t,o){e("body").addClass(o).removeClass(t),j.config.classes.push(o),j.config.classes=j.config.classes.filter((function(e){return-1===t.split(" ").indexOf(e)}));let r=j.pageCssClasses.split(" ");r.push(o),r=r.filter((function(e){return-1===t.split(" ").indexOf(e)})),j.pageCssClasses=[...new Set(r)].join(" "),se()}function ge(e){apex.devToolbar.dismissNotification();var t=e.metaData.subtype,o={oldValue:e.oldValue,value:e.value};"theme selector"===t?K.hasChanges()?s.confirm(me("UTR.STYLE_CHANGE.CONFIRM"),(function(t){t?(Te(e.value),K.clear()):$().propertyEditor("updatePropertyValue",e.propertyName,o.oldValue,!0)})):(Te(e.value),K.clear()):e.metaData&&e.metaData.sourceCode&&e.metaData.sourceCode.target===q?(fe(o.oldValue,o.value),K.push({undo:function(){fe(o.value,o.oldValue),$().propertyEditor("updatePropertyValue",e.propertyName,o.oldValue,!0)},redo:function(){fe(o.oldValue,o.value),$().propertyEditor("updatePropertyValue",e.propertyName,o.value,!0)}}),se()):!1!==e.metaData.isModVar||e.propertyName!==c&&e.propertyName!==f?(K.push({undo:function(){$().propertyEditor("updatePropertyValue",e.propertyName,o.oldValue,!0),Ce(e.propertyName,o.oldValue)},redo:function(){$().propertyEditor("updatePropertyValue",e.propertyName,o.value,!0),Ce(e.propertyName,o.value)}}),Ce(e.propertyName,e.value)):(j.config||(j.config={}),e.propertyName===f?(j.config.useCustomLess=e.value,j.config.customCSS=$().propertyEditor("getProperty",c).value,K.push({undo:function(){$().propertyEditor("updatePropertyValue",e.propertyName,o.oldValue,!0),j.config.useCustomLess=o.oldValue,ie(j)},redo:function(){$().propertyEditor("updatePropertyValue",e.propertyName,o.value,!0),j.config.useCustomLess=o.value,ie(j)}})):e.propertyName===c&&(j.config.useCustomLess=$().propertyEditor("getProperty",f).value,j.config.customCSS=H.codeEditor("getValue"),K.push({undo:function(){$().propertyEditor("updatePropertyValue",e.propertyName,o.oldValue,!0),j.config.customCSS=o.oldValue,ie(j)},redo:function(){$().propertyEditor("updatePropertyValue",e.propertyName,o.value,!0),j.config.customCSS=o.value,ie(j)}})),ie(j),se()),ye()}function he(){n._trigger("progressReset")}function ye(){if(!B){var e=Oe();n._trigger("progressUpdate",null,{themeId:e.id,config:e.config})}}function Ee(){var e,t=$(),o=t.propertyEditor("option","data").propertySet,r=i.compilerOptions.lVariables;e=o.map((e=>e.properties.map((e=>e.propertyName)))).flat().filter((e=>e.startsWith("@")));var n=a.getLevel();a.setLevel(a.LOG_LEVEL.OFF),e.forEach((e=>{var o="";e.split(",").forEach((e=>{o+=(o?",":"")+r[e]})),t.propertyEditor("updatePropertyValue",e,o,!0)})),a.setLevel(n)}function Ce(e,t){var o=e.split(","),r=t.split(",");o.forEach(((e,t)=>{y.set(o[t],r[t])})),i.recompile(y.values(),(function(){Ee(),be.apply(this,arguments)})),se()}function Te(t,o,r){var a=apex.widget.waitPopup(),n=j;j=P.find((function(e){return e.id===t})),y.resetWith(j.config&&j.config.vars||{}),xe(""),de(j,(function(t){i.compileTheme(t,j,(function(t){var r;ye(),n.id!==j.id&&(ee=!0),e("body").removeClass(n.pageCssClasses).addClass(j.pageCssClasses),Q(t),[...(r=n).cssFileUrls,...r.outputFileUrls].forEach((function(t){e(`link[href="${t}"]`).remove()})),function(t){[...t.cssFileUrls].forEach((function(t){e('<link rel="stylesheet" type="text/css"></link>').attr("href",t).insertBefore(Re())}))}(j),be(t.lessOutput),ie(j),a&&(a.remove(),a=null),o&&o()}),(function(e){e&&(a&&(a.remove(),a=null),o&&o(),ve(me("UTR.ERROR.THEME_STYLE_WITH_ERRORS").replace("%0",j.name),g))}))}),(function(e){e&&(a&&(a.remove(),a=null),r&&r(),ve(me("UTR.ERROR.THEME_STYLE_URL_ERROR").replace("%0",j.name),g))}))}function _e(e){if(e.inputFileUrls&&e.inputFileUrls.length>0)for(var t=e.inputFileUrls.length-1;t>=0;t--)if(o=e.inputFileUrls[t],r=".less",-1!==o.indexOf(r,o.length-r.length))return!0;var o,r;return!1}function be(e){Re().text(e.css)}function Re(){return e("#"+E)}function Pe(){return Re().text()}function xe(t){return e("#"+C).text(t)}function Oe(){return{id:j.id,name:j.name,css:Pe(),config:{classes:j.config&&j.config.classes||[],vars:y.values(),customCSS:j.config&&j.config.customCSS||"",useCustomLess:$().propertyEditor("getProperty",f).value}}}function Se(){return{id:j.id,name:j.name,css:[Pe(),e("#"+C).text()].filter((e=>e)).join("\n"),pageCssClasses:j.pageCssClasses,config:{classes:j.config.classes,vars:y.values(),customCSS:$().propertyEditor("getProperty",c).value,useCustomLess:$().propertyEditor("getProperty",f).value}}}function De(e){for(var t=1;t<1e3;t++){var o=e+" ("+me("copy_")+t+")";if(0===Ve(o).length){e=o;break}}return e}function Ve(e){return P.map((function(e){return e.name})).filter((function(t){return t===e}))}o.init=function(e,a){var i,s;t=e,n=a,te(),oe(),re(),ae(),ne(),t.find(".apex-rds-hover").hide(),$().propertyEditor({searchable:!0,data:{propertySet:[],componentCount:[]},change:function(e,t){ge(t.property)},expand:function(e,t){t.displayGroupId===u&&H.resize(),n._trigger("updateExpandedGroups")},collapse:function(){n._trigger("updateExpandedGroups")}}).on("scroll",r.debounce((function(){n._trigger("updateScrollTop")}),100)),ee=!1,i=null,n.options.progressThemeId&&(i=n.options.progressThemeId,s=function(){B=!0,o.config(n.options.progressConfig),B=!1;var e=n.options.progressExpandedGroups;e&&e.forEach((function(e){$().propertyEditor("expand",e)})),n.options.progressScrollTop&&$().scrollTop(n.options.progressScrollTop)}),Y(i,s)},o.config=function(e){!function(e){if(e){if("string"==typeof e)try{e=JSON.parse(e)}catch(e){throw a(me(F)),new Error}if(void 0===e.classes||void 0===e.vars||void 0===e.customCSS)throw a(me(F)),new Error;if(Z||console.log(e),j.config.useCustomLess=e.useCustomLess||"N",$().propertyEditor("updatePropertyValue",f,j.config.useCustomLess,!1),j.config.customCSS=e.customCSS||"",$().propertyEditor("updatePropertyValue",c,j.config.customCSS,!1),j.config.classes=e.classes||[],j.config.classes.length){var t=function(e,t){return e.filter((function(e){return-1!==t.indexOf(e)}))},o=$().propertyEditor("instance"),r=o.propMap;for(var n of Object.values(r))if("SELECT LIST"===n.metaData.type){var s=n.metaData.sourceCode;if(s&&"class"===s.target){var l=t(s.options.map((e=>e.r)),j.config.classes);l.length&&o._getElement(n).val(l[0]).trigger("change")}}}for(var u in e.vars)Object.prototype.hasOwnProperty.call(e.vars,u)&&$().propertyEditor("updatePropertyValue",u,e.vars[u],!1);y.resetWith(e.vars),i.recompile(y.values(),(function(){be.apply(this,arguments),ie(j),Ee(),ye()}))}else Z||console.log(me("UTR.CONFIG_OUTPUT")+"\n\napex.utr.config("+JSON.stringify(Oe().config)+");");Z=!1}(e)},o.recompileWith=function(e,t){Ce(e,t)},o.reset=function(){he(),W(j.id,(function(){K.clear(),se()}))},o.redo=function(){K.redo(),ye()},o.undo=function(){K.undo(),ye()},o.reloadPage=function(){ee&&location.reload(),ee=!1},o.upload=function(){he();const t="a-ThemeRoller-upload-file";e("#"+t).remove(),e("#"+h).after(`<input id="${t}" type="file" accept=".json" class="file apex-item-file apex-item-file--inline"></input>`),e("#"+t).trigger("click").on("change",(function(){const e=document.getElementById(t).files[0],o=new FileReader;o.onload=function(e){const t=e.target.result;try{Z=!0,apex.utr.config(JSON.parse(t)),ve(me(A),m)}catch(e){return ve(me(F),v),!1}},o.readAsText(e),document.getElementById(t).value=null}))},o.download=function(){Z=!0,apex.utr.config();const e=JSON.stringify(Oe().config),t=document.createElement("a");t.setAttribute("href","data:application/json;charset=utf-8,"+encodeURIComponent(e)),t.setAttribute("download",j.name.toLowerCase().replace(/[/:*?"<>| \\;,]/g,"-").replace(/-{2,}/g,"-")+".json"),t.click()},o.saveAs=function(){var t,o,r;he(),t={message:me("UTR.SAVE_AS.PROMPT"),property:{name:me("UTR.COMMON.STYLE_NAME"),value:De(j.name)},onSave:function(e){!function(e){var t=e.find("input");if(e.find("div").removeClass("is-error"),Ve(t.val()).length>0)t.val(De(t.val())),ve(me("WWV_FLOW_THEME_DEV.WWV_FLOW_THEME_STYLE_UK"),v);else{var o=Se();o.name=t.val(),ue(o,(function(t){W(t.id,(function(){pe(j.id,(function(){e.dialog("close"),Y(),ve(me("UTR.SAVE_AS.SUCCESS"),m),ee=!0}))}))}),(function(){J&&J.remove(),ve(me("UTR.ERROR.CREATE_FAILED"),g)}))}}(e),K.clear()},title:me(G)},o=e("<div/>").append(e("<div/>").addClass("a-Property-message").text(t.message)).addClass("a-PropertyEditor-propertyGroup-body").append(e("<div/>").addClass("a-Property").append(e("<span/>").addClass("a-Icon").addClass("icon-required").attr("aria-hidden",!0)).append(e("<div/>").addClass("a-Property-labelContainer").append(e("<label/>").addClass("a-Property-label").addClass("a-Property-label--withIcon").attr("for","te-new-theme-name").text(t.property.name).prepend(e("<span/>").addClass("a-Icon").addClass("icon-error")))).append(e("<div/>").addClass("a-Property-fieldContainer").append(e("<input/>").attr("id","te-new-theme-name").attr("type","text").val(t.property.value).addClass("a-Property-field").addClass("a-Property-field--text")))),(r=e("<div/>").addClass("a-DevTools-container").addClass("apex-rds-container").append(e("<div/>").addClass("a-DevTools-container__body").append(o))).dialog({title:t.title,autoOpen:!0,dialogClass:"a-DevTools",modal:!0,appendTo:"body",buttons:[{text:me(U),class:"a-Button a-DevTools-toolbar-item a-DevTools-toolbar-item--right a-DevTools-toolbar-item--push a-DevTools-toolbar-button",click:function(){e(this).dialog("close")}},{text:me(M),class:"a-Button a-Button--hot ui-button--hot a-DevTools-toolbar-item a-DevTools-toolbar-item--right a-DevTools-toolbar-button",click:function(){t.onSave(r)}}]}),r.find(".icon-error").hide()},o.save=function(){var e,t=function(){e=apex.widget.waitPopup()},r=function(){e&&(e.remove(),e=null)};if(he(),j.isReadOnly){if(!K.hasChangesToUndo())return t(),void pe(j.id,(function(){r(),ve(me("UTR.SET_AS_CURRENT_THEME_STYLE_SUCCESS"),m),Y()}),(function(){r(),ve(me("UTR.ERROR.SET_AS_CURRENT_FAILED"),g)}));o.saveAs()}else t(),ce(Se(),(function(){j.isCurrent?(r(),ve(me(A),m)):pe(j.id,(function(){r(),ve(me(A),m)})),K.clear(),se(),ee=!0}),(function(){r(),ve(me("UTR.ERROR.UPDATE_FAILED"),g)}))}};function me(e){return t.getMessage(e)}function ve(t,o){apex.devToolbar.notification(e("#themeRollerDialog"),t,o)}e.widget("apex.themeRoller",{_dialogContentView$:null,_status:null,_create:function(){var t=this,o=t.options;de.init((function(){var a=e('<div id="themeRollerDialog" class="a-DevTools-content"></div>');a.find(".apex-rds-hover").hide(),t.element.append(a);var n=e(W.replace("TEMPLATE_ID",l));a.append(n),a.dialog({autoOpen:!0,title:me("UTR.THEME_ROLLER"),dialogClass:"a-DevTools",resizable:!0,draggable:!0,minWidth:320,minHeight:420,width:o.dialogSize?o.dialogSize.width:void 0,height:o.dialogSize?o.dialogSize.height:void 0,position:o.dialogPosition?{my:"left top",at:`left+${o.dialogPosition.left} top+${o.dialogPosition.top}`,of:e("body")}:{my:"right top",at:"right-12 top+92",of:e(window)},closeOnEscape:!0,resize:r.debounce((function(){H.trigger("resize"),t._trigger("updateSize")}),100),drag:r.debounce((function(){t._trigger("updatePosition")}),100),buttons:[{id:T,text:me(B),title:me(B),class:"a-Button a-DevTools-toolbar-item a-DevTools-toolbar-item--left a-DevTools-toolbar-button",click:function(){fe.undo()}},{id:_,text:me($),title:me($),class:"a-Button a-DevTools-toolbar-item a-DevTools-toolbar-item--left a-DevTools-toolbar-button",click:function(){fe.redo()}},{id:b,text:me(M),title:me(M),class:"a-Button a-Button--hot a-DevTools-toolbar-item a-DevTools-toolbar-item--right a-DevTools-toolbar-button a-DevTools-toolbar-item--push",click:function(){fe.save()}},{id:R,text:me(G),title:me(G),class:"a-Button a-DevTools-toolbar-item a-DevTools-toolbar-item--right a-DevTools-toolbar-button",click:function(){fe.saveAs()}},{id:P,title:me(j),class:"a-Button a-DevTools-toolbar-item a-DevTools-toolbar-item--left a-DevTools-toolbar-button js-menuButton","data-menu":h,"aria-label":me(j),click:function(){}}],close:function(){t._trigger("close"),ee=ee||K.hasChangesToUndo()}}),e("body").find("#"+P).html('<span class="a-Icon icon-actions" aria-hidden="true"></span>'),e("#"+P).after('<div class="a-DevToolbar-menu a-Menu" id="'+h+'"> </div>');const i=e("#"+h);i.appendTo("body").menu({items:[{type:"action",label:me("UTR.IMPORT"),action:fe.upload},{type:"action",label:me("UTR.EXPORT"),action:fe.download},{id:y,type:"action",label:me("UTR.RESET"),disabled:!K.hasChanges(),action:fe.reset}],beforeOpen:function(){i.menu("find",y).disabled=!K.hasChanges()}}),e.apex.propertyEditor.setMessagePrefix("APEXDEV.PE."),fe.init(a,t),e("#"+l).before('<div id="themeRollerDialog-search" class="a-DevTools-search"><div class="a-Toolbar-items--left"></div>'),e("body").find("#"+T).html('<span class="a-Icon icon-tr-undo" aria-hidden="true"></span>'),e("body").find("#"+_).html('<span class="a-Icon icon-tr-redo" aria-hidden="true"></span>'),e("#"+R).hide(),t._status="READY",t._dialogContentView$=a,t._trigger("open")})),Q=o.config},isReady:function(){return"READY"===this._status},toggle:function(){this.isOpen()?this.close():this.open()},close:function(){this._dialogContentView$.dialog("close")},isOpen:function(){return this._dialogContentView$.dialog("isOpen")},open:function(){this._dialogContentView$.dialog("open"),this._trigger("open")},getDialogPosition:function(){return this._dialogContentView$.dialog("widget").position()},getDialogSize:function(){return{height:this._dialogContentView$.height(),width:this._dialogContentView$.width()}},getExpandedGroups:function(){return e(".a-PropertyEditor-propertyGroup.is-expanded",e("#"+l)).map(((t,o)=>e(o).attr("data-group-id"))).get()},getScrollTop:function(){return e("#"+l).scrollTop()}}),apex.utr=fe}(apex.jQuery,apex.lang,apex.server,apex.util,apex.debug,apex.env,apex.libVersions,apex.message);