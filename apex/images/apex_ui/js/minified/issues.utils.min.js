/*!
 * Copyright (c) 2019, 2021, Oracle and/or its affiliates.
 */
apex.issues={},function(e){"use strict";function a(e){e.toolbar.data[0].controls.unshift({type:"BUTTON",label:apex.lang.getMessage("APEX.ISSUES.JS.HEADING"),iconOnly:!0,icon:"fa fa-header",action:"addHeader"})}function t(e,a){var t=window.location.href.split("?")[0],n=$v(a);return t+="?p=4600:100:"+apex.env.APP_SESSION+":APPLICATION_PROCESS=getAttachment:NO::P100_ISSUE_ID,P100_FILE_NAME_SLUG:"+n+","+e}apex.issues={addHeadButton:a,replacePrefixImage:function(e,a){for(var n="(#ISSUE_FILE#",i=[],o=0;o<e.length;o++){var r=e.indexOf(n,o);if(r>=0){var l=e.indexOf(")",r+1);if(l<0){o=r+13;continue}var s=e.substring(r+13,l);i.push({imageName:s,path:t(s,a)}),o=l+1}else o=e.length}return i.forEach((function(a){e=e.replace(n+a.imageName+")","("+a.path+")")})),e},addAttachButton:function(t,n,i,o){var r=$v(n);a(t),"Y"===r&&t.toolbar.data[t.toolbar.data.length-1].controls.unshift({type:"BUTTON",label:apex.lang.getMessage("APEX.ISSUES.JS.ATTACH_FILES"),iconOnly:!0,icon:"fa fa-paperclip",action:"attach_files"}),t.toolbar.actions.push({name:"attach_files",action:function(){var a="apexclosedialoginternal";window.location.assign($v(o)),apex.util.getTopApex().gPageContext$.off(a).on(a,(function(a,t){var n,o,r,l,s,c;if(t&&t.P109_FILES_INFO){for(r=(n=JSON.parse(t.P109_FILES_INFO)).length,o=0;o<r;o++){s=(l=n[o]).n,c="#ISSUE_FILE#"+l.slug;let e=(l.isImage?"!":"")+"["+s+"]("+c+")";var f=apex.item(i),u=f.getValue();f.setValue(u+e)}e("#issueTimeline").trigger("apexrefresh")}}))}})}}}(apex.jQuery);